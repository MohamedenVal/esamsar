(self.webpackChunkesemsar=self.webpackChunkesemsar||[]).push([[179],{8255:Cn=>{function Dt(xe){return Promise.resolve().then(()=>{var $=new Error("Cannot find module '"+xe+"'");throw $.code="MODULE_NOT_FOUND",$})}Dt.keys=()=>[],Dt.resolve=Dt,Dt.id=8255,Cn.exports=Dt},8583:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{mr:()=>cn,ez:()=>Ao,H9:()=>Go,K0:()=>ze,uU:()=>mi,Do:()=>vr,V_:()=>ge,Ye:()=>hn,S$:()=>qt,mk:()=>Eo,sg:()=>pi,O5:()=>Lo,b0:()=>jt,lw:()=>Me,EM:()=>an,JF:()=>Ti,w_:()=>nt,bD:()=>po,q:()=>Rt,Mx:()=>Gr,HT:()=>Qe});var $=xe(639);let y=null;function Rt(){return y}function Qe(H){y||(y=H)}class nt{}const ze=new $.OlP("DocumentToken");let Me=(()=>{class H{historyGo(G){throw new Error("Not implemented")}}return H.\u0275fac=function(G){return new(G||H)},H.\u0275prov=(0,$.Yz7)({factory:qe,token:H,providedIn:"platform"}),H})();function qe(){return(0,$.LFG)(Ye)}const ge=new $.OlP("Location Initialized");let Ye=(()=>{class H extends Me{constructor(G){super(),this._doc=G,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Rt().getBaseHref(this._doc)}onPopState(G){const S=Rt().getGlobalEventTarget(this._doc,"window");return S.addEventListener("popstate",G,!1),()=>S.removeEventListener("popstate",G)}onHashChange(G){const S=Rt().getGlobalEventTarget(this._doc,"window");return S.addEventListener("hashchange",G,!1),()=>S.removeEventListener("hashchange",G)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(G){this.location.pathname=G}pushState(G,S,k){Xe()?this._history.pushState(G,S,k):this.location.hash=k}replaceState(G,S,k){Xe()?this._history.replaceState(G,S,k):this.location.hash=k}forward(){this._history.forward()}back(){this._history.back()}historyGo(G=0){this._history.go(G)}getState(){return this._history.state}}return H.\u0275fac=function(G){return new(G||H)($.LFG(ze))},H.\u0275prov=(0,$.Yz7)({factory:Ct,token:H,providedIn:"platform"}),H})();function Xe(){return!!window.history.pushState}function Ct(){return new Ye((0,$.LFG)(ze))}function _t(H,ie){if(0==H.length)return ie;if(0==ie.length)return H;let G=0;return H.endsWith("/")&&G++,ie.startsWith("/")&&G++,2==G?H+ie.substring(1):1==G?H+ie:H+"/"+ie}function Vt(H){const ie=H.match(/#|\?|$/),G=ie&&ie.index||H.length;return H.slice(0,G-("/"===H[G-1]?1:0))+H.slice(G)}function ut(H){return H&&"?"!==H[0]?"?"+H:H}let qt=(()=>{class H{historyGo(G){throw new Error("Not implemented")}}return H.\u0275fac=function(G){return new(G||H)},H.\u0275prov=(0,$.Yz7)({factory:Dn,token:H,providedIn:"root"}),H})();function Dn(H){const ie=(0,$.LFG)(ze).location;return new jt((0,$.LFG)(Me),ie&&ie.origin||"")}const cn=new $.OlP("appBaseHref");let jt=(()=>{class H extends qt{constructor(G,S){if(super(),this._platformLocation=G,this._removeListenerFns=[],null==S&&(S=this._platformLocation.getBaseHrefFromDOM()),null==S)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=S}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(G){this._removeListenerFns.push(this._platformLocation.onPopState(G),this._platformLocation.onHashChange(G))}getBaseHref(){return this._baseHref}prepareExternalUrl(G){return _t(this._baseHref,G)}path(G=!1){const S=this._platformLocation.pathname+ut(this._platformLocation.search),k=this._platformLocation.hash;return k&&G?`${S}${k}`:S}pushState(G,S,k,I){const K=this.prepareExternalUrl(k+ut(I));this._platformLocation.pushState(G,S,K)}replaceState(G,S,k,I){const K=this.prepareExternalUrl(k+ut(I));this._platformLocation.replaceState(G,S,K)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(G=0){var S,k;null===(k=(S=this._platformLocation).historyGo)||void 0===k||k.call(S,G)}}return H.\u0275fac=function(G){return new(G||H)($.LFG(Me),$.LFG(cn,8))},H.\u0275prov=$.Yz7({token:H,factory:H.\u0275fac}),H})(),vr=(()=>{class H extends qt{constructor(G,S){super(),this._platformLocation=G,this._baseHref="",this._removeListenerFns=[],null!=S&&(this._baseHref=S)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(G){this._removeListenerFns.push(this._platformLocation.onPopState(G),this._platformLocation.onHashChange(G))}getBaseHref(){return this._baseHref}path(G=!1){let S=this._platformLocation.hash;return null==S&&(S="#"),S.length>0?S.substring(1):S}prepareExternalUrl(G){const S=_t(this._baseHref,G);return S.length>0?"#"+S:S}pushState(G,S,k,I){let K=this.prepareExternalUrl(k+ut(I));0==K.length&&(K=this._platformLocation.pathname),this._platformLocation.pushState(G,S,K)}replaceState(G,S,k,I){let K=this.prepareExternalUrl(k+ut(I));0==K.length&&(K=this._platformLocation.pathname),this._platformLocation.replaceState(G,S,K)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(G=0){var S,k;null===(k=(S=this._platformLocation).historyGo)||void 0===k||k.call(S,G)}}return H.\u0275fac=function(G){return new(G||H)($.LFG(Me),$.LFG(cn,8))},H.\u0275prov=$.Yz7({token:H,factory:H.\u0275fac}),H})(),hn=(()=>{class H{constructor(G,S){this._subject=new $.vpe,this._urlChangeListeners=[],this._platformStrategy=G;const k=this._platformStrategy.getBaseHref();this._platformLocation=S,this._baseHref=Vt(li(k)),this._platformStrategy.onPopState(I=>{this._subject.emit({url:this.path(!0),pop:!0,state:I.state,type:I.type})})}path(G=!1){return this.normalize(this._platformStrategy.path(G))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(G,S=""){return this.path()==this.normalize(G+ut(S))}normalize(G){return H.stripTrailingSlash(function(H,ie){return H&&ie.startsWith(H)?ie.substring(H.length):ie}(this._baseHref,li(G)))}prepareExternalUrl(G){return G&&"/"!==G[0]&&(G="/"+G),this._platformStrategy.prepareExternalUrl(G)}go(G,S="",k=null){this._platformStrategy.pushState(k,"",G,S),this._notifyUrlChangeListeners(this.prepareExternalUrl(G+ut(S)),k)}replaceState(G,S="",k=null){this._platformStrategy.replaceState(k,"",G,S),this._notifyUrlChangeListeners(this.prepareExternalUrl(G+ut(S)),k)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(G=0){var S,k;null===(k=(S=this._platformStrategy).historyGo)||void 0===k||k.call(S,G)}onUrlChange(G){this._urlChangeListeners.push(G),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(S=>{this._notifyUrlChangeListeners(S.url,S.state)}))}_notifyUrlChangeListeners(G="",S){this._urlChangeListeners.forEach(k=>k(G,S))}subscribe(G,S,k){return this._subject.subscribe({next:G,error:S,complete:k})}}return H.\u0275fac=function(G){return new(G||H)($.LFG(qt),$.LFG(Me))},H.normalizeQueryParams=ut,H.joinWithSlash=_t,H.stripTrailingSlash=Vt,H.\u0275prov=(0,$.Yz7)({factory:Kr,token:H,providedIn:"root"}),H})();function Kr(){return new hn((0,$.LFG)(qt),(0,$.LFG)(Me))}function li(H){return H.replace(/\/index.html$/,"")}const Jt={ADP:[void 0,void 0,0],AFN:[void 0,void 0,0],ALL:[void 0,void 0,0],AMD:[void 0,void 0,2],AOA:[void 0,"Kz"],ARS:[void 0,"$"],AUD:["A$","$"],BAM:[void 0,"KM"],BBD:[void 0,"$"],BDT:[void 0,"\u09f3"],BHD:[void 0,void 0,3],BIF:[void 0,void 0,0],BMD:[void 0,"$"],BND:[void 0,"$"],BOB:[void 0,"Bs"],BRL:["R$"],BSD:[void 0,"$"],BWP:[void 0,"P"],BYN:[void 0,"\u0440.",2],BYR:[void 0,void 0,0],BZD:[void 0,"$"],CAD:["CA$","$",2],CHF:[void 0,void 0,2],CLF:[void 0,void 0,4],CLP:[void 0,"$",0],CNY:["CN\xa5","\xa5"],COP:[void 0,"$",2],CRC:[void 0,"\u20a1",2],CUC:[void 0,"$"],CUP:[void 0,"$"],CZK:[void 0,"K\u010d",2],DJF:[void 0,void 0,0],DKK:[void 0,"kr",2],DOP:[void 0,"$"],EGP:[void 0,"E\xa3"],ESP:[void 0,"\u20a7",0],EUR:["\u20ac"],FJD:[void 0,"$"],FKP:[void 0,"\xa3"],GBP:["\xa3"],GEL:[void 0,"\u20be"],GIP:[void 0,"\xa3"],GNF:[void 0,"FG",0],GTQ:[void 0,"Q"],GYD:[void 0,"$",2],HKD:["HK$","$"],HNL:[void 0,"L"],HRK:[void 0,"kn"],HUF:[void 0,"Ft",2],IDR:[void 0,"Rp",2],ILS:["\u20aa"],INR:["\u20b9"],IQD:[void 0,void 0,0],IRR:[void 0,void 0,0],ISK:[void 0,"kr",0],ITL:[void 0,void 0,0],JMD:[void 0,"$"],JOD:[void 0,void 0,3],JPY:["\xa5",void 0,0],KHR:[void 0,"\u17db"],KMF:[void 0,"CF",0],KPW:[void 0,"\u20a9",0],KRW:["\u20a9",void 0,0],KWD:[void 0,void 0,3],KYD:[void 0,"$"],KZT:[void 0,"\u20b8"],LAK:[void 0,"\u20ad",0],LBP:[void 0,"L\xa3",0],LKR:[void 0,"Rs"],LRD:[void 0,"$"],LTL:[void 0,"Lt"],LUF:[void 0,void 0,0],LVL:[void 0,"Ls"],LYD:[void 0,void 0,3],MGA:[void 0,"Ar",0],MGF:[void 0,void 0,0],MMK:[void 0,"K",0],MNT:[void 0,"\u20ae",2],MRO:[void 0,void 0,0],MUR:[void 0,"Rs",2],MXN:["MX$","$"],MYR:[void 0,"RM"],NAD:[void 0,"$"],NGN:[void 0,"\u20a6"],NIO:[void 0,"C$"],NOK:[void 0,"kr",2],NPR:[void 0,"Rs"],NZD:["NZ$","$"],OMR:[void 0,void 0,3],PHP:[void 0,"\u20b1"],PKR:[void 0,"Rs",2],PLN:[void 0,"z\u0142"],PYG:[void 0,"\u20b2",0],RON:[void 0,"lei"],RSD:[void 0,void 0,0],RUB:[void 0,"\u20bd"],RUR:[void 0,"\u0440."],RWF:[void 0,"RF",0],SBD:[void 0,"$"],SEK:[void 0,"kr",2],SGD:[void 0,"$"],SHP:[void 0,"\xa3"],SLL:[void 0,void 0,0],SOS:[void 0,void 0,0],SRD:[void 0,"$"],SSP:[void 0,"\xa3"],STD:[void 0,void 0,0],STN:[void 0,"Db"],SYP:[void 0,"\xa3",0],THB:[void 0,"\u0e3f"],TMM:[void 0,void 0,0],TND:[void 0,void 0,3],TOP:[void 0,"T$"],TRL:[void 0,void 0,0],TRY:[void 0,"\u20ba"],TTD:[void 0,"$"],TWD:["NT$","$",2],TZS:[void 0,void 0,2],UAH:[void 0,"\u20b4"],UGX:[void 0,void 0,0],USD:["$"],UYI:[void 0,void 0,0],UYU:[void 0,"$"],UYW:[void 0,void 0,4],UZS:[void 0,void 0,2],VEF:[void 0,"Bs",2],VND:["\u20ab",void 0,0],VUV:[void 0,void 0,0],XAF:["FCFA",void 0,0],XCD:["EC$","$"],XOF:["CFA",void 0,0],XPF:["CFPF",void 0,0],XXX:["\xa4"],YER:[void 0,void 0,0],ZAR:[void 0,"R"],ZMK:[void 0,void 0,0],ZMW:[void 0,"ZK"],ZWD:[void 0,void 0,0]};var qn=(()=>((qn=qn||{})[qn.Decimal=0]="Decimal",qn[qn.Percent=1]="Percent",qn[qn.Currency=2]="Currency",qn[qn.Scientific=3]="Scientific",qn))(),Mr=(()=>((Mr=Mr||{})[Mr.Zero=0]="Zero",Mr[Mr.One=1]="One",Mr[Mr.Two=2]="Two",Mr[Mr.Few=3]="Few",Mr[Mr.Many=4]="Many",Mr[Mr.Other=5]="Other",Mr))(),In=(()=>((In=In||{})[In.Format=0]="Format",In[In.Standalone=1]="Standalone",In))(),dn=(()=>((dn=dn||{})[dn.Narrow=0]="Narrow",dn[dn.Abbreviated=1]="Abbreviated",dn[dn.Wide=2]="Wide",dn[dn.Short=3]="Short",dn))(),Un=(()=>((Un=Un||{})[Un.Short=0]="Short",Un[Un.Medium=1]="Medium",Un[Un.Long=2]="Long",Un[Un.Full=3]="Full",Un))(),$t=(()=>(($t=$t||{})[$t.Decimal=0]="Decimal",$t[$t.Group=1]="Group",$t[$t.List=2]="List",$t[$t.PercentSign=3]="PercentSign",$t[$t.PlusSign=4]="PlusSign",$t[$t.MinusSign=5]="MinusSign",$t[$t.Exponential=6]="Exponential",$t[$t.SuperscriptingExponent=7]="SuperscriptingExponent",$t[$t.PerMille=8]="PerMille",$t[$t.Infinity=9]="Infinity",$t[$t.NaN=10]="NaN",$t[$t.TimeSeparator=11]="TimeSeparator",$t[$t.CurrencyDecimal=12]="CurrencyDecimal",$t[$t.CurrencyGroup=13]="CurrencyGroup",$t))();function Fo(H,ie){return Br((0,$.cg1)(H)[$.wAp.DateFormat],ie)}function Ko(H,ie){return Br((0,$.cg1)(H)[$.wAp.TimeFormat],ie)}function ji(H,ie){return Br((0,$.cg1)(H)[$.wAp.DateTimeFormat],ie)}function Jr(H,ie){const G=(0,$.cg1)(H),S=G[$.wAp.NumberSymbols][ie];if(void 0===S){if(ie===$t.CurrencyDecimal)return G[$.wAp.NumberSymbols][$t.Decimal];if(ie===$t.CurrencyGroup)return G[$.wAp.NumberSymbols][$t.Group]}return S}const hr=$.kL8;function Ji(H){if(!H[$.wAp.ExtraData])throw new Error(`Missing extra locale data for the locale "${H[$.wAp.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function Br(H,ie){for(let G=ie;G>-1;G--)if(void 0!==H[G])return H[G];throw new Error("Locale data API: locale data undefined")}function $i(H){const[ie,G]=H.split(":");return{hours:+ie,minutes:+G}}const Fe=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,At={},Je=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Zt=(()=>((Zt=Zt||{})[Zt.Short=0]="Short",Zt[Zt.ShortGMT=1]="ShortGMT",Zt[Zt.Long=2]="Long",Zt[Zt.Extended=3]="Extended",Zt))(),Wt=(()=>((Wt=Wt||{})[Wt.FullYear=0]="FullYear",Wt[Wt.Month=1]="Month",Wt[Wt.Date=2]="Date",Wt[Wt.Hours=3]="Hours",Wt[Wt.Minutes=4]="Minutes",Wt[Wt.Seconds=5]="Seconds",Wt[Wt.FractionalSeconds=6]="FractionalSeconds",Wt[Wt.Day=7]="Day",Wt))(),Xt=(()=>((Xt=Xt||{})[Xt.DayPeriods=0]="DayPeriods",Xt[Xt.Days=1]="Days",Xt[Xt.Months=2]="Months",Xt[Xt.Eras=3]="Eras",Xt))();function _n(H,ie,G,S){let k=function(H){if(Oe(H))return H;if("number"==typeof H&&!isNaN(H))return new Date(H);if("string"==typeof H){if(H=H.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(H)){const[k,I=1,K=1]=H.split("-").map(He=>+He);return Sr(k,I-1,K)}const G=parseFloat(H);if(!isNaN(H-G))return new Date(G);let S;if(S=H.match(Fe))return function(H){const ie=new Date(0);let G=0,S=0;const k=H[8]?ie.setUTCFullYear:ie.setFullYear,I=H[8]?ie.setUTCHours:ie.setHours;H[9]&&(G=Number(H[9]+H[10]),S=Number(H[9]+H[11])),k.call(ie,Number(H[1]),Number(H[2])-1,Number(H[3]));const K=Number(H[4]||0)-G,He=Number(H[5]||0)-S,yt=Number(H[6]||0),Pn=Math.floor(1e3*parseFloat("0."+(H[7]||0)));return I.call(ie,K,He,yt,Pn),ie}(S)}const ie=new Date(H);if(!Oe(ie))throw new Error(`Unable to convert "${H}" into a date`);return ie}(H);ie=Nn(G,ie)||ie;let He,K=[];for(;ie;){if(He=Je.exec(ie),!He){K.push(ie);break}{K=K.concat(He.slice(1));const pr=K.pop();if(!pr)break;ie=pr}}let yt=k.getTimezoneOffset();S&&(yt=pe(S,yt),k=function(H,ie,G){const k=H.getTimezoneOffset();return function(H,ie){return(H=new Date(H.getTime())).setMinutes(H.getMinutes()+ie),H}(H,-1*(pe(ie,k)-k))}(k,S));let Pn="";return K.forEach(pr=>{const Hn=function(H){if(Z[H])return Z[H];let ie;switch(H){case"G":case"GG":case"GGG":ie=Gn(Xt.Eras,dn.Abbreviated);break;case"GGGG":ie=Gn(Xt.Eras,dn.Wide);break;case"GGGGG":ie=Gn(Xt.Eras,dn.Narrow);break;case"y":ie=rn(Wt.FullYear,1,0,!1,!0);break;case"yy":ie=rn(Wt.FullYear,2,0,!0,!0);break;case"yyy":ie=rn(Wt.FullYear,3,0,!1,!0);break;case"yyyy":ie=rn(Wt.FullYear,4,0,!1,!0);break;case"Y":ie=me(1);break;case"YY":ie=me(2,!0);break;case"YYY":ie=me(3);break;case"YYYY":ie=me(4);break;case"M":case"L":ie=rn(Wt.Month,1,1);break;case"MM":case"LL":ie=rn(Wt.Month,2,1);break;case"MMM":ie=Gn(Xt.Months,dn.Abbreviated);break;case"MMMM":ie=Gn(Xt.Months,dn.Wide);break;case"MMMMM":ie=Gn(Xt.Months,dn.Narrow);break;case"LLL":ie=Gn(Xt.Months,dn.Abbreviated,In.Standalone);break;case"LLLL":ie=Gn(Xt.Months,dn.Wide,In.Standalone);break;case"LLLLL":ie=Gn(Xt.Months,dn.Narrow,In.Standalone);break;case"w":ie=zn(1);break;case"ww":ie=zn(2);break;case"W":ie=zn(1,!0);break;case"d":ie=rn(Wt.Date,1);break;case"dd":ie=rn(Wt.Date,2);break;case"c":case"cc":ie=rn(Wt.Day,1);break;case"ccc":ie=Gn(Xt.Days,dn.Abbreviated,In.Standalone);break;case"cccc":ie=Gn(Xt.Days,dn.Wide,In.Standalone);break;case"ccccc":ie=Gn(Xt.Days,dn.Narrow,In.Standalone);break;case"cccccc":ie=Gn(Xt.Days,dn.Short,In.Standalone);break;case"E":case"EE":case"EEE":ie=Gn(Xt.Days,dn.Abbreviated);break;case"EEEE":ie=Gn(Xt.Days,dn.Wide);break;case"EEEEE":ie=Gn(Xt.Days,dn.Narrow);break;case"EEEEEE":ie=Gn(Xt.Days,dn.Short);break;case"a":case"aa":case"aaa":ie=Gn(Xt.DayPeriods,dn.Abbreviated);break;case"aaaa":ie=Gn(Xt.DayPeriods,dn.Wide);break;case"aaaaa":ie=Gn(Xt.DayPeriods,dn.Narrow);break;case"b":case"bb":case"bbb":ie=Gn(Xt.DayPeriods,dn.Abbreviated,In.Standalone,!0);break;case"bbbb":ie=Gn(Xt.DayPeriods,dn.Wide,In.Standalone,!0);break;case"bbbbb":ie=Gn(Xt.DayPeriods,dn.Narrow,In.Standalone,!0);break;case"B":case"BB":case"BBB":ie=Gn(Xt.DayPeriods,dn.Abbreviated,In.Format,!0);break;case"BBBB":ie=Gn(Xt.DayPeriods,dn.Wide,In.Format,!0);break;case"BBBBB":ie=Gn(Xt.DayPeriods,dn.Narrow,In.Format,!0);break;case"h":ie=rn(Wt.Hours,1,-12);break;case"hh":ie=rn(Wt.Hours,2,-12);break;case"H":ie=rn(Wt.Hours,1);break;case"HH":ie=rn(Wt.Hours,2);break;case"m":ie=rn(Wt.Minutes,1);break;case"mm":ie=rn(Wt.Minutes,2);break;case"s":ie=rn(Wt.Seconds,1);break;case"ss":ie=rn(Wt.Seconds,2);break;case"S":ie=rn(Wt.FractionalSeconds,1);break;case"SS":ie=rn(Wt.FractionalSeconds,2);break;case"SSS":ie=rn(Wt.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":ie=di(Zt.Short);break;case"ZZZZZ":ie=di(Zt.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":ie=di(Zt.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":ie=di(Zt.Long);break;default:return null}return Z[H]=ie,ie}(pr);Pn+=Hn?Hn(k,G,yt):"''"===pr?"'":pr.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),Pn}function Sr(H,ie,G){const S=new Date(0);return S.setFullYear(H,ie,G),S.setHours(0,0,0),S}function Nn(H,ie){const G=function(H){return(0,$.cg1)(H)[$.wAp.LocaleId]}(H);if(At[G]=At[G]||{},At[G][ie])return At[G][ie];let S="";switch(ie){case"shortDate":S=Fo(H,Un.Short);break;case"mediumDate":S=Fo(H,Un.Medium);break;case"longDate":S=Fo(H,Un.Long);break;case"fullDate":S=Fo(H,Un.Full);break;case"shortTime":S=Ko(H,Un.Short);break;case"mediumTime":S=Ko(H,Un.Medium);break;case"longTime":S=Ko(H,Un.Long);break;case"fullTime":S=Ko(H,Un.Full);break;case"short":const k=Nn(H,"shortTime"),I=Nn(H,"shortDate");S=Nr(ji(H,Un.Short),[k,I]);break;case"medium":const K=Nn(H,"mediumTime"),He=Nn(H,"mediumDate");S=Nr(ji(H,Un.Medium),[K,He]);break;case"long":const yt=Nn(H,"longTime"),Pn=Nn(H,"longDate");S=Nr(ji(H,Un.Long),[yt,Pn]);break;case"full":const pr=Nn(H,"fullTime"),Hn=Nn(H,"fullDate");S=Nr(ji(H,Un.Full),[pr,Hn])}return S&&(At[G][ie]=S),S}function Nr(H,ie){return ie&&(H=H.replace(/\{([^}]+)}/g,function(G,S){return null!=ie&&S in ie?ie[S]:G})),H}function kn(H,ie,G="-",S,k){let I="";(H<0||k&&H<=0)&&(k?H=1-H:(H=-H,I=G));let K=String(H);for(;K.length<ie;)K="0"+K;return S&&(K=K.substr(K.length-ie)),I+K}function rn(H,ie,G=0,S=!1,k=!1){return function(I,K){let He=function(H,ie){switch(H){case Wt.FullYear:return ie.getFullYear();case Wt.Month:return ie.getMonth();case Wt.Date:return ie.getDate();case Wt.Hours:return ie.getHours();case Wt.Minutes:return ie.getMinutes();case Wt.Seconds:return ie.getSeconds();case Wt.FractionalSeconds:return ie.getMilliseconds();case Wt.Day:return ie.getDay();default:throw new Error(`Unknown DateType value "${H}".`)}}(H,I);if((G>0||He>-G)&&(He+=G),H===Wt.Hours)0===He&&-12===G&&(He=12);else if(H===Wt.FractionalSeconds)return function(H,ie){return kn(H,3).substr(0,ie)}(He,ie);const yt=Jr(K,$t.MinusSign);return kn(He,ie,yt,S,k)}}function Gn(H,ie,G=In.Format,S=!1){return function(k,I){return function(H,ie,G,S,k,I){switch(G){case Xt.Months:return function(H,ie,G){const S=(0,$.cg1)(H),I=Br([S[$.wAp.MonthsFormat],S[$.wAp.MonthsStandalone]],ie);return Br(I,G)}(ie,k,S)[H.getMonth()];case Xt.Days:return function(H,ie,G){const S=(0,$.cg1)(H),I=Br([S[$.wAp.DaysFormat],S[$.wAp.DaysStandalone]],ie);return Br(I,G)}(ie,k,S)[H.getDay()];case Xt.DayPeriods:const K=H.getHours(),He=H.getMinutes();if(I){const Pn=function(H){const ie=(0,$.cg1)(H);return Ji(ie),(ie[$.wAp.ExtraData][2]||[]).map(S=>"string"==typeof S?$i(S):[$i(S[0]),$i(S[1])])}(ie),pr=function(H,ie,G){const S=(0,$.cg1)(H);Ji(S);const I=Br([S[$.wAp.ExtraData][0],S[$.wAp.ExtraData][1]],ie)||[];return Br(I,G)||[]}(ie,k,S),Hn=Pn.findIndex(ar=>{if(Array.isArray(ar)){const[Vr,Ri]=ar,So=K>=Vr.hours&&He>=Vr.minutes,_i=K<Ri.hours||K===Ri.hours&&He<Ri.minutes;if(Vr.hours<Ri.hours){if(So&&_i)return!0}else if(So||_i)return!0}else if(ar.hours===K&&ar.minutes===He)return!0;return!1});if(-1!==Hn)return pr[Hn]}return function(H,ie,G){const S=(0,$.cg1)(H),I=Br([S[$.wAp.DayPeriodsFormat],S[$.wAp.DayPeriodsStandalone]],ie);return Br(I,G)}(ie,k,S)[K<12?0:1];case Xt.Eras:return function(H,ie){return Br((0,$.cg1)(H)[$.wAp.Eras],ie)}(ie,S)[H.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${G}`)}}(k,I,H,ie,G,S)}}function di(H){return function(ie,G,S){const k=-1*S,I=Jr(G,$t.MinusSign),K=k>0?Math.floor(k/60):Math.ceil(k/60);switch(H){case Zt.Short:return(k>=0?"+":"")+kn(K,2,I)+kn(Math.abs(k%60),2,I);case Zt.ShortGMT:return"GMT"+(k>=0?"+":"")+kn(K,1,I);case Zt.Long:return"GMT"+(k>=0?"+":"")+kn(K,2,I)+":"+kn(Math.abs(k%60),2,I);case Zt.Extended:return 0===S?"Z":(k>=0?"+":"")+kn(K,2,I)+":"+kn(Math.abs(k%60),2,I);default:throw new Error(`Unknown zone width "${H}"`)}}}function Co(H){return Sr(H.getFullYear(),H.getMonth(),H.getDate()+(4-H.getDay()))}function zn(H,ie=!1){return function(G,S){let k;if(ie){const I=new Date(G.getFullYear(),G.getMonth(),1).getDay()-1,K=G.getDate();k=1+Math.floor((K+I)/7)}else{const I=Co(G),K=function(H){const ie=Sr(H,0,1).getDay();return Sr(H,0,1+(ie<=4?4:11)-ie)}(I.getFullYear()),He=I.getTime()-K.getTime();k=1+Math.round(He/6048e5)}return kn(k,H,Jr(S,$t.MinusSign))}}function me(H,ie=!1){return function(G,S){return kn(Co(G).getFullYear(),H,Jr(S,$t.MinusSign),ie)}}const Z={};function pe(H,ie){H=H.replace(/:/g,"");const G=Date.parse("Jan 01, 1970 00:00:00 "+H)/6e4;return isNaN(G)?ie:G}function Oe(H){return H instanceof Date&&!isNaN(H.valueOf())}const Ze=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function Kn(H,ie,G,S,k){const K=function(H,ie="-"){const G={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},S=H.split(";"),k=S[0],I=S[1],K=-1!==k.indexOf(".")?k.split("."):[k.substring(0,k.lastIndexOf("0")+1),k.substring(k.lastIndexOf("0")+1)],He=K[0],yt=K[1]||"";G.posPre=He.substr(0,He.indexOf("#"));for(let pr=0;pr<yt.length;pr++){const Hn=yt.charAt(pr);"0"===Hn?G.minFrac=G.maxFrac=pr+1:"#"===Hn?G.maxFrac=pr+1:G.posSuf+=Hn}const Pn=He.split(",");if(G.gSize=Pn[1]?Pn[1].length:0,G.lgSize=Pn[2]||Pn[1]?(Pn[2]||Pn[1]).length:0,I){const pr=k.length-G.posPre.length-G.posSuf.length,Hn=I.indexOf("#");G.negPre=I.substr(0,Hn).replace(/'/g,""),G.negSuf=I.substr(Hn+pr).replace(/'/g,"")}else G.negPre=ie+G.posPre,G.negSuf=G.posSuf;return G}(function(H,ie){return(0,$.cg1)(H)[$.wAp.NumberFormats][ie]}(ie,qn.Currency),Jr(ie,$t.MinusSign));return K.minFrac=function(H){let ie;const G=Jt[H];return G&&(ie=G[2]),"number"==typeof ie?ie:2}(S),K.maxFrac=K.minFrac,function(H,ie,G,S,k,I,K=!1){let He="",yt=!1;if(isFinite(H)){let Pn=function(H){let S,k,I,K,He,ie=Math.abs(H)+"",G=0;for((k=ie.indexOf("."))>-1&&(ie=ie.replace(".","")),(I=ie.search(/e/i))>0?(k<0&&(k=I),k+=+ie.slice(I+1),ie=ie.substring(0,I)):k<0&&(k=ie.length),I=0;"0"===ie.charAt(I);I++);if(I===(He=ie.length))S=[0],k=1;else{for(He--;"0"===ie.charAt(He);)He--;for(k-=I,S=[],K=0;I<=He;I++,K++)S[K]=Number(ie.charAt(I))}return k>22&&(S=S.splice(0,21),G=k-1,k=1),{digits:S,exponent:G,integerLen:k}}(H);K&&(Pn=function(H){if(0===H.digits[0])return H;const ie=H.digits.length-H.integerLen;return H.exponent?H.exponent+=2:(0===ie?H.digits.push(0,0):1===ie&&H.digits.push(0),H.integerLen+=2),H}(Pn));let pr=ie.minInt,Hn=ie.minFrac,ar=ie.maxFrac;if(I){const ds=I.match(Ze);if(null===ds)throw new Error(`${I} is not a valid digit info`);const ts=ds[1],xr=ds[3],ps=ds[5];null!=ts&&(pr=sr(ts)),null!=xr&&(Hn=sr(xr)),null!=ps?ar=sr(ps):null!=xr&&Hn>ar&&(ar=Hn)}!function(H,ie,G){if(ie>G)throw new Error(`The minimum number of digits after fraction (${ie}) is higher than the maximum (${G}).`);let S=H.digits,k=S.length-H.integerLen;const I=Math.min(Math.max(ie,k),G);let K=I+H.integerLen,He=S[K];if(K>0){S.splice(Math.max(H.integerLen,K));for(let Hn=K;Hn<S.length;Hn++)S[Hn]=0}else{k=Math.max(0,k),H.integerLen=1,S.length=Math.max(1,K=I+1),S[0]=0;for(let Hn=1;Hn<K;Hn++)S[Hn]=0}if(He>=5)if(K-1<0){for(let Hn=0;Hn>K;Hn--)S.unshift(0),H.integerLen++;S.unshift(1),H.integerLen++}else S[K-1]++;for(;k<Math.max(0,I);k++)S.push(0);let yt=0!==I;const Pn=ie+H.integerLen,pr=S.reduceRight(function(Hn,ar,Vr,Ri){return Ri[Vr]=(ar+=Hn)<10?ar:ar-10,yt&&(0===Ri[Vr]&&Vr>=Pn?Ri.pop():yt=!1),ar>=10?1:0},0);pr&&(S.unshift(pr),H.integerLen++)}(Pn,Hn,ar);let Vr=Pn.digits,Ri=Pn.integerLen;const So=Pn.exponent;let _i=[];for(yt=Vr.every(ds=>!ds);Ri<pr;Ri++)Vr.unshift(0);for(;Ri<0;Ri++)Vr.unshift(0);Ri>0?_i=Vr.splice(Ri,Vr.length):(_i=Vr,Vr=[0]);const qs=[];for(Vr.length>=ie.lgSize&&qs.unshift(Vr.splice(-ie.lgSize,Vr.length).join(""));Vr.length>ie.gSize;)qs.unshift(Vr.splice(-ie.gSize,Vr.length).join(""));Vr.length&&qs.unshift(Vr.join("")),He=qs.join(Jr(G,S)),_i.length&&(He+=Jr(G,k)+_i.join("")),So&&(He+=Jr(G,$t.Exponential)+"+"+So)}else He=Jr(G,$t.Infinity);return He=H<0&&!yt?ie.negPre+He+ie.negSuf:ie.posPre+He+ie.posSuf,He}(H,K,ie,$t.CurrencyGroup,$t.CurrencyDecimal,k).replace("\xa4",G).replace("\xa4","").trim()}function sr(H){const ie=parseInt(H);if(isNaN(ie))throw new Error("Invalid integer literal when parsing "+H);return ie}class un{}let Zr=(()=>{class H extends un{constructor(G){super(),this.locale=G}getPluralCategory(G,S){switch(hr(S||this.locale)(G)){case Mr.Zero:return"zero";case Mr.One:return"one";case Mr.Two:return"two";case Mr.Few:return"few";case Mr.Many:return"many";default:return"other"}}}return H.\u0275fac=function(G){return new(G||H)($.LFG($.soG))},H.\u0275prov=$.Yz7({token:H,factory:H.\u0275fac}),H})();function Gr(H,ie){ie=encodeURIComponent(ie);for(const G of H.split(";")){const S=G.indexOf("="),[k,I]=-1==S?[G,""]:[G.slice(0,S),G.slice(S+1)];if(k.trim()===ie)return decodeURIComponent(I)}return null}let Eo=(()=>{class H{constructor(G,S,k,I){this._iterableDiffers=G,this._keyValueDiffers=S,this._ngEl=k,this._renderer=I,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(G){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof G?G.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(G){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof G?G.split(/\s+/):G,this._rawClass&&((0,$.sIi)(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const G=this._iterableDiffer.diff(this._rawClass);G&&this._applyIterableChanges(G)}else if(this._keyValueDiffer){const G=this._keyValueDiffer.diff(this._rawClass);G&&this._applyKeyValueChanges(G)}}_applyKeyValueChanges(G){G.forEachAddedItem(S=>this._toggleClass(S.key,S.currentValue)),G.forEachChangedItem(S=>this._toggleClass(S.key,S.currentValue)),G.forEachRemovedItem(S=>{S.previousValue&&this._toggleClass(S.key,!1)})}_applyIterableChanges(G){G.forEachAddedItem(S=>{if("string"!=typeof S.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${(0,$.AaK)(S.item)}`);this._toggleClass(S.item,!0)}),G.forEachRemovedItem(S=>this._toggleClass(S.item,!1))}_applyClasses(G){G&&(Array.isArray(G)||G instanceof Set?G.forEach(S=>this._toggleClass(S,!0)):Object.keys(G).forEach(S=>this._toggleClass(S,!!G[S])))}_removeClasses(G){G&&(Array.isArray(G)||G instanceof Set?G.forEach(S=>this._toggleClass(S,!1)):Object.keys(G).forEach(S=>this._toggleClass(S,!1)))}_toggleClass(G,S){(G=G.trim())&&G.split(/\s+/g).forEach(k=>{S?this._renderer.addClass(this._ngEl.nativeElement,k):this._renderer.removeClass(this._ngEl.nativeElement,k)})}}return H.\u0275fac=function(G){return new(G||H)($.Y36($.ZZ4),$.Y36($.aQg),$.Y36($.SBq),$.Y36($.Qsj))},H.\u0275dir=$.lG2({type:H,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),H})();class bn{constructor(ie,G,S,k){this.$implicit=ie,this.ngForOf=G,this.index=S,this.count=k}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let pi=(()=>{class H{constructor(G,S,k){this._viewContainer=G,this._template=S,this._differs=k,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(G){this._ngForOf=G,this._ngForOfDirty=!0}set ngForTrackBy(G){this._trackByFn=G}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(G){G&&(this._template=G)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const G=this._ngForOf;if(!this._differ&&G)try{this._differ=this._differs.find(G).create(this.ngForTrackBy)}catch(S){throw new Error(`Cannot find a differ supporting object '${G}' of type '${function(H){return H.name||typeof H}(G)}'. NgFor only supports binding to Iterables such as Arrays.`)}}if(this._differ){const G=this._differ.diff(this._ngForOf);G&&this._applyChanges(G)}}_applyChanges(G){const S=[];G.forEachOperation((k,I,K)=>{if(null==k.previousIndex){const He=this._viewContainer.createEmbeddedView(this._template,new bn(null,this._ngForOf,-1,-1),null===K?void 0:K),yt=new Li(k,He);S.push(yt)}else if(null==K)this._viewContainer.remove(null===I?void 0:I);else if(null!==I){const He=this._viewContainer.get(I);this._viewContainer.move(He,K);const yt=new Li(k,He);S.push(yt)}});for(let k=0;k<S.length;k++)this._perViewChange(S[k].view,S[k].record);for(let k=0,I=this._viewContainer.length;k<I;k++){const K=this._viewContainer.get(k);K.context.index=k,K.context.count=I,K.context.ngForOf=this._ngForOf}G.forEachIdentityChange(k=>{this._viewContainer.get(k.currentIndex).context.$implicit=k.item})}_perViewChange(G,S){G.context.$implicit=S.item}static ngTemplateContextGuard(G,S){return!0}}return H.\u0275fac=function(G){return new(G||H)($.Y36($.s_b),$.Y36($.Rgc),$.Y36($.ZZ4))},H.\u0275dir=$.lG2({type:H,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),H})();class Li{constructor(ie,G){this.record=ie,this.view=G}}let Lo=(()=>{class H{constructor(G,S){this._viewContainer=G,this._context=new Zi,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=S}set ngIf(G){this._context.$implicit=this._context.ngIf=G,this._updateView()}set ngIfThen(G){no("ngIfThen",G),this._thenTemplateRef=G,this._thenViewRef=null,this._updateView()}set ngIfElse(G){no("ngIfElse",G),this._elseTemplateRef=G,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(G,S){return!0}}return H.\u0275fac=function(G){return new(G||H)($.Y36($.s_b),$.Y36($.Rgc))},H.\u0275dir=$.lG2({type:H,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),H})();class Zi{constructor(){this.$implicit=null,this.ngIf=null}}function no(H,ie){if(ie&&!ie.createEmbeddedView)throw new Error(`${H} must be a TemplateRef, but received '${(0,$.AaK)(ie)}'.`)}function dr(H,ie){return Error(`InvalidPipeArgument: '${ie}' for pipe '${(0,$.AaK)(H)}'`)}let mi=(()=>{class H{constructor(G){this.locale=G}transform(G,S="mediumDate",k,I){if(null==G||""===G||G!=G)return null;try{return _n(G,S,I||this.locale,k)}catch(K){throw dr(H,K.message)}}}return H.\u0275fac=function(G){return new(G||H)($.Y36($.soG,16))},H.\u0275pipe=$.Yjl({name:"date",type:H,pure:!0}),H})(),Go=(()=>{class H{constructor(G,S="USD"){this._locale=G,this._defaultCurrencyCode=S}transform(G,S=this._defaultCurrencyCode,k="symbol",I,K){if(!function(H){return!(null==H||""===H||H!=H)}(G))return null;K=K||this._locale,"boolean"==typeof k&&(k=k?"symbol":"code");let He=S||this._defaultCurrencyCode;"code"!==k&&(He="symbol"===k||"symbol-narrow"===k?function(H,ie,G="en"){const S=function(H){return(0,$.cg1)(H)[$.wAp.Currencies]}(G)[H]||Jt[H]||[],k=S[1];return"narrow"===ie&&"string"==typeof k?k:S[0]||H}(He,"symbol"===k?"wide":"narrow",K):k);try{return Kn(function(H){if("string"==typeof H&&!isNaN(Number(H)-parseFloat(H)))return Number(H);if("number"!=typeof H)throw new Error(`${H} is not a number`);return H}(G),K,He,S,I)}catch(yt){throw dr(H,yt.message)}}}return H.\u0275fac=function(G){return new(G||H)($.Y36($.soG,16),$.Y36($.EJc,16))},H.\u0275pipe=$.Yjl({name:"currency",type:H,pure:!0}),H})();let Ao=(()=>{class H{}return H.\u0275fac=function(G){return new(G||H)},H.\u0275mod=$.oAB({type:H}),H.\u0275inj=$.cJS({providers:[{provide:un,useClass:Zr}]}),H})();const po="browser";let an=(()=>{class H{}return H.\u0275prov=(0,$.Yz7)({token:H,providedIn:"root",factory:()=>new Hi((0,$.LFG)(ze),window)}),H})();class Hi{constructor(ie,G){this.document=ie,this.window=G,this.offset=()=>[0,0]}setOffset(ie){this.offset=Array.isArray(ie)?()=>ie:ie}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(ie){this.supportsScrolling()&&this.window.scrollTo(ie[0],ie[1])}scrollToAnchor(ie){if(!this.supportsScrolling())return;const G=function(H,ie){const G=H.getElementById(ie)||H.getElementsByName(ie)[0];if(G)return G;if("function"==typeof H.createTreeWalker&&H.body&&(H.body.createShadowRoot||H.body.attachShadow)){const S=H.createTreeWalker(H.body,NodeFilter.SHOW_ELEMENT);let k=S.currentNode;for(;k;){const I=k.shadowRoot;if(I){const K=I.getElementById(ie)||I.querySelector(`[name="${ie}"]`);if(K)return K}k=S.nextNode()}}return null}(this.document,ie);G&&(this.scrollToElement(G),this.attemptFocus(G))}setHistoryScrollRestoration(ie){if(this.supportScrollRestoration()){const G=this.window.history;G&&G.scrollRestoration&&(G.scrollRestoration=ie)}}scrollToElement(ie){const G=ie.getBoundingClientRect(),S=G.left+this.window.pageXOffset,k=G.top+this.window.pageYOffset,I=this.offset();this.window.scrollTo(S-I[0],k-I[1])}attemptFocus(ie){return ie.focus(),this.document.activeElement===ie}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const ie=Mo(this.window.history)||Mo(Object.getPrototypeOf(this.window.history));return!(!ie||!ie.writable&&!ie.set)}catch(ie){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(ie){return!1}}}function Mo(H){return Object.getOwnPropertyDescriptor(H,"scrollRestoration")}class Ti{}},1841:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{TP:()=>Ln,eN:()=>$t,JF:()=>Br,LE:()=>qt});var $=xe(8583),y=xe(639),Rt=xe(5917),h=xe(7574),Qe=xe(4612),nt=xe(5435),ze=xe(8002);class Me{}class qe{}class ge{constructor(Ne){this.normalizedNames=new Map,this.lazyUpdate=null,Ne?this.lazyInit="string"==typeof Ne?()=>{this.headers=new Map,Ne.split("\n").forEach(Fe=>{const At=Fe.indexOf(":");if(At>0){const Je=Fe.slice(0,At),Zt=Je.toLowerCase(),Wt=Fe.slice(At+1).trim();this.maybeSetNormalizedName(Je,Zt),this.headers.has(Zt)?this.headers.get(Zt).push(Wt):this.headers.set(Zt,[Wt])}})}:()=>{this.headers=new Map,Object.keys(Ne).forEach(Fe=>{let At=Ne[Fe];const Je=Fe.toLowerCase();"string"==typeof At&&(At=[At]),At.length>0&&(this.headers.set(Je,At),this.maybeSetNormalizedName(Fe,Je))})}:this.headers=new Map}has(Ne){return this.init(),this.headers.has(Ne.toLowerCase())}get(Ne){this.init();const Fe=this.headers.get(Ne.toLowerCase());return Fe&&Fe.length>0?Fe[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(Ne){return this.init(),this.headers.get(Ne.toLowerCase())||null}append(Ne,Fe){return this.clone({name:Ne,value:Fe,op:"a"})}set(Ne,Fe){return this.clone({name:Ne,value:Fe,op:"s"})}delete(Ne,Fe){return this.clone({name:Ne,value:Fe,op:"d"})}maybeSetNormalizedName(Ne,Fe){this.normalizedNames.has(Fe)||this.normalizedNames.set(Fe,Ne)}init(){this.lazyInit&&(this.lazyInit instanceof ge?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(Ne=>this.applyUpdate(Ne)),this.lazyUpdate=null))}copyFrom(Ne){Ne.init(),Array.from(Ne.headers.keys()).forEach(Fe=>{this.headers.set(Fe,Ne.headers.get(Fe)),this.normalizedNames.set(Fe,Ne.normalizedNames.get(Fe))})}clone(Ne){const Fe=new ge;return Fe.lazyInit=this.lazyInit&&this.lazyInit instanceof ge?this.lazyInit:this,Fe.lazyUpdate=(this.lazyUpdate||[]).concat([Ne]),Fe}applyUpdate(Ne){const Fe=Ne.name.toLowerCase();switch(Ne.op){case"a":case"s":let At=Ne.value;if("string"==typeof At&&(At=[At]),0===At.length)return;this.maybeSetNormalizedName(Ne.name,Fe);const Je=("a"===Ne.op?this.headers.get(Fe):void 0)||[];Je.push(...At),this.headers.set(Fe,Je);break;case"d":const Zt=Ne.value;if(Zt){let Wt=this.headers.get(Fe);if(!Wt)return;Wt=Wt.filter(Xt=>-1===Zt.indexOf(Xt)),0===Wt.length?(this.headers.delete(Fe),this.normalizedNames.delete(Fe)):this.headers.set(Fe,Wt)}else this.headers.delete(Fe),this.normalizedNames.delete(Fe)}}forEach(Ne){this.init(),Array.from(this.normalizedNames.keys()).forEach(Fe=>Ne(this.normalizedNames.get(Fe),this.headers.get(Fe)))}}class Ye{encodeKey(Ne){return Vt(Ne)}encodeValue(Ne){return Vt(Ne)}decodeKey(Ne){return decodeURIComponent(Ne)}decodeValue(Ne){return decodeURIComponent(Ne)}}const Ct=/%(\d[a-f0-9])/gi,_t={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function Vt(st){return encodeURIComponent(st).replace(Ct,(Ne,Fe)=>{var At;return null!==(At=_t[Fe])&&void 0!==At?At:Ne})}function ut(st){return`${st}`}class qt{constructor(Ne={}){if(this.updates=null,this.cloneFrom=null,this.encoder=Ne.encoder||new Ye,Ne.fromString){if(Ne.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(st,Ne){const Fe=new Map;return st.length>0&&st.replace(/^\?/,"").split("&").forEach(Je=>{const Zt=Je.indexOf("="),[Wt,Xt]=-1==Zt?[Ne.decodeKey(Je),""]:[Ne.decodeKey(Je.slice(0,Zt)),Ne.decodeValue(Je.slice(Zt+1))],_n=Fe.get(Wt)||[];_n.push(Xt),Fe.set(Wt,_n)}),Fe}(Ne.fromString,this.encoder)}else Ne.fromObject?(this.map=new Map,Object.keys(Ne.fromObject).forEach(Fe=>{const At=Ne.fromObject[Fe];this.map.set(Fe,Array.isArray(At)?At:[At])})):this.map=null}has(Ne){return this.init(),this.map.has(Ne)}get(Ne){this.init();const Fe=this.map.get(Ne);return Fe?Fe[0]:null}getAll(Ne){return this.init(),this.map.get(Ne)||null}keys(){return this.init(),Array.from(this.map.keys())}append(Ne,Fe){return this.clone({param:Ne,value:Fe,op:"a"})}appendAll(Ne){const Fe=[];return Object.keys(Ne).forEach(At=>{const Je=Ne[At];Array.isArray(Je)?Je.forEach(Zt=>{Fe.push({param:At,value:Zt,op:"a"})}):Fe.push({param:At,value:Je,op:"a"})}),this.clone(Fe)}set(Ne,Fe){return this.clone({param:Ne,value:Fe,op:"s"})}delete(Ne,Fe){return this.clone({param:Ne,value:Fe,op:"d"})}toString(){return this.init(),this.keys().map(Ne=>{const Fe=this.encoder.encodeKey(Ne);return this.map.get(Ne).map(At=>Fe+"="+this.encoder.encodeValue(At)).join("&")}).filter(Ne=>""!==Ne).join("&")}clone(Ne){const Fe=new qt({encoder:this.encoder});return Fe.cloneFrom=this.cloneFrom||this,Fe.updates=(this.updates||[]).concat(Ne),Fe}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(Ne=>this.map.set(Ne,this.cloneFrom.map.get(Ne))),this.updates.forEach(Ne=>{switch(Ne.op){case"a":case"s":const Fe=("a"===Ne.op?this.map.get(Ne.param):void 0)||[];Fe.push(ut(Ne.value)),this.map.set(Ne.param,Fe);break;case"d":if(void 0===Ne.value){this.map.delete(Ne.param);break}{let At=this.map.get(Ne.param)||[];const Je=At.indexOf(ut(Ne.value));-1!==Je&&At.splice(Je,1),At.length>0?this.map.set(Ne.param,At):this.map.delete(Ne.param)}}}),this.cloneFrom=this.updates=null)}}class cn{constructor(){this.map=new Map}set(Ne,Fe){return this.map.set(Ne,Fe),this}get(Ne){return this.map.has(Ne)||this.map.set(Ne,Ne.defaultValue()),this.map.get(Ne)}delete(Ne){return this.map.delete(Ne),this}keys(){return this.map.keys()}}function vr(st){return"undefined"!=typeof ArrayBuffer&&st instanceof ArrayBuffer}function hn(st){return"undefined"!=typeof Blob&&st instanceof Blob}function Kr(st){return"undefined"!=typeof FormData&&st instanceof FormData}class li{constructor(Ne,Fe,At,Je){let Zt;if(this.url=Fe,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=Ne.toUpperCase(),function(st){switch(st){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||Je?(this.body=void 0!==At?At:null,Zt=Je):Zt=At,Zt&&(this.reportProgress=!!Zt.reportProgress,this.withCredentials=!!Zt.withCredentials,Zt.responseType&&(this.responseType=Zt.responseType),Zt.headers&&(this.headers=Zt.headers),Zt.context&&(this.context=Zt.context),Zt.params&&(this.params=Zt.params)),this.headers||(this.headers=new ge),this.context||(this.context=new cn),this.params){const Wt=this.params.toString();if(0===Wt.length)this.urlWithParams=Fe;else{const Xt=Fe.indexOf("?");this.urlWithParams=Fe+(-1===Xt?"?":Xt<Fe.length-1?"&":"")+Wt}}else this.params=new qt,this.urlWithParams=Fe}serializeBody(){return null===this.body?null:vr(this.body)||hn(this.body)||Kr(this.body)||"undefined"!=typeof URLSearchParams&&this.body instanceof URLSearchParams||"string"==typeof this.body?this.body:this.body instanceof qt?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Kr(this.body)?null:hn(this.body)?this.body.type||null:vr(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof qt?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(Ne={}){var Fe;const At=Ne.method||this.method,Je=Ne.url||this.url,Zt=Ne.responseType||this.responseType,Wt=void 0!==Ne.body?Ne.body:this.body,Xt=void 0!==Ne.withCredentials?Ne.withCredentials:this.withCredentials,_n=void 0!==Ne.reportProgress?Ne.reportProgress:this.reportProgress;let Sr=Ne.headers||this.headers,Nn=Ne.params||this.params;const Nr=null!==(Fe=Ne.context)&&void 0!==Fe?Fe:this.context;return void 0!==Ne.setHeaders&&(Sr=Object.keys(Ne.setHeaders).reduce((kn,On)=>kn.set(On,Ne.setHeaders[On]),Sr)),Ne.setParams&&(Nn=Object.keys(Ne.setParams).reduce((kn,On)=>kn.set(On,Ne.setParams[On]),Nn)),new li(At,Je,Wt,{params:Nn,headers:Sr,context:Nr,reportProgress:_n,responseType:Zt,withCredentials:Xt})}}var Jt=(()=>((Jt=Jt||{})[Jt.Sent=0]="Sent",Jt[Jt.UploadProgress=1]="UploadProgress",Jt[Jt.ResponseHeader=2]="ResponseHeader",Jt[Jt.DownloadProgress=3]="DownloadProgress",Jt[Jt.Response=4]="Response",Jt[Jt.User=5]="User",Jt))();class qn{constructor(Ne,Fe=200,At="OK"){this.headers=Ne.headers||new ge,this.status=void 0!==Ne.status?Ne.status:Fe,this.statusText=Ne.statusText||At,this.url=Ne.url||null,this.ok=this.status>=200&&this.status<300}}class Mr extends qn{constructor(Ne={}){super(Ne),this.type=Jt.ResponseHeader}clone(Ne={}){return new Mr({headers:Ne.headers||this.headers,status:void 0!==Ne.status?Ne.status:this.status,statusText:Ne.statusText||this.statusText,url:Ne.url||this.url||void 0})}}class In extends qn{constructor(Ne={}){super(Ne),this.type=Jt.Response,this.body=void 0!==Ne.body?Ne.body:null}clone(Ne={}){return new In({body:void 0!==Ne.body?Ne.body:this.body,headers:Ne.headers||this.headers,status:void 0!==Ne.status?Ne.status:this.status,statusText:Ne.statusText||this.statusText,url:Ne.url||this.url||void 0})}}class dn extends qn{constructor(Ne){super(Ne,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${Ne.url||"(unknown url)"}`:`Http failure response for ${Ne.url||"(unknown url)"}: ${Ne.status} ${Ne.statusText}`,this.error=Ne.error||null}}function Un(st,Ne){return{body:Ne,headers:st.headers,context:st.context,observe:st.observe,params:st.params,reportProgress:st.reportProgress,responseType:st.responseType,withCredentials:st.withCredentials}}let $t=(()=>{class st{constructor(Fe){this.handler=Fe}request(Fe,At,Je={}){let Zt;if(Fe instanceof li)Zt=Fe;else{let _n,Sr;_n=Je.headers instanceof ge?Je.headers:new ge(Je.headers),Je.params&&(Sr=Je.params instanceof qt?Je.params:new qt({fromObject:Je.params})),Zt=new li(Fe,At,void 0!==Je.body?Je.body:null,{headers:_n,context:Je.context,params:Sr,reportProgress:Je.reportProgress,responseType:Je.responseType||"json",withCredentials:Je.withCredentials})}const Wt=(0,Rt.of)(Zt).pipe((0,Qe.b)(_n=>this.handler.handle(_n)));if(Fe instanceof li||"events"===Je.observe)return Wt;const Xt=Wt.pipe((0,nt.h)(_n=>_n instanceof In));switch(Je.observe||"body"){case"body":switch(Zt.responseType){case"arraybuffer":return Xt.pipe((0,ze.U)(_n=>{if(null!==_n.body&&!(_n.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return _n.body}));case"blob":return Xt.pipe((0,ze.U)(_n=>{if(null!==_n.body&&!(_n.body instanceof Blob))throw new Error("Response is not a Blob.");return _n.body}));case"text":return Xt.pipe((0,ze.U)(_n=>{if(null!==_n.body&&"string"!=typeof _n.body)throw new Error("Response is not a string.");return _n.body}));case"json":default:return Xt.pipe((0,ze.U)(_n=>_n.body))}case"response":return Xt;default:throw new Error(`Unreachable: unhandled observe type ${Je.observe}}`)}}delete(Fe,At={}){return this.request("DELETE",Fe,At)}get(Fe,At={}){return this.request("GET",Fe,At)}head(Fe,At={}){return this.request("HEAD",Fe,At)}jsonp(Fe,At){return this.request("JSONP",Fe,{params:(new qt).append(At,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(Fe,At={}){return this.request("OPTIONS",Fe,At)}patch(Fe,At,Je={}){return this.request("PATCH",Fe,Un(Je,At))}post(Fe,At,Je={}){return this.request("POST",Fe,Un(Je,At))}put(Fe,At,Je={}){return this.request("PUT",Fe,Un(Je,At))}}return st.\u0275fac=function(Fe){return new(Fe||st)(y.LFG(Me))},st.\u0275prov=y.Yz7({token:st,factory:st.\u0275fac}),st})();class lo{constructor(Ne,Fe){this.next=Ne,this.interceptor=Fe}handle(Ne){return this.interceptor.intercept(Ne,this.next)}}const Ln=new y.OlP("HTTP_INTERCEPTORS");let Ki=(()=>{class st{intercept(Fe,At){return At.handle(Fe)}}return st.\u0275fac=function(Fe){return new(Fe||st)},st.\u0275prov=y.Yz7({token:st,factory:st.\u0275fac}),st})();const ji=/^\)\]\}',?\n/;let ii=(()=>{class st{constructor(Fe){this.xhrFactory=Fe}handle(Fe){if("JSONP"===Fe.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new h.y(At=>{const Je=this.xhrFactory.build();if(Je.open(Fe.method,Fe.urlWithParams),Fe.withCredentials&&(Je.withCredentials=!0),Fe.headers.forEach((On,rn)=>Je.setRequestHeader(On,rn.join(","))),Fe.headers.has("Accept")||Je.setRequestHeader("Accept","application/json, text/plain, */*"),!Fe.headers.has("Content-Type")){const On=Fe.detectContentTypeHeader();null!==On&&Je.setRequestHeader("Content-Type",On)}if(Fe.responseType){const On=Fe.responseType.toLowerCase();Je.responseType="json"!==On?On:"text"}const Zt=Fe.serializeBody();let Wt=null;const Xt=()=>{if(null!==Wt)return Wt;const On=1223===Je.status?204:Je.status,rn=Je.statusText||"OK",ci=new ge(Je.getAllResponseHeaders()),Gn=function(st){return"responseURL"in st&&st.responseURL?st.responseURL:/^X-Request-URL:/m.test(st.getAllResponseHeaders())?st.getResponseHeader("X-Request-URL"):null}(Je)||Fe.url;return Wt=new Mr({headers:ci,status:On,statusText:rn,url:Gn}),Wt},_n=()=>{let{headers:On,status:rn,statusText:ci,url:Gn}=Xt(),Qr=null;204!==rn&&(Qr=void 0===Je.response?Je.responseText:Je.response),0===rn&&(rn=Qr?200:0);let di=rn>=200&&rn<300;if("json"===Fe.responseType&&"string"==typeof Qr){const Qn=Qr;Qr=Qr.replace(ji,"");try{Qr=""!==Qr?JSON.parse(Qr):null}catch(Qi){Qr=Qn,di&&(di=!1,Qr={error:Qi,text:Qr})}}di?(At.next(new In({body:Qr,headers:On,status:rn,statusText:ci,url:Gn||void 0})),At.complete()):At.error(new dn({error:Qr,headers:On,status:rn,statusText:ci,url:Gn||void 0}))},Sr=On=>{const{url:rn}=Xt(),ci=new dn({error:On,status:Je.status||0,statusText:Je.statusText||"Unknown Error",url:rn||void 0});At.error(ci)};let Nn=!1;const Nr=On=>{Nn||(At.next(Xt()),Nn=!0);let rn={type:Jt.DownloadProgress,loaded:On.loaded};On.lengthComputable&&(rn.total=On.total),"text"===Fe.responseType&&!!Je.responseText&&(rn.partialText=Je.responseText),At.next(rn)},kn=On=>{let rn={type:Jt.UploadProgress,loaded:On.loaded};On.lengthComputable&&(rn.total=On.total),At.next(rn)};return Je.addEventListener("load",_n),Je.addEventListener("error",Sr),Je.addEventListener("timeout",Sr),Je.addEventListener("abort",Sr),Fe.reportProgress&&(Je.addEventListener("progress",Nr),null!==Zt&&Je.upload&&Je.upload.addEventListener("progress",kn)),Je.send(Zt),At.next({type:Jt.Sent}),()=>{Je.removeEventListener("error",Sr),Je.removeEventListener("abort",Sr),Je.removeEventListener("load",_n),Je.removeEventListener("timeout",Sr),Fe.reportProgress&&(Je.removeEventListener("progress",Nr),null!==Zt&&Je.upload&&Je.upload.removeEventListener("progress",kn)),Je.readyState!==Je.DONE&&Je.abort()}})}}return st.\u0275fac=function(Fe){return new(Fe||st)(y.LFG($.JF))},st.\u0275prov=y.Yz7({token:st,factory:st.\u0275fac}),st})();const Xn=new y.OlP("XSRF_COOKIE_NAME"),An=new y.OlP("XSRF_HEADER_NAME");class Lr{}let Ci=(()=>{class st{constructor(Fe,At,Je){this.doc=Fe,this.platform=At,this.cookieName=Je,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const Fe=this.doc.cookie||"";return Fe!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,$.Mx)(Fe,this.cookieName),this.lastCookieString=Fe),this.lastToken}}return st.\u0275fac=function(Fe){return new(Fe||st)(y.LFG($.K0),y.LFG(y.Lbi),y.LFG(Xn))},st.\u0275prov=y.Yz7({token:st,factory:st.\u0275fac}),st})(),hr=(()=>{class st{constructor(Fe,At){this.tokenService=Fe,this.headerName=At}intercept(Fe,At){const Je=Fe.url.toLowerCase();if("GET"===Fe.method||"HEAD"===Fe.method||Je.startsWith("http://")||Je.startsWith("https://"))return At.handle(Fe);const Zt=this.tokenService.getToken();return null!==Zt&&!Fe.headers.has(this.headerName)&&(Fe=Fe.clone({headers:Fe.headers.set(this.headerName,Zt)})),At.handle(Fe)}}return st.\u0275fac=function(Fe){return new(Fe||st)(y.LFG(Lr),y.LFG(An))},st.\u0275prov=y.Yz7({token:st,factory:st.\u0275fac}),st})(),Ji=(()=>{class st{constructor(Fe,At){this.backend=Fe,this.injector=At,this.chain=null}handle(Fe){if(null===this.chain){const At=this.injector.get(Ln,[]);this.chain=At.reduceRight((Je,Zt)=>new lo(Je,Zt),this.backend)}return this.chain.handle(Fe)}}return st.\u0275fac=function(Fe){return new(Fe||st)(y.LFG(qe),y.LFG(y.zs3))},st.\u0275prov=y.Yz7({token:st,factory:st.\u0275fac}),st})(),wo=(()=>{class st{static disable(){return{ngModule:st,providers:[{provide:hr,useClass:Ki}]}}static withOptions(Fe={}){return{ngModule:st,providers:[Fe.cookieName?{provide:Xn,useValue:Fe.cookieName}:[],Fe.headerName?{provide:An,useValue:Fe.headerName}:[]]}}}return st.\u0275fac=function(Fe){return new(Fe||st)},st.\u0275mod=y.oAB({type:st}),st.\u0275inj=y.cJS({providers:[hr,{provide:Ln,useExisting:hr,multi:!0},{provide:Lr,useClass:Ci},{provide:Xn,useValue:"XSRF-TOKEN"},{provide:An,useValue:"X-XSRF-TOKEN"}]}),st})(),Br=(()=>{class st{}return st.\u0275fac=function(Fe){return new(Fe||st)},st.\u0275mod=y.oAB({type:st}),st.\u0275inj=y.cJS({providers:[$t,{provide:Me,useClass:Ji},ii,{provide:qe,useExisting:ii}],imports:[[wo.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),st})()},639:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{deG:()=>Ht,tb:()=>Db,AFp:()=>Cb,ip1:()=>Vy,CZH:()=>Bd,hGG:()=>BD,z2F:()=>Ef,sBO:()=>AC,Sil:()=>Cf,_Vd:()=>Pd,aQ5:()=>i,EJc:()=>Mb,SBq:()=>Sc,qLn:()=>Wc,vpe:()=>Ic,gxx:()=>Us,tBr:()=>Bi,XFs:()=>Je,OlP:()=>kr,zs3:()=>jr,ZZ4:()=>Eg,aQg:()=>Tg,soG:()=>Lg,YKP:()=>mx,v3s:()=>yD,h0i:()=>Ah,PXZ:()=>dD,R0b:()=>tl,FiY:()=>_s,Lbi:()=>Tb,g9A:()=>Eb,Qsj:()=>dC,FYo:()=>Cg,JOm:()=>vl,Tiy:()=>fy,q3G:()=>xo,tp0:()=>ki,EAV:()=>wD,Rgc:()=>hf,dDg:()=>Rb,DyG:()=>j,GfV:()=>ax,s_b:()=>Mg,ifc:()=>rn,eFA:()=>zb,G48:()=>oD,Gpc:()=>cn,_c5:()=>RD,VLi:()=>iD,c2e:()=>Ab,zSh:()=>iu,wAp:()=>$n,vHH:()=>Kr,EiD:()=>qu,mCW:()=>$c,qzn:()=>jc,JVY:()=>Bf,pB0:()=>qg,eBb:()=>Uf,L6k:()=>Vf,LAX:()=>jf,cg1:()=>oy,Tjo:()=>ID,kL8:()=>S0,yhl:()=>Xd,dqk:()=>Qn,sIi:()=>O,CqO:()=>Y_,QGY:()=>W_,F4k:()=>Nv,RDi:()=>I,AaK:()=>ut,z3N:()=>ml,qOj:()=>Kp,TTD:()=>qo,_Bn:()=>nx,xp6:()=>Cm,uIk:()=>Ve,ekj:()=>ey,Suo:()=>tb,Xpm:()=>Oe,lG2:()=>sn,Yz7:()=>hr,cJS:()=>Uo,oAB:()=>Qt,Yjl:()=>Mn,Y36:()=>rf,_UZ:()=>Fv,BQk:()=>q_,ynx:()=>H_,qZA:()=>G_,TgZ:()=>Z_,EpF:()=>Lv,n5z:()=>M,Ikx:()=>iy,LFG:()=>ir,$8M:()=>V,NdJ:()=>X_,CRH:()=>nb,oxw:()=>Uv,ALo:()=>Yx,lcZ:()=>Xx,xi3:()=>Kx,Q6J:()=>j_,s9C:()=>J_,DdM:()=>$x,iGM:()=>eb,MAs:()=>Po,CHM:()=>Jl,LSH:()=>Ul,B6R:()=>Ze,kYT:()=>Gt,YNc:()=>Wi,_uU:()=>h0,Oqu:()=>ny,hij:()=>gg,AsE:()=>ry});var $=xe(7574),y=xe(4869),Rt=xe(3282),h=xe(6693),nt=xe(9765),ze=xe(5319),Me=xe(2441);var Ye=xe(1307);function Xe(){return new nt.xQ}function _t(t){for(let n in t)if(t[n]===_t)return n;throw Error("Could not find renamed property on target object.")}function Vt(t,n){for(const s in n)n.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(t[s]=n[s])}function ut(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(ut).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const n=t.toString();if(null==n)return""+n;const s=n.indexOf("\n");return-1===s?n:n.substring(0,s)}function qt(t,n){return null==t||""===t?null===n?"":n:null==n||""===n?t:t+" "+n}const Dn=_t({__forward_ref__:_t});function cn(t){return t.__forward_ref__=cn,t.toString=function(){return ut(this())},t}function jt(t){return vr(t)?t():t}function vr(t){return"function"==typeof t&&t.hasOwnProperty(Dn)&&t.__forward_ref__===cn}class Kr extends Error{constructor(n,s){super(function(t,n){return`${t?`NG0${t}: `:""}${n}`}(n,s)),this.code=n}}function Jt(t){return"string"==typeof t?t:null==t?"":String(t)}function qn(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():Jt(t)}function Un(t,n){const s=n?` in ${n}`:"";throw new Kr("201",`No provider for ${qn(t)} found${s}`)}function ii(t,n){null==t&&function(t,n,s,l){throw new Error(`ASSERTION ERROR: ${t}`+(null==l?"":` [Expected=> ${s} ${l} ${n} <=Actual]`))}(n,t,null,"!=")}function hr(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Uo(t){return{providers:t.providers||[],imports:t.imports||[]}}function pn(t){return wo(t,st)||wo(t,Fe)}function wo(t,n){return t.hasOwnProperty(n)?t[n]:null}function Jo(t){return t&&(t.hasOwnProperty(Ne)||t.hasOwnProperty(At))?t[Ne]:null}const st=_t({\u0275prov:_t}),Ne=_t({\u0275inj:_t}),Fe=_t({ngInjectableDef:_t}),At=_t({ngInjectorDef:_t});var Je=(()=>((Je=Je||{})[Je.Default=0]="Default",Je[Je.Host=1]="Host",Je[Je.Self=2]="Self",Je[Je.SkipSelf=4]="SkipSelf",Je[Je.Optional=8]="Optional",Je))();let Zt;function Xt(t){const n=Zt;return Zt=t,n}function _n(t,n,s){const l=pn(t);return l&&"root"==l.providedIn?void 0===l.value?l.value=l.factory():l.value:s&Je.Optional?null:void 0!==n?n:void Un(ut(t),"Injector")}function Nn(t){return{toString:t}.toString()}var Nr=(()=>((Nr=Nr||{})[Nr.OnPush=0]="OnPush",Nr[Nr.Default=1]="Default",Nr))(),rn=(()=>((rn=rn||{})[rn.Emulated=0]="Emulated",rn[rn.None=2]="None",rn[rn.ShadowDom=3]="ShadowDom",rn))();const ci="undefined"!=typeof globalThis&&globalThis,Gn="undefined"!=typeof window&&window,Qr="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Qn=ci||"undefined"!=typeof global&&global||Gn||Qr,Co={},zn=[],me=_t({\u0275cmp:_t}),Z=_t({\u0275dir:_t}),re=_t({\u0275pipe:_t}),pe=_t({\u0275mod:_t}),ve=_t({\u0275loc:_t}),Ie=_t({\u0275fac:_t}),Be=_t({__NG_ELEMENT_ID__:_t});let je=0;function Oe(t){return Nn(()=>{const s={},l={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:s,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===Nr.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors||zn,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||rn.Emulated,id:"c",styles:t.styles||zn,_:null,setInput:null,schemas:t.schemas||null,tView:null},d=t.directives,g=t.features,w=t.pipes;return l.id+=je++,l.inputs=Yt(t.inputs,s),l.outputs=Yt(t.outputs),g&&g.forEach(E=>E(l)),l.directiveDefs=d?()=>("function"==typeof d?d():d).map(lt):null,l.pipeDefs=w?()=>("function"==typeof w?w():w).map(ot):null,l})}function Ze(t,n,s){const l=t.\u0275cmp;l.directiveDefs=()=>n.map(lt),l.pipeDefs=()=>s.map(ot)}function lt(t){return xn(t)||function(t){return t[Z]||null}(t)}function ot(t){return function(t){return t[re]||null}(t)}const mt={};function Qt(t){return Nn(()=>{const n={type:t.type,bootstrap:t.bootstrap||zn,declarations:t.declarations||zn,imports:t.imports||zn,exports:t.exports||zn,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null};return null!=t.id&&(mt[t.id]=t.type),n})}function Gt(t,n){return Nn(()=>{const s=Wn(t,!0);s.declarations=n.declarations||zn,s.imports=n.imports||zn,s.exports=n.exports||zn})}function Yt(t,n){if(null==t)return Co;const s={};for(const l in t)if(t.hasOwnProperty(l)){let d=t[l],g=d;Array.isArray(d)&&(g=d[1],d=d[0]),s[d]=l,n&&(n[d]=g)}return s}const sn=Oe;function Mn(t){return{type:t.type,name:t.name,factory:null,pure:!1!==t.pure,onDestroy:t.type.prototype.ngOnDestroy||null}}function xn(t){return t[me]||null}function Wn(t,n){const s=t[pe]||null;if(!s&&!0===n)throw new Error(`Type ${ut(t)} does not have '\u0275mod' property.`);return s}function nr(t){return Array.isArray(t)&&"object"==typeof t[1]}function ti(t){return Array.isArray(t)&&!0===t[1]}function Gi(t){return 0!=(8&t.flags)}function Ei(t){return 2==(2&t.flags)}function Si(t){return 1==(1&t.flags)}function kt(t){return null!==t.template}function Bn(t){return 0!=(512&t[2])}function Ar(t,n){return t.hasOwnProperty(Ie)?t[Ie]:null}class Wr{constructor(n,s,l){this.previousValue=n,this.currentValue=s,this.firstChange=l}isFirstChange(){return this.firstChange}}function qo(){return gi}function gi(t){return t.type.prototype.ngOnChanges&&(t.setInput=Hi),an}function an(){const t=mo(this),n=null==t?void 0:t.current;if(n){const s=t.previous;if(s===Co)t.previous=n;else for(let l in n)s[l]=n[l];t.current=null,this.ngOnChanges(n)}}function Hi(t,n,s,l){const d=mo(t)||function(t,n){return t[Mo]=n}(t,{previous:Co,current:null}),g=d.current||(d.current={}),w=d.previous,E=this.declaredInputs[s],P=w[E];g[E]=new Wr(P&&P.currentValue,n,w===Co),t[l]=n}qo.ngInherit=!0;const Mo="__ngSimpleChanges__";function mo(t){return t[Mo]||null}let k;function I(t){k=t}function yt(t){return!!t.listen}const pr={createRenderer:(t,n)=>void 0!==k?k:"undefined"!=typeof document?document:void 0};function ar(t){for(;Array.isArray(t);)t=t[0];return t}function So(t,n){return ar(n[t])}function _i(t,n){return ar(n[t.index])}function ds(t,n){return t.data[n]}function ts(t,n){return t[n]}function xr(t,n){const s=n[t];return nr(s)?s:s[0]}function ps(t){return 4==(4&t[2])}function Ws(t){return 128==(128&t[2])}function No(t,n){return null==n?null:t[n]}function Oa(t){t[18]=0}function Ca(t,n){t[5]+=n;let s=t,l=t[3];for(;null!==l&&(1===n&&1===s[5]||-1===n&&0===s[5]);)l[5]+=n,s=l,l=l[3]}const Sn={lFrame:Ql(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function fs(){return Sn.bindingsEnabled}function Mt(){return Sn.lFrame.lView}function br(){return Sn.lFrame.tView}function Jl(t){return Sn.lFrame.contextLView=t,t[8]}function yi(){let t=La();for(;null!==t&&64===t.type;)t=t.parent;return t}function La(){return Sn.lFrame.currentTNode}function go(t,n){const s=Sn.lFrame;s.currentTNode=t,s.isParent=n}function nl(){return Sn.lFrame.isParent}function Na(){Sn.lFrame.isParent=!1}function Ks(){return Sn.isInCheckNoChangesMode}function Js(t){Sn.isInCheckNoChangesMode=t}function Y(){const t=Sn.lFrame;let n=t.bindingRootIndex;return-1===n&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}function te(){return Sn.lFrame.bindingIndex}function ee(){return Sn.lFrame.bindingIndex++}function Te(t){const n=Sn.lFrame,s=n.bindingIndex;return n.bindingIndex=n.bindingIndex+t,s}function jn(t,n){const s=Sn.lFrame;s.bindingIndex=s.bindingRootIndex=t,qi(n)}function qi(t){Sn.lFrame.currentDirectiveIndex=t}function Cs(){return Sn.lFrame.currentQueryIndex}function zo(t){Sn.lFrame.currentQueryIndex=t}function hu(t){const n=t[1];return 2===n.type?n.declTNode:1===n.type?t[6]:null}function kl(t,n,s){if(s&Je.SkipSelf){let d=n,g=t;for(;!(d=d.parent,null!==d||s&Je.Host||(d=hu(g),null===d||(g=g[15],10&d.type))););if(null===d)return!1;n=d,t=g}const l=Sn.lFrame=Pc();return l.currentTNode=n,l.lView=t,!0}function rl(t){const n=Pc(),s=t[1];Sn.lFrame=n,n.currentTNode=s.firstChild,n.lView=t,n.tView=s,n.contextLView=t,n.bindingIndex=s.bindingStartIndex,n.inI18n=!1}function Pc(){const t=Sn.lFrame,n=null===t?null:t.child;return null===n?Ql(t):n}function Ql(t){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=n),n}function Rc(){const t=Sn.lFrame;return Sn.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const Ol=Rc;function Ea(){const t=Rc();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function _o(){return Sn.lFrame.selectedIndex}function ms(t){Sn.lFrame.selectedIndex=t}function Hr(){const t=Sn.lFrame;return ds(t.tView,t.selectedIndex)}function Ba(t,n){for(let s=n.directiveStart,l=n.directiveEnd;s<l;s++){const g=t.data[s].type.prototype,{ngAfterContentInit:w,ngAfterContentChecked:E,ngAfterViewInit:P,ngAfterViewChecked:U,ngOnDestroy:J}=g;w&&(t.contentHooks||(t.contentHooks=[])).push(-s,w),E&&((t.contentHooks||(t.contentHooks=[])).push(s,E),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(s,E)),P&&(t.viewHooks||(t.viewHooks=[])).push(-s,P),U&&((t.viewHooks||(t.viewHooks=[])).push(s,U),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(s,U)),null!=J&&(t.destroyHooks||(t.destroyHooks=[])).push(s,J)}}function Va(t,n,s){ol(t,n,3,s)}function Ta(t,n,s,l){(3&t[2])===s&&ol(t,n,s,l)}function zi(t,n){let s=t[2];(3&s)===n&&(s&=2047,s+=1,t[2]=s)}function ol(t,n,s,l){const g=null!=l?l:-1,w=n.length-1;let E=0;for(let P=void 0!==l?65535&t[18]:0;P<w;P++)if("number"==typeof n[P+1]){if(E=n[P],null!=l&&E>=l)break}else n[P]<0&&(t[18]+=65536),(E<g||-1==g)&&(zu(t,s,n,P),t[18]=(4294901760&t[18])+P+2),P++}function zu(t,n,s,l){const d=s[l]<0,g=s[l+1],E=t[d?-s[l]:s[l]];if(d){if(t[2]>>11<t[18]>>16&&(3&t[2])===n){t[2]+=2048;try{g.call(E)}finally{}}}else try{g.call(E)}finally{}}class Fl{constructor(n,s,l){this.factory=n,this.resolving=!1,this.canSeeViewProviders=s,this.injectImpl=l}}function yo(t,n,s){const l=yt(t);let d=0;for(;d<s.length;){const g=s[d];if("number"==typeof g){if(0!==g)break;d++;const w=s[d++],E=s[d++],P=s[d++];l?t.setAttribute(n,E,P,w):n.setAttributeNS(w,E,P)}else{const w=g,E=s[++d];ja(w)?l&&t.setProperty(n,w,E):l?t.setAttribute(n,w,E):n.setAttribute(w,E),d++}}return d}function Ua(t){return 3===t||4===t||6===t}function ja(t){return 64===t.charCodeAt(0)}function Es(t,n){if(null!==n&&0!==n.length)if(null===t||0===t.length)t=n.slice();else{let s=-1;for(let l=0;l<n.length;l++){const d=n[l];"number"==typeof d?s=d:0===s||ea(t,s,d,null,-1===s||2===s?n[++l]:null)}}return t}function ea(t,n,s,l,d){let g=0,w=t.length;if(-1===n)w=-1;else for(;g<t.length;){const E=t[g++];if("number"==typeof E){if(E===n){w=-1;break}if(E>n){w=g-1;break}}}for(;g<t.length;){const E=t[g];if("number"==typeof E)break;if(E===s){if(null===l)return void(null!==d&&(t[g+1]=d));if(l===t[g+1])return void(t[g+2]=d)}g++,null!==l&&g++,null!==d&&g++}-1!==w&&(t.splice(w,0,n),g=w+1),t.splice(g++,0,s),null!==l&&t.splice(g++,0,l),null!==d&&t.splice(g++,0,d)}function tc(t){return-1!==t}function Ls(t){return 32767&t}function ta(t,n){let s=function(t){return t>>16}(t),l=n;for(;s>0;)l=l[15],s--;return l}let al=!0;function ll(t){const n=al;return al=t,n}let da=0;function $a(t,n){const s=oc(t,n);if(-1!==s)return s;const l=n[1];l.firstCreatePass&&(t.injectorIndex=n.length,ic(l.data,t),ic(n,null),ic(l.blueprint,null));const d=Za(t,n),g=t.injectorIndex;if(tc(d)){const w=Ls(d),E=ta(d,n),P=E[1].data;for(let U=0;U<8;U++)n[g+U]=E[w+U]|P[w+U]}return n[g+8]=d,g}function ic(t,n){t.push(0,0,0,0,0,0,0,0,n)}function oc(t,n){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===n[t.injectorIndex+8]?-1:t.injectorIndex}function Za(t,n){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let s=0,l=null,d=n;for(;null!==d;){const g=d[1],w=g.type;if(l=2===w?g.declTNode:1===w?d[6]:null,null===l)return-1;if(s++,d=d[15],-1!==l.injectorIndex)return l.injectorIndex|s<<16}return-1}function ul(t,n,s){!function(t,n,s){let l;"string"==typeof s?l=s.charCodeAt(0)||0:s.hasOwnProperty(Be)&&(l=s[Be]),null==l&&(l=s[Be]=da++);const d=255&l;n.data[t+(d>>5)]|=1<<d}(t,n,s)}function hl(t,n,s){if(s&Je.Optional)return t;Un(n,"NodeInjector")}function sc(t,n,s,l){if(s&Je.Optional&&void 0===l&&(l=null),0==(s&(Je.Self|Je.Host))){const d=t[9],g=Xt(void 0);try{return d?d.get(n,l,s&Je.Optional):_n(n,l,s&Je.Optional)}finally{Xt(g)}}return hl(l,n,s)}function Nc(t,n,s,l=Je.Default,d){if(null!==t){const g=function(t){if("string"==typeof t)return t.charCodeAt(0)||0;const n=t.hasOwnProperty(Be)?t[Be]:void 0;return"number"==typeof n?n>=0?255&n:pl:n}(s);if("function"==typeof g){if(!kl(n,t,l))return l&Je.Host?hl(d,s,l):sc(n,s,l,d);try{const w=g(l);if(null!=w||l&Je.Optional)return w;Un(s)}finally{Ol()}}else if("number"==typeof g){let w=null,E=oc(t,n),P=-1,U=l&Je.Host?n[16][6]:null;for((-1===E||l&Je.SkipSelf)&&(P=-1===E?Za(t,n):n[E+8],-1!==P&&zc(l,!1)?(w=n[1],E=Ls(P),n=ta(P,n)):E=-1);-1!==E;){const J=n[1];if(lc(g,E,J.data)){const ce=Nl(E,n,s,w,l,U);if(ce!==dl)return ce}P=n[E+8],-1!==P&&zc(l,n[1].data[E+8]===U)&&lc(g,E,n)?(w=J,E=Ls(P),n=ta(P,n)):E=-1}}}return sc(n,s,l,d)}const dl={};function pl(){return new L(yi(),Mt())}function Nl(t,n,s,l,d,g){const w=n[1],E=w.data[t+8],J=zl(E,w,s,null==l?Ei(E)&&al:l!=w&&0!=(3&E.type),d&Je.Host&&g===E);return null!==J?Ga(n,w,J,E):dl}function zl(t,n,s,l,d){const g=t.providerIndexes,w=n.data,E=1048575&g,P=t.directiveStart,J=g>>20,_e=d?E+J:t.directiveEnd;for(let ke=l?E:E+J;ke<_e;ke++){const Ue=w[ke];if(ke<P&&s===Ue||ke>=P&&Ue.type===s)return ke}if(d){const ke=w[P];if(ke&&kt(ke)&&ke.type===s)return P}return null}function Ga(t,n,s,l){let d=t[s];const g=n.data;if(function(t){return t instanceof Fl}(d)){const w=d;w.resolving&&function(t,n){throw new Kr("200",`Circular dependency in DI detected for ${t}`)}(qn(g[s]));const E=ll(w.canSeeViewProviders);w.resolving=!0;const P=w.injectImpl?Xt(w.injectImpl):null;kl(t,l,Je.Default);try{d=t[s]=w.factory(void 0,g,t,l),n.firstCreatePass&&s>=l.directiveStart&&function(t,n,s){const{ngOnChanges:l,ngOnInit:d,ngDoCheck:g}=n.type.prototype;if(l){const w=gi(n);(s.preOrderHooks||(s.preOrderHooks=[])).push(t,w),(s.preOrderCheckHooks||(s.preOrderCheckHooks=[])).push(t,w)}d&&(s.preOrderHooks||(s.preOrderHooks=[])).push(0-t,d),g&&((s.preOrderHooks||(s.preOrderHooks=[])).push(t,g),(s.preOrderCheckHooks||(s.preOrderCheckHooks=[])).push(t,g))}(s,g[s],n)}finally{null!==P&&Xt(P),ll(E),w.resolving=!1,Ol()}}return d}function lc(t,n,s){return!!(s[n+(t>>5)]&1<<t)}function zc(t,n){return!(t&Je.Self||t&Je.Host&&n)}class L{constructor(n,s){this._tNode=n,this._lView=s}get(n,s,l){return Nc(this._tNode,this._lView,n,l,s)}}function M(t){return Nn(()=>{const n=t.prototype.constructor,s=n[Ie]||A(n),l=Object.prototype;let d=Object.getPrototypeOf(t.prototype).constructor;for(;d&&d!==l;){const g=d[Ie]||A(d);if(g&&g!==s)return g;d=Object.getPrototypeOf(d)}return g=>new g})}function A(t){return vr(t)?()=>{const n=A(jt(t));return n&&n()}:Ar(t)}function V(t){return function(t,n){if("class"===n)return t.classes;if("style"===n)return t.styles;const s=t.attrs;if(s){const l=s.length;let d=0;for(;d<l;){const g=s[d];if(Ua(g))break;if(0===g)d+=2;else if("number"==typeof g)for(d++;d<l&&"string"==typeof s[d];)d++;else{if(g===n)return s[d+1];d+=2}}}return null}(yi(),t)}const oe="__parameters__",we="__prop__metadata__";function ft(t){return function(...s){if(t){const l=t(...s);for(const d in l)this[d]=l[d]}}}function en(t,n,s){return Nn(()=>{const l=ft(n);function d(...g){if(this instanceof d)return l.apply(this,g),this;const w=new d(...g);return E.annotation=w,E;function E(P,U,J){const ce=P.hasOwnProperty(oe)?P[oe]:Object.defineProperty(P,oe,{value:[]})[oe];for(;ce.length<=J;)ce.push(null);return(ce[J]=ce[J]||[]).push(w),P}}return s&&(d.prototype=Object.create(s.prototype)),d.prototype.ngMetadataName=t,d.annotationCls=d,d})}function Rr(t,n,s,l){return Nn(()=>{const d=ft(n);function g(...w){if(this instanceof g)return d.apply(this,w),this;const E=new g(...w);return function(U,J){const ce=U.constructor,_e=ce.hasOwnProperty(we)?ce[we]:Object.defineProperty(ce,we,{value:{}})[we];_e[J]=_e.hasOwnProperty(J)&&_e[J]||[],_e[J].unshift(E),l&&l(U,J,...w)}}return s&&(g.prototype=Object.create(s.prototype)),g.prototype.ngMetadataName=t,g.annotationCls=g,g})}class kr{constructor(n,s){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof s?this.__NG_ELEMENT_ID__=s:void 0!==s&&(this.\u0275prov=hr({token:this,providedIn:s.providedIn||"root",factory:s.factory}))}toString(){return`InjectionToken ${this._desc}`}}const Ht=new kr("AnalyzeForEntryComponents");class pa{}const i=Rr("ContentChild",(t,n={})=>Object.assign({selector:t,first:!0,isViewQuery:!1,descendants:!0},n),pa),j=Function;function he(t,n){void 0===n&&(n=t);for(let s=0;s<t.length;s++){let l=t[s];Array.isArray(l)?(n===t&&(n=t.slice(0,s)),he(l,n)):n!==t&&n.push(l)}return n}function ue(t,n){t.forEach(s=>Array.isArray(s)?ue(s,n):n(s))}function fe(t,n,s){n>=t.length?t.push(s):t.splice(n,0,s)}function Se(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}function et(t,n,s){let l=bt(t,n);return l>=0?t[1|l]=s:(l=~l,function(t,n,s,l){let d=t.length;if(d==n)t.push(s,l);else if(1===d)t.push(l,t[0]),t[0]=s;else{for(d--,t.push(t[d-1],t[d]);d>n;)t[d]=t[d-2],d--;t[n]=s,t[n+1]=l}}(t,l,n,s)),l}function Ft(t,n){const s=bt(t,n);if(s>=0)return t[1|s]}function bt(t,n){return function(t,n,s){let l=0,d=t.length>>s;for(;d!==l;){const g=l+(d-l>>1),w=t[g<<s];if(n===w)return g<<s;w>n?d=g:l=g+1}return~(d<<s)}(t,n,1)}const Or={},Yr="__NG_DI_FLAG__",vn="ngTempTokenPath",vi=/\n/gm,rs="__source",Bs=_t({provide:String,useValue:_t});let cr;function En(t){const n=cr;return cr=t,n}function _r(t,n=Je.Default){if(void 0===cr)throw new Error("inject() must be called from an injection context");return null===cr?_n(t,void 0,n):cr.get(t,n&Je.Optional?null:void 0,n)}function ir(t,n=Je.Default){return(Zt||_r)(jt(t),n)}function Io(t){const n=[];for(let s=0;s<t.length;s++){const l=jt(t[s]);if(Array.isArray(l)){if(0===l.length)throw new Error("Arguments array must have arguments.");let d,g=Je.Default;for(let w=0;w<l.length;w++){const E=l[w],P=Ds(E);"number"==typeof P?-1===P?d=E.token:g|=P:d=E}n.push(ir(d,g))}else n.push(ir(l))}return n}function Ha(t,n){return t[Yr]=n,t.prototype[Yr]=n,t}function Ds(t){return t[Yr]}function fl(t,n,s,l){const d=t[vn];throw n[rs]&&d.unshift(n[rs]),t.message=function(t,n,s,l=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let d=ut(n);if(Array.isArray(n))d=n.map(ut).join(" -> ");else if("object"==typeof n){let g=[];for(let w in n)if(n.hasOwnProperty(w)){let E=n[w];g.push(w+":"+("string"==typeof E?JSON.stringify(E):ut(E)))}d=`{${g.join(", ")}}`}return`${s}${l?"("+l+")":""}[${d}]: ${t.replace(vi,"\n  ")}`}("\n"+t.message,d,s,l),t.ngTokenPath=d,t[vn]=null,t}const Bi=Ha(en("Inject",t=>({token:t})),-1),_s=Ha(en("Optional"),8),ki=Ha(en("SkipSelf"),4);let yu;function cc(t){var n;return(null===(n=function(){if(void 0===yu&&(yu=null,Qn.trustedTypes))try{yu=Qn.trustedTypes.createPolicy("angular",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch(t){}return yu}())||void 0===n?void 0:n.createHTML(t))||t}class Vl{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Ff extends Vl{getTypeName(){return"HTML"}}class Yd extends Vl{getTypeName(){return"Style"}}class Lf extends Vl{getTypeName(){return"Script"}}class Nf extends Vl{getTypeName(){return"URL"}}class zf extends Vl{getTypeName(){return"ResourceURL"}}function ml(t){return t instanceof Vl?t.changingThisBreaksApplicationSecurity:t}function jc(t,n){const s=Xd(t);if(null!=s&&s!==n){if("ResourceURL"===s&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${s} (see https://g.co/ng/security#xss)`)}return s===n}function Xd(t){return t instanceof Vl&&t.getTypeName()||null}function Bf(t){return new Ff(t)}function Vf(t){return new Yd(t)}function Uf(t){return new Lf(t)}function jf(t){return new Nf(t)}function qg(t){return new zf(t)}class Zf{constructor(n){this.inertDocumentHelper=n}getInertBodyElement(n){n="<body><remove></remove>"+n;try{const s=(new window.DOMParser).parseFromString(cc(n),"text/html").body;return null===s?this.inertDocumentHelper.getInertBodyElement(n):(s.removeChild(s.firstChild),s)}catch(s){return null}}}class Wg{constructor(n){if(this.defaultDoc=n,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const s=this.inertDocument.createElement("html");this.inertDocument.appendChild(s);const l=this.inertDocument.createElement("body");s.appendChild(l)}}getInertBodyElement(n){const s=this.inertDocument.createElement("template");if("content"in s)return s.innerHTML=cc(n),s;const l=this.inertDocument.createElement("body");return l.innerHTML=cc(n),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(l),l}stripCustomNsAttrs(n){const s=n.attributes;for(let d=s.length-1;0<d;d--){const w=s.item(d).name;("xmlns:ns1"===w||0===w.indexOf("ns1:"))&&n.removeAttribute(w)}let l=n.firstChild;for(;l;)l.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(l),l=l.nextSibling}}const Yg=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Gf=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function $c(t){return(t=String(t)).match(Yg)||t.match(Gf)?t:"unsafe:"+t}function is(t){const n={};for(const s of t.split(","))n[s]=!0;return n}function hc(...t){const n={};for(const s of t)for(const l in s)s.hasOwnProperty(l)&&(n[l]=!0);return n}const Jd=is("area,br,col,hr,img,wbr"),Qd=is("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Hf=is("rp,rt"),Zc=hc(Jd,hc(Qd,is("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),hc(Hf,is("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),hc(Hf,Qd)),dc=is("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Wa=is("srcset"),_l=hc(dc,Wa,is("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),is("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),Hc=is("script,style,template");class Xg{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(n){let s=n.firstChild,l=!0;for(;s;)if(s.nodeType===Node.ELEMENT_NODE?l=this.startElement(s):s.nodeType===Node.TEXT_NODE?this.chars(s.nodeValue):this.sanitizedSomething=!0,l&&s.firstChild)s=s.firstChild;else for(;s;){s.nodeType===Node.ELEMENT_NODE&&this.endElement(s);let d=this.checkClobberedElement(s,s.nextSibling);if(d){s=d;break}s=this.checkClobberedElement(s,s.parentNode)}return this.buf.join("")}startElement(n){const s=n.nodeName.toLowerCase();if(!Zc.hasOwnProperty(s))return this.sanitizedSomething=!0,!Hc.hasOwnProperty(s);this.buf.push("<"),this.buf.push(s);const l=n.attributes;for(let d=0;d<l.length;d++){const g=l.item(d),w=g.name,E=w.toLowerCase();if(!_l.hasOwnProperty(E)){this.sanitizedSomething=!0;continue}let P=g.value;dc[E]&&(P=$c(P)),Wa[E]&&(t=P,P=(t=String(t)).split(",").map(n=>$c(n.trim())).join(", ")),this.buf.push(" ",w,'="',Wf(P),'"')}var t;return this.buf.push(">"),!0}endElement(n){const s=n.nodeName.toLowerCase();Zc.hasOwnProperty(s)&&!Jd.hasOwnProperty(s)&&(this.buf.push("</"),this.buf.push(s),this.buf.push(">"))}chars(n){this.buf.push(Wf(n))}checkClobberedElement(n,s){if(s&&(n.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${n.outerHTML}`);return s}}const Kg=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Jg=/([^\#-~ |!])/g;function Wf(t){return t.replace(/&/g,"&amp;").replace(Kg,function(n){return"&#"+(1024*(n.charCodeAt(0)-55296)+(n.charCodeAt(1)-56320)+65536)+";"}).replace(Jg,function(n){return"&#"+n.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Hu;function qu(t,n){let s=null;try{Hu=Hu||function(t){const n=new Wg(t);return function(){try{return!!(new window.DOMParser).parseFromString(cc(""),"text/html")}catch(t){return!1}}()?new Zf(n):n}(t);let l=n?String(n):"";s=Hu.getInertBodyElement(l);let d=5,g=l;do{if(0===d)throw new Error("Failed to sanitize html because the input is unstable");d--,l=g,g=s.innerHTML,s=Hu.getInertBodyElement(l)}while(l!==g);return cc((new Xg).sanitizeChildren(_a(s)||s))}finally{if(s){const l=_a(s)||s;for(;l.firstChild;)l.removeChild(l.firstChild)}}}function _a(t){return"content"in t&&function(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}var xo=(()=>((xo=xo||{})[xo.NONE=0]="NONE",xo[xo.HTML=1]="HTML",xo[xo.STYLE=2]="STYLE",xo[xo.SCRIPT=3]="SCRIPT",xo[xo.URL=4]="URL",xo[xo.RESOURCE_URL=5]="RESOURCE_URL",xo))();function Ul(t){const n=function(){const t=Mt();return t&&t[12]}();return n?n.sanitize(xo.URL,t)||"":jc(t,"URL")?ml(t):$c(Jt(t))}const Oh="__ngContext__";function Ss(t,n){t[Oh]=n}function Fh(t){const n=function(t){return t[Oh]||null}(t);return n?Array.isArray(n)?n:n.lView:null}function zh(t){return t.ngOriginalError}function Bh(t,...n){t.error(...n)}class Wc{constructor(){this._console=console}handleError(n){const s=this._findOriginalError(n),l=this._findContext(n),d=(t=n)&&t.ngErrorLogger||Bh;var t;d(this._console,"ERROR",n),s&&d(this._console,"ORIGINAL ERROR",s),l&&d(this._console,"ERROR CONTEXT",l)}_findContext(n){return n?n.ngDebugContext||this._findContext(zh(n)):null}_findOriginalError(n){let s=n&&zh(n);for(;s&&zh(s);)s=zh(s);return s||null}}const ap=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Qn))();function Sa(t){return t instanceof Function?t():t}var vl=(()=>((vl=vl||{})[vl.Important=1]="Important",vl[vl.DashCase=2]="DashCase",vl))();function Vh(t,n){return undefined(t,n)}function Ju(t){const n=t[3];return ti(n)?n[3]:n}function up(t){return am(t[13])}function hp(t){return am(t[4])}function am(t){for(;null!==t&&!ti(t);)t=t[4];return t}function _c(t,n,s,l,d){if(null!=l){let g,w=!1;ti(l)?g=l:nr(l)&&(w=!0,l=l[0]);const E=ar(l);0===t&&null!==s?null==d?dm(n,s,E):$l(n,s,E,d||null,!0):1===t&&null!==s?$l(n,s,E,d||null,!0):2===t?function(t,n,s){const l=Kc(t,n);l&&function(t,n,s,l){yt(t)?t.removeChild(n,s,l):n.removeChild(s)}(t,l,n,s)}(n,E,w):3===t&&n.destroyNode(E),null!=g&&function(t,n,s,l,d){const g=s[7];g!==ar(s)&&_c(n,t,l,g,d);for(let E=10;E<s.length;E++){const P=s[E];th(P[1],P,t,n,l,g)}}(n,t,g,s,d)}}function Vi(t,n,s){return yt(t)?t.createElement(n,s):null===s?t.createElement(n):t.createElementNS(s,n)}function pp(t,n){const s=t[9],l=s.indexOf(n),d=n[3];1024&n[2]&&(n[2]&=-1025,Ca(d,-1)),s.splice(l,1)}function Xc(t,n){if(t.length<=10)return;const s=10+n,l=t[s];if(l){const d=l[17];null!==d&&d!==t&&pp(d,l),n>0&&(t[s-1][4]=l[4]);const g=Se(t,10+n);!function(t,n){th(t,n,n[11],2,null,null),n[0]=null,n[6]=null}(l[1],l);const w=g[19];null!==w&&w.detachView(g[1]),l[3]=null,l[4]=null,l[2]&=-129}return l}function Zh(t,n){if(!(256&n[2])){const s=n[11];yt(s)&&s.destroyNode&&th(t,n,s,3,null,null),function(t){let n=t[13];if(!n)return eh(t[1],t);for(;n;){let s=null;if(nr(n))s=n[13];else{const l=n[10];l&&(s=l)}if(!s){for(;n&&!n[4]&&n!==t;)nr(n)&&eh(n[1],n),n=n[3];null===n&&(n=t),nr(n)&&eh(n[1],n),s=n&&n[4]}n=s}}(n)}}function eh(t,n){if(!(256&n[2])){n[2]&=-129,n[2]|=256,function(t,n){let s;if(null!=t&&null!=(s=t.destroyHooks))for(let l=0;l<s.length;l+=2){const d=n[s[l]];if(!(d instanceof Fl)){const g=s[l+1];if(Array.isArray(g))for(let w=0;w<g.length;w+=2){const E=d[g[w]],P=g[w+1];try{P.call(E)}finally{}}else try{g.call(d)}finally{}}}}(t,n),function(t,n){const s=t.cleanup,l=n[7];let d=-1;if(null!==s)for(let g=0;g<s.length-1;g+=2)if("string"==typeof s[g]){const w=s[g+1],E="function"==typeof w?w(n):ar(n[w]),P=l[d=s[g+2]],U=s[g+3];"boolean"==typeof U?E.removeEventListener(s[g],P,U):U>=0?l[d=U]():l[d=-U].unsubscribe(),g+=2}else{const w=l[d=s[g+1]];s[g].call(w)}if(null!==l){for(let g=d+1;g<l.length;g++)l[g]();n[7]=null}}(t,n),1===n[1].type&&yt(n[11])&&n[11].destroy();const s=n[17];if(null!==s&&ti(n[3])){s!==n[3]&&pp(s,n);const l=n[19];null!==l&&l.detachView(t)}}}function Tu(t,n,s){return function(t,n,s){let l=n;for(;null!==l&&40&l.type;)l=(n=l).parent;if(null===l)return s[0];if(2&l.flags){const d=t.data[l.directiveStart].encapsulation;if(d===rn.None||d===rn.Emulated)return null}return _i(l,s)}(t,n.parent,s)}function $l(t,n,s,l,d){yt(t)?t.insertBefore(n,s,l,d):n.insertBefore(s,l,d)}function dm(t,n,s){yt(t)?t.appendChild(n,s):n.appendChild(s)}function Gh(t,n,s,l,d){null!==l?$l(t,n,s,l,d):dm(t,n,s)}function Kc(t,n){return yt(t)?t.parentNode(n):n.parentNode}let mm=function(t,n,s){return 40&t.type?_i(t,s):null};function Zl(t,n,s,l){const d=Tu(t,l,n),g=n[11],E=function(t,n,s){return mm(t,n,s)}(l.parent||n[6],l,n);if(null!=d)if(Array.isArray(s))for(let P=0;P<s.length;P++)Gh(g,d,s[P],E,!1);else Gh(g,d,s,E,!1)}function Hh(t,n){if(null!==n){const s=n.type;if(3&s)return _i(n,t);if(4&s)return qh(-1,t[n.index]);if(8&s){const l=n.child;if(null!==l)return Hh(t,l);{const d=t[n.index];return ti(d)?qh(-1,d):ar(d)}}if(32&s)return Vh(n,t)()||ar(t[n.index]);{const l=gm(t,n);return null!==l?Array.isArray(l)?l[0]:Hh(Ju(t[16]),l):Hh(t,n.next)}}return null}function gm(t,n){return null!==n?t[16][6].projection[n.projection]:null}function qh(t,n){const s=10+t+1;if(s<n.length){const l=n[s],d=l[1].firstChild;if(null!==d)return Hh(l,d)}return n[7]}function yp(t,n,s,l,d,g,w){for(;null!=s;){const E=l[s.index],P=s.type;if(w&&0===n&&(E&&Ss(ar(E),l),s.flags|=4),64!=(64&s.flags))if(8&P)yp(t,n,s.child,l,d,g,!1),_c(n,t,d,E,g);else if(32&P){const U=Vh(s,l);let J;for(;J=U();)_c(n,t,d,J,g);_c(n,t,d,E,g)}else 16&P?_m(t,n,l,s,d,g):_c(n,t,d,E,g);s=w?s.projectionNext:s.next}}function th(t,n,s,l,d,g){yp(s,l,t.firstChild,n,d,g,!1)}function _m(t,n,s,l,d,g){const w=s[16],P=w[6].projection[l.projection];if(Array.isArray(P))for(let U=0;U<P.length;U++)_c(n,t,d,P[U],g);else yp(t,n,P,w[3],d,g,!0)}function vp(t,n,s){yt(t)?t.setAttribute(n,"style",s):n.style.cssText=s}function rh(t,n,s){yt(t)?""===s?t.removeAttribute(n,"class"):t.setAttribute(n,"class",s):n.className=s}function ym(t,n,s){let l=t.length;for(;;){const d=t.indexOf(n,s);if(-1===d)return d;if(0===d||t.charCodeAt(d-1)<=32){const g=n.length;if(d+g===l||t.charCodeAt(d+g)<=32)return d}s=d+1}}const Du="ng-template";function vm(t,n,s){let l=0;for(;l<t.length;){let d=t[l++];if(s&&"class"===d){if(d=t[l],-1!==ym(d.toLowerCase(),n,0))return!0}else if(1===d){for(;l<t.length&&"string"==typeof(d=t[l++]);)if(d.toLowerCase()===n)return!0;return!1}}return!1}function xp(t){return 4===t.type&&t.value!==Du}function u_(t,n,s){return n===(4!==t.type||s?t.value:Du)}function h_(t,n,s){let l=4;const d=t.attrs||[],g=function(t){for(let n=0;n<t.length;n++)if(Ua(t[n]))return n;return t.length}(d);let w=!1;for(let E=0;E<n.length;E++){const P=n[E];if("number"!=typeof P){if(!w)if(4&l){if(l=2|1&l,""!==P&&!u_(t,P,s)||""===P&&1===n.length){if(Xa(l))return!1;w=!0}}else{const U=8&l?P:n[++E];if(8&l&&null!==t.attrs){if(!vm(t.attrs,U,s)){if(Xa(l))return!1;w=!0}continue}const ce=d_(8&l?"class":P,d,xp(t),s);if(-1===ce){if(Xa(l))return!1;w=!0;continue}if(""!==U){let _e;_e=ce>g?"":d[ce+1].toLowerCase();const ke=8&l?_e:null;if(ke&&-1!==ym(ke,U,0)||2&l&&U!==_e){if(Xa(l))return!1;w=!0}}}}else{if(!w&&!Xa(l)&&!Xa(P))return!1;if(w&&Xa(P))continue;w=!1,l=P|1&l}}return Xa(l)||w}function Xa(t){return 0==(1&t)}function d_(t,n,s,l){if(null===n)return-1;let d=0;if(l||!s){let g=!1;for(;d<n.length;){const w=n[d];if(w===t)return d;if(3===w||6===w)g=!0;else{if(1===w||2===w){let E=n[++d];for(;"string"==typeof E;)E=n[++d];continue}if(4===w)break;if(0===w){d+=4;continue}}d+=g?1:2}return-1}return function(t,n){let s=t.indexOf(4);if(s>-1)for(s++;s<t.length;){const l=t[s];if("number"==typeof l)return-1;if(l===n)return s;s++}return-1}(n,t)}function xm(t,n,s=!1){for(let l=0;l<n.length;l++)if(h_(t,n[l],s))return!0;return!1}function bp(t,n){return t?":not("+n.trim()+")":n}function bm(t){let n=t[0],s=1,l=2,d="",g=!1;for(;s<t.length;){let w=t[s];if("string"==typeof w)if(2&l){const E=t[++s];d+="["+w+(E.length>0?'="'+E+'"':"")+"]"}else 8&l?d+="."+w:4&l&&(d+=" "+w);else""!==d&&!Xa(w)&&(n+=bp(g,d),d=""),l=w,g=g||!Xa(l);s++}return""!==d&&(n+=bp(g,d)),n}const er={};function Cm(t){Em(br(),Mt(),_o()+t,Ks())}function Em(t,n,s,l){if(!l)if(3==(3&n[2])){const g=t.preOrderCheckHooks;null!==g&&Va(n,g,s)}else{const g=t.preOrderHooks;null!==g&&Ta(n,g,0,s)}ms(s)}function ih(t,n){return t<<17|n<<2}function Ka(t){return t>>17&32767}function oh(t){return 2|t}function Ia(t){return(131068&t)>>2}function yc(t,n){return-131069&t|n<<2}function wp(t){return 1|t}function Jh(t,n){const s=t.contentQueries;if(null!==s)for(let l=0;l<s.length;l+=2){const d=s[l],g=s[l+1];if(-1!==g){const w=t.data[g];zo(d),w.contentQueries(2,n[g],g)}}}function uh(t,n,s,l,d,g,w,E,P,U){const J=n.blueprint.slice();return J[0]=d,J[2]=140|l,Oa(J),J[3]=J[15]=t,J[8]=s,J[10]=w||t&&t[10],J[11]=E||t&&t[11],J[12]=P||t&&t[12]||null,J[9]=U||t&&t[9]||null,J[6]=g,J[16]=2==n.type?t[16]:J,J}function tu(t,n,s,l,d){let g=t.data[n];if(null===g)g=function(t,n,s,l,d){const g=La(),w=nl(),P=t.data[n]=function(t,n,s,l,d,g){return{type:s,index:l,insertBeforeIndex:null,injectorIndex:n?n.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:d,attrs:g,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,w?g:g&&g.parent,s,n,l,d);return null===t.firstChild&&(t.firstChild=P),null!==g&&(w?null==g.child&&null!==P.parent&&(g.child=P):null===g.next&&(g.next=P)),P}(t,n,s,l,d),Sn.lFrame.inI18n&&(g.flags|=64);else if(64&g.type){g.type=s,g.value=l,g.attrs=d;const w=function(){const t=Sn.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}();g.injectorIndex=null===w?-1:w.injectorIndex}return go(g,!0),g}function nu(t,n,s,l){if(0===s)return-1;const d=n.length;for(let g=0;g<s;g++)n.push(l),t.blueprint.push(l),t.data.push(null);return d}function Mu(t,n,s){rl(n);try{const l=t.viewQuery;null!==l&&yh(1,l,s);const d=t.template;null!==d&&Lm(t,n,d,1,s),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&Jh(t,n),t.staticViewQueries&&yh(2,t.viewQuery,s);const g=t.components;null!==g&&function(t,n){for(let s=0;s<n.length;s++)A_(t,n[s])}(n,g)}catch(l){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),l}finally{n[2]&=-5,Ea()}}function ru(t,n,s,l){const d=n[2];if(256==(256&d))return;rl(n);const g=Ks();try{Oa(n),function(t){Sn.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==s&&Lm(t,n,s,2,l);const w=3==(3&d);if(!g)if(w){const U=t.preOrderCheckHooks;null!==U&&Va(n,U,null)}else{const U=t.preOrderHooks;null!==U&&Ta(n,U,0,null),zi(n,0)}if(function(t){for(let n=up(t);null!==n;n=hp(n)){if(!n[2])continue;const s=n[9];for(let l=0;l<s.length;l++){const d=s[l],g=d[3];0==(1024&d[2])&&Ca(g,1),d[2]|=1024}}}(n),function(t){for(let n=up(t);null!==n;n=hp(n))for(let s=10;s<n.length;s++){const l=n[s],d=l[1];Ws(l)&&ru(d,l,d.template,l[8])}}(n),null!==t.contentQueries&&Jh(t,n),!g)if(w){const U=t.contentCheckHooks;null!==U&&Va(n,U)}else{const U=t.contentHooks;null!==U&&Ta(n,U,1),zi(n,1)}!function(t,n){const s=t.hostBindingOpCodes;if(null!==s)try{for(let l=0;l<s.length;l++){const d=s[l];if(d<0)ms(~d);else{const g=d,w=s[++l],E=s[++l];jn(w,g),E(2,n[g])}}}finally{ms(-1)}}(t,n);const E=t.components;null!==E&&function(t,n){for(let s=0;s<n.length;s++)D_(t,n[s])}(n,E);const P=t.viewQuery;if(null!==P&&yh(2,P,l),!g)if(w){const U=t.viewCheckHooks;null!==U&&Va(n,U)}else{const U=t.viewHooks;null!==U&&Ta(n,U,2),zi(n,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),g||(n[2]&=-73),1024&n[2]&&(n[2]&=-1025,Ca(n[3],-1))}finally{Ea()}}function Fm(t,n,s,l){const d=n[10],g=!Ks(),w=ps(n);try{g&&!w&&d.begin&&d.begin(),w&&Mu(t,n,l),ru(t,n,s,l)}finally{g&&!w&&d.end&&d.end()}}function Lm(t,n,s,l,d){const g=_o(),w=2&l;try{ms(-1),w&&n.length>20&&Em(t,n,20,Ks()),s(l,d)}finally{ms(g)}}function Nm(t,n,s){if(Gi(n)){const d=n.directiveEnd;for(let g=n.directiveStart;g<d;g++){const w=t.data[g];w.contentQueries&&w.contentQueries(1,s[g],g)}}}function Qh(t,n,s){!fs()||(function(t,n,s,l){const d=s.directiveStart,g=s.directiveEnd;t.firstCreatePass||$a(s,n),Ss(l,n);const w=s.initialInputs;for(let E=d;E<g;E++){const P=t.data[E],U=kt(P);U&&Pp(n,s,P);const J=Ga(n,t,E,s);Ss(J,n),null!==w&&Rp(0,E-d,J,P,0,w),U&&(xr(s.index,n)[8]=J)}}(t,n,s,_i(s,n)),128==(128&s.flags)&&function(t,n,s){const l=s.directiveStart,d=s.directiveEnd,w=s.index,E=Sn.lFrame.currentDirectiveIndex;try{ms(w);for(let P=l;P<d;P++){const U=t.data[P],J=n[P];qi(P),(null!==U.hostBindings||0!==U.hostVars||null!==U.hostAttrs)&&Ip(U,J)}}finally{ms(-1),qi(E)}}(t,n,s))}function ed(t,n,s=_i){const l=n.localNames;if(null!==l){let d=n.index+1;for(let g=0;g<l.length;g+=2){const w=l[g+1],E=-1===w?s(n,t):t[w];t[d++]=E}}}function Su(t){const n=t.tView;return null===n||n.incompleteFirstPass?t.tView=hh(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):n}function hh(t,n,s,l,d,g,w,E,P,U){const J=20+l,ce=J+d,_e=function(t,n){const s=[];for(let l=0;l<n;l++)s.push(l<t?null:er);return s}(J,ce),ke="function"==typeof U?U():U;return _e[1]={type:t,blueprint:_e,template:s,queries:null,viewQuery:E,declTNode:n,data:_e.slice().fill(null,J),bindingStartIndex:J,expandoStartIndex:ce,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof g?g():g,pipeRegistry:"function"==typeof w?w():w,firstChild:null,schemas:P,consts:ke,incompleteFirstPass:!1}}function ph(t,n,s,l){const d=Lp(n);null===s?d.push(l):(d.push(s),t.firstCreatePass&&Gm(t).push(l,d.length-1))}function fh(t,n,s){for(let l in t)if(t.hasOwnProperty(l)){const d=t[l];(s=null===s?{}:s).hasOwnProperty(l)?s[l].push(n,d):s[l]=[n,d]}return s}function va(t,n,s,l,d,g,w,E){const P=_i(n,s);let J,U=n.inputs;!E&&null!=U&&(J=U[l])?(pd(t,s,J,l,d),Ei(n)&&function(t,n){const s=xr(n,t);16&s[2]||(s[2]|=64)}(s,n.index)):3&n.type&&(l=function(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(l),d=null!=w?w(d,n.value||"",l):d,yt(g)?g.setProperty(P,l,d):ja(l)||(P.setProperty?P.setProperty(l,d):P[l]=d))}function Sp(t,n,s,l){let d=!1;if(fs()){const g=function(t,n,s){const l=t.directiveRegistry;let d=null;if(l)for(let g=0;g<l.length;g++){const w=l[g];xm(s,w.selectors,!1)&&(d||(d=[]),ul($a(s,n),t,w.type),kt(w)?(sd(t,s),d.unshift(w)):d.push(w))}return d}(t,n,s),w=null===l?null:{"":-1};if(null!==g){d=!0,jm(s,t.data.length,g.length);for(let J=0;J<g.length;J++){const ce=g[J];ce.providersResolver&&ce.providersResolver(ce)}let E=!1,P=!1,U=nu(t,n,g.length,null);for(let J=0;J<g.length;J++){const ce=g[J];s.mergedAttrs=Es(s.mergedAttrs,ce.hostAttrs),gh(t,s,n,U,ce),T_(U,ce,w),null!==ce.contentQueries&&(s.flags|=8),(null!==ce.hostBindings||null!==ce.hostAttrs||0!==ce.hostVars)&&(s.flags|=128);const _e=ce.type.prototype;!E&&(_e.ngOnChanges||_e.ngOnInit||_e.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(s.index),E=!0),!P&&(_e.ngOnChanges||_e.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(s.index),P=!0),U++}!function(t,n){const l=n.directiveEnd,d=t.data,g=n.attrs,w=[];let E=null,P=null;for(let U=n.directiveStart;U<l;U++){const J=d[U],ce=J.inputs,_e=null===g||xp(n)?null:Cc(ce,g);w.push(_e),E=fh(ce,U,E),P=fh(J.outputs,U,P)}null!==E&&(E.hasOwnProperty("class")&&(n.flags|=16),E.hasOwnProperty("style")&&(n.flags|=32)),n.initialInputs=w,n.inputs=E,n.outputs=P}(t,s)}w&&function(t,n,s){if(n){const l=t.localNames=[];for(let d=0;d<n.length;d+=2){const g=s[n[d+1]];if(null==g)throw new Kr("301",`Export of name '${n[d+1]}' not found!`);l.push(n[d],g)}}}(s,l,w)}return s.mergedAttrs=Es(s.mergedAttrs,s.attrs),d}function id(t,n,s,l,d,g){const w=g.hostBindings;if(w){let E=t.hostBindingOpCodes;null===E&&(E=t.hostBindingOpCodes=[]);const P=~n.index;(function(t){let n=t.length;for(;n>0;){const s=t[--n];if("number"==typeof s&&s<0)return s}return 0})(E)!=P&&E.push(P),E.push(l,d,w)}}function Ip(t,n){null!==t.hostBindings&&t.hostBindings(1,n)}function sd(t,n){n.flags|=2,(t.components||(t.components=[])).push(n.index)}function T_(t,n,s){if(s){if(n.exportAs)for(let l=0;l<n.exportAs.length;l++)s[n.exportAs[l]]=t;kt(n)&&(s[""]=t)}}function jm(t,n,s){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+s,t.providerIndexes=n}function gh(t,n,s,l,d){t.data[l]=d;const g=d.factory||(d.factory=Ar(d.type)),w=new Fl(g,kt(d),null);t.blueprint[l]=w,s[l]=w,id(t,n,0,l,nu(t,s,d.hostVars,er),d)}function Pp(t,n,s){const l=_i(n,t),d=Su(s),g=t[10],w=Iu(t,uh(t,d,null,s.onPush?64:16,l,n,g,g.createRenderer(l,s),null,null));t[n.index]=w}function Cl(t,n,s,l,d,g){const w=_i(t,n);!function(t,n,s,l,d,g,w){if(null==g)yt(t)?t.removeAttribute(n,d,s):n.removeAttribute(d);else{const E=null==w?Jt(g):w(g,l||"",d);yt(t)?t.setAttribute(n,d,E,s):s?n.setAttributeNS(s,d,E):n.setAttribute(d,E)}}(n[11],w,g,t.value,s,l,d)}function Rp(t,n,s,l,d,g){const w=g[n];if(null!==w){const E=l.setInput;for(let P=0;P<w.length;){const U=w[P++],J=w[P++],ce=w[P++];null!==E?l.setInput(s,ce,U,J):s[J]=ce}}}function Cc(t,n){let s=null,l=0;for(;l<n.length;){const d=n[l];if(0!==d)if(5!==d){if("number"==typeof d)break;t.hasOwnProperty(d)&&(null===s&&(s=[]),s.push(d,t[d],n[l+1])),l+=2}else l+=2;else l+=4}return s}function ad(t,n,s,l){return new Array(t,!0,!1,n,null,0,l,s,null,null)}function D_(t,n){const s=xr(n,t);if(Ws(s)){const l=s[1];80&s[2]?ru(l,s,l.template,s[8]):s[5]>0&&kp(s)}}function kp(t){for(let l=up(t);null!==l;l=hp(l))for(let d=10;d<l.length;d++){const g=l[d];if(1024&g[2]){const w=g[1];ru(w,g,w.template,g[8])}else g[5]>0&&kp(g)}const s=t[1].components;if(null!==s)for(let l=0;l<s.length;l++){const d=xr(s[l],t);Ws(d)&&d[5]>0&&kp(d)}}function A_(t,n){const s=xr(n,t),l=s[1];(function(t,n){for(let s=n.length;s<t.blueprint.length;s++)n.push(t.blueprint[s])})(l,s),Mu(l,s,s[8])}function Iu(t,n){return t[13]?t[14][4]=n:t[13]=n,t[14]=n,n}function Op(t){for(;t;){t[2]|=64;const n=Ju(t);if(Bn(t)&&!n)return t;t=n}return null}function ud(t,n,s){const l=n[10];l.begin&&l.begin();try{ru(t,n,t.template,s)}catch(d){throw vh(n,d),d}finally{l.end&&l.end()}}function Fp(t){!function(t){for(let n=0;n<t.components.length;n++){const s=t.components[n],l=Fh(s),d=l[1];Fm(d,l,d.template,s)}}(t[8])}function yh(t,n,s){zo(0),n(t,s)}const S_=(()=>Promise.resolve(null))();function Lp(t){return t[7]||(t[7]=[])}function Gm(t){return t.cleanup||(t.cleanup=[])}function vh(t,n){const s=t[9],l=s?s.get(Wc,null):null;l&&l.handleError(n)}function pd(t,n,s,l,d){for(let g=0;g<s.length;){const w=s[g++],E=s[g++],P=n[w],U=t.data[w];null!==U.setInput?U.setInput(P,d,l,E):P[E]=d}}function oo(t,n,s){const l=So(n,t);!function(t,n,s){yt(t)?t.setValue(n,s):n.textContent=s}(t[11],l,s)}function Ec(t,n,s){let l=s?t.styles:null,d=s?t.classes:null,g=0;if(null!==n)for(let w=0;w<n.length;w++){const E=n[w];"number"==typeof E?g=E:1==g?d=qt(d,E):2==g&&(l=qt(l,E+": "+n[++w]+";"))}s?t.styles=l:t.stylesWithoutHost=l,s?t.classes=d:t.classesWithoutHost=d}const Us=new kr("INJECTOR",-1);class fd{get(n,s=Or){if(s===Or){const l=new Error(`NullInjectorError: No provider for ${ut(n)}!`);throw l.name="NullInjectorError",l}return s}}const iu=new kr("Set Injector scope."),js={},qm={};let md;function Wm(){return void 0===md&&(md=new fd),md}function Bp(t,n=null,s=null,l){return new Xm(t,s,n||Wm(),l)}class Xm{constructor(n,s,l,d=null){this.parent=l,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const g=[];s&&ue(s,E=>this.processProvider(E,n,s)),ue([n],E=>this.processInjectorType(E,[],g)),this.records.set(Us,xa(void 0,this));const w=this.records.get(iu);this.scope=null!=w?w.value:null,this.source=d||("object"==typeof n?null:ut(n))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(n=>n.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(n,s=Or,l=Je.Default){this.assertNotDestroyed();const d=En(this),g=Xt(void 0);try{if(!(l&Je.SkipSelf)){let E=this.records.get(n);if(void 0===E){const P=("function"==typeof(t=n)||"object"==typeof t&&t instanceof kr)&&pn(n);E=P&&this.injectableDefInScope(P)?xa(gd(n),js):null,this.records.set(n,E)}if(null!=E)return this.hydrate(n,E)}return(l&Je.Self?Wm():this.parent).get(n,s=l&Je.Optional&&s===Or?null:s)}catch(w){if("NullInjectorError"===w.name){if((w[vn]=w[vn]||[]).unshift(ut(n)),d)throw w;return fl(w,n,"R3InjectorError",this.source)}throw w}finally{Xt(g),En(d)}var t}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(n=>this.get(n))}toString(){const n=[];return this.records.forEach((l,d)=>n.push(ut(d))),`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(n,s,l){if(!(n=jt(n)))return!1;let d=Jo(n);const g=null==d&&n.ngModule||void 0,w=void 0===g?n:g,E=-1!==l.indexOf(w);if(void 0!==g&&(d=Jo(g)),null==d)return!1;if(null!=d.imports&&!E){let J;l.push(w);try{ue(d.imports,ce=>{this.processInjectorType(ce,s,l)&&(void 0===J&&(J=[]),J.push(ce))})}finally{}if(void 0!==J)for(let ce=0;ce<J.length;ce++){const{ngModule:_e,providers:ke}=J[ce];ue(ke,Ue=>this.processProvider(Ue,_e,ke||zn))}}this.injectorDefTypes.add(w);const P=Ar(w)||(()=>new w);this.records.set(w,xa(P,js));const U=d.providers;if(null!=U&&!E){const J=n;ue(U,ce=>this.processProvider(ce,J,U))}return void 0!==g&&void 0!==n.providers}processProvider(n,s,l){let d=Pa(n=jt(n))?n:jt(n&&n.provide);const g=Up(t=n)?xa(void 0,t.useValue):xa(Vp(t),js);var t;if(Pa(n)||!0!==n.multi)this.records.get(d);else{let w=this.records.get(d);w||(w=xa(void 0,js,!0),w.factory=()=>Io(w.multi),this.records.set(d,w)),d=n,w.multi.push(n)}this.records.set(d,g)}hydrate(n,s){return s.value===js&&(s.value=qm,s.value=s.factory()),"object"==typeof s.value&&s.value&&null!==(t=s.value)&&"object"==typeof t&&"function"==typeof t.ngOnDestroy&&this.onDestroy.add(s.value),s.value;var t}injectableDefInScope(n){if(!n.providedIn)return!1;const s=jt(n.providedIn);return"string"==typeof s?"any"===s||s===this.scope:this.injectorDefTypes.has(s)}}function gd(t){const n=pn(t),s=null!==n?n.factory:Ar(t);if(null!==s)return s;if(t instanceof kr)throw new Error(`Token ${ut(t)} is missing a \u0275prov definition.`);if(t instanceof Function)return function(t){const n=t.length;if(n>0){const l=function(t,n){const s=[];for(let l=0;l<t;l++)s.push(n);return s}(n,"?");throw new Error(`Can't resolve all parameters for ${ut(t)}: (${l.join(", ")}).`)}const s=function(t){const n=t&&(t[st]||t[Fe]);if(n){const s=function(t){if(t.hasOwnProperty("name"))return t.name;const n=(""+t).match(/^function\s*([^\s(]+)/);return null===n?"":n[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${s}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${s}" class.`),n}return null}(t);return null!==s?()=>s.factory(t):()=>new t}(t);throw new Error("unreachable")}function Vp(t,n,s){let l;if(Pa(t)){const d=jt(t);return Ar(d)||gd(d)}if(Up(t))l=()=>jt(t.useValue);else if(function(t){return!(!t||!t.useFactory)}(t))l=()=>t.useFactory(...Io(t.deps||[]));else if(function(t){return!(!t||!t.useExisting)}(t))l=()=>ir(jt(t.useExisting));else{const d=jt(t&&(t.useClass||t.provide));if(!function(t){return!!t.deps}(t))return Ar(d)||gd(d);l=()=>new d(...Io(t.deps))}return l}function xa(t,n,s=!1){return{factory:t,value:n,multi:s?[]:void 0}}function Up(t){return null!==t&&"object"==typeof t&&Bs in t}function Pa(t){return"function"==typeof t}const ng=function(t,n,s){return function(t,n=null,s=null,l){const d=Bp(t,n,s,l);return d._resolveInjectorDefTypes(),d}({name:s},n,t,s)};let jr=(()=>{class t{static create(s,l){return Array.isArray(s)?ng(s,l,""):ng(s.providers,s.parent,s.name||"")}}return t.THROW_IF_NOT_FOUND=Or,t.NULL=new fd,t.\u0275prov=hr({token:t,providedIn:"any",factory:()=>ir(Us)}),t.__NG_ELEMENT_ID__=-1,t})();function N_(t,n){Ba(Fh(t)[1],yi())}function Kp(t){let n=function(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),s=!0;const l=[t];for(;n;){let d;if(kt(t))d=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new Error("Directives cannot inherit Components");d=n.\u0275dir}if(d){if(s){l.push(d);const w=t;w.inputs=Td(t.inputs),w.declaredInputs=Td(t.declaredInputs),w.outputs=Td(t.outputs);const E=d.hostBindings;E&&o(t,E);const P=d.viewQuery,U=d.contentQueries;if(P&&r(t,P),U&&e(t,U),Vt(t.inputs,d.inputs),Vt(t.declaredInputs,d.declaredInputs),Vt(t.outputs,d.outputs),kt(d)&&d.data.animation){const J=t.data;J.animation=(J.animation||[]).concat(d.data.animation)}}const g=d.features;if(g)for(let w=0;w<g.length;w++){const E=g[w];E&&E.ngInherit&&E(t),E===Kp&&(s=!1)}}n=Object.getPrototypeOf(n)}!function(t){let n=0,s=null;for(let l=t.length-1;l>=0;l--){const d=t[l];d.hostVars=n+=d.hostVars,d.hostAttrs=Es(d.hostAttrs,s=Es(s,d.hostAttrs))}}(l)}function Td(t){return t===Co?{}:t===zn?[]:t}function r(t,n){const s=t.viewQuery;t.viewQuery=s?(l,d)=>{n(l,d),s(l,d)}:n}function e(t,n){const s=t.contentQueries;t.contentQueries=s?(l,d,g)=>{n(l,d,g),s(l,d,g)}:n}function o(t,n){const s=t.hostBindings;t.hostBindings=s?(l,d)=>{n(l,d),s(l,d)}:n}let _=null;function x(){if(!_){const t=Qn.Symbol;if(t&&t.iterator)_=t.iterator;else{const n=Object.getOwnPropertyNames(Map.prototype);for(let s=0;s<n.length;++s){const l=n[s];"entries"!==l&&"size"!==l&&Map.prototype[l]===Map.prototype.entries&&(_=l)}}}return _}class D{constructor(n){this.wrapped=n}static wrap(n){return new D(n)}static unwrap(n){return D.isWrapped(n)?n.wrapped:n}static isWrapped(n){return n instanceof D}}function O(t){return!!X(t)&&(Array.isArray(t)||!(t instanceof Map)&&x()in t)}function X(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function ne(t,n,s){return t[n]=s}function le(t,n,s){return!Object.is(t[n],s)&&(t[n]=s,!0)}function ye(t,n,s,l){const d=le(t,n,s);return le(t,n+1,l)||d}function Ve(t,n,s,l){const d=Mt();return le(d,ee(),n)&&(br(),Cl(Hr(),d,t,n,s,l)),Ve}function Ge(t,n,s,l){return le(t,ee(),s)?n+Jt(s)+l:er}function Wi(t,n,s,l,d,g,w,E){const P=Mt(),U=br(),J=t+20,ce=U.firstCreatePass?function(t,n,s,l,d,g,w,E,P){const U=n.consts,J=tu(n,t,4,w||null,No(U,E));Sp(n,s,J,No(U,P)),Ba(n,J);const ce=J.tViews=hh(2,J,l,d,g,n.directiveRegistry,n.pipeRegistry,null,n.schemas,U);return null!==n.queries&&(n.queries.template(n,J),ce.queries=n.queries.embeddedTView(J)),J}(J,U,P,n,s,l,d,g,w):U.data[J];go(ce,!1);const _e=P[11].createComment("");Zl(U,P,_e,ce),Ss(_e,P),Iu(P,P[J]=ad(_e,P,_e,ce)),Si(ce)&&Qh(U,P,ce),null!=w&&ed(P,ce,E)}function Po(t){return ts(Sn.lFrame.contextLView,20+t)}function rf(t,n=Je.Default){const s=Mt();return null===s?ir(t,n):Nc(yi(),s,jt(t),n)}function j_(t,n,s){const l=Mt();return le(l,ee(),n)&&va(br(),Hr(),l,t,n,l[11],s,!1),j_}function $_(t,n,s,l,d){const w=d?"class":"style";pd(t,s,n.inputs[w],w,l)}function Z_(t,n,s,l){const d=Mt(),g=br(),w=20+t,E=d[11],P=d[w]=Vi(E,n,Sn.lFrame.currentNamespace),U=g.firstCreatePass?function(t,n,s,l,d,g,w){const E=n.consts,U=tu(n,t,2,d,No(E,g));return Sp(n,s,U,No(E,w)),null!==U.attrs&&Ec(U,U.attrs,!1),null!==U.mergedAttrs&&Ec(U,U.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,U),U}(w,g,d,0,n,s,l):g.data[w];go(U,!0);const J=U.mergedAttrs;null!==J&&yo(E,P,J);const ce=U.classes;null!==ce&&rh(E,P,ce);const _e=U.styles;null!==_e&&vp(E,P,_e),64!=(64&U.flags)&&Zl(g,d,P,U),0===Sn.lFrame.elementDepthCount&&Ss(P,d),Sn.lFrame.elementDepthCount++,Si(U)&&(Qh(g,d,U),Nm(g,U,d)),null!==l&&ed(d,U)}function G_(){let t=yi();nl()?Na():(t=t.parent,go(t,!1));const n=t;Sn.lFrame.elementDepthCount--;const s=br();s.firstCreatePass&&(Ba(s,t),Gi(t)&&s.queries.elementEnd(t)),null!=n.classesWithoutHost&&function(t){return 0!=(16&t.flags)}(n)&&$_(s,n,Mt(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function(t){return 0!=(32&t.flags)}(n)&&$_(s,n,Mt(),n.stylesWithoutHost,!1)}function Fv(t,n,s,l){Z_(t,n,s,l),G_()}function H_(t,n,s){const l=Mt(),d=br(),g=t+20,w=d.firstCreatePass?function(t,n,s,l,d){const g=n.consts,w=No(g,l),E=tu(n,t,8,"ng-container",w);return null!==w&&Ec(E,w,!0),Sp(n,s,E,No(g,d)),null!==n.queries&&n.queries.elementStart(n,E),E}(g,d,l,n,s):d.data[g];go(w,!0);const E=l[g]=l[11].createComment("");Zl(d,l,E,w),Ss(E,l),Si(w)&&(Qh(d,l,w),Nm(d,w,l)),null!=s&&ed(l,w)}function q_(){let t=yi();const n=br();nl()?Na():(t=t.parent,go(t,!1)),n.firstCreatePass&&(Ba(n,t),Gi(t)&&n.queries.elementEnd(t))}function Lv(){return Mt()}function W_(t){return!!t&&"function"==typeof t.then}function Nv(t){return!!t&&"function"==typeof t.subscribe}const Y_=Nv;function X_(t,n,s,l){const d=Mt(),g=br(),w=yi();return function(t,n,s,l,d,g,w,E){const P=Si(l),J=t.firstCreatePass&&Gm(t),ce=n[8],_e=Lp(n);let ke=!0;if(3&l.type||E){const Ke=_i(l,n),Ut=E?E(Ke):Ke,wt=_e.length,Tn=E?Yn=>E(ar(Yn[l.index])):l.index;if(yt(s)){let Yn=null;if(!E&&P&&(Yn=function(t,n,s,l){const d=t.cleanup;if(null!=d)for(let g=0;g<d.length-1;g+=2){const w=d[g];if(w===s&&d[g+1]===l){const E=n[7],P=d[g+2];return E.length>P?E[P]:null}"string"==typeof w&&(g+=2)}return null}(t,n,d,l.index)),null!==Yn)(Yn.__ngLastListenerFn__||Yn).__ngNextListenerFn__=g,Yn.__ngLastListenerFn__=g,ke=!1;else{g=K_(l,n,ce,g,!1);const $r=s.listen(Ut,d,g);_e.push(g,$r),J&&J.push(d,Tn,wt,wt+1)}}else g=K_(l,n,ce,g,!0),Ut.addEventListener(d,g,w),_e.push(g),J&&J.push(d,Tn,wt,w)}else g=K_(l,n,ce,g,!1);const Ue=l.outputs;let at;if(ke&&null!==Ue&&(at=Ue[d])){const Ke=at.length;if(Ke)for(let Ut=0;Ut<Ke;Ut+=2){const xs=n[at[Ut]][at[Ut+1]].subscribe(g),Ml=_e.length;_e.push(g,xs),J&&J.push(d,l.index,Ml,-(Ml+1))}}}(g,d,d[11],w,t,n,!!s,l),X_}function Vv(t,n,s,l){try{return!1!==s(l)}catch(d){return vh(t,d),!1}}function K_(t,n,s,l,d){return function g(w){if(w===Function)return l;const E=2&t.flags?xr(t.index,n):n;0==(32&n[2])&&Op(E);let P=Vv(n,0,l,w),U=g.__ngNextListenerFn__;for(;U;)P=Vv(n,0,U,w)&&P,U=U.__ngNextListenerFn__;return d&&!1===P&&(w.preventDefault(),w.returnValue=!1),P}}function Uv(t=1){return function(t){return(Sn.lFrame.contextLView=function(t,n){for(;t>0;)n=n[15],t--;return n}(t,Sn.lFrame.contextLView))[8]}(t)}function J_(t,n,s){return Q_(t,"",n,"",s),J_}function Q_(t,n,s,l,d){const g=Mt(),w=Ge(g,n,s,l);return w!==er&&va(br(),Hr(),g,t,w,g[11],d,!1),Q_}function Xv(t,n,s,l,d){const g=t[s+1],w=null===n;let E=l?Ka(g):Ia(g),P=!1;for(;0!==E&&(!1===P||w);){const J=t[E+1];A1(t[E],n)&&(P=!0,t[E+1]=l?wp(J):oh(J)),E=l?Ka(J):Ia(J)}P&&(t[s+1]=l?oh(g):wp(g))}function A1(t,n){return null===t||null==n||(Array.isArray(t)?t[1]:t)===n||!(!Array.isArray(t)||"string"!=typeof n)&&bt(t,n)>=0}function ey(t,n){return function(t,n,s,l){const d=Mt(),g=br(),w=Te(2);g.firstUpdatePass&&function(t,n,s,l){const d=t.data;if(null===d[s+1]){const g=d[_o()],w=function(t,n){return n>=t.expandoStartIndex}(t,s);(function(t,n){return 0!=(t.flags&(n?16:32))})(g,l)&&null===n&&!w&&(n=!1),n=function(t,n,s,l){const d=function(t){const n=Sn.lFrame.currentDirectiveIndex;return-1===n?null:t[n]}(t);let g=l?n.residualClasses:n.residualStyles;if(null===d)0===(l?n.classBindings:n.styleBindings)&&(s=of(s=ty(null,t,n,s,l),n.attrs,l),g=null);else{const w=n.directiveStylingLast;if(-1===w||t[w]!==d)if(s=ty(d,t,n,s,l),null===g){let P=function(t,n,s){const l=s?n.classBindings:n.styleBindings;if(0!==Ia(l))return t[Ka(l)]}(t,n,l);void 0!==P&&Array.isArray(P)&&(P=ty(null,t,n,P[1],l),P=of(P,n.attrs,l),function(t,n,s,l){t[Ka(s?n.classBindings:n.styleBindings)]=l}(t,n,l,P))}else g=function(t,n,s){let l;const d=n.directiveEnd;for(let g=1+n.directiveStylingLast;g<d;g++)l=of(l,t[g].hostAttrs,s);return of(l,n.attrs,s)}(t,n,l)}return void 0!==g&&(l?n.residualClasses=g:n.residualStyles=g),s}(d,g,n,l),function(t,n,s,l,d,g){let w=g?n.classBindings:n.styleBindings,E=Ka(w),P=Ia(w);t[l]=s;let J,U=!1;if(Array.isArray(s)){const ce=s;J=ce[1],(null===J||bt(ce,J)>0)&&(U=!0)}else J=s;if(d)if(0!==P){const _e=Ka(t[E+1]);t[l+1]=ih(_e,E),0!==_e&&(t[_e+1]=yc(t[_e+1],l)),t[E+1]=function(t,n){return 131071&t|n<<17}(t[E+1],l)}else t[l+1]=ih(E,0),0!==E&&(t[E+1]=yc(t[E+1],l)),E=l;else t[l+1]=ih(P,0),0===E?E=l:t[P+1]=yc(t[P+1],l),P=l;U&&(t[l+1]=oh(t[l+1])),Xv(t,J,l,!0),Xv(t,J,l,!1),function(t,n,s,l,d){const g=d?t.residualClasses:t.residualStyles;null!=g&&"string"==typeof n&&bt(g,n)>=0&&(s[l+1]=wp(s[l+1]))}(n,J,t,l,g),w=ih(E,P),g?n.classBindings=w:n.styleBindings=w}(d,g,n,s,w,l)}}(g,t,w,l),n!==er&&le(d,w,n)&&function(t,n,s,l,d,g,w,E){if(!(3&n.type))return;const P=t.data,U=P[E+1];mg(function(t){return 1==(1&t)}(U)?c0(P,n,s,d,Ia(U),w):void 0)||(mg(g)||function(t){return 2==(2&t)}(U)&&(g=c0(P,null,s,d,E,w)),function(t,n,s,l,d){const g=yt(t);if(n)d?g?t.addClass(s,l):s.classList.add(l):g?t.removeClass(s,l):s.classList.remove(l);else{let w=-1===l.indexOf("-")?void 0:vl.DashCase;if(null==d)g?t.removeStyle(s,l,w):s.style.removeProperty(l);else{const E="string"==typeof d&&d.endsWith("!important");E&&(d=d.slice(0,-10),w|=vl.Important),g?t.setStyle(s,l,d,w):s.style.setProperty(l,d,E?"important":"")}}}(l,w,So(_o(),s),d,g))}(g,g.data[_o()],d,d[11],t,d[w+1]=function(t,n){return null==t||("string"==typeof n?t+=n:"object"==typeof t&&(t=ut(ml(t)))),t}(n,s),l,w)}(t,n,null,!0),ey}function ty(t,n,s,l,d){let g=null;const w=s.directiveEnd;let E=s.directiveStylingLast;for(-1===E?E=s.directiveStart:E++;E<w&&(g=n[E],l=of(l,g.hostAttrs,d),g!==t);)E++;return null!==t&&(s.directiveStylingLast=E),l}function of(t,n,s){const l=s?1:2;let d=-1;if(null!==n)for(let g=0;g<n.length;g++){const w=n[g];"number"==typeof w?d=w:d===l&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),et(t,w,!!s||n[++g]))}return void 0===t?null:t}function c0(t,n,s,l,d,g){const w=null===n;let E;for(;d>0;){const P=t[d],U=Array.isArray(P),J=U?P[1]:P,ce=null===J;let _e=s[d+1];_e===er&&(_e=ce?zn:void 0);let ke=ce?Ft(_e,l):J===l?_e:void 0;if(U&&!mg(ke)&&(ke=Ft(P,l)),mg(ke)&&(E=ke,w))return E;const Ue=t[d+1];d=w?Ka(Ue):Ia(Ue)}if(null!==n){let P=g?n.residualClasses:n.residualStyles;null!=P&&(E=Ft(P,l))}return E}function mg(t){return void 0!==t}function h0(t,n=""){const s=Mt(),l=br(),d=t+20,g=l.firstCreatePass?tu(l,d,1,n,null):l.data[d],w=s[d]=function(t,n){return yt(t)?t.createText(n):t.createTextNode(n)}(s[11],n);Zl(l,s,w,g),go(g,!1)}function ny(t){return gg("",t,""),ny}function gg(t,n,s){const l=Mt(),d=Ge(l,t,n,s);return d!==er&&oo(l,_o(),d),gg}function ry(t,n,s,l,d){const g=Mt(),w=function(t,n,s,l,d,g){const E=ye(t,te(),s,d);return Te(2),E?n+Jt(s)+l+Jt(d)+g:er}(g,t,n,s,l,d);return w!==er&&oo(g,_o(),w),ry}function iy(t,n,s){const l=Mt();return le(l,ee(),n)&&va(br(),Hr(),l,t,n,l[11],s,!0),iy}const Dh=void 0;var lw=["en",[["a","p"],["AM","PM"],Dh],[["AM","PM"],Dh,Dh],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Dh,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Dh,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Dh,"{1} 'at' {0}",Dh],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(t){const n=Math.floor(Math.abs(t)),s=t.toString().replace(/^[^.]*\.?/,"").length;return 1===n&&0===s?1:5}];let Sd={};function oy(t){const n=function(t){return t.toLowerCase().replace(/_/g,"-")}(t);let s=I0(n);if(s)return s;const l=n.split("-")[0];if(s=I0(l),s)return s;if("en"===l)return lw;throw new Error(`Missing locale data for the locale "${t}".`)}function S0(t){return oy(t)[$n.PluralCase]}function I0(t){return t in Sd||(Sd[t]=Qn.ng&&Qn.ng.common&&Qn.ng.common.locales&&Qn.ng.common.locales[t]),Sd[t]}var $n=(()=>(($n=$n||{})[$n.LocaleId=0]="LocaleId",$n[$n.DayPeriodsFormat=1]="DayPeriodsFormat",$n[$n.DayPeriodsStandalone=2]="DayPeriodsStandalone",$n[$n.DaysFormat=3]="DaysFormat",$n[$n.DaysStandalone=4]="DaysStandalone",$n[$n.MonthsFormat=5]="MonthsFormat",$n[$n.MonthsStandalone=6]="MonthsStandalone",$n[$n.Eras=7]="Eras",$n[$n.FirstDayOfWeek=8]="FirstDayOfWeek",$n[$n.WeekendRange=9]="WeekendRange",$n[$n.DateFormat=10]="DateFormat",$n[$n.TimeFormat=11]="TimeFormat",$n[$n.DateTimeFormat=12]="DateTimeFormat",$n[$n.NumberSymbols=13]="NumberSymbols",$n[$n.NumberFormats=14]="NumberFormats",$n[$n.CurrencyCode=15]="CurrencyCode",$n[$n.CurrencySymbol=16]="CurrencySymbol",$n[$n.CurrencyName=17]="CurrencyName",$n[$n.Currencies=18]="Currencies",$n[$n.Directionality=19]="Directionality",$n[$n.PluralCase=20]="PluralCase",$n[$n.ExtraData=21]="ExtraData",$n))();const _g="en-US";let P0=_g;function sy(t){ii(t,"Expected localeId to be defined"),"string"==typeof t&&(P0=t.toLowerCase().replace(/_/g,"-"))}function cy(t,n,s,l,d){if(t=jt(t),Array.isArray(t))for(let g=0;g<t.length;g++)cy(t[g],n,s,l,d);else{const g=br(),w=Mt();let E=Pa(t)?t:jt(t.provide),P=Vp(t);const U=yi(),J=1048575&U.providerIndexes,ce=U.directiveStart,_e=U.providerIndexes>>20;if(Pa(t)||!t.multi){const ke=new Fl(P,d,rf),Ue=hy(E,n,d?J:J+_e,ce);-1===Ue?(ul($a(U,w),g,E),uy(g,t,n.length),n.push(E),U.directiveStart++,U.directiveEnd++,d&&(U.providerIndexes+=1048576),s.push(ke),w.push(ke)):(s[Ue]=ke,w[Ue]=ke)}else{const ke=hy(E,n,J+_e,ce),Ue=hy(E,n,J,J+_e),at=ke>=0&&s[ke],Ke=Ue>=0&&s[Ue];if(d&&!Ke||!d&&!at){ul($a(U,w),g,E);const Ut=function(t,n,s,l,d){const g=new Fl(t,s,rf);return g.multi=[],g.index=n,g.componentProviders=0,tx(g,d,l&&!s),g}(d?oC:iC,s.length,d,l,P);!d&&Ke&&(s[Ue].providerFactory=Ut),uy(g,t,n.length,0),n.push(E),U.directiveStart++,U.directiveEnd++,d&&(U.providerIndexes+=1048576),s.push(Ut),w.push(Ut)}else uy(g,t,ke>-1?ke:Ue,tx(s[d?Ue:ke],P,!d&&l));!d&&l&&Ke&&s[Ue].componentProviders++}}}function uy(t,n,s,l){const d=Pa(n);if(d||function(t){return!!t.useClass}(n)){const w=(n.useClass||n).prototype.ngOnDestroy;if(w){const E=t.destroyHooks||(t.destroyHooks=[]);if(!d&&n.multi){const P=E.indexOf(s);-1===P?E.push(s,[l,w]):E[P+1].push(l,w)}else E.push(s,w)}}}function tx(t,n,s){return s&&t.componentProviders++,t.multi.push(n)-1}function hy(t,n,s,l){for(let d=s;d<l;d++)if(n[d]===t)return d;return-1}function iC(t,n,s,l){return dy(this.multi,[])}function oC(t,n,s,l){const d=this.multi;let g;if(this.providerFactory){const w=this.providerFactory.componentProviders,E=Ga(s,s[1],this.providerFactory.index,l);g=E.slice(0,w),dy(d,g);for(let P=w;P<E.length;P++)g.push(E[P])}else g=[],dy(d,g);return g}function dy(t,n){for(let s=0;s<t.length;s++)n.push((0,t[s])());return n}function nx(t,n=[]){return s=>{s.providersResolver=(l,d)=>function(t,n,s){const l=br();if(l.firstCreatePass){const d=kt(t);cy(s,l.data,l.blueprint,d,!0),cy(n,l.data,l.blueprint,d,!1)}}(l,d?d(t):t,n)}}class rx{}const ox="ngComponent";class lC{resolveComponentFactory(n){throw function(t){const n=Error(`No component factory found for ${ut(t)}. Did you add it to @NgModule.entryComponents?`);return n[ox]=t,n}(n)}}let Pd=(()=>{class t{}return t.NULL=new lC,t})();function wg(...t){}function Rd(t,n){return new Sc(_i(t,n))}const hC=function(){return Rd(yi(),Mt())};let Sc=(()=>{class t{constructor(s){this.nativeElement=s}}return t.__NG_ELEMENT_ID__=hC,t})();function sx(t){return t instanceof Sc?t.nativeElement:t}class Cg{}let dC=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>fC(),t})();const fC=function(){const t=Mt(),s=xr(yi().index,t);return function(t){return t[11]}(nr(s)?s:t)};let fy=(()=>{class t{}return t.\u0275prov=hr({token:t,providedIn:"root",factory:()=>null}),t})();class ax{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const lx=new ax("12.2.16");class cx{constructor(){}supports(n){return O(n)}create(n){return new yC(n)}}const _C=(t,n)=>n;class yC{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||_C}forEachItem(n){let s;for(s=this._itHead;null!==s;s=s._next)n(s)}forEachOperation(n){let s=this._itHead,l=this._removalsHead,d=0,g=null;for(;s||l;){const w=!l||s&&s.currentIndex<hx(l,d,g)?s:l,E=hx(w,d,g),P=w.currentIndex;if(w===l)d--,l=l._nextRemoved;else if(s=s._next,null==w.previousIndex)d++;else{g||(g=[]);const U=E-d,J=P-d;if(U!=J){for(let _e=0;_e<U;_e++){const ke=_e<g.length?g[_e]:g[_e]=0,Ue=ke+_e;J<=Ue&&Ue<U&&(g[_e]=ke+1)}g[w.previousIndex]=J-U}}E!==P&&n(w,E,P)}}forEachPreviousItem(n){let s;for(s=this._previousItHead;null!==s;s=s._nextPrevious)n(s)}forEachAddedItem(n){let s;for(s=this._additionsHead;null!==s;s=s._nextAdded)n(s)}forEachMovedItem(n){let s;for(s=this._movesHead;null!==s;s=s._nextMoved)n(s)}forEachRemovedItem(n){let s;for(s=this._removalsHead;null!==s;s=s._nextRemoved)n(s)}forEachIdentityChange(n){let s;for(s=this._identityChangesHead;null!==s;s=s._nextIdentityChange)n(s)}diff(n){if(null==n&&(n=[]),!O(n))throw new Error(`Error trying to diff '${ut(n)}'. Only arrays and iterables are allowed`);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let d,g,w,s=this._itHead,l=!1;if(Array.isArray(n)){this.length=n.length;for(let E=0;E<this.length;E++)g=n[E],w=this._trackByFn(E,g),null!==s&&Object.is(s.trackById,w)?(l&&(s=this._verifyReinsertion(s,g,w,E)),Object.is(s.item,g)||this._addIdentityChange(s,g)):(s=this._mismatch(s,g,w,E),l=!0),s=s._next}else d=0,function(t,n){if(Array.isArray(t))for(let s=0;s<t.length;s++)n(t[s]);else{const s=t[x()]();let l;for(;!(l=s.next()).done;)n(l.value)}}(n,E=>{w=this._trackByFn(d,E),null!==s&&Object.is(s.trackById,w)?(l&&(s=this._verifyReinsertion(s,E,w,d)),Object.is(s.item,E)||this._addIdentityChange(s,E)):(s=this._mismatch(s,E,w,d),l=!0),s=s._next,d++}),this.length=d;return this._truncate(s),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,s,l,d){let g;return null===n?g=this._itTail:(g=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(l,null))?(Object.is(n.item,s)||this._addIdentityChange(n,s),this._reinsertAfter(n,g,d)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(l,d))?(Object.is(n.item,s)||this._addIdentityChange(n,s),this._moveAfter(n,g,d)):n=this._addAfter(new vC(s,l),g,d),n}_verifyReinsertion(n,s,l,d){let g=null===this._unlinkedRecords?null:this._unlinkedRecords.get(l,null);return null!==g?n=this._reinsertAfter(g,n._prev,d):n.currentIndex!=d&&(n.currentIndex=d,this._addToMoves(n,d)),n}_truncate(n){for(;null!==n;){const s=n._next;this._addToRemovals(this._unlink(n)),n=s}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,s,l){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const d=n._prevRemoved,g=n._nextRemoved;return null===d?this._removalsHead=g:d._nextRemoved=g,null===g?this._removalsTail=d:g._prevRemoved=d,this._insertAfter(n,s,l),this._addToMoves(n,l),n}_moveAfter(n,s,l){return this._unlink(n),this._insertAfter(n,s,l),this._addToMoves(n,l),n}_addAfter(n,s,l){return this._insertAfter(n,s,l),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,s,l){const d=null===s?this._itHead:s._next;return n._next=d,n._prev=s,null===d?this._itTail=n:d._prev=n,null===s?this._itHead=n:s._next=n,null===this._linkedRecords&&(this._linkedRecords=new ux),this._linkedRecords.put(n),n.currentIndex=l,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const s=n._prev,l=n._next;return null===s?this._itHead=l:s._next=l,null===l?this._itTail=s:l._prev=s,n}_addToMoves(n,s){return n.previousIndex===s||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new ux),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,s){return n.item=s,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class vC{constructor(n,s){this.item=n,this.trackById=s,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class xC{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,s){let l;for(l=this._head;null!==l;l=l._nextDup)if((null===s||s<=l.currentIndex)&&Object.is(l.trackById,n))return l;return null}remove(n){const s=n._prevDup,l=n._nextDup;return null===s?this._head=l:s._nextDup=l,null===l?this._tail=s:l._prevDup=s,null===this._head}}class ux{constructor(){this.map=new Map}put(n){const s=n.trackById;let l=this.map.get(s);l||(l=new xC,this.map.set(s,l)),l.add(n)}get(n,s){const d=this.map.get(n);return d?d.get(n,s):null}remove(n){const s=n.trackById;return this.map.get(s).remove(n)&&this.map.delete(s),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function hx(t,n,s){const l=t.previousIndex;if(null===l)return l;let d=0;return s&&l<s.length&&(d=s[l]),l+n+d}class dx{constructor(){}supports(n){return n instanceof Map||X(n)}create(){return new bC}}class bC{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let s;for(s=this._mapHead;null!==s;s=s._next)n(s)}forEachPreviousItem(n){let s;for(s=this._previousMapHead;null!==s;s=s._nextPrevious)n(s)}forEachChangedItem(n){let s;for(s=this._changesHead;null!==s;s=s._nextChanged)n(s)}forEachAddedItem(n){let s;for(s=this._additionsHead;null!==s;s=s._nextAdded)n(s)}forEachRemovedItem(n){let s;for(s=this._removalsHead;null!==s;s=s._nextRemoved)n(s)}diff(n){if(n){if(!(n instanceof Map||X(n)))throw new Error(`Error trying to diff '${ut(n)}'. Only maps and objects are allowed`)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let s=this._mapHead;if(this._appendAfter=null,this._forEach(n,(l,d)=>{if(s&&s.key===d)this._maybeAddToChanges(s,l),this._appendAfter=s,s=s._next;else{const g=this._getOrCreateRecordForKey(d,l);s=this._insertBeforeOrAppend(s,g)}}),s){s._prev&&(s._prev._next=null),this._removalsHead=s;for(let l=s;null!==l;l=l._nextRemoved)l===this._mapHead&&(this._mapHead=null),this._records.delete(l.key),l._nextRemoved=l._next,l.previousValue=l.currentValue,l.currentValue=null,l._prev=null,l._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,s){if(n){const l=n._prev;return s._next=n,s._prev=l,n._prev=s,l&&(l._next=s),n===this._mapHead&&(this._mapHead=s),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=s,s._prev=this._appendAfter):this._mapHead=s,this._appendAfter=s,null}_getOrCreateRecordForKey(n,s){if(this._records.has(n)){const d=this._records.get(n);this._maybeAddToChanges(d,s);const g=d._prev,w=d._next;return g&&(g._next=w),w&&(w._prev=g),d._next=null,d._prev=null,d}const l=new wC(n);return this._records.set(n,l),l.currentValue=s,this._addToAdditions(l),l}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,s){Object.is(s,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=s,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,s){n instanceof Map?n.forEach(s):Object.keys(n).forEach(l=>s(n[l],l))}}class wC{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function px(){return new Eg([new cx])}let Eg=(()=>{class t{constructor(s){this.factories=s}static create(s,l){if(null!=l){const d=l.factories.slice();s=s.concat(d)}return new t(s)}static extend(s){return{provide:t,useFactory:l=>t.create(s,l||px()),deps:[[t,new ki,new _s]]}}find(s){const l=this.factories.find(d=>d.supports(s));if(null!=l)return l;throw new Error(`Cannot find a differ supporting object '${s}' of type '${function(t){return t.name||typeof t}(s)}'`)}}return t.\u0275prov=hr({token:t,providedIn:"root",factory:px}),t})();function fx(){return new Tg([new dx])}let Tg=(()=>{class t{constructor(s){this.factories=s}static create(s,l){if(l){const d=l.factories.slice();s=s.concat(d)}return new t(s)}static extend(s){return{provide:t,useFactory:l=>t.create(s,l||fx()),deps:[[t,new ki,new _s]]}}find(s){const l=this.factories.find(d=>d.supports(s));if(l)return l;throw new Error(`Cannot find a differ supporting object '${s}'`)}}return t.\u0275prov=hr({token:t,providedIn:"root",factory:fx}),t})();function Dg(t,n,s,l,d=!1){for(;null!==s;){const g=n[s.index];if(null!==g&&l.push(ar(g)),ti(g))for(let E=10;E<g.length;E++){const P=g[E],U=P[1].firstChild;null!==U&&Dg(P[1],P,U,l)}const w=s.type;if(8&w)Dg(t,n,s.child,l);else if(32&w){const E=Vh(s,n);let P;for(;P=E();)l.push(P)}else if(16&w){const E=gm(n,s);if(Array.isArray(E))l.push(...E);else{const P=Ju(n[16]);Dg(P[1],P,E,l,!0)}}s=d?s.projectionNext:s.next}return l}class uf{constructor(n,s){this._lView=n,this._cdRefInjectingView=s,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const n=this._lView,s=n[1];return Dg(s,n,s.firstChild,[])}get context(){return this._lView[8]}set context(n){this._lView[8]=n}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[3];if(ti(n)){const s=n[8],l=s?s.indexOf(this):-1;l>-1&&(Xc(n,l),Se(s,l))}this._attachedToViewContainer=!1}Zh(this._lView[1],this._lView)}onDestroy(n){ph(this._lView[1],this._lView,null,n)}markForCheck(){Op(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){ud(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(t,n,s){Js(!0);try{ud(t,n,s)}finally{Js(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){var n;this._appRef=null,th(this._lView[1],n=this._lView,n[11],2,null,null)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=n}}class EC extends uf{constructor(n){super(n),this._view=n}detectChanges(){Fp(this._view)}checkNoChanges(){!function(t){Js(!0);try{Fp(t)}finally{Js(!1)}}(this._view)}get context(){return null}}const DC=function(t){return function(t,n,s){if(Ei(t)&&!s){const l=xr(t.index,n);return new uf(l,l)}return 47&t.type?new uf(n[16],n):null}(yi(),Mt(),16==(16&t))};let AC=(()=>{class t{}return t.__NG_ELEMENT_ID__=DC,t})();const IC=[new dx],RC=new Eg([new cx]),kC=new Tg(IC),FC=function(){return Ag(yi(),Mt())};let hf=(()=>{class t{}return t.__NG_ELEMENT_ID__=FC,t})();const LC=hf,NC=class extends LC{constructor(n,s,l){super(),this._declarationLView=n,this._declarationTContainer=s,this.elementRef=l}createEmbeddedView(n){const s=this._declarationTContainer.tViews,l=uh(this._declarationLView,s,n,16,null,s.declTNode,null,null,null,null);l[17]=this._declarationLView[this._declarationTContainer.index];const g=this._declarationLView[19];return null!==g&&(l[19]=g.createEmbeddedView(s)),Mu(s,l,n),new uf(l)}};function Ag(t,n){return 4&t.type?new NC(n,t,Rd(t,n)):null}class Ah{}class mx{}const VC=function(){return yx(yi(),Mt())};let Mg=(()=>{class t{}return t.__NG_ELEMENT_ID__=VC,t})();const jC=Mg,gx=class extends jC{constructor(n,s,l){super(),this._lContainer=n,this._hostTNode=s,this._hostLView=l}get element(){return Rd(this._hostTNode,this._hostLView)}get injector(){return new L(this._hostTNode,this._hostLView)}get parentInjector(){const n=Za(this._hostTNode,this._hostLView);if(tc(n)){const s=ta(n,this._hostLView),l=Ls(n);return new L(s[1].data[l+8],s)}return new L(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const s=_x(this._lContainer);return null!==s&&s[n]||null}get length(){return this._lContainer.length-10}createEmbeddedView(n,s,l){const d=n.createEmbeddedView(s||{});return this.insert(d,l),d}createComponent(n,s,l,d,g){const w=l||this.parentInjector;if(!g&&null==n.ngModule&&w){const P=w.get(Ah,null);P&&(g=P)}const E=n.create(w,d,void 0,g);return this.insert(E.hostView,s),E}insert(n,s){const l=n._lView,d=l[1];if(ti(l[3])){const J=this.indexOf(n);if(-1!==J)this.detach(J);else{const ce=l[3],_e=new gx(ce,ce[6],ce[3]);_e.detach(_e.indexOf(n))}}const g=this._adjustIndex(s),w=this._lContainer;!function(t,n,s,l){const d=10+l,g=s.length;l>0&&(s[d-1][4]=n),l<g-10?(n[4]=s[d],fe(s,10+l,n)):(s.push(n),n[4]=null),n[3]=s;const w=n[17];null!==w&&s!==w&&function(t,n){const s=t[9];n[16]!==n[3][3][16]&&(t[2]=!0),null===s?t[9]=[n]:s.push(n)}(w,n);const E=n[19];null!==E&&E.insertView(t),n[2]|=128}(d,l,w,g);const E=qh(g,w),P=l[11],U=Kc(P,w[7]);return null!==U&&function(t,n,s,l,d,g){l[0]=d,l[6]=n,th(t,l,s,1,d,g)}(d,w[6],P,l,U,E),n.attachToViewContainerRef(),fe(my(w),g,n),n}move(n,s){return this.insert(n,s)}indexOf(n){const s=_x(this._lContainer);return null!==s?s.indexOf(n):-1}remove(n){const s=this._adjustIndex(n,-1),l=Xc(this._lContainer,s);l&&(Se(my(this._lContainer),s),Zh(l[1],l))}detach(n){const s=this._adjustIndex(n,-1),l=Xc(this._lContainer,s);return l&&null!=Se(my(this._lContainer),s)?new uf(l):null}_adjustIndex(n,s=0){return null==n?this.length+s:n}};function _x(t){return t[8]}function my(t){return t[8]||(t[8]=[])}function yx(t,n){let s;const l=n[t.index];if(ti(l))s=l;else{let d;if(8&t.type)d=ar(l);else{const g=n[11];d=g.createComment("");const w=_i(t,n);$l(g,Kc(g,w),d,function(t,n){return yt(t)?t.nextSibling(n):n.nextSibling}(g,w),!1)}n[t.index]=s=ad(l,n,d,t),Iu(n,s)}return new gx(s,t,n)}const Ld={};class zx extends Pd{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const s=xn(n);return new Vx(s,this.ngModule)}}function Bx(t){const n=[];for(let s in t)t.hasOwnProperty(s)&&n.push({propName:t[s],templateName:s});return n}const zE=new kr("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>ap});class Vx extends rx{constructor(n,s){super(),this.componentDef=n,this.ngModule=s,this.componentType=n.type,this.selector=n.selectors.map(bm).join(","),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!s}get inputs(){return Bx(this.componentDef.inputs)}get outputs(){return Bx(this.componentDef.outputs)}create(n,s,l,d){const g=(d=d||this.ngModule)?function(t,n){return{get:(s,l,d)=>{const g=t.get(s,Ld,d);return g!==Ld||l===Ld?g:n.get(s,l,d)}}}(n,d.injector):n,w=g.get(Cg,pr),E=g.get(fy,null),P=w.createRenderer(null,this.componentDef),U=this.componentDef.selectors[0][0]||"div",J=l?function(t,n,s){if(yt(t))return t.selectRootElement(n,s===rn.ShadowDom);let l="string"==typeof n?t.querySelector(n):n;return l.textContent="",l}(P,l,this.componentDef.encapsulation):Vi(w.createRenderer(null,this.componentDef),U,function(t){const n=t.toLowerCase();return"svg"===n?"http://www.w3.org/2000/svg":"math"===n?"http://www.w3.org/1998/MathML/":null}(U)),ce=this.componentDef.onPush?576:528,_e=function(t,n){return{components:[],scheduler:t||ap,clean:S_,playerHandler:n||null,flags:0}}(),ke=hh(0,null,null,1,0,null,null,null,null,null),Ue=uh(null,ke,_e,ce,null,null,w,P,E,g);let at,Ke;rl(Ue);try{const Ut=function(t,n,s,l,d,g){const w=s[1];s[20]=t;const P=tu(w,20,2,"#host",null),U=P.mergedAttrs=n.hostAttrs;null!==U&&(Ec(P,U,!0),null!==t&&(yo(d,t,U),null!==P.classes&&rh(d,t,P.classes),null!==P.styles&&vp(d,t,P.styles)));const J=l.createRenderer(t,n),ce=uh(s,Su(n),null,n.onPush?64:16,s[20],P,l,J,g||null,null);return w.firstCreatePass&&(ul($a(P,s),w,n.type),sd(w,P),jm(P,s.length,1)),Iu(s,ce),s[20]=ce}(J,this.componentDef,Ue,w,P);if(J)if(l)yo(P,J,["ng-version",lx.full]);else{const{attrs:wt,classes:Tn}=function(t){const n=[],s=[];let l=1,d=2;for(;l<t.length;){let g=t[l];if("string"==typeof g)2===d?""!==g&&n.push(g,t[++l]):8===d&&s.push(g);else{if(!Xa(d))break;d=g}l++}return{attrs:n,classes:s}}(this.componentDef.selectors[0]);wt&&yo(P,J,wt),Tn&&Tn.length>0&&rh(P,J,Tn.join(" "))}if(Ke=ds(ke,20),void 0!==s){const wt=Ke.projection=[];for(let Tn=0;Tn<this.ngContentSelectors.length;Tn++){const Yn=s[Tn];wt.push(null!=Yn?Array.from(Yn):null)}}at=function(t,n,s,l,d){const g=s[1],w=function(t,n,s){const l=yi();t.firstCreatePass&&(s.providersResolver&&s.providersResolver(s),gh(t,l,n,nu(t,n,1,null),s));const d=Ga(n,t,l.directiveStart,l);Ss(d,n);const g=_i(l,n);return g&&Ss(g,n),d}(g,s,n);if(l.components.push(w),t[8]=w,d&&d.forEach(P=>P(w,n)),n.contentQueries){const P=yi();n.contentQueries(1,w,P.directiveStart)}const E=yi();return!g.firstCreatePass||null===n.hostBindings&&null===n.hostAttrs||(ms(E.index),id(s[1],E,0,E.directiveStart,E.directiveEnd,n),Ip(n,w)),w}(Ut,this.componentDef,Ue,_e,[N_]),Mu(ke,Ue,null)}finally{Ea()}return new UE(this.componentType,at,Rd(Ke,Ue),Ue,Ke)}}class UE extends class{}{constructor(n,s,l,d,g){super(),this.location=l,this._rootLView=d,this._tNode=g,this.instance=s,this.hostView=this.changeDetectorRef=new EC(d),this.componentType=n}get injector(){return new L(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}const Nd=new Map;class ZE extends Ah{constructor(n,s){super(),this._parent=s,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new zx(this);const l=Wn(n),d=n[ve]||null;d&&sy(d),this._bootstrapComponents=Sa(l.bootstrap),this._r3Injector=Bp(n,s,[{provide:Ah,useValue:this},{provide:Pd,useValue:this.componentFactoryResolver}],ut(n)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(n)}get(n,s=jr.THROW_IF_NOT_FOUND,l=Je.Default){return n===jr||n===Ah||n===Us?this:this._r3Injector.get(n,s,l)}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(s=>s()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class My extends mx{constructor(n){super(),this.moduleType=n,null!==Wn(n)&&function(t){const n=new Set;!function s(l){const d=Wn(l,!0),g=d.id;null!==g&&(function(t,n,s){if(n&&n!==s)throw new Error(`Duplicate module registered for ${t} - ${ut(n)} vs ${ut(n.name)}`)}(g,Nd.get(g),l),Nd.set(g,l));const w=Sa(d.imports);for(const E of w)n.has(E)||(n.add(E),s(E))}(t)}(n)}create(n){return new ZE(this.moduleType,n)}}function $x(t,n,s){const l=Y()+t,d=Mt();return d[l]===er?ne(d,l,s?n.call(s):n()):function(t,n){return t[n]}(d,l)}function vf(t,n){const s=t[n];return s===er?void 0:s}function Yx(t,n){const s=br();let l;const d=t+20;s.firstCreatePass?(l=function(t,n){if(n)for(let s=n.length-1;s>=0;s--){const l=n[s];if(t===l.name)return l}throw new Kr("302",`The pipe '${t}' could not be found!`)}(n,s.pipeRegistry),s.data[d]=l,l.onDestroy&&(s.destroyHooks||(s.destroyHooks=[])).push(d,l.onDestroy)):l=s.data[d];const g=l.factory||(l.factory=Ar(l.type)),w=Xt(rf);try{const E=ll(!1),P=g();return ll(E),function(t,n,s,l){s>=t.data.length&&(t.data[s]=null,t.blueprint[s]=null),n[s]=l}(s,Mt(),d,P),P}finally{Xt(w)}}function Xx(t,n,s){const l=t+20,d=Mt(),g=ts(d,l);return bf(d,xf(d,l)?function(t,n,s,l,d,g){const w=n+s;return le(t,w,d)?ne(t,w+1,g?l.call(g,d):l(d)):vf(t,w+1)}(d,Y(),n,g.transform,s,g):g.transform(s))}function Kx(t,n,s,l){const d=t+20,g=Mt(),w=ts(g,d);return bf(g,xf(g,d)?function(t,n,s,l,d,g,w){const E=n+s;return ye(t,E,d,g)?ne(t,E+2,w?l.call(w,d,g):l(d,g)):vf(t,E+2)}(g,Y(),n,w.transform,s,l,w):w.transform(s,l))}function xf(t,n){return t[1].data[n].pure}function bf(t,n){return D.isWrapped(n)&&(n=D.unwrap(n),t[te()]=er),n}function Sy(t){return n=>{setTimeout(t,void 0,n)}}const Ic=class extends nt.xQ{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,s,l){var d,g,w;let E=n,P=s||(()=>null),U=l;if(n&&"object"==typeof n){const ce=n;E=null===(d=ce.next)||void 0===d?void 0:d.bind(ce),P=null===(g=ce.error)||void 0===g?void 0:g.bind(ce),U=null===(w=ce.complete)||void 0===w?void 0:w.bind(ce)}this.__isAsync&&(P=Sy(P),E&&(E=Sy(E)),U&&(U=Sy(U)));const J=super.subscribe({next:E,error:P,complete:U});return n instanceof ze.w&&n.add(J),J}};function oT(){return this._results[x()]()}class kg{constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const s=x(),l=kg.prototype;l[s]||(l[s]=oT)}get changes(){return this._changes||(this._changes=new Ic)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,s){return this._results.reduce(n,s)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,s){const l=this;l.dirty=!1;const d=he(n);(this._changesDetected=!function(t,n,s){if(t.length!==n.length)return!1;for(let l=0;l<t.length;l++){let d=t[l],g=n[l];if(s&&(d=s(d),g=s(g)),g!==d)return!1}return!0}(l._results,d,s))&&(l._results=d,l.length=d.length,l.last=d[this.length-1],l.first=d[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class Iy{constructor(n){this.queryList=n,this.matches=null}clone(){return new Iy(this.queryList)}setDirty(){this.queryList.setDirty()}}class Py{constructor(n=[]){this.queries=n}createEmbeddedView(n){const s=n.queries;if(null!==s){const l=null!==n.contentQueries?n.contentQueries[0]:s.length,d=[];for(let g=0;g<l;g++){const w=s.getByIndex(g);d.push(this.queries[w.indexInDeclarationView].clone())}return new Py(d)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let s=0;s<this.queries.length;s++)null!==ob(n,s).matches&&this.queries[s].setDirty()}}class Jx{constructor(n,s,l=null){this.predicate=n,this.flags=s,this.read=l}}class Ry{constructor(n=[]){this.queries=n}elementStart(n,s){for(let l=0;l<this.queries.length;l++)this.queries[l].elementStart(n,s)}elementEnd(n){for(let s=0;s<this.queries.length;s++)this.queries[s].elementEnd(n)}embeddedTView(n){let s=null;for(let l=0;l<this.length;l++){const d=null!==s?s.length:0,g=this.getByIndex(l).embeddedTView(n,d);g&&(g.indexInDeclarationView=l,null!==s?s.push(g):s=[g])}return null!==s?new Ry(s):null}template(n,s){for(let l=0;l<this.queries.length;l++)this.queries[l].template(n,s)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class ky{constructor(n,s=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=s}elementStart(n,s){this.isApplyingToNode(s)&&this.matchTNode(n,s)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,s){this.elementStart(n,s)}embeddedTView(n,s){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,s),new ky(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const s=this._declarationNodeIndex;let l=n.parent;for(;null!==l&&8&l.type&&l.index!==s;)l=l.parent;return s===(null!==l?l.index:-1)}return this._appliesToNextNode}matchTNode(n,s){const l=this.metadata.predicate;if(Array.isArray(l))for(let d=0;d<l.length;d++){const g=l[d];this.matchTNodeWithReadOption(n,s,lT(s,g)),this.matchTNodeWithReadOption(n,s,zl(s,n,g,!1,!1))}else l===hf?4&s.type&&this.matchTNodeWithReadOption(n,s,-1):this.matchTNodeWithReadOption(n,s,zl(s,n,l,!1,!1))}matchTNodeWithReadOption(n,s,l){if(null!==l){const d=this.metadata.read;if(null!==d)if(d===Sc||d===Mg||d===hf&&4&s.type)this.addMatch(s.index,-2);else{const g=zl(s,n,d,!1,!1);null!==g&&this.addMatch(s.index,g)}else this.addMatch(s.index,l)}}addMatch(n,s){null===this.matches?this.matches=[n,s]:this.matches.push(n,s)}}function lT(t,n){const s=t.localNames;if(null!==s)for(let l=0;l<s.length;l+=2)if(s[l]===n)return s[l+1];return null}function uT(t,n,s,l){return-1===s?function(t,n){return 11&t.type?Rd(t,n):4&t.type?Ag(t,n):null}(n,t):-2===s?function(t,n,s){return s===Sc?Rd(n,t):s===hf?Ag(n,t):s===Mg?yx(n,t):void 0}(t,n,l):Ga(t,t[1],s,n)}function Qx(t,n,s,l){const d=n[19].queries[l];if(null===d.matches){const g=t.data,w=s.matches,E=[];for(let P=0;P<w.length;P+=2){const U=w[P];E.push(U<0?null:uT(n,g[U],w[P+1],s.metadata.read))}d.matches=E}return d.matches}function Oy(t,n,s,l){const d=t.queries.getByIndex(s),g=d.matches;if(null!==g){const w=Qx(t,n,d,s);for(let E=0;E<g.length;E+=2){const P=g[E];if(P>0)l.push(w[E/2]);else{const U=g[E+1],J=n[-P];for(let ce=10;ce<J.length;ce++){const _e=J[ce];_e[17]===_e[3]&&Oy(_e[1],_e,U,l)}if(null!==J[9]){const ce=J[9];for(let _e=0;_e<ce.length;_e++){const ke=ce[_e];Oy(ke[1],ke,U,l)}}}}}return l}function eb(t){const n=Mt(),s=br(),l=Cs();zo(l+1);const d=ob(s,l);if(t.dirty&&ps(n)===(2==(2&d.metadata.flags))){if(null===d.matches)t.reset([]);else{const g=d.crossesNgTemplate?Oy(s,n,l,[]):Qx(s,n,d,l);t.reset(g,sx),t.notifyOnChanges()}return!0}return!1}function tb(t,n,s,l){const d=br();if(d.firstCreatePass){const g=yi();(function(t,n,s){null===t.queries&&(t.queries=new Ry),t.queries.track(new ky(n,s))})(d,new Jx(n,s,l),g.index),function(t,n){const s=t.contentQueries||(t.contentQueries=[]);n!==(s.length?s[s.length-1]:-1)&&s.push(t.queries.length-1,n)}(d,t),2==(2&s)&&(d.staticContentQueries=!0)}!function(t,n,s){const l=new kg(4==(4&s));ph(t,n,l,l.destroy),null===n[19]&&(n[19]=new Py),n[19].queries.push(new Iy(l))}(d,Mt(),s)}function nb(){return t=Mt(),n=Cs(),t[19].queries[n].queryList;var t,n}function ob(t,n){return t.queries.getByIndex(n)}const Vy=new kr("Application Initializer");let Bd=(()=>{class t{constructor(s){this.appInits=s,this.resolve=wg,this.reject=wg,this.initialized=!1,this.done=!1,this.donePromise=new Promise((l,d)=>{this.resolve=l,this.reject=d})}runInitializers(){if(this.initialized)return;const s=[],l=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let d=0;d<this.appInits.length;d++){const g=this.appInits[d]();if(W_(g))s.push(g);else if(Y_(g)){const w=new Promise((E,P)=>{g.subscribe({complete:E,error:P})});s.push(w)}}Promise.all(s).then(()=>{l()}).catch(d=>{this.reject(d)}),0===s.length&&l(),this.initialized=!0}}return t.\u0275fac=function(s){return new(s||t)(ir(Vy,8))},t.\u0275prov=hr({token:t,factory:t.\u0275fac}),t})();const Cb=new kr("AppId"),jT={provide:Cb,useFactory:function(){return`${Uy()}${Uy()}${Uy()}`},deps:[]};function Uy(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Eb=new kr("Platform Initializer"),Tb=new kr("Platform ID"),Db=new kr("appBootstrapListener");let Ab=(()=>{class t{log(s){console.log(s)}warn(s){console.warn(s)}}return t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac}),t})();const Lg=new kr("LocaleId"),Mb=new kr("DefaultCurrencyCode");class ZT{constructor(n,s){this.ngModuleFactory=n,this.componentFactories=s}}const jy=function(t){return new My(t)},GT=jy,HT=function(t){return Promise.resolve(jy(t))},Sb=function(t){const n=jy(t),l=Sa(Wn(t).declarations).reduce((d,g)=>{const w=xn(g);return w&&d.push(new Vx(w)),d},[]);return new ZT(n,l)},qT=Sb,WT=function(t){return Promise.resolve(Sb(t))};let Cf=(()=>{class t{constructor(){this.compileModuleSync=GT,this.compileModuleAsync=HT,this.compileModuleAndAllComponentsSync=qT,this.compileModuleAndAllComponentsAsync=WT}clearCache(){}clearCacheFor(s){}getModuleId(s){}}return t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac}),t})();const KT=(()=>Promise.resolve(0))();function $y(t){"undefined"==typeof Zone?KT.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class tl{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:s=!1,shouldCoalesceRunChangeDetection:l=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Ic(!1),this.onMicrotaskEmpty=new Ic(!1),this.onStable=new Ic(!1),this.onError=new Ic(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const d=this;d._nesting=0,d._outer=d._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(d._inner=d._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(d._inner=d._inner.fork(Zone.longStackTraceZoneSpec)),d.shouldCoalesceEventChangeDetection=!l&&s,d.shouldCoalesceRunChangeDetection=l,d.lastRequestAnimationFrameId=-1,d.nativeRequestAnimationFrame=function(){let t=Qn.requestAnimationFrame,n=Qn.cancelAnimationFrame;if("undefined"!=typeof Zone&&t&&n){const s=t[Zone.__symbol__("OriginalDelegate")];s&&(t=s);const l=n[Zone.__symbol__("OriginalDelegate")];l&&(n=l)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function(t){const n=()=>{!function(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(Qn,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,Gy(t),t.isCheckStableRunning=!0,Zy(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),Gy(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(s,l,d,g,w,E)=>{try{return Ib(t),s.invokeTask(d,g,w,E)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===g.type||t.shouldCoalesceRunChangeDetection)&&n(),Pb(t)}},onInvoke:(s,l,d,g,w,E,P)=>{try{return Ib(t),s.invoke(d,g,w,E,P)}finally{t.shouldCoalesceRunChangeDetection&&n(),Pb(t)}},onHasTask:(s,l,d,g)=>{s.hasTask(d,g),l===d&&("microTask"==g.change?(t._hasPendingMicrotasks=g.microTask,Gy(t),Zy(t)):"macroTask"==g.change&&(t.hasPendingMacrotasks=g.macroTask))},onHandleError:(s,l,d,g)=>(s.handleError(d,g),t.runOutsideAngular(()=>t.onError.emit(g)),!1)})}(d)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!tl.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(tl.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(n,s,l){return this._inner.run(n,s,l)}runTask(n,s,l,d){const g=this._inner,w=g.scheduleEventTask("NgZoneEvent: "+d,n,QT,wg,wg);try{return g.runTask(w,s,l)}finally{g.cancelTask(w)}}runGuarded(n,s,l){return this._inner.runGuarded(n,s,l)}runOutsideAngular(n){return this._outer.run(n)}}const QT={};function Zy(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function Gy(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function Ib(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function Pb(t){t._nesting--,Zy(t)}class nD{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Ic,this.onMicrotaskEmpty=new Ic,this.onStable=new Ic,this.onError=new Ic}run(n,s,l){return n.apply(s,l)}runGuarded(n,s,l){return n.apply(s,l)}runOutsideAngular(n){return n()}runTask(n,s,l,d){return n.apply(s,l)}}let Rb=(()=>{class t{constructor(s){this._ngZone=s,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),s.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{tl.assertNotInAngularZone(),$y(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())$y(()=>{for(;0!==this._callbacks.length;){let s=this._callbacks.pop();clearTimeout(s.timeoutId),s.doneCb(this._didWork)}this._didWork=!1});else{let s=this.getPendingTasks();this._callbacks=this._callbacks.filter(l=>!l.updateCb||!l.updateCb(s)||(clearTimeout(l.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(s=>({source:s.source,creationLocation:s.creationLocation,data:s.data})):[]}addCallback(s,l,d){let g=-1;l&&l>0&&(g=setTimeout(()=>{this._callbacks=this._callbacks.filter(w=>w.timeoutId!==g),s(this._didWork,this.getPendingTasks())},l)),this._callbacks.push({doneCb:s,timeoutId:g,updateCb:d})}whenStable(s,l,d){if(d&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(s,l,d),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(s,l,d){return[]}}return t.\u0275fac=function(s){return new(s||t)(ir(tl))},t.\u0275prov=hr({token:t,factory:t.\u0275fac}),t})(),kb=(()=>{class t{constructor(){this._applications=new Map,Hy.addToWindow(this)}registerApplication(s,l){this._applications.set(s,l)}unregisterApplication(s){this._applications.delete(s)}unregisterAllApplications(){this._applications.clear()}getTestability(s){return this._applications.get(s)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(s,l=!0){return Hy.findTestabilityInTree(this,s,l)}}return t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac}),t})();class rD{addToWindow(n){}findTestabilityInTree(n,s,l){return null}}function iD(t){Hy=t}let Hy=new rD,Ob=!0,Fb=!1;function oD(){if(Fb)throw new Error("Cannot enable prod mode after platform setup.");Ob=!1}let Yl;const Nb=new kr("AllowMultipleToken");class dD{constructor(n,s){this.name=n,this.token=s}}function zb(t,n,s=[]){const l=`Platform: ${n}`,d=new kr(l);return(g=[])=>{let w=Bb();if(!w||w.injector.get(Nb,!1))if(t)t(s.concat(g).concat({provide:d,useValue:!0}));else{const E=s.concat(g).concat({provide:d,useValue:!0},{provide:iu,useValue:"platform"});!function(t){if(Yl&&!Yl.destroyed&&!Yl.injector.get(Nb,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Yl=t.get(Vb);const n=t.get(Eb,null);n&&n.forEach(s=>s())}(jr.create({providers:E,name:l}))}return function(t){const n=Bb();if(!n)throw new Error("No platform exists!");if(!n.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return n}(d)}}function Bb(){return Yl&&!Yl.destroyed?Yl:null}let Vb=(()=>{class t{constructor(s){this._injector=s,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(s,l){const E=function(t,n){let s;return s="noop"===t?new nD:("zone.js"===t?void 0:t)||new tl({enableLongStackTrace:(Fb=!0,Ob),shouldCoalesceEventChangeDetection:!!(null==n?void 0:n.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==n?void 0:n.ngZoneRunCoalescing)}),s}(l?l.ngZone:void 0,{ngZoneEventCoalescing:l&&l.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:l&&l.ngZoneRunCoalescing||!1}),P=[{provide:tl,useValue:E}];return E.run(()=>{const U=jr.create({providers:P,parent:this.injector,name:s.moduleType.name}),J=s.create(U),ce=J.injector.get(Wc,null);if(!ce)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return E.runOutsideAngular(()=>{const _e=E.onError.subscribe({next:ke=>{ce.handleError(ke)}});J.onDestroy(()=>{qy(this._modules,J),_e.unsubscribe()})}),function(t,n,s){try{const l=s();return W_(l)?l.catch(d=>{throw n.runOutsideAngular(()=>t.handleError(d)),d}):l}catch(l){throw n.runOutsideAngular(()=>t.handleError(l)),l}}(ce,E,()=>{const _e=J.injector.get(Bd);return _e.runInitializers(),_e.donePromise.then(()=>(sy(J.injector.get(Lg,_g)||_g),this._moduleDoBootstrap(J),J))})})}bootstrapModule(s,l=[]){const d=Ub({},l);return function(t,n,s){const l=new My(s);return Promise.resolve(l)}(0,0,s).then(g=>this.bootstrapModuleFactory(g,d))}_moduleDoBootstrap(s){const l=s.injector.get(Ef);if(s._bootstrapComponents.length>0)s._bootstrapComponents.forEach(d=>l.bootstrap(d));else{if(!s.instance.ngDoBootstrap)throw new Error(`The module ${ut(s.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);s.instance.ngDoBootstrap(l)}this._modules.push(s)}onDestroy(s){this._destroyListeners.push(s)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(s=>s.destroy()),this._destroyListeners.forEach(s=>s()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(s){return new(s||t)(ir(jr))},t.\u0275prov=hr({token:t,factory:t.\u0275fac}),t})();function Ub(t,n){return Array.isArray(n)?n.reduce(Ub,t):Object.assign(Object.assign({},t),n)}let Ef=(()=>{class t{constructor(s,l,d,g,w){this._zone=s,this._injector=l,this._exceptionHandler=d,this._componentFactoryResolver=g,this._initStatus=w,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const E=new $.y(U=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{U.next(this._stable),U.complete()})}),P=new $.y(U=>{let J;this._zone.runOutsideAngular(()=>{J=this._zone.onStable.subscribe(()=>{tl.assertNotInAngularZone(),$y(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,U.next(!0))})})});const ce=this._zone.onUnstable.subscribe(()=>{tl.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{U.next(!1)}))});return()=>{J.unsubscribe(),ce.unsubscribe()}});this.isStable=function(...t){let n=Number.POSITIVE_INFINITY,s=null,l=t[t.length-1];return(0,y.K)(l)?(s=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(n=t.pop())):"number"==typeof l&&(n=t.pop()),null===s&&1===t.length&&t[0]instanceof $.y?t[0]:(0,Rt.J)(n)((0,h.n)(t,s))}(E,P.pipe(t=>(0,Ye.x)()(function(t,n){return function(l){let d;d="function"==typeof t?t:function(){return t};const g=Object.create(l,Me.N);return g.source=l,g.subjectFactory=d,g}}(Xe)(t))))}bootstrap(s,l){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let d;d=s instanceof rx?s:this._componentFactoryResolver.resolveComponentFactory(s),this.componentTypes.push(d.componentType);const g=function(t){return t.isBoundToModule}(d)?void 0:this._injector.get(Ah),E=d.create(jr.NULL,[],l||d.selector,g),P=E.location.nativeElement,U=E.injector.get(Rb,null),J=U&&E.injector.get(kb);return U&&J&&J.registerApplication(P,U),E.onDestroy(()=>{this.detachView(E.hostView),qy(this.components,E),J&&J.unregisterApplication(P)}),this._loadComponent(E),E}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let s of this._views)s.detectChanges()}catch(s){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(s))}finally{this._runningTick=!1}}attachView(s){const l=s;this._views.push(l),l.attachToAppRef(this)}detachView(s){const l=s;qy(this._views,l),l.detachFromAppRef()}_loadComponent(s){this.attachView(s.hostView),this.tick(),this.components.push(s),this._injector.get(Db,[]).concat(this._bootstrapListeners).forEach(d=>d(s))}ngOnDestroy(){this._views.slice().forEach(s=>s.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return t.\u0275fac=function(s){return new(s||t)(ir(tl),ir(jr),ir(Wc),ir(Pd),ir(Bd))},t.\u0275prov=hr({token:t,factory:t.\u0275fac}),t})();function qy(t,n){const s=t.indexOf(n);s>-1&&t.splice(s,1)}class yD{}class xD{}const bD={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let wD=(()=>{class t{constructor(s,l){this._compiler=s,this._config=l||bD}load(s){return this.loadAndCompile(s)}loadAndCompile(s){let[l,d]=s.split("#");return void 0===d&&(d="default"),xe(8255)(l).then(g=>g[d]).then(g=>Gb(g,l,d)).then(g=>this._compiler.compileModuleAsync(g))}loadFactory(s){let[l,d]=s.split("#"),g="NgFactory";return void 0===d&&(d="default",g=""),xe(8255)(this._config.factoryPathPrefix+l+this._config.factoryPathSuffix).then(w=>w[d+g]).then(w=>Gb(w,l,d))}}return t.\u0275fac=function(s){return new(s||t)(ir(Cf),ir(xD,8))},t.\u0275prov=hr({token:t,factory:t.\u0275fac}),t})();function Gb(t,n,s){if(!t)throw new Error(`Cannot find '${s}' in '${n}'`);return t}const ID=function(t){return null},RD=zb(null,"core",[{provide:Tb,useValue:"unknown"},{provide:Vb,deps:[jr]},{provide:kb,deps:[]},{provide:Ab,deps:[]}]),ND=[{provide:Ef,useClass:Ef,deps:[tl,jr,Wc,Pd,Bd]},{provide:zE,deps:[tl],useFactory:function(t){let n=[];return t.onStable.subscribe(()=>{for(;n.length;)n.pop()()}),function(s){n.push(s)}}},{provide:Bd,useClass:Bd,deps:[[new _s,Vy]]},{provide:Cf,useClass:Cf,deps:[]},jT,{provide:Eg,useFactory:function(){return RC},deps:[]},{provide:Tg,useFactory:function(){return kC},deps:[]},{provide:Lg,useFactory:function(t){return sy(t=t||"undefined"!=typeof $localize&&$localize.locale||_g),t},deps:[[new Bi(Lg),new _s,new ki]]},{provide:Mb,useValue:"USD"}];let BD=(()=>{class t{constructor(s){}}return t.\u0275fac=function(s){return new(s||t)(ir(Ef))},t.\u0275mod=Qt({type:t}),t.\u0275inj=Uo({providers:ND}),t})()},3679:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{Wl:()=>ge,Fj:()=>_t,qu:()=>ie,u:()=>Ei,sg:()=>rt,u5:()=>Hs,JU:()=>Me,JJ:()=>pn,JL:()=>wo,On:()=>bn,YN:()=>mi,wV:()=>Ni,UX:()=>Ti,Q7:()=>Ao,EJ:()=>Rn,kI:()=>jt,_Y:()=>pi,Kr:()=>ui});var $=xe(639),y=xe(8583),Rt=xe(4402),h=xe(5758),Qe=xe(8002);let nt=(()=>{class S{constructor(I,K){this._renderer=I,this._elementRef=K,this.onChange=He=>{},this.onTouched=()=>{}}setProperty(I,K){this._renderer.setProperty(this._elementRef.nativeElement,I,K)}registerOnTouched(I){this.onTouched=I}registerOnChange(I){this.onChange=I}setDisabledState(I){this.setProperty("disabled",I)}}return S.\u0275fac=function(I){return new(I||S)($.Y36($.Qsj),$.Y36($.SBq))},S.\u0275dir=$.lG2({type:S}),S})(),ze=(()=>{class S extends nt{}return S.\u0275fac=function(){let k;return function(K){return(k||(k=$.n5z(S)))(K||S)}}(),S.\u0275dir=$.lG2({type:S,features:[$.qOj]}),S})();const Me=new $.OlP("NgValueAccessor"),qe={provide:Me,useExisting:(0,$.Gpc)(()=>ge),multi:!0};let ge=(()=>{class S extends ze{writeValue(I){this.setProperty("checked",I)}}return S.\u0275fac=function(){let k;return function(K){return(k||(k=$.n5z(S)))(K||S)}}(),S.\u0275dir=$.lG2({type:S,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(I,K){1&I&&$.NdJ("change",function(yt){return K.onChange(yt.target.checked)})("blur",function(){return K.onTouched()})},features:[$._Bn([qe]),$.qOj]}),S})();const Ye={provide:Me,useExisting:(0,$.Gpc)(()=>_t),multi:!0},Ct=new $.OlP("CompositionEventMode");let _t=(()=>{class S extends nt{constructor(I,K,He){super(I,K),this._compositionMode=He,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const S=(0,y.q)()?(0,y.q)().getUserAgent():"";return/android (\d+)/.test(S.toLowerCase())}())}writeValue(I){this.setProperty("value",null==I?"":I)}_handleInput(I){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(I)}_compositionStart(){this._composing=!0}_compositionEnd(I){this._composing=!1,this._compositionMode&&this.onChange(I)}}return S.\u0275fac=function(I){return new(I||S)($.Y36($.Qsj),$.Y36($.SBq),$.Y36(Ct,8))},S.\u0275dir=$.lG2({type:S,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(I,K){1&I&&$.NdJ("input",function(yt){return K._handleInput(yt.target.value)})("blur",function(){return K.onTouched()})("compositionstart",function(){return K._compositionStart()})("compositionend",function(yt){return K._compositionEnd(yt.target.value)})},features:[$._Bn([Ye]),$.qOj]}),S})();function Vt(S){return null==S||0===S.length}function ut(S){return null!=S&&"number"==typeof S.length}const qt=new $.OlP("NgValidators"),Dn=new $.OlP("NgAsyncValidators"),cn=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class jt{static min(k){return S=k,k=>{if(Vt(k.value)||Vt(S))return null;const I=parseFloat(k.value);return!isNaN(I)&&I<S?{min:{min:S,actual:k.value}}:null};var S}static max(k){return S=k,k=>{if(Vt(k.value)||Vt(S))return null;const I=parseFloat(k.value);return!isNaN(I)&&I>S?{max:{max:S,actual:k.value}}:null};var S}static required(k){return Kr(k)}static requiredTrue(k){return!0===k.value?null:{required:!0}}static email(k){return Vt((S=k).value)||cn.test(S.value)?null:{email:!0};var S}static minLength(k){return S=k,k=>Vt(k.value)||!ut(k.value)?null:k.value.length<S?{minlength:{requiredLength:S,actualLength:k.value.length}}:null;var S}static maxLength(k){return S=k,k=>ut(k.value)&&k.value.length>S?{maxlength:{requiredLength:S,actualLength:k.value.length}}:null;var S}static pattern(k){return function(S){if(!S)return In;let k,I;return"string"==typeof S?(I="","^"!==S.charAt(0)&&(I+="^"),I+=S,"$"!==S.charAt(S.length-1)&&(I+="$"),k=new RegExp(I)):(I=S.toString(),k=S),K=>{if(Vt(K.value))return null;const He=K.value;return k.test(He)?null:{pattern:{requiredPattern:I,actualValue:He}}}}(k)}static nullValidator(k){return null}static compose(k){return hi(k)}static composeAsync(k){return Os(k)}}function Kr(S){return Vt(S.value)?{required:!0}:null}function In(S){return null}function dn(S){return null!=S}function Un(S){const k=(0,$.QGY)(S)?(0,Rt.D)(S):S;return(0,$.CqO)(k),k}function $t(S){let k={};return S.forEach(I=>{k=null!=I?Object.assign(Object.assign({},k),I):k}),0===Object.keys(k).length?null:k}function lo(S,k){return k.map(I=>I(S))}function Ki(S){return S.map(k=>function(S){return!S.validate}(k)?k:I=>k.validate(I))}function hi(S){if(!S)return null;const k=S.filter(dn);return 0==k.length?null:function(I){return $t(lo(I,k))}}function co(S){return null!=S?hi(Ki(S)):null}function Os(S){if(!S)return null;const k=S.filter(dn);return 0==k.length?null:function(I){const K=lo(I,k).map(Un);return(0,h.D)(K).pipe((0,Qe.U)($t))}}function hs(S){return null!=S?Os(Ki(S)):null}function bo(S,k){return null===S?[k]:Array.isArray(S)?[...S,k]:[S,k]}function Fo(S){return S._rawValidators}function Ko(S){return S._rawAsyncValidators}function ji(S){return S?Array.isArray(S)?S:[S]:[]}function Jr(S,k){return Array.isArray(S)?S.includes(k):S===k}function ii(S,k){const I=ji(k);return ji(S).forEach(He=>{Jr(I,He)||I.push(He)}),I}function Xn(S,k){return ji(k).filter(I=>!Jr(S,I))}let An=(()=>{class S{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(I){this._rawValidators=I||[],this._composedValidatorFn=co(this._rawValidators)}_setAsyncValidators(I){this._rawAsyncValidators=I||[],this._composedAsyncValidatorFn=hs(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(I){this._onDestroyCallbacks.push(I)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(I=>I()),this._onDestroyCallbacks=[]}reset(I){this.control&&this.control.reset(I)}hasError(I,K){return!!this.control&&this.control.hasError(I,K)}getError(I,K){return this.control?this.control.getError(I,K):null}}return S.\u0275fac=function(I){return new(I||S)},S.\u0275dir=$.lG2({type:S}),S})(),Lr=(()=>{class S extends An{get formDirective(){return null}get path(){return null}}return S.\u0275fac=function(){let k;return function(K){return(k||(k=$.n5z(S)))(K||S)}}(),S.\u0275dir=$.lG2({type:S,features:[$.qOj]}),S})();class Ci extends An{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class hr{constructor(k){this._cd=k}is(k){var I,K,He;return"submitted"===k?!!(null===(I=this._cd)||void 0===I?void 0:I.submitted):!!(null===(He=null===(K=this._cd)||void 0===K?void 0:K.control)||void 0===He?void 0:He[k])}}let pn=(()=>{class S extends hr{constructor(I){super(I)}}return S.\u0275fac=function(I){return new(I||S)($.Y36(Ci,2))},S.\u0275dir=$.lG2({type:S,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(I,K){2&I&&$.ekj("ng-untouched",K.is("untouched"))("ng-touched",K.is("touched"))("ng-pristine",K.is("pristine"))("ng-dirty",K.is("dirty"))("ng-valid",K.is("valid"))("ng-invalid",K.is("invalid"))("ng-pending",K.is("pending"))},features:[$.qOj]}),S})(),wo=(()=>{class S extends hr{constructor(I){super(I)}}return S.\u0275fac=function(I){return new(I||S)($.Y36(Lr,10))},S.\u0275dir=$.lG2({type:S,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(I,K){2&I&&$.ekj("ng-untouched",K.is("untouched"))("ng-touched",K.is("touched"))("ng-pristine",K.is("pristine"))("ng-dirty",K.is("dirty"))("ng-valid",K.is("valid"))("ng-invalid",K.is("invalid"))("ng-pending",K.is("pending"))("ng-submitted",K.is("submitted"))},features:[$.qOj]}),S})();function Sr(S,k){return[...k.path,S]}function Nn(S,k){rn(S,k),k.valueAccessor.writeValue(S.value),function(S,k){k.valueAccessor.registerOnChange(I=>{S._pendingValue=I,S._pendingChange=!0,S._pendingDirty=!0,"change"===S.updateOn&&di(S,k)})}(S,k),function(S,k){const I=(K,He)=>{k.valueAccessor.writeValue(K),He&&k.viewToModelUpdate(K)};S.registerOnChange(I),k._registerOnDestroy(()=>{S._unregisterOnChange(I)})}(S,k),function(S,k){k.valueAccessor.registerOnTouched(()=>{S._pendingTouched=!0,"blur"===S.updateOn&&S._pendingChange&&di(S,k),"submit"!==S.updateOn&&S.markAsTouched()})}(S,k),function(S,k){if(k.valueAccessor.setDisabledState){const I=K=>{k.valueAccessor.setDisabledState(K)};S.registerOnDisabledChange(I),k._registerOnDestroy(()=>{S._unregisterOnDisabledChange(I)})}}(S,k)}function Nr(S,k,I=!0){const K=()=>{};k.valueAccessor&&(k.valueAccessor.registerOnChange(K),k.valueAccessor.registerOnTouched(K)),ci(S,k),S&&(k._invokeOnDestroyCallbacks(),S._registerOnCollectionChange(()=>{}))}function kn(S,k){S.forEach(I=>{I.registerOnValidatorChange&&I.registerOnValidatorChange(k)})}function rn(S,k){const I=Fo(S);null!==k.validator?S.setValidators(bo(I,k.validator)):"function"==typeof I&&S.setValidators([I]);const K=Ko(S);null!==k.asyncValidator?S.setAsyncValidators(bo(K,k.asyncValidator)):"function"==typeof K&&S.setAsyncValidators([K]);const He=()=>S.updateValueAndValidity();kn(k._rawValidators,He),kn(k._rawAsyncValidators,He)}function ci(S,k){let I=!1;if(null!==S){if(null!==k.validator){const He=Fo(S);if(Array.isArray(He)&&He.length>0){const yt=He.filter(Pn=>Pn!==k.validator);yt.length!==He.length&&(I=!0,S.setValidators(yt))}}if(null!==k.asyncValidator){const He=Ko(S);if(Array.isArray(He)&&He.length>0){const yt=He.filter(Pn=>Pn!==k.asyncValidator);yt.length!==He.length&&(I=!0,S.setAsyncValidators(yt))}}}const K=()=>{};return kn(k._rawValidators,K),kn(k._rawAsyncValidators,K),I}function di(S,k){S._pendingDirty&&S.markAsDirty(),S.setValue(S._pendingValue,{emitModelToViewChange:!1}),k.viewToModelUpdate(S._pendingValue),S._pendingChange=!1}function me(S,k){if(!S.hasOwnProperty("model"))return!1;const I=S.model;return!!I.isFirstChange()||!Object.is(k,I.currentValue)}function pe(S,k){if(!k)return null;let I,K,He;return Array.isArray(k),k.forEach(yt=>{yt.constructor===_t?I=yt:function(S){return Object.getPrototypeOf(S.constructor)===ze}(yt)?K=yt:He=yt}),He||K||I||null}function ve(S,k){const I=S.indexOf(k);I>-1&&S.splice(I,1)}const Be="VALID",je="INVALID",Oe="PENDING",Ze="DISABLED";function ot(S){return(Yt(S)?S.validators:S)||null}function mt(S){return Array.isArray(S)?co(S):S||null}function Qt(S,k){return(Yt(k)?k.asyncValidators:S)||null}function Gt(S){return Array.isArray(S)?hs(S):S||null}function Yt(S){return null!=S&&!Array.isArray(S)&&"object"==typeof S}class sn{constructor(k,I){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=k,this._rawAsyncValidators=I,this._composedValidatorFn=mt(this._rawValidators),this._composedAsyncValidatorFn=Gt(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(k){this._rawValidators=this._composedValidatorFn=k}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(k){this._rawAsyncValidators=this._composedAsyncValidatorFn=k}get parent(){return this._parent}get valid(){return this.status===Be}get invalid(){return this.status===je}get pending(){return this.status==Oe}get disabled(){return this.status===Ze}get enabled(){return this.status!==Ze}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(k){this._rawValidators=k,this._composedValidatorFn=mt(k)}setAsyncValidators(k){this._rawAsyncValidators=k,this._composedAsyncValidatorFn=Gt(k)}addValidators(k){this.setValidators(ii(k,this._rawValidators))}addAsyncValidators(k){this.setAsyncValidators(ii(k,this._rawAsyncValidators))}removeValidators(k){this.setValidators(Xn(k,this._rawValidators))}removeAsyncValidators(k){this.setAsyncValidators(Xn(k,this._rawAsyncValidators))}hasValidator(k){return Jr(this._rawValidators,k)}hasAsyncValidator(k){return Jr(this._rawAsyncValidators,k)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(k={}){this.touched=!0,this._parent&&!k.onlySelf&&this._parent.markAsTouched(k)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(k=>k.markAllAsTouched())}markAsUntouched(k={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(I=>{I.markAsUntouched({onlySelf:!0})}),this._parent&&!k.onlySelf&&this._parent._updateTouched(k)}markAsDirty(k={}){this.pristine=!1,this._parent&&!k.onlySelf&&this._parent.markAsDirty(k)}markAsPristine(k={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(I=>{I.markAsPristine({onlySelf:!0})}),this._parent&&!k.onlySelf&&this._parent._updatePristine(k)}markAsPending(k={}){this.status=Oe,!1!==k.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!k.onlySelf&&this._parent.markAsPending(k)}disable(k={}){const I=this._parentMarkedDirty(k.onlySelf);this.status=Ze,this.errors=null,this._forEachChild(K=>{K.disable(Object.assign(Object.assign({},k),{onlySelf:!0}))}),this._updateValue(),!1!==k.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},k),{skipPristineCheck:I})),this._onDisabledChange.forEach(K=>K(!0))}enable(k={}){const I=this._parentMarkedDirty(k.onlySelf);this.status=Be,this._forEachChild(K=>{K.enable(Object.assign(Object.assign({},k),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:k.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},k),{skipPristineCheck:I})),this._onDisabledChange.forEach(K=>K(!1))}_updateAncestors(k){this._parent&&!k.onlySelf&&(this._parent.updateValueAndValidity(k),k.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(k){this._parent=k}updateValueAndValidity(k={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Be||this.status===Oe)&&this._runAsyncValidator(k.emitEvent)),!1!==k.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!k.onlySelf&&this._parent.updateValueAndValidity(k)}_updateTreeValidity(k={emitEvent:!0}){this._forEachChild(I=>I._updateTreeValidity(k)),this.updateValueAndValidity({onlySelf:!0,emitEvent:k.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ze:Be}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(k){if(this.asyncValidator){this.status=Oe,this._hasOwnPendingAsyncValidator=!0;const I=Un(this.asyncValidator(this));this._asyncValidationSubscription=I.subscribe(K=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(K,{emitEvent:k})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(k,I={}){this.errors=k,this._updateControlsErrors(!1!==I.emitEvent)}get(k){return function(S,k,I){if(null==k||(Array.isArray(k)||(k=k.split(".")),Array.isArray(k)&&0===k.length))return null;let K=S;return k.forEach(He=>{K=K instanceof xn?K.controls.hasOwnProperty(He)?K.controls[He]:null:K instanceof Kn&&K.at(He)||null}),K}(this,k)}getError(k,I){const K=I?this.get(I):this;return K&&K.errors?K.errors[k]:null}hasError(k,I){return!!this.getError(k,I)}get root(){let k=this;for(;k._parent;)k=k._parent;return k}_updateControlsErrors(k){this.status=this._calculateStatus(),k&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(k)}_initObservables(){this.valueChanges=new $.vpe,this.statusChanges=new $.vpe}_calculateStatus(){return this._allControlsDisabled()?Ze:this.errors?je:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Oe)?Oe:this._anyControlsHaveStatus(je)?je:Be}_anyControlsHaveStatus(k){return this._anyControls(I=>I.status===k)}_anyControlsDirty(){return this._anyControls(k=>k.dirty)}_anyControlsTouched(){return this._anyControls(k=>k.touched)}_updatePristine(k={}){this.pristine=!this._anyControlsDirty(),this._parent&&!k.onlySelf&&this._parent._updatePristine(k)}_updateTouched(k={}){this.touched=this._anyControlsTouched(),this._parent&&!k.onlySelf&&this._parent._updateTouched(k)}_isBoxedValue(k){return"object"==typeof k&&null!==k&&2===Object.keys(k).length&&"value"in k&&"disabled"in k}_registerOnCollectionChange(k){this._onCollectionChange=k}_setUpdateStrategy(k){Yt(k)&&null!=k.updateOn&&(this._updateOn=k.updateOn)}_parentMarkedDirty(k){return!k&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class Mn extends sn{constructor(k=null,I,K){super(ot(I),Qt(K,I)),this._onChange=[],this._applyFormState(k),this._setUpdateStrategy(I),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}setValue(k,I={}){this.value=this._pendingValue=k,this._onChange.length&&!1!==I.emitModelToViewChange&&this._onChange.forEach(K=>K(this.value,!1!==I.emitViewToModelChange)),this.updateValueAndValidity(I)}patchValue(k,I={}){this.setValue(k,I)}reset(k=null,I={}){this._applyFormState(k),this.markAsPristine(I),this.markAsUntouched(I),this.setValue(this.value,I),this._pendingChange=!1}_updateValue(){}_anyControls(k){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(k){this._onChange.push(k)}_unregisterOnChange(k){ve(this._onChange,k)}registerOnDisabledChange(k){this._onDisabledChange.push(k)}_unregisterOnDisabledChange(k){ve(this._onDisabledChange,k)}_forEachChild(k){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(k){this._isBoxedValue(k)?(this.value=this._pendingValue=k.value,k.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=k}}class xn extends sn{constructor(k,I,K){super(ot(I),Qt(K,I)),this.controls=k,this._initObservables(),this._setUpdateStrategy(I),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(k,I){return this.controls[k]?this.controls[k]:(this.controls[k]=I,I.setParent(this),I._registerOnCollectionChange(this._onCollectionChange),I)}addControl(k,I,K={}){this.registerControl(k,I),this.updateValueAndValidity({emitEvent:K.emitEvent}),this._onCollectionChange()}removeControl(k,I={}){this.controls[k]&&this.controls[k]._registerOnCollectionChange(()=>{}),delete this.controls[k],this.updateValueAndValidity({emitEvent:I.emitEvent}),this._onCollectionChange()}setControl(k,I,K={}){this.controls[k]&&this.controls[k]._registerOnCollectionChange(()=>{}),delete this.controls[k],I&&this.registerControl(k,I),this.updateValueAndValidity({emitEvent:K.emitEvent}),this._onCollectionChange()}contains(k){return this.controls.hasOwnProperty(k)&&this.controls[k].enabled}setValue(k,I={}){this._checkAllValuesPresent(k),Object.keys(k).forEach(K=>{this._throwIfControlMissing(K),this.controls[K].setValue(k[K],{onlySelf:!0,emitEvent:I.emitEvent})}),this.updateValueAndValidity(I)}patchValue(k,I={}){null!=k&&(Object.keys(k).forEach(K=>{this.controls[K]&&this.controls[K].patchValue(k[K],{onlySelf:!0,emitEvent:I.emitEvent})}),this.updateValueAndValidity(I))}reset(k={},I={}){this._forEachChild((K,He)=>{K.reset(k[He],{onlySelf:!0,emitEvent:I.emitEvent})}),this._updatePristine(I),this._updateTouched(I),this.updateValueAndValidity(I)}getRawValue(){return this._reduceChildren({},(k,I,K)=>(k[K]=I instanceof Mn?I.value:I.getRawValue(),k))}_syncPendingControls(){let k=this._reduceChildren(!1,(I,K)=>!!K._syncPendingControls()||I);return k&&this.updateValueAndValidity({onlySelf:!0}),k}_throwIfControlMissing(k){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[k])throw new Error(`Cannot find form control with name: ${k}.`)}_forEachChild(k){Object.keys(this.controls).forEach(I=>{const K=this.controls[I];K&&k(K,I)})}_setUpControls(){this._forEachChild(k=>{k.setParent(this),k._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(k){for(const I of Object.keys(this.controls)){const K=this.controls[I];if(this.contains(I)&&k(K))return!0}return!1}_reduceValue(){return this._reduceChildren({},(k,I,K)=>((I.enabled||this.disabled)&&(k[K]=I.value),k))}_reduceChildren(k,I){let K=k;return this._forEachChild((He,yt)=>{K=I(K,He,yt)}),K}_allControlsDisabled(){for(const k of Object.keys(this.controls))if(this.controls[k].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(k){this._forEachChild((I,K)=>{if(void 0===k[K])throw new Error(`Must supply a value for form control with name: '${K}'.`)})}}class Kn extends sn{constructor(k,I,K){super(ot(I),Qt(K,I)),this.controls=k,this._initObservables(),this._setUpdateStrategy(I),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(k){return this.controls[k]}push(k,I={}){this.controls.push(k),this._registerControl(k),this.updateValueAndValidity({emitEvent:I.emitEvent}),this._onCollectionChange()}insert(k,I,K={}){this.controls.splice(k,0,I),this._registerControl(I),this.updateValueAndValidity({emitEvent:K.emitEvent})}removeAt(k,I={}){this.controls[k]&&this.controls[k]._registerOnCollectionChange(()=>{}),this.controls.splice(k,1),this.updateValueAndValidity({emitEvent:I.emitEvent})}setControl(k,I,K={}){this.controls[k]&&this.controls[k]._registerOnCollectionChange(()=>{}),this.controls.splice(k,1),I&&(this.controls.splice(k,0,I),this._registerControl(I)),this.updateValueAndValidity({emitEvent:K.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(k,I={}){this._checkAllValuesPresent(k),k.forEach((K,He)=>{this._throwIfControlMissing(He),this.at(He).setValue(K,{onlySelf:!0,emitEvent:I.emitEvent})}),this.updateValueAndValidity(I)}patchValue(k,I={}){null!=k&&(k.forEach((K,He)=>{this.at(He)&&this.at(He).patchValue(K,{onlySelf:!0,emitEvent:I.emitEvent})}),this.updateValueAndValidity(I))}reset(k=[],I={}){this._forEachChild((K,He)=>{K.reset(k[He],{onlySelf:!0,emitEvent:I.emitEvent})}),this._updatePristine(I),this._updateTouched(I),this.updateValueAndValidity(I)}getRawValue(){return this.controls.map(k=>k instanceof Mn?k.value:k.getRawValue())}clear(k={}){this.controls.length<1||(this._forEachChild(I=>I._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:k.emitEvent}))}_syncPendingControls(){let k=this.controls.reduce((I,K)=>!!K._syncPendingControls()||I,!1);return k&&this.updateValueAndValidity({onlySelf:!0}),k}_throwIfControlMissing(k){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(k))throw new Error(`Cannot find form control at index ${k}`)}_forEachChild(k){this.controls.forEach((I,K)=>{k(I,K)})}_updateValue(){this.value=this.controls.filter(k=>k.enabled||this.disabled).map(k=>k.value)}_anyControls(k){return this.controls.some(I=>I.enabled&&k(I))}_setUpControls(){this._forEachChild(k=>this._registerControl(k))}_checkAllValuesPresent(k){this._forEachChild((I,K)=>{if(void 0===k[K])throw new Error(`Must supply a value for form control at index: ${K}.`)})}_allControlsDisabled(){for(const k of this.controls)if(k.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(k){k.setParent(this),k._registerOnCollectionChange(this._onCollectionChange)}}const Gr={provide:Ci,useExisting:(0,$.Gpc)(()=>bn)},to=(()=>Promise.resolve(null))();let bn=(()=>{class S extends Ci{constructor(I,K,He,yt){super(),this.control=new Mn,this._registered=!1,this.update=new $.vpe,this._parent=I,this._setValidators(K),this._setAsyncValidators(He),this.valueAccessor=pe(0,yt)}ngOnChanges(I){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in I&&this._updateDisabled(I),me(I,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?Sr(this.name,this._parent):[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(I){this.viewModel=I,this.update.emit(I)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Nn(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(I){to.then(()=>{this.control.setValue(I,{emitViewToModelChange:!1})})}_updateDisabled(I){const K=I.isDisabled.currentValue,He=""===K||K&&"false"!==K;to.then(()=>{He&&!this.control.disabled?this.control.disable():!He&&this.control.disabled&&this.control.enable()})}}return S.\u0275fac=function(I){return new(I||S)($.Y36(Lr,9),$.Y36(qt,10),$.Y36(Dn,10),$.Y36(Me,10))},S.\u0275dir=$.lG2({type:S,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[$._Bn([Gr]),$.qOj,$.TTD]}),S})(),pi=(()=>{class S{}return S.\u0275fac=function(I){return new(I||S)},S.\u0275dir=$.lG2({type:S,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),S})();const Li={provide:Me,useExisting:(0,$.Gpc)(()=>Ni),multi:!0};let Ni=(()=>{class S extends ze{writeValue(I){this.setProperty("value",null==I?"":I)}registerOnChange(I){this.onChange=K=>{I(""==K?null:parseFloat(K))}}}return S.\u0275fac=function(){let k;return function(K){return(k||(k=$.n5z(S)))(K||S)}}(),S.\u0275dir=$.lG2({type:S,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(I,K){1&I&&$.NdJ("input",function(yt){return K.onChange(yt.target.value)})("blur",function(){return K.onTouched()})},features:[$._Bn([Li]),$.qOj]}),S})(),no=(()=>{class S{}return S.\u0275fac=function(I){return new(I||S)},S.\u0275mod=$.oAB({type:S}),S.\u0275inj=$.cJS({}),S})();const Fs=new $.OlP("NgModelWithFormControlWarning"),qr={provide:Lr,useExisting:(0,$.Gpc)(()=>rt)};let rt=(()=>{class S extends Lr{constructor(I,K){super(),this.validators=I,this.asyncValidators=K,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new $.vpe,this._setValidators(I),this._setAsyncValidators(K)}ngOnChanges(I){this._checkFormPresent(),I.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(ci(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(I){const K=this.form.get(I.path);return Nn(K,I),K.updateValueAndValidity({emitEvent:!1}),this.directives.push(I),K}getControl(I){return this.form.get(I.path)}removeControl(I){Nr(I.control||null,I,!1),ve(this.directives,I)}addFormGroup(I){this._setUpFormContainer(I)}removeFormGroup(I){this._cleanUpFormContainer(I)}getFormGroup(I){return this.form.get(I.path)}addFormArray(I){this._setUpFormContainer(I)}removeFormArray(I){this._cleanUpFormContainer(I)}getFormArray(I){return this.form.get(I.path)}updateModel(I,K){this.form.get(I.path).setValue(K)}onSubmit(I){return this.submitted=!0,function(S,k){S._syncPendingControls(),k.forEach(I=>{const K=I.control;"submit"===K.updateOn&&K._pendingChange&&(I.viewToModelUpdate(K._pendingValue),K._pendingChange=!1)})}(this.form,this.directives),this.ngSubmit.emit(I),!1}onReset(){this.resetForm()}resetForm(I){this.form.reset(I),this.submitted=!1}_updateDomValue(){this.directives.forEach(I=>{const K=I.control,He=this.form.get(I.path);K!==He&&(Nr(K||null,I),He instanceof Mn&&(Nn(He,I),I.control=He))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(I){const K=this.form.get(I.path);(function(S,k){rn(S,k)})(K,I),K.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(I){if(this.form){const K=this.form.get(I.path);K&&function(S,k){return ci(S,k)}(K,I)&&K.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){rn(this.form,this),this._oldForm&&ci(this._oldForm,this)}_checkFormPresent(){}}return S.\u0275fac=function(I){return new(I||S)($.Y36(qt,10),$.Y36(Dn,10))},S.\u0275dir=$.lG2({type:S,selectors:[["","formGroup",""]],hostBindings:function(I,K){1&I&&$.NdJ("submit",function(yt){return K.onSubmit(yt)})("reset",function(){return K.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[$._Bn([qr]),$.qOj,$.TTD]}),S})();const Gi={provide:Ci,useExisting:(0,$.Gpc)(()=>Ei)};let Ei=(()=>{class S extends Ci{constructor(I,K,He,yt,Pn){super(),this._ngModelWarningConfig=Pn,this._added=!1,this.update=new $.vpe,this._ngModelWarningSent=!1,this._parent=I,this._setValidators(K),this._setAsyncValidators(He),this.valueAccessor=pe(0,yt)}set isDisabled(I){}ngOnChanges(I){this._added||this._setUpControl(),me(I,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(I){this.viewModel=I,this.update.emit(I)}get path(){return Sr(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}}return S.\u0275fac=function(I){return new(I||S)($.Y36(Lr,13),$.Y36(qt,10),$.Y36(Dn,10),$.Y36(Me,10),$.Y36(Fs,8))},S.\u0275dir=$.lG2({type:S,selectors:[["","formControlName",""]],inputs:{isDisabled:["disabled","isDisabled"],name:["formControlName","name"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[$._Bn([Gi]),$.qOj,$.TTD]}),S._ngModelWarningSentOnce=!1,S})();const Si={provide:Me,useExisting:(0,$.Gpc)(()=>Rn),multi:!0};function kt(S,k){return null==S?`${k}`:(k&&"object"==typeof k&&(k="Object"),`${S}: ${k}`.slice(0,50))}let Rn=(()=>{class S extends ze{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(I){this._compareWith=I}writeValue(I){this.value=I;const K=this._getOptionId(I);null==K&&this.setProperty("selectedIndex",-1);const He=kt(K,I);this.setProperty("value",He)}registerOnChange(I){this.onChange=K=>{this.value=this._getOptionValue(K),I(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(I){for(const K of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(K),I))return K;return null}_getOptionValue(I){const K=function(S){return S.split(":")[0]}(I);return this._optionMap.has(K)?this._optionMap.get(K):I}}return S.\u0275fac=function(){let k;return function(K){return(k||(k=$.n5z(S)))(K||S)}}(),S.\u0275dir=$.lG2({type:S,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(I,K){1&I&&$.NdJ("change",function(yt){return K.onChange(yt.target.value)})("blur",function(){return K.onTouched()})},inputs:{compareWith:"compareWith"},features:[$._Bn([Si]),$.qOj]}),S})(),mi=(()=>{class S{constructor(I,K,He){this._element=I,this._renderer=K,this._select=He,this._select&&(this.id=this._select._registerOption())}set ngValue(I){null!=this._select&&(this._select._optionMap.set(this.id,I),this._setElementValue(kt(this.id,I)),this._select.writeValue(this._select.value))}set value(I){this._setElementValue(I),this._select&&this._select.writeValue(this._select.value)}_setElementValue(I){this._renderer.setProperty(this._element.nativeElement,"value",I)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return S.\u0275fac=function(I){return new(I||S)($.Y36($.SBq),$.Y36($.Qsj),$.Y36(Rn,9))},S.\u0275dir=$.lG2({type:S,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),S})();const ho={provide:Me,useExisting:(0,$.Gpc)(()=>To),multi:!0};function Fn(S,k){return null==S?`${k}`:("string"==typeof k&&(k=`'${k}'`),k&&"object"==typeof k&&(k="Object"),`${S}: ${k}`.slice(0,50))}let To=(()=>{class S extends ze{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(I){this._compareWith=I}writeValue(I){let K;if(this.value=I,Array.isArray(I)){const He=I.map(yt=>this._getOptionId(yt));K=(yt,Pn)=>{yt._setSelected(He.indexOf(Pn.toString())>-1)}}else K=(He,yt)=>{He._setSelected(!1)};this._optionMap.forEach(K)}registerOnChange(I){this.onChange=K=>{const He=[];if(void 0!==K.selectedOptions){const yt=K.selectedOptions;for(let Pn=0;Pn<yt.length;Pn++){const pr=yt.item(Pn),Hn=this._getOptionValue(pr.value);He.push(Hn)}}else{const yt=K.options;for(let Pn=0;Pn<yt.length;Pn++){const pr=yt.item(Pn);if(pr.selected){const Hn=this._getOptionValue(pr.value);He.push(Hn)}}}this.value=He,I(He)}}_registerOption(I){const K=(this._idCounter++).toString();return this._optionMap.set(K,I),K}_getOptionId(I){for(const K of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(K)._value,I))return K;return null}_getOptionValue(I){const K=function(S){return S.split(":")[0]}(I);return this._optionMap.has(K)?this._optionMap.get(K)._value:I}}return S.\u0275fac=function(){let k;return function(K){return(k||(k=$.n5z(S)))(K||S)}}(),S.\u0275dir=$.lG2({type:S,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(I,K){1&I&&$.NdJ("change",function(yt){return K.onChange(yt.target)})("blur",function(){return K.onTouched()})},inputs:{compareWith:"compareWith"},features:[$._Bn([ho]),$.qOj]}),S})(),ui=(()=>{class S{constructor(I,K,He){this._element=I,this._renderer=K,this._select=He,this._select&&(this.id=this._select._registerOption(this))}set ngValue(I){null!=this._select&&(this._value=I,this._setElementValue(Fn(this.id,I)),this._select.writeValue(this._select.value))}set value(I){this._select?(this._value=I,this._setElementValue(Fn(this.id,I)),this._select.writeValue(this._select.value)):this._setElementValue(I)}_setElementValue(I){this._renderer.setProperty(this._element.nativeElement,"value",I)}_setSelected(I){this._renderer.setProperty(this._element.nativeElement,"selected",I)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return S.\u0275fac=function(I){return new(I||S)($.Y36($.SBq),$.Y36($.Qsj),$.Y36(To,9))},S.\u0275dir=$.lG2({type:S,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),S})();const bs={provide:qt,useExisting:(0,$.Gpc)(()=>Ao),multi:!0};let Ao=(()=>{class S{constructor(){this._required=!1}get required(){return this._required}set required(I){this._required=null!=I&&!1!==I&&"false"!=`${I}`,this._onChange&&this._onChange()}validate(I){return this.required?Kr(I):null}registerOnValidatorChange(I){this._onChange=I}}return S.\u0275fac=function(I){return new(I||S)},S.\u0275dir=$.lG2({type:S,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(I,K){2&I&&$.uIk("required",K.required?"":null)},inputs:{required:"required"},features:[$._Bn([bs])]}),S})(),mo=(()=>{class S{}return S.\u0275fac=function(I){return new(I||S)},S.\u0275mod=$.oAB({type:S}),S.\u0275inj=$.cJS({imports:[[no]]}),S})(),Hs=(()=>{class S{}return S.\u0275fac=function(I){return new(I||S)},S.\u0275mod=$.oAB({type:S}),S.\u0275inj=$.cJS({imports:[mo]}),S})(),Ti=(()=>{class S{static withConfig(I){return{ngModule:S,providers:[{provide:Fs,useValue:I.warnOnNgModelWithFormControl}]}}}return S.\u0275fac=function(I){return new(I||S)},S.\u0275mod=$.oAB({type:S}),S.\u0275inj=$.cJS({imports:[mo]}),S})(),ie=(()=>{class S{group(I,K=null){const He=this._reduceControls(I);let pr,yt=null,Pn=null;return null!=K&&(function(S){return void 0!==S.asyncValidators||void 0!==S.validators||void 0!==S.updateOn}(K)?(yt=null!=K.validators?K.validators:null,Pn=null!=K.asyncValidators?K.asyncValidators:null,pr=null!=K.updateOn?K.updateOn:void 0):(yt=null!=K.validator?K.validator:null,Pn=null!=K.asyncValidator?K.asyncValidator:null)),new xn(He,{asyncValidators:Pn,updateOn:pr,validators:yt})}control(I,K,He){return new Mn(I,K,He)}array(I,K,He){const yt=I.map(Pn=>this._createControl(Pn));return new Kn(yt,K,He)}_reduceControls(I){const K={};return Object.keys(I).forEach(He=>{K[He]=this._createControl(I[He])}),K}_createControl(I){return I instanceof Mn||I instanceof xn||I instanceof Kn?I:Array.isArray(I)?this.control(I[0],I.length>1?I[1]:null,I.length>2?I[2]:null):this.control(I)}}return S.\u0275fac=function(I){return new(I||S)},S.\u0275prov=(0,$.Yz7)({factory:function(){return new S},token:S,providedIn:Ti}),S})()},8217:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{gz:()=>mi,F0:()=>ro,rH:()=>Ua,yS:()=>ja,Bz:()=>Za,lC:()=>Ls});var $=xe(8583),y=xe(639),Rt=xe(9765),h=xe(7971);class Qe extends Rt.xQ{constructor(M){super(),this._value=M}get value(){return this.getValue()}_subscribe(M){const A=super._subscribe(M);return A&&!A.closed&&M.next(this._value),A}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new h.N;return this._value}next(M){super.next(this._value=M)}}var nt=xe(4869),ze=xe(9796),Me=xe(7393);class qe extends Me.L{notifyNext(M,A,V,W,oe){this.destination.next(A)}notifyError(M,A){this.destination.error(M)}notifyComplete(M){this.destination.complete()}}class ge extends Me.L{constructor(M,A,V){super(),this.parent=M,this.outerValue=A,this.outerIndex=V,this.index=0}_next(M){this.parent.notifyNext(this.outerValue,M,this.outerIndex,this.index++,this)}_error(M){this.parent.notifyError(M,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}var Ye=xe(7444),Xe=xe(7574);function Ct(L,M,A,V,W=new ge(L,A,V)){if(!W.closed)return M instanceof Xe.y?M.subscribe(W):(0,Ye.s)(M)(W)}var _t=xe(6693);const Vt={};class qt{constructor(M){this.resultSelector=M}call(M,A){return A.subscribe(new Dn(M,this.resultSelector))}}class Dn extends qe{constructor(M,A){super(M),this.resultSelector=A,this.active=0,this.values=[],this.observables=[]}_next(M){this.values.push(Vt),this.observables.push(M)}_complete(){const M=this.observables,A=M.length;if(0===A)this.destination.complete();else{this.active=A,this.toRespond=A;for(let V=0;V<A;V++)this.add(Ct(this,M[V],void 0,V))}}notifyComplete(M){0==(this.active-=1)&&this.destination.complete()}notifyNext(M,A,V){const W=this.values,we=this.toRespond?W[V]===Vt?--this.toRespond:this.toRespond:0;W[V]=A,0===we&&(this.resultSelector?this._tryResultSelector(W):this.destination.next(W.slice()))}_tryResultSelector(M){let A;try{A=this.resultSelector.apply(this,M)}catch(V){return void this.destination.error(V)}this.destination.next(A)}}const jt=(()=>{function L(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return L.prototype=Object.create(Error.prototype),L})();var vr=xe(4402),hn=xe(5917),Kr=xe(8071),ao=xe(1439),li=xe(9193),Jt=xe(2441);function Mr(L,M){let A=!1;return arguments.length>=2&&(A=!0),function(W){return W.lift(new In(L,M,A))}}class In{constructor(M,A,V=!1){this.accumulator=M,this.seed=A,this.hasSeed=V}call(M,A){return A.subscribe(new dn(M,this.accumulator,this.seed,this.hasSeed))}}class dn extends Me.L{constructor(M,A,V,W){super(M),this.accumulator=A,this._seed=V,this.hasSeed=W,this.index=0}get seed(){return this._seed}set seed(M){this.hasSeed=!0,this._seed=M}_next(M){if(this.hasSeed)return this._tryNext(M);this.seed=M,this.destination.next(M)}_tryNext(M){const A=this.index++;let V;try{V=this.accumulator(this.seed,M,A)}catch(W){this.destination.error(W)}this.seed=V,this.destination.next(V)}}var Un=xe(5345);function $t(L){return function(A){const V=new lo(L),W=A.lift(V);return V.caught=W}}class lo{constructor(M){this.selector=M}call(M,A){return A.subscribe(new Ln(M,this.selector,this.caught))}}class Ln extends Un.Ds{constructor(M,A,V){super(M),this.selector=A,this.caught=V}error(M){if(!this.isStopped){let A;try{A=this.selector(M,this.caught)}catch(oe){return void super.error(oe)}this._unsubscribeAndRecycle();const V=new Un.IY(this);this.add(V);const W=(0,Un.ft)(A,V);W!==V&&this.add(W)}}}var Ki=xe(5435),hi=xe(7108);function co(L){return function(A){return 0===L?(0,li.c)():A.lift(new Os(L))}}class Os{constructor(M){if(this.total=M,this.total<0)throw new hi.W}call(M,A){return A.subscribe(new hs(M,this.total))}}class hs extends Me.L{constructor(M,A){super(M),this.total=A,this.ring=new Array,this.count=0}_next(M){const A=this.ring,V=this.total,W=this.count++;A.length<V?A.push(M):A[W%V]=M}_complete(){const M=this.destination;let A=this.count;if(A>0){const V=this.count>=this.total?this.total:this.count,W=this.ring;for(let oe=0;oe<V;oe++){const we=A++%V;M.next(W[we])}}M.complete()}}function bo(L=ji){return M=>M.lift(new Fo(L))}class Fo{constructor(M){this.errorFactory=M}call(M,A){return A.subscribe(new Ko(M,this.errorFactory))}}class Ko extends Me.L{constructor(M,A){super(M),this.errorFactory=A,this.hasValue=!1}_next(M){this.hasValue=!0,this.destination.next(M)}_complete(){if(this.hasValue)return this.destination.complete();{let M;try{M=this.errorFactory()}catch(A){M=A}this.destination.error(M)}}}function ji(){return new jt}function Jr(L=null){return M=>M.lift(new ii(L))}class ii{constructor(M){this.defaultValue=M}call(M,A){return A.subscribe(new Xn(M,this.defaultValue))}}class Xn extends Me.L{constructor(M,A){super(M),this.defaultValue=A,this.isEmpty=!0}_next(M){this.isEmpty=!1,this.destination.next(M)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}var An=xe(4487),Ci=xe(5257);function hr(L,M){const A=arguments.length>=2;return V=>V.pipe(L?(0,Ki.h)((W,oe)=>L(W,oe,V)):An.y,(0,Ci.q)(1),A?Jr(M):bo(()=>new jt))}function Ji(){}var Uo=xe(9105);function pn(L,M,A){return function(W){return W.lift(new wo(L,M,A))}}class wo{constructor(M,A,V){this.nextOrObserver=M,this.error=A,this.complete=V}call(M,A){return A.subscribe(new Br(M,this.nextOrObserver,this.error,this.complete))}}class Br extends Me.L{constructor(M,A,V,W){super(M),this._tapNext=Ji,this._tapError=Ji,this._tapComplete=Ji,this._tapError=V||Ji,this._tapComplete=W||Ji,(0,Uo.m)(A)?(this._context=this,this._tapNext=A):A&&(this._context=A,this._tapNext=A.next||Ji,this._tapError=A.error||Ji,this._tapComplete=A.complete||Ji)}_next(M){try{this._tapNext.call(this._context,M)}catch(A){return void this.destination.error(A)}this.destination.next(M)}_error(M){try{this._tapError.call(this._context,M)}catch(A){return void this.destination.error(A)}this.destination.error(M)}_complete(){try{this._tapComplete.call(this._context)}catch(M){return void this.destination.error(M)}return this.destination.complete()}}var $i=xe(5319);class st{constructor(M){this.callback=M}call(M,A){return A.subscribe(new Ne(M,this.callback))}}class Ne extends Me.L{constructor(M,A){super(M),this.add(new $i.w(A))}}var Fe=xe(8002),At=xe(3190),Je=xe(4612),Zt=xe(9773),Wt=xe(1307),Xt=xe(3282);class _n{constructor(M,A){this.id=M,this.url=A}}class Sr extends _n{constructor(M,A,V="imperative",W=null){super(M,A),this.navigationTrigger=V,this.restoredState=W}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Nn extends _n{constructor(M,A,V){super(M,A),this.urlAfterRedirects=V}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Nr extends _n{constructor(M,A,V){super(M,A),this.reason=V}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class kn extends _n{constructor(M,A,V){super(M,A),this.error=V}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class On extends _n{constructor(M,A,V,W){super(M,A),this.urlAfterRedirects=V,this.state=W}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class rn extends _n{constructor(M,A,V,W){super(M,A),this.urlAfterRedirects=V,this.state=W}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ci extends _n{constructor(M,A,V,W,oe){super(M,A),this.urlAfterRedirects=V,this.state=W,this.shouldActivate=oe}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Gn extends _n{constructor(M,A,V,W){super(M,A),this.urlAfterRedirects=V,this.state=W}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Qr extends _n{constructor(M,A,V,W){super(M,A),this.urlAfterRedirects=V,this.state=W}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class di{constructor(M){this.route=M}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Qn{constructor(M){this.route=M}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Qi{constructor(M){this.snapshot=M}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class jo{constructor(M){this.snapshot=M}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Co{constructor(M){this.snapshot=M}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class zn{constructor(M){this.snapshot=M}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class me{constructor(M,A,V){this.routerEvent=M,this.position=A,this.anchor=V}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Z="primary";class re{constructor(M){this.params=M||{}}has(M){return Object.prototype.hasOwnProperty.call(this.params,M)}get(M){if(this.has(M)){const A=this.params[M];return Array.isArray(A)?A[0]:A}return null}getAll(M){if(this.has(M)){const A=this.params[M];return Array.isArray(A)?A:[A]}return[]}get keys(){return Object.keys(this.params)}}function pe(L){return new re(L)}const ve="ngNavigationCancelingError";function Ie(L){const M=Error("NavigationCancelingError: "+L);return M[ve]=!0,M}function je(L,M,A){const V=A.path.split("/");if(V.length>L.length||"full"===A.pathMatch&&(M.hasChildren()||V.length<L.length))return null;const W={};for(let oe=0;oe<V.length;oe++){const we=V[oe],Le=L[oe];if(we.startsWith(":"))W[we.substring(1)]=Le;else if(we!==Le.path)return null}return{consumed:L.slice(0,V.length),posParams:W}}function Ze(L,M){const A=L?Object.keys(L):void 0,V=M?Object.keys(M):void 0;if(!A||!V||A.length!=V.length)return!1;let W;for(let oe=0;oe<A.length;oe++)if(W=A[oe],!lt(L[W],M[W]))return!1;return!0}function lt(L,M){if(Array.isArray(L)&&Array.isArray(M)){if(L.length!==M.length)return!1;const A=[...L].sort(),V=[...M].sort();return A.every((W,oe)=>V[oe]===W)}return L===M}function ot(L){return Array.prototype.concat.apply([],L)}function mt(L){return L.length>0?L[L.length-1]:null}function Gt(L,M){for(const A in L)L.hasOwnProperty(A)&&M(L[A],A)}function Yt(L){return(0,y.CqO)(L)?L:(0,y.QGY)(L)?(0,vr.D)(Promise.resolve(L)):(0,hn.of)(L)}const Mn={exact:function Wn(L,M,A){if(!si(L.segments,M.segments)||!yn(L.segments,M.segments,A)||L.numberOfChildren!==M.numberOfChildren)return!1;for(const V in M.children)if(!L.children[V]||!Wn(L.children[V],M.children[V],A))return!1;return!0},subset:ei},xn={exact:function(L,M){return Ze(L,M)},subset:function(L,M){return Object.keys(M).length<=Object.keys(L).length&&Object.keys(M).every(A=>lt(L[A],M[A]))},ignored:()=>!0};function Kn(L,M,A){return Mn[A.paths](L.root,M.root,A.matrixParams)&&xn[A.queryParams](L.queryParams,M.queryParams)&&!("exact"===A.fragment&&L.fragment!==M.fragment)}function ei(L,M,A){return Nt(L,M,M.segments,A)}function Nt(L,M,A,V){if(L.segments.length>A.length){const W=L.segments.slice(0,A.length);return!(!si(W,A)||M.hasChildren()||!yn(W,A,V))}if(L.segments.length===A.length){if(!si(L.segments,A)||!yn(L.segments,A,V))return!1;for(const W in M.children)if(!L.children[W]||!ei(L.children[W],M.children[W],V))return!1;return!0}{const W=A.slice(0,L.segments.length),oe=A.slice(L.segments.length);return!!(si(L.segments,W)&&yn(L.segments,W,V)&&L.children[Z])&&Nt(L.children[Z],M,oe,V)}}function yn(L,M,A){return M.every((V,W)=>xn[A](L[W].parameters,V.parameters))}class sr{constructor(M,A,V){this.root=M,this.queryParams=A,this.fragment=V}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=pe(this.queryParams)),this._queryParamMap}toString(){return bn.serialize(this)}}class un{constructor(M,A){this.segments=M,this.children=A,this.parent=null,Gt(A,(V,W)=>V.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return pi(this)}}class oi{constructor(M,A){this.path=M,this.parameters=A}get parameterMap(){return this._parameterMap||(this._parameterMap=pe(this.parameters)),this._parameterMap}toString(){return Ir(this)}}function si(L,M){return L.length===M.length&&L.every((A,V)=>A.path===M[V].path)}class Eo{}class to{parse(M){const A=new Qo(M);return new sr(A.parseRootSegment(),A.parseQueryParams(),A.parseFragment())}serialize(M){var L;return`${`/${Li(M.root,!0)}`}${function(L){const M=Object.keys(L).map(A=>{const V=L[A];return Array.isArray(V)?V.map(W=>`${Lo(A)}=${Lo(W)}`).join("&"):`${Lo(A)}=${Lo(V)}`}).filter(A=>!!A);return M.length?`?${M.join("&")}`:""}(M.queryParams)}${"string"==typeof M.fragment?`#${L=M.fragment,encodeURI(L)}`:""}`}}const bn=new to;function pi(L){return L.segments.map(M=>Ir(M)).join("/")}function Li(L,M){if(!L.hasChildren())return pi(L);if(M){const A=L.children[Z]?Li(L.children[Z],!1):"",V=[];return Gt(L.children,(W,oe)=>{oe!==Z&&V.push(`${oe}:${Li(W,!1)}`)}),V.length>0?`${A}(${V.join("//")})`:A}{const A=function(L,M){let A=[];return Gt(L.children,(V,W)=>{W===Z&&(A=A.concat(M(V,W)))}),Gt(L.children,(V,W)=>{W!==Z&&(A=A.concat(M(V,W)))}),A}(L,(V,W)=>W===Z?[Li(L.children[Z],!1)]:[`${W}:${Li(V,!1)}`]);return 1===Object.keys(L.children).length&&null!=L.children[Z]?`${pi(L)}/${A[0]}`:`${pi(L)}/(${A.join("//")})`}}function Ni(L){return encodeURIComponent(L).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Lo(L){return Ni(L).replace(/%3B/gi,";")}function no(L){return Ni(L).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Mi(L){return decodeURIComponent(L)}function fi(L){return Mi(L.replace(/\+/g,"%20"))}function Ir(L){return`${no(L.path)}${function(L){return Object.keys(L).map(M=>`;${no(M)}=${no(L[M])}`).join("")}(L.parameters)}`}const uo=/^[^\/()?;=#]+/;function $o(L){const M=L.match(uo);return M?M[0]:""}const qr=/^[^=?&#]+/,zt=/^[^?&#]+/;class Qo{constructor(M){this.url=M,this.remaining=M}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new un([],{}):new un([],this.parseChildren())}parseQueryParams(){const M={};if(this.consumeOptional("?"))do{this.parseQueryParam(M)}while(this.consumeOptional("&"));return M}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const M=[];for(this.peekStartsWith("(")||M.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),M.push(this.parseSegment());let A={};this.peekStartsWith("/(")&&(this.capture("/"),A=this.parseParens(!0));let V={};return this.peekStartsWith("(")&&(V=this.parseParens(!1)),(M.length>0||Object.keys(A).length>0)&&(V[Z]=new un(M,A)),V}parseSegment(){const M=$o(this.remaining);if(""===M&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(M),new oi(Mi(M),this.parseMatrixParams())}parseMatrixParams(){const M={};for(;this.consumeOptional(";");)this.parseParam(M);return M}parseParam(M){const A=$o(this.remaining);if(!A)return;this.capture(A);let V="";if(this.consumeOptional("=")){const W=$o(this.remaining);W&&(V=W,this.capture(V))}M[Mi(A)]=Mi(V)}parseQueryParam(M){const A=function(L){const M=L.match(qr);return M?M[0]:""}(this.remaining);if(!A)return;this.capture(A);let V="";if(this.consumeOptional("=")){const we=function(L){const M=L.match(zt);return M?M[0]:""}(this.remaining);we&&(V=we,this.capture(V))}const W=fi(A),oe=fi(V);if(M.hasOwnProperty(W)){let we=M[W];Array.isArray(we)||(we=[we],M[W]=we),we.push(oe)}else M[W]=oe}parseParens(M){const A={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const V=$o(this.remaining),W=this.remaining[V.length];if("/"!==W&&")"!==W&&";"!==W)throw new Error(`Cannot parse url '${this.url}'`);let oe;V.indexOf(":")>-1?(oe=V.substr(0,V.indexOf(":")),this.capture(oe),this.capture(":")):M&&(oe=Z);const we=this.parseChildren();A[oe]=1===Object.keys(we).length?we[Z]:new un([],we),this.consumeOptional("//")}return A}peekStartsWith(M){return this.remaining.startsWith(M)}consumeOptional(M){return!!this.peekStartsWith(M)&&(this.remaining=this.remaining.substring(M.length),!0)}capture(M){if(!this.consumeOptional(M))throw new Error(`Expected "${M}".`)}}class nr{constructor(M){this._root=M}get root(){return this._root.value}parent(M){const A=this.pathFromRoot(M);return A.length>1?A[A.length-2]:null}children(M){const A=ti(M,this._root);return A?A.children.map(V=>V.value):[]}firstChild(M){const A=ti(M,this._root);return A&&A.children.length>0?A.children[0].value:null}siblings(M){const A=Gi(M,this._root);return A.length<2?[]:A[A.length-2].children.map(W=>W.value).filter(W=>W!==M)}pathFromRoot(M){return Gi(M,this._root).map(A=>A.value)}}function ti(L,M){if(L===M.value)return M;for(const A of M.children){const V=ti(L,A);if(V)return V}return null}function Gi(L,M){if(L===M.value)return[M];for(const A of M.children){const V=Gi(L,A);if(V.length)return V.unshift(M),V}return[]}class Ei{constructor(M,A){this.value=M,this.children=A}toString(){return`TreeNode(${this.value})`}}function Si(L){const M={};return L&&L.children.forEach(A=>M[A.value.outlet]=A),M}class kt extends nr{constructor(M,A){super(M),this.snapshot=A,To(this,M)}toString(){return this.snapshot.toString()}}function Bn(L,M){const A=function(L,M){const we=new Zo([],{},{},"",{},Z,M,null,L.root,-1,{});return new es("",new Ei(we,[]))}(L,M),V=new Qe([new oi("",{})]),W=new Qe({}),oe=new Qe({}),we=new Qe({}),Le=new Qe(""),ft=new mi(V,W,we,Le,oe,Z,M,A.root);return ft.snapshot=A.root,new kt(new Ei(ft,[]),A)}class mi{constructor(M,A,V,W,oe,we,Le,ft){this.url=M,this.params=A,this.queryParams=V,this.fragment=W,this.data=oe,this.outlet=we,this.component=Le,this._futureSnapshot=ft}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,Fe.U)(M=>pe(M)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,Fe.U)(M=>pe(M)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function ho(L,M="emptyOnly"){const A=L.pathFromRoot;let V=0;if("always"!==M)for(V=A.length-1;V>=1;){const W=A[V],oe=A[V-1];if(W.routeConfig&&""===W.routeConfig.path)V--;else{if(oe.component)break;V--}}return function(L){return L.reduce((M,A)=>({params:Object.assign(Object.assign({},M.params),A.params),data:Object.assign(Object.assign({},M.data),A.data),resolve:Object.assign(Object.assign({},M.resolve),A._resolvedData)}),{params:{},data:{},resolve:{}})}(A.slice(V))}class Zo{constructor(M,A,V,W,oe,we,Le,ft,en,Rr,wn){this.url=M,this.params=A,this.queryParams=V,this.fragment=W,this.data=oe,this.outlet=we,this.component=Le,this.routeConfig=ft,this._urlSegment=en,this._lastPathIndex=Rr,this._resolve=wn}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=pe(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=pe(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(V=>V.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class es extends nr{constructor(M,A){super(A),this.url=M,To(this,A)}toString(){return ui(this._root)}}function To(L,M){M.value._routerState=L,M.children.forEach(A=>To(L,A))}function ui(L){const M=L.children.length>0?` { ${L.children.map(ui).join(", ")} } `:"";return`${L.value}${M}`}function Dr(L){if(L.snapshot){const M=L.snapshot,A=L._futureSnapshot;L.snapshot=A,Ze(M.queryParams,A.queryParams)||L.queryParams.next(A.queryParams),M.fragment!==A.fragment&&L.fragment.next(A.fragment),Ze(M.params,A.params)||L.params.next(A.params),function(L,M){if(L.length!==M.length)return!1;for(let A=0;A<L.length;++A)if(!Ze(L[A],M[A]))return!1;return!0}(M.url,A.url)||L.url.next(A.url),Ze(M.data,A.data)||L.data.next(A.data)}else L.snapshot=L._futureSnapshot,L.data.next(L._futureSnapshot.data)}function Gs(L,M){return Ze(L.params,M.params)&&function(L,M){return si(L,M)&&L.every((A,V)=>Ze(A.parameters,M[V].parameters))}(L.url,M.url)&&!(!L.parent!=!M.parent)&&(!L.parent||Gs(L.parent,M.parent))}function Go(L,M,A){if(A&&L.shouldReuseRoute(M.value,A.value.snapshot)){const V=A.value;V._futureSnapshot=M.value;const W=function(L,M,A){return M.children.map(V=>{for(const W of A.children)if(L.shouldReuseRoute(V.value,W.value.snapshot))return Go(L,V,W);return Go(L,V)})}(L,M,A);return new Ei(V,W)}{if(L.shouldAttach(M.value)){const oe=L.retrieve(M.value);if(null!==oe){const we=oe.route;return Do(M,we),we}}const V=function(L){return new mi(new Qe(L.url),new Qe(L.params),new Qe(L.queryParams),new Qe(L.fragment),new Qe(L.data),L.outlet,L.component,L)}(M.value),W=M.children.map(oe=>Go(L,oe));return new Ei(V,W)}}function Do(L,M){if(L.value.routeConfig!==M.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(L.children.length!==M.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");M.value._futureSnapshot=L.value;for(let A=0;A<L.children.length;++A)Do(L.children[A],M.children[A])}function Ao(L){return"object"==typeof L&&null!=L&&!L.outlets&&!L.segmentPath}function po(L){return"object"==typeof L&&null!=L&&L.outlets}function mn(L,M,A,V,W){let oe={};return V&&Gt(V,(we,Le)=>{oe[Le]=Array.isArray(we)?we.map(ft=>`${ft}`):`${we}`}),new sr(A.root===L?M:Pi(A.root,L,M),oe,W)}function Pi(L,M,A){const V={};return Gt(L.children,(W,oe)=>{V[oe]=W===M?A:Pi(W,M,A)}),new un(L.segments,V)}class ka{constructor(M,A,V){if(this.isAbsolute=M,this.numberOfDoubleDots=A,this.commands=V,M&&V.length>0&&Ao(V[0]))throw new Error("Root segment cannot have matrix parameters");const W=V.find(po);if(W&&W!==mt(V))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Ar{constructor(M,A,V){this.segmentGroup=M,this.processChildren=A,this.index=V}}function an(L,M,A){if(L||(L=new un([],{})),0===L.segments.length&&L.hasChildren())return Hi(L,M,A);const V=function(L,M,A){let V=0,W=M;const oe={match:!1,pathIndex:0,commandIndex:0};for(;W<L.segments.length;){if(V>=A.length)return oe;const we=L.segments[W],Le=A[V];if(po(Le))break;const ft=`${Le}`,en=V<A.length-1?A[V+1]:null;if(W>0&&void 0===ft)break;if(ft&&en&&"object"==typeof en&&void 0===en.outlets){if(!H(ft,en,we))return oe;V+=2}else{if(!H(ft,{},we))return oe;V++}W++}return{match:!0,pathIndex:W,commandIndex:V}}(L,M,A),W=A.slice(V.commandIndex);if(V.match&&V.pathIndex<L.segments.length){const oe=new un(L.segments.slice(0,V.pathIndex),{});return oe.children[Z]=new un(L.segments.slice(V.pathIndex),L.children),Hi(oe,0,W)}return V.match&&0===W.length?new un(L.segments,{}):V.match&&!L.hasChildren()?mo(L,M,A):V.match?Hi(L,0,W):mo(L,M,A)}function Hi(L,M,A){if(0===A.length)return new un(L.segments,{});{const V=function(L){return po(L[0])?L[0].outlets:{[Z]:L}}(A),W={};return Gt(V,(oe,we)=>{"string"==typeof oe&&(oe=[oe]),null!==oe&&(W[we]=an(L.children[we],M,oe))}),Gt(L.children,(oe,we)=>{void 0===V[we]&&(W[we]=oe)}),new un(L.segments,W)}}function mo(L,M,A){const V=L.segments.slice(0,M);let W=0;for(;W<A.length;){const oe=A[W];if(po(oe)){const ft=Hs(oe.outlets);return new un(V,ft)}if(0===W&&Ao(A[0])){V.push(new oi(L.segments[M].path,Ti(A[0]))),W++;continue}const we=po(oe)?oe.outlets[Z]:`${oe}`,Le=W<A.length-1?A[W+1]:null;we&&Le&&Ao(Le)?(V.push(new oi(we,Ti(Le))),W+=2):(V.push(new oi(we,{})),W++)}return new un(V,{})}function Hs(L){const M={};return Gt(L,(A,V)=>{"string"==typeof A&&(A=[A]),null!==A&&(M[V]=mo(new un([],{}),0,A))}),M}function Ti(L){const M={};return Gt(L,(A,V)=>M[V]=`${A}`),M}function H(L,M,A){return L==A.path&&Ze(M,A.parameters)}class G{constructor(M,A,V,W){this.routeReuseStrategy=M,this.futureState=A,this.currState=V,this.forwardEvent=W}activate(M){const A=this.futureState._root,V=this.currState?this.currState._root:null;this.deactivateChildRoutes(A,V,M),Dr(this.futureState.root),this.activateChildRoutes(A,V,M)}deactivateChildRoutes(M,A,V){const W=Si(A);M.children.forEach(oe=>{const we=oe.value.outlet;this.deactivateRoutes(oe,W[we],V),delete W[we]}),Gt(W,(oe,we)=>{this.deactivateRouteAndItsChildren(oe,V)})}deactivateRoutes(M,A,V){const W=M.value,oe=A?A.value:null;if(W===oe)if(W.component){const we=V.getContext(W.outlet);we&&this.deactivateChildRoutes(M,A,we.children)}else this.deactivateChildRoutes(M,A,V);else oe&&this.deactivateRouteAndItsChildren(A,V)}deactivateRouteAndItsChildren(M,A){this.routeReuseStrategy.shouldDetach(M.value.snapshot)?this.detachAndStoreRouteSubtree(M,A):this.deactivateRouteAndOutlet(M,A)}detachAndStoreRouteSubtree(M,A){const V=A.getContext(M.value.outlet);if(V&&V.outlet){const W=V.outlet.detach(),oe=V.children.onOutletDeactivated();this.routeReuseStrategy.store(M.value.snapshot,{componentRef:W,route:M,contexts:oe})}}deactivateRouteAndOutlet(M,A){const V=A.getContext(M.value.outlet),W=V&&M.value.component?V.children:A,oe=Si(M);for(const we of Object.keys(oe))this.deactivateRouteAndItsChildren(oe[we],W);V&&V.outlet&&(V.outlet.deactivate(),V.children.onOutletDeactivated(),V.attachRef=null,V.resolver=null,V.route=null)}activateChildRoutes(M,A,V){const W=Si(A);M.children.forEach(oe=>{this.activateRoutes(oe,W[oe.value.outlet],V),this.forwardEvent(new zn(oe.value.snapshot))}),M.children.length&&this.forwardEvent(new jo(M.value.snapshot))}activateRoutes(M,A,V){const W=M.value,oe=A?A.value:null;if(Dr(W),W===oe)if(W.component){const we=V.getOrCreateContext(W.outlet);this.activateChildRoutes(M,A,we.children)}else this.activateChildRoutes(M,A,V);else if(W.component){const we=V.getOrCreateContext(W.outlet);if(this.routeReuseStrategy.shouldAttach(W.snapshot)){const Le=this.routeReuseStrategy.retrieve(W.snapshot);this.routeReuseStrategy.store(W.snapshot,null),we.children.onOutletReAttached(Le.contexts),we.attachRef=Le.componentRef,we.route=Le.route.value,we.outlet&&we.outlet.attach(Le.componentRef,Le.route.value),S(Le.route)}else{const Le=function(L){for(let M=L.parent;M;M=M.parent){const A=M.routeConfig;if(A&&A._loadedConfig)return A._loadedConfig;if(A&&A.component)return null}return null}(W.snapshot),ft=Le?Le.module.componentFactoryResolver:null;we.attachRef=null,we.route=W,we.resolver=ft,we.outlet&&we.outlet.activateWith(W,ft),this.activateChildRoutes(M,null,we.children)}}else this.activateChildRoutes(M,null,V)}}function S(L){Dr(L.value),L.children.forEach(S)}class I{constructor(M,A){this.routes=M,this.module=A}}function K(L){return"function"==typeof L}function yt(L){return L instanceof sr}const Vr=Symbol("INITIAL_VALUE");function Ri(){return(0,At.w)(L=>function(...L){let M,A;return(0,nt.K)(L[L.length-1])&&(A=L.pop()),"function"==typeof L[L.length-1]&&(M=L.pop()),1===L.length&&(0,ze.k)(L[0])&&(L=L[0]),(0,_t.n)(L,A).lift(new qt(M))}(L.map(M=>M.pipe((0,Ci.q)(1),function(...L){const M=L[L.length-1];return(0,nt.K)(M)?(L.pop(),A=>(0,Kr.z)(L,A,M)):A=>(0,Kr.z)(L,A)}(Vr)))).pipe(Mr((M,A)=>{let V=!1;return A.reduce((W,oe,we)=>W!==Vr?W:(oe===Vr&&(V=!0),V||!1!==oe&&we!==A.length-1&&!yt(oe)?W:oe),M)},Vr),(0,Ki.h)(M=>M!==Vr),(0,Fe.U)(M=>yt(M)?M:!0===M),(0,Ci.q)(1)))}let So=(()=>{class L{}return L.\u0275fac=function(A){return new(A||L)},L.\u0275cmp=y.Xpm({type:L,selectors:[["ng-component"]],decls:1,vars:0,template:function(A,V){1&A&&y._UZ(0,"router-outlet")},directives:function(){return[Ls]},encapsulation:2}),L})();function _i(L,M=""){for(let A=0;A<L.length;A++){const V=L[A];qs(V,ds(M,V))}}function qs(L,M){L.children&&_i(L.children,M)}function ds(L,M){return M?L||M.path?L&&!M.path?`${L}/`:!L&&M.path?M.path:`${L}/${M.path}`:"":L}function ts(L){const M=L.children&&L.children.map(ts),A=M?Object.assign(Object.assign({},L),{children:M}):Object.assign({},L);return!A.component&&(M||A.loadChildren)&&A.outlet&&A.outlet!==Z&&(A.component=So),A}function xr(L){return L.outlet||Z}function ps(L,M){const A=L.filter(V=>xr(V)===M);return A.push(...L.filter(V=>xr(V)!==M)),A}const Ws={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function Ys(L,M,A){var V;if(""===M.path)return"full"===M.pathMatch&&(L.hasChildren()||A.length>0)?Object.assign({},Ws):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const oe=(M.matcher||je)(A,L,M);if(!oe)return Object.assign({},Ws);const we={};Gt(oe.posParams,(ft,en)=>{we[en]=ft.path});const Le=oe.consumed.length>0?Object.assign(Object.assign({},we),oe.consumed[oe.consumed.length-1].parameters):we;return{matched:!0,consumedSegments:oe.consumed,lastChild:oe.consumed.length,parameters:Le,positionalParamSegments:null!==(V=oe.posParams)&&void 0!==V?V:{}}}function No(L,M,A,V,W="corrected"){if(A.length>0&&function(L,M,A){return A.some(V=>fr(L,M,V)&&xr(V)!==Z)}(L,A,V)){const we=new un(M,function(L,M,A,V){const W={};W[Z]=V,V._sourceSegment=L,V._segmentIndexShift=M.length;for(const oe of A)if(""===oe.path&&xr(oe)!==Z){const we=new un([],{});we._sourceSegment=L,we._segmentIndexShift=M.length,W[xr(oe)]=we}return W}(L,M,V,new un(A,L.children)));return we._sourceSegment=L,we._segmentIndexShift=M.length,{segmentGroup:we,slicedSegments:[]}}if(0===A.length&&function(L,M,A){return A.some(V=>fr(L,M,V))}(L,A,V)){const we=new un(L.segments,function(L,M,A,V,W,oe){const we={};for(const Le of V)if(fr(L,A,Le)&&!W[xr(Le)]){const ft=new un([],{});ft._sourceSegment=L,ft._segmentIndexShift="legacy"===oe?L.segments.length:M.length,we[xr(Le)]=ft}return Object.assign(Object.assign({},W),we)}(L,M,A,V,L.children,W));return we._sourceSegment=L,we._segmentIndexShift=M.length,{segmentGroup:we,slicedSegments:A}}const oe=new un(L.segments,L.children);return oe._sourceSegment=L,oe._segmentIndexShift=M.length,{segmentGroup:oe,slicedSegments:A}}function fr(L,M,A){return(!(L.hasChildren()||M.length>0)||"full"!==A.pathMatch)&&""===A.path}function Fa(L,M,A,V){return!!(xr(L)===V||V!==Z&&fr(M,A,L))&&("**"===L.path||Ys(M,L,A).matched)}function Il(L,M,A){return 0===M.length&&!L.children[A]}class fs{constructor(M){this.segmentGroup=M||null}}class Pl{constructor(M){this.urlTree=M}}function ca(L){return new Xe.y(M=>M.error(new fs(L)))}function Mt(L){return new Xe.y(M=>M.error(new Pl(L)))}function br(L){return new Xe.y(M=>M.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${L}'`)))}class La{constructor(M,A,V,W,oe){this.configLoader=A,this.urlSerializer=V,this.urlTree=W,this.config=oe,this.allowRedirects=!0,this.ngModule=M.get(y.h0i)}apply(){const M=No(this.urlTree.root,[],[],this.config).segmentGroup,A=new un(M.segments,M.children);return this.expandSegmentGroup(this.ngModule,this.config,A,Z).pipe((0,Fe.U)(oe=>this.createUrlTree(go(oe),this.urlTree.queryParams,this.urlTree.fragment))).pipe($t(oe=>{if(oe instanceof Pl)return this.allowRedirects=!1,this.match(oe.urlTree);throw oe instanceof fs?this.noMatchError(oe):oe}))}match(M){return this.expandSegmentGroup(this.ngModule,this.config,M.root,Z).pipe((0,Fe.U)(W=>this.createUrlTree(go(W),M.queryParams,M.fragment))).pipe($t(W=>{throw W instanceof fs?this.noMatchError(W):W}))}noMatchError(M){return new Error(`Cannot match any routes. URL Segment: '${M.segmentGroup}'`)}createUrlTree(M,A,V){const W=M.segments.length>0?new un([],{[Z]:M}):M;return new sr(W,A,V)}expandSegmentGroup(M,A,V,W){return 0===V.segments.length&&V.hasChildren()?this.expandChildren(M,A,V).pipe((0,Fe.U)(oe=>new un([],oe))):this.expandSegment(M,V,A,V.segments,W,!0)}expandChildren(M,A,V){const W=[];for(const oe of Object.keys(V.children))"primary"===oe?W.unshift(oe):W.push(oe);return(0,vr.D)(W).pipe((0,Je.b)(oe=>{const we=V.children[oe],Le=ps(A,oe);return this.expandSegmentGroup(M,Le,we,oe).pipe((0,Fe.U)(ft=>({segment:ft,outlet:oe})))}),Mr((oe,we)=>(oe[we.outlet]=we.segment,oe),{}),function(L,M){const A=arguments.length>=2;return V=>V.pipe(L?(0,Ki.h)((W,oe)=>L(W,oe,V)):An.y,co(1),A?Jr(M):bo(()=>new jt))}())}expandSegment(M,A,V,W,oe,we){return(0,vr.D)(V).pipe((0,Je.b)(Le=>this.expandSegmentAgainstRoute(M,A,V,Le,W,oe,we).pipe($t(en=>{if(en instanceof fs)return(0,hn.of)(null);throw en}))),hr(Le=>!!Le),$t((Le,ft)=>{if(Le instanceof jt||"EmptyError"===Le.name){if(Il(A,W,oe))return(0,hn.of)(new un([],{}));throw new fs(A)}throw Le}))}expandSegmentAgainstRoute(M,A,V,W,oe,we,Le){return Fa(W,A,oe,we)?void 0===W.redirectTo?this.matchSegmentAgainstRoute(M,A,W,oe,we):Le&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(M,A,V,W,oe,we):ca(A):ca(A)}expandSegmentAgainstRouteUsingRedirect(M,A,V,W,oe,we){return"**"===W.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(M,V,W,we):this.expandRegularSegmentAgainstRouteUsingRedirect(M,A,V,W,oe,we)}expandWildCardWithParamsAgainstRouteUsingRedirect(M,A,V,W){const oe=this.applyRedirectCommands([],V.redirectTo,{});return V.redirectTo.startsWith("/")?Mt(oe):this.lineralizeSegments(V,oe).pipe((0,Zt.zg)(we=>{const Le=new un(we,{});return this.expandSegment(M,Le,A,we,W,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(M,A,V,W,oe,we){const{matched:Le,consumedSegments:ft,lastChild:en,positionalParamSegments:Rr}=Ys(A,W,oe);if(!Le)return ca(A);const wn=this.applyRedirectCommands(ft,W.redirectTo,Rr);return W.redirectTo.startsWith("/")?Mt(wn):this.lineralizeSegments(W,wn).pipe((0,Zt.zg)(rr=>this.expandSegment(M,A,V,rr.concat(oe.slice(en)),we,!1)))}matchSegmentAgainstRoute(M,A,V,W,oe){if("**"===V.path)return V.loadChildren?(V._loadedConfig?(0,hn.of)(V._loadedConfig):this.configLoader.load(M.injector,V)).pipe((0,Fe.U)(rr=>(V._loadedConfig=rr,new un(W,{})))):(0,hn.of)(new un(W,{}));const{matched:we,consumedSegments:Le,lastChild:ft}=Ys(A,V,W);if(!we)return ca(A);const en=W.slice(ft);return this.getChildConfig(M,V,W).pipe((0,Zt.zg)(wn=>{const rr=wn.module,gr=wn.routes,{segmentGroup:gs,slicedSegments:kr}=No(A,Le,en,gr),Ht=new un(gs.segments,gs.children);if(0===kr.length&&Ht.hasChildren())return this.expandChildren(rr,gr,Ht).pipe((0,Fe.U)(fa=>new un(Le,fa)));if(0===gr.length&&0===kr.length)return(0,hn.of)(new un(Le,{}));const Ns=xr(V)===oe;return this.expandSegment(rr,Ht,gr,kr,Ns?Z:oe,!0).pipe((0,Fe.U)(zs=>new un(Le.concat(zs.segments),zs.children)))}))}getChildConfig(M,A,V){return A.children?(0,hn.of)(new I(A.children,M)):A.loadChildren?void 0!==A._loadedConfig?(0,hn.of)(A._loadedConfig):this.runCanLoadGuards(M.injector,A,V).pipe((0,Zt.zg)(W=>{return W?this.configLoader.load(M.injector,A).pipe((0,Fe.U)(oe=>(A._loadedConfig=oe,oe))):(L=A,new Xe.y(M=>M.error(Ie(`Cannot load children because the guard of the route "path: '${L.path}'" returned false`))));var L})):(0,hn.of)(new I([],M))}runCanLoadGuards(M,A,V){const W=A.canLoad;if(!W||0===W.length)return(0,hn.of)(!0);const oe=W.map(we=>{const Le=M.get(we);let ft;if((L=Le)&&K(L.canLoad))ft=Le.canLoad(A,V);else{if(!K(Le))throw new Error("Invalid CanLoad guard");ft=Le(A,V)}var L;return Yt(ft)});return(0,hn.of)(oe).pipe(Ri(),pn(we=>{if(!yt(we))return;const Le=Ie(`Redirecting to "${this.urlSerializer.serialize(we)}"`);throw Le.url=we,Le}),(0,Fe.U)(we=>!0===we))}lineralizeSegments(M,A){let V=[],W=A.root;for(;;){if(V=V.concat(W.segments),0===W.numberOfChildren)return(0,hn.of)(V);if(W.numberOfChildren>1||!W.children[Z])return br(M.redirectTo);W=W.children[Z]}}applyRedirectCommands(M,A,V){return this.applyRedirectCreatreUrlTree(A,this.urlSerializer.parse(A),M,V)}applyRedirectCreatreUrlTree(M,A,V,W){const oe=this.createSegmentGroup(M,A.root,V,W);return new sr(oe,this.createQueryParams(A.queryParams,this.urlTree.queryParams),A.fragment)}createQueryParams(M,A){const V={};return Gt(M,(W,oe)=>{if("string"==typeof W&&W.startsWith(":")){const Le=W.substring(1);V[oe]=A[Le]}else V[oe]=W}),V}createSegmentGroup(M,A,V,W){const oe=this.createSegments(M,A.segments,V,W);let we={};return Gt(A.children,(Le,ft)=>{we[ft]=this.createSegmentGroup(M,Le,V,W)}),new un(oe,we)}createSegments(M,A,V,W){return A.map(oe=>oe.path.startsWith(":")?this.findPosParam(M,oe,W):this.findOrReturn(oe,V))}findPosParam(M,A,V){const W=V[A.path.substring(1)];if(!W)throw new Error(`Cannot redirect to '${M}'. Cannot find '${A.path}'.`);return W}findOrReturn(M,A){let V=0;for(const W of A){if(W.path===M.path)return A.splice(V),W;V++}return M}}function go(L){const M={};for(const V of Object.keys(L.children)){const oe=go(L.children[V]);(oe.segments.length>0||oe.hasChildren())&&(M[V]=oe)}return function(L){if(1===L.numberOfChildren&&L.children[Z]){const M=L.children[Z];return new un(L.segments.concat(M.segments),M.children)}return L}(new un(L.segments,M))}class Na{constructor(M){this.path=M,this.route=this.path[this.path.length-1]}}class Rl{constructor(M,A){this.component=M,this.route=A}}function za(L,M,A){const V=L._root;return te(V,M?M._root:null,A,[V.value])}function Js(L,M,A){const V=function(L){if(!L)return null;for(let M=L.parent;M;M=M.parent){const A=M.routeConfig;if(A&&A._loadedConfig)return A._loadedConfig}return null}(M);return(V?V.module.injector:A).get(L)}function te(L,M,A,V,W={canDeactivateChecks:[],canActivateChecks:[]}){const oe=Si(M);return L.children.forEach(we=>{(function(L,M,A,V,W={canDeactivateChecks:[],canActivateChecks:[]}){const oe=L.value,we=M?M.value:null,Le=A?A.getContext(L.value.outlet):null;if(we&&oe.routeConfig===we.routeConfig){const ft=function(L,M,A){if("function"==typeof A)return A(L,M);switch(A){case"pathParamsChange":return!si(L.url,M.url);case"pathParamsOrQueryParamsChange":return!si(L.url,M.url)||!Ze(L.queryParams,M.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Gs(L,M)||!Ze(L.queryParams,M.queryParams);case"paramsChange":default:return!Gs(L,M)}}(we,oe,oe.routeConfig.runGuardsAndResolvers);ft?W.canActivateChecks.push(new Na(V)):(oe.data=we.data,oe._resolvedData=we._resolvedData),te(L,M,oe.component?Le?Le.children:null:A,V,W),ft&&Le&&Le.outlet&&Le.outlet.isActivated&&W.canDeactivateChecks.push(new Rl(Le.outlet.component,we))}else we&&Te(M,Le,W),W.canActivateChecks.push(new Na(V)),te(L,null,oe.component?Le?Le.children:null:A,V,W)})(we,oe[we.value.outlet],A,V.concat([we.value]),W),delete oe[we.value.outlet]}),Gt(oe,(we,Le)=>Te(we,A.getContext(Le),W)),W}function Te(L,M,A){const V=Si(L),W=L.value;Gt(V,(oe,we)=>{Te(oe,W.component?M?M.children.getContext(we):null:M,A)}),A.canDeactivateChecks.push(new Rl(W.component&&M&&M.outlet&&M.outlet.isActivated?M.outlet.component:null,W))}class hu{}function kl(L){return new Xe.y(M=>M.error(L))}class Pc{constructor(M,A,V,W,oe,we){this.rootComponentType=M,this.config=A,this.urlTree=V,this.url=W,this.paramsInheritanceStrategy=oe,this.relativeLinkResolution=we}recognize(){const M=No(this.urlTree.root,[],[],this.config.filter(we=>void 0===we.redirectTo),this.relativeLinkResolution).segmentGroup,A=this.processSegmentGroup(this.config,M,Z);if(null===A)return null;const V=new Zo([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Z,this.rootComponentType,null,this.urlTree.root,-1,{}),W=new Ei(V,A),oe=new es(this.url,W);return this.inheritParamsAndData(oe._root),oe}inheritParamsAndData(M){const A=M.value,V=ho(A,this.paramsInheritanceStrategy);A.params=Object.freeze(V.params),A.data=Object.freeze(V.data),M.children.forEach(W=>this.inheritParamsAndData(W))}processSegmentGroup(M,A,V){return 0===A.segments.length&&A.hasChildren()?this.processChildren(M,A):this.processSegment(M,A,A.segments,V)}processChildren(M,A){const V=[];for(const oe of Object.keys(A.children)){const we=A.children[oe],Le=ps(M,oe),ft=this.processSegmentGroup(Le,we,oe);if(null===ft)return null;V.push(...ft)}const W=Ea(V);return W.sort((M,A)=>M.value.outlet===Z?-1:A.value.outlet===Z?1:M.value.outlet.localeCompare(A.value.outlet)),W}processSegment(M,A,V,W){for(const oe of M){const we=this.processSegmentAgainstRoute(oe,A,V,W);if(null!==we)return we}return Il(A,V,W)?[]:null}processSegmentAgainstRoute(M,A,V,W){if(M.redirectTo||!Fa(M,A,V,W))return null;let oe,we=[],Le=[];if("**"===M.path){const gr=V.length>0?mt(V).parameters:{};oe=new Zo(V,gr,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,ms(M),xr(M),M.component,M,ec(A),_o(A)+V.length,Hr(M))}else{const gr=Ys(A,M,V);if(!gr.matched)return null;we=gr.consumedSegments,Le=V.slice(gr.lastChild),oe=new Zo(we,gr.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,ms(M),xr(M),M.component,M,ec(A),_o(A)+we.length,Hr(M))}const ft=(L=M).children?L.children:L.loadChildren?L._loadedConfig.routes:[],{segmentGroup:en,slicedSegments:Rr}=No(A,we,Le,ft.filter(gr=>void 0===gr.redirectTo),this.relativeLinkResolution);var L;if(0===Rr.length&&en.hasChildren()){const gr=this.processChildren(ft,en);return null===gr?null:[new Ei(oe,gr)]}if(0===ft.length&&0===Rr.length)return[new Ei(oe,[])];const wn=xr(M)===W,rr=this.processSegment(ft,en,Rr,wn?Z:W);return null===rr?null:[new Ei(oe,rr)]}}function Ol(L){const M=L.value.routeConfig;return M&&""===M.path&&void 0===M.redirectTo}function Ea(L){const M=[],A=new Set;for(const V of L){if(!Ol(V)){M.push(V);continue}const W=M.find(oe=>V.value.routeConfig===oe.value.routeConfig);void 0!==W?(W.children.push(...V.children),A.add(W)):M.push(V)}for(const V of A){const W=Ea(V.children);M.push(new Ei(V.value,W))}return M.filter(V=>!A.has(V))}function ec(L){let M=L;for(;M._sourceSegment;)M=M._sourceSegment;return M}function _o(L){let M=L,A=M._segmentIndexShift?M._segmentIndexShift:0;for(;M._sourceSegment;)M=M._sourceSegment,A+=M._segmentIndexShift?M._segmentIndexShift:0;return A-1}function ms(L){return L.data||{}}function Hr(L){return L.resolve||{}}function wr(L){return(0,At.w)(M=>{const A=L(M);return A?(0,vr.D)(A).pipe((0,Fe.U)(()=>M)):(0,hn.of)(M)})}class Ta extends class{shouldDetach(M){return!1}store(M,A){}shouldAttach(M){return!1}retrieve(M){return null}shouldReuseRoute(M,A){return M.routeConfig===A.routeConfig}}{}const zi=new y.OlP("ROUTES");class ol{constructor(M,A,V,W){this.loader=M,this.compiler=A,this.onLoadStartListener=V,this.onLoadEndListener=W}load(M,A){if(A._loader$)return A._loader$;this.onLoadStartListener&&this.onLoadStartListener(A);const W=this.loadModuleFactory(A.loadChildren).pipe((0,Fe.U)(oe=>{this.onLoadEndListener&&this.onLoadEndListener(A);const we=oe.create(M);return new I(ot(we.injector.get(zi,void 0,y.XFs.Self|y.XFs.Optional)).map(ts),we)}),$t(oe=>{throw A._loader$=void 0,oe}));return A._loader$=new Jt.c(W,()=>new Rt.xQ).pipe((0,Wt.x)()),A._loader$}loadModuleFactory(M){return"string"==typeof M?(0,vr.D)(this.loader.load(M)):Yt(M()).pipe((0,Zt.zg)(A=>A instanceof y.YKP?(0,hn.of)(A):(0,vr.D)(this.compiler.compileModuleAsync(A))))}}class zu{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new ns,this.attachRef=null}}class ns{constructor(){this.contexts=new Map}onChildOutletCreated(M,A){const V=this.getOrCreateContext(M);V.outlet=A,this.contexts.set(M,V)}onChildOutletDestroyed(M){const A=this.getContext(M);A&&(A.outlet=null,A.attachRef=null)}onOutletDeactivated(){const M=this.contexts;return this.contexts=new Map,M}onOutletReAttached(M){this.contexts=M}getOrCreateContext(M){let A=this.getContext(M);return A||(A=new zu,this.contexts.set(M,A)),A}getContext(M){return this.contexts.get(M)||null}}class Oc{shouldProcessUrl(M){return!0}extract(M){return M}merge(M,A){return M}}function sl(L){throw L}function ha(L,M,A){return M.parse("/")}function Da(L,M){return(0,hn.of)(null)}const Fc={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},fu={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ro=(()=>{class L{constructor(A,V,W,oe,we,Le,ft,en){this.rootComponentType=A,this.urlSerializer=V,this.rootContexts=W,this.location=oe,this.config=en,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Rt.xQ,this.errorHandler=sl,this.malformedUriErrorHandler=ha,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Da,afterPreactivation:Da},this.urlHandlingStrategy=new Oc,this.routeReuseStrategy=new Ta,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=we.get(y.h0i),this.console=we.get(y.c2e);const rr=we.get(y.R0b);this.isNgZoneEnabled=rr instanceof y.R0b&&y.R0b.isInAngularZone(),this.resetConfig(en),this.currentUrlTree=new sr(new un([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new ol(Le,ft,gr=>this.triggerEvent(new di(gr)),gr=>this.triggerEvent(new Qn(gr))),this.routerState=Bn(this.currentUrlTree,this.rootComponentType),this.transitions=new Qe({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var A;return null===(A=this.location.getState())||void 0===A?void 0:A.\u0275routerPageId}setupNavigations(A){const V=this.events;return A.pipe((0,Ki.h)(W=>0!==W.id),(0,Fe.U)(W=>Object.assign(Object.assign({},W),{extractedUrl:this.urlHandlingStrategy.extract(W.rawUrl)})),(0,At.w)(W=>{let oe=!1,we=!1;return(0,hn.of)(W).pipe(pn(Le=>{this.currentNavigation={id:Le.id,initialUrl:Le.currentRawUrl,extractedUrl:Le.extractedUrl,trigger:Le.source,extras:Le.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),(0,At.w)(Le=>{const ft=this.browserUrlTree.toString(),en=!this.navigated||Le.extractedUrl.toString()!==ft||ft!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||en)&&this.urlHandlingStrategy.shouldProcessUrl(Le.rawUrl))return yo(Le.source)&&(this.browserUrlTree=Le.extractedUrl),(0,hn.of)(Le).pipe((0,At.w)(wn=>{const rr=this.transitions.getValue();return V.next(new Sr(wn.id,this.serializeUrl(wn.extractedUrl),wn.source,wn.restoredState)),rr!==this.transitions.getValue()?li.E:Promise.resolve(wn)}),function(L,M,A,V){return(0,At.w)(W=>function(L,M,A,V,W){return new La(L,M,A,V,W).apply()}(L,M,A,W.extractedUrl,V).pipe((0,Fe.U)(oe=>Object.assign(Object.assign({},W),{urlAfterRedirects:oe}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),pn(wn=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:wn.urlAfterRedirects})}),function(L,M,A,V,W){return(0,Zt.zg)(oe=>function(L,M,A,V,W="emptyOnly",oe="legacy"){try{const we=new Pc(L,M,A,V,W,oe).recognize();return null===we?kl(new hu):(0,hn.of)(we)}catch(we){return kl(we)}}(L,M,oe.urlAfterRedirects,A(oe.urlAfterRedirects),V,W).pipe((0,Fe.U)(we=>Object.assign(Object.assign({},oe),{targetSnapshot:we}))))}(this.rootComponentType,this.config,wn=>this.serializeUrl(wn),this.paramsInheritanceStrategy,this.relativeLinkResolution),pn(wn=>{"eager"===this.urlUpdateStrategy&&(wn.extras.skipLocationChange||this.setBrowserUrl(wn.urlAfterRedirects,wn),this.browserUrlTree=wn.urlAfterRedirects);const rr=new On(wn.id,this.serializeUrl(wn.extractedUrl),this.serializeUrl(wn.urlAfterRedirects),wn.targetSnapshot);V.next(rr)}));if(en&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:rr,extractedUrl:gr,source:gs,restoredState:kr,extras:Ht}=Le,Ns=new Sr(rr,this.serializeUrl(gr),gs,kr);V.next(Ns);const pa=Bn(gr,this.rootComponentType).snapshot;return(0,hn.of)(Object.assign(Object.assign({},Le),{targetSnapshot:pa,urlAfterRedirects:gr,extras:Object.assign(Object.assign({},Ht),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=Le.rawUrl,this.browserUrlTree=Le.urlAfterRedirects,Le.resolve(null),li.E}),wr(Le=>{const{targetSnapshot:ft,id:en,extractedUrl:Rr,rawUrl:wn,extras:{skipLocationChange:rr,replaceUrl:gr}}=Le;return this.hooks.beforePreactivation(ft,{navigationId:en,appliedUrlTree:Rr,rawUrlTree:wn,skipLocationChange:!!rr,replaceUrl:!!gr})}),pn(Le=>{const ft=new rn(Le.id,this.serializeUrl(Le.extractedUrl),this.serializeUrl(Le.urlAfterRedirects),Le.targetSnapshot);this.triggerEvent(ft)}),(0,Fe.U)(Le=>Object.assign(Object.assign({},Le),{guards:za(Le.targetSnapshot,Le.currentSnapshot,this.rootContexts)})),function(L,M){return(0,Zt.zg)(A=>{const{targetSnapshot:V,currentSnapshot:W,guards:{canActivateChecks:oe,canDeactivateChecks:we}}=A;return 0===we.length&&0===oe.length?(0,hn.of)(Object.assign(Object.assign({},A),{guardsResult:!0})):function(L,M,A,V){return(0,vr.D)(L).pipe((0,Zt.zg)(W=>function(L,M,A,V,W){const oe=M&&M.routeConfig?M.routeConfig.canDeactivate:null;if(!oe||0===oe.length)return(0,hn.of)(!0);const we=oe.map(Le=>{const ft=Js(Le,M,W);let en;if(function(L){return L&&K(L.canDeactivate)}(ft))en=Yt(ft.canDeactivate(L,M,A,V));else{if(!K(ft))throw new Error("Invalid CanDeactivate guard");en=Yt(ft(L,M,A,V))}return en.pipe(hr())});return(0,hn.of)(we).pipe(Ri())}(W.component,W.route,A,M,V)),hr(W=>!0!==W,!0))}(we,V,W,L).pipe((0,Zt.zg)(Le=>Le&&function(L){return"boolean"==typeof L}(Le)?function(L,M,A,V){return(0,vr.D)(M).pipe((0,Je.b)(W=>(0,Kr.z)(function(L,M){return null!==L&&M&&M(new Qi(L)),(0,hn.of)(!0)}(W.route.parent,V),function(L,M){return null!==L&&M&&M(new Co(L)),(0,hn.of)(!0)}(W.route,V),function(L,M,A){const V=M[M.length-1],oe=M.slice(0,M.length-1).reverse().map(we=>function(L){const M=L.routeConfig?L.routeConfig.canActivateChild:null;return M&&0!==M.length?{node:L,guards:M}:null}(we)).filter(we=>null!==we).map(we=>(0,ao.P)(()=>{const Le=we.guards.map(ft=>{const en=Js(ft,we.node,A);let Rr;if(function(L){return L&&K(L.canActivateChild)}(en))Rr=Yt(en.canActivateChild(V,L));else{if(!K(en))throw new Error("Invalid CanActivateChild guard");Rr=Yt(en(V,L))}return Rr.pipe(hr())});return(0,hn.of)(Le).pipe(Ri())}));return(0,hn.of)(oe).pipe(Ri())}(L,W.path,A),function(L,M,A){const V=M.routeConfig?M.routeConfig.canActivate:null;if(!V||0===V.length)return(0,hn.of)(!0);const W=V.map(oe=>(0,ao.P)(()=>{const we=Js(oe,M,A);let Le;if(function(L){return L&&K(L.canActivate)}(we))Le=Yt(we.canActivate(M,L));else{if(!K(we))throw new Error("Invalid CanActivate guard");Le=Yt(we(M,L))}return Le.pipe(hr())}));return(0,hn.of)(W).pipe(Ri())}(L,W.route,A))),hr(W=>!0!==W,!0))}(V,oe,L,M):(0,hn.of)(Le)),(0,Fe.U)(Le=>Object.assign(Object.assign({},A),{guardsResult:Le})))})}(this.ngModule.injector,Le=>this.triggerEvent(Le)),pn(Le=>{if(yt(Le.guardsResult)){const en=Ie(`Redirecting to "${this.serializeUrl(Le.guardsResult)}"`);throw en.url=Le.guardsResult,en}const ft=new ci(Le.id,this.serializeUrl(Le.extractedUrl),this.serializeUrl(Le.urlAfterRedirects),Le.targetSnapshot,!!Le.guardsResult);this.triggerEvent(ft)}),(0,Ki.h)(Le=>!!Le.guardsResult||(this.restoreHistory(Le),this.cancelNavigationTransition(Le,""),!1)),wr(Le=>{if(Le.guards.canActivateChecks.length)return(0,hn.of)(Le).pipe(pn(ft=>{const en=new Gn(ft.id,this.serializeUrl(ft.extractedUrl),this.serializeUrl(ft.urlAfterRedirects),ft.targetSnapshot);this.triggerEvent(en)}),(0,At.w)(ft=>{let en=!1;return(0,hn.of)(ft).pipe(function(L,M){return(0,Zt.zg)(A=>{const{targetSnapshot:V,guards:{canActivateChecks:W}}=A;if(!W.length)return(0,hn.of)(A);let oe=0;return(0,vr.D)(W).pipe((0,Je.b)(we=>function(L,M,A,V){return function(L,M,A,V){const W=Object.keys(L);if(0===W.length)return(0,hn.of)({});const oe={};return(0,vr.D)(W).pipe((0,Zt.zg)(we=>function(L,M,A,V){const W=Js(L,M,V);return Yt(W.resolve?W.resolve(M,A):W(M,A))}(L[we],M,A,V).pipe(pn(Le=>{oe[we]=Le}))),co(1),(0,Zt.zg)(()=>Object.keys(oe).length===W.length?(0,hn.of)(oe):li.E))}(L._resolve,L,M,V).pipe((0,Fe.U)(oe=>(L._resolvedData=oe,L.data=Object.assign(Object.assign({},L.data),ho(L,A).resolve),null)))}(we.route,V,L,M)),pn(()=>oe++),co(1),(0,Zt.zg)(we=>oe===W.length?(0,hn.of)(A):li.E))})}(this.paramsInheritanceStrategy,this.ngModule.injector),pn({next:()=>en=!0,complete:()=>{en||(this.restoreHistory(ft),this.cancelNavigationTransition(ft,"At least one route resolver didn't emit any value."))}}))}),pn(ft=>{const en=new Qr(ft.id,this.serializeUrl(ft.extractedUrl),this.serializeUrl(ft.urlAfterRedirects),ft.targetSnapshot);this.triggerEvent(en)}))}),wr(Le=>{const{targetSnapshot:ft,id:en,extractedUrl:Rr,rawUrl:wn,extras:{skipLocationChange:rr,replaceUrl:gr}}=Le;return this.hooks.afterPreactivation(ft,{navigationId:en,appliedUrlTree:Rr,rawUrlTree:wn,skipLocationChange:!!rr,replaceUrl:!!gr})}),(0,Fe.U)(Le=>{const ft=function(L,M,A){const V=Go(L,M._root,A?A._root:void 0);return new kt(V,M)}(this.routeReuseStrategy,Le.targetSnapshot,Le.currentRouterState);return Object.assign(Object.assign({},Le),{targetRouterState:ft})}),pn(Le=>{this.currentUrlTree=Le.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(Le.urlAfterRedirects,Le.rawUrl),this.routerState=Le.targetRouterState,"deferred"===this.urlUpdateStrategy&&(Le.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,Le),this.browserUrlTree=Le.urlAfterRedirects)}),((L,M,A)=>(0,Fe.U)(V=>(new G(M,V.targetRouterState,V.currentRouterState,A).activate(L),V)))(this.rootContexts,this.routeReuseStrategy,Le=>this.triggerEvent(Le)),pn({next(){oe=!0},complete(){oe=!0}}),function(L){return M=>M.lift(new st(L))}(()=>{var Le;if(!oe&&!we){const ft=`Navigation ID ${W.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(W),this.cancelNavigationTransition(W,ft)):this.cancelNavigationTransition(W,ft)}(null===(Le=this.currentNavigation)||void 0===Le?void 0:Le.id)===W.id&&(this.currentNavigation=null)}),$t(Le=>{if(we=!0,function(L){return L&&L[ve]}(Le)){const ft=yt(Le.url);ft||(this.navigated=!0,this.restoreHistory(W,!0));const en=new Nr(W.id,this.serializeUrl(W.extractedUrl),Le.message);V.next(en),ft?setTimeout(()=>{const Rr=this.urlHandlingStrategy.merge(Le.url,this.rawUrlTree),wn={skipLocationChange:W.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||yo(W.source)};this.scheduleNavigation(Rr,"imperative",null,wn,{resolve:W.resolve,reject:W.reject,promise:W.promise})},0):W.resolve(!1)}else{this.restoreHistory(W,!0);const ft=new kn(W.id,this.serializeUrl(W.extractedUrl),Le);V.next(ft);try{W.resolve(this.errorHandler(Le))}catch(en){W.reject(en)}}return li.E}))}))}resetRootComponentType(A){this.rootComponentType=A,this.routerState.root.component=this.rootComponentType}getTransition(){const A=this.transitions.value;return A.urlAfterRedirects=this.browserUrlTree,A}setTransition(A){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),A))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(A=>{const V=this.extractLocationChangeInfoFromEvent(A);this.shouldScheduleNavigation(this.lastLocationChangeInfo,V)&&setTimeout(()=>{const{source:W,state:oe,urlTree:we}=V,Le={replaceUrl:!0};if(oe){const ft=Object.assign({},oe);delete ft.navigationId,delete ft.\u0275routerPageId,0!==Object.keys(ft).length&&(Le.state=ft)}this.scheduleNavigation(we,W,oe,Le)},0),this.lastLocationChangeInfo=V}))}extractLocationChangeInfoFromEvent(A){var V;return{source:"popstate"===A.type?"popstate":"hashchange",urlTree:this.parseUrl(A.url),state:(null===(V=A.state)||void 0===V?void 0:V.navigationId)?A.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(A,V){if(!A)return!0;const W=V.urlTree.toString()===A.urlTree.toString();return V.transitionId!==A.transitionId||!W||!("hashchange"===V.source&&"popstate"===A.source||"popstate"===V.source&&"hashchange"===A.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(A){this.events.next(A)}resetConfig(A){_i(A),this.config=A.map(ts),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(A,V={}){const{relativeTo:W,queryParams:oe,fragment:we,queryParamsHandling:Le,preserveFragment:ft}=V,en=W||this.routerState.root,Rr=ft?this.currentUrlTree.fragment:we;let wn=null;switch(Le){case"merge":wn=Object.assign(Object.assign({},this.currentUrlTree.queryParams),oe);break;case"preserve":wn=this.currentUrlTree.queryParams;break;default:wn=oe||null}return null!==wn&&(wn=this.removeEmptyProps(wn)),function(L,M,A,V,W){if(0===A.length)return mn(M.root,M.root,M,V,W);const oe=function(L){if("string"==typeof L[0]&&1===L.length&&"/"===L[0])return new ka(!0,0,L);let M=0,A=!1;const V=L.reduce((W,oe,we)=>{if("object"==typeof oe&&null!=oe){if(oe.outlets){const Le={};return Gt(oe.outlets,(ft,en)=>{Le[en]="string"==typeof ft?ft.split("/"):ft}),[...W,{outlets:Le}]}if(oe.segmentPath)return[...W,oe.segmentPath]}return"string"!=typeof oe?[...W,oe]:0===we?(oe.split("/").forEach((Le,ft)=>{0==ft&&"."===Le||(0==ft&&""===Le?A=!0:".."===Le?M++:""!=Le&&W.push(Le))}),W):[...W,oe]},[]);return new ka(A,M,V)}(A);if(oe.toRoot())return mn(M.root,new un([],{}),M,V,W);const we=function(L,M,A){if(L.isAbsolute)return new Ar(M.root,!0,0);if(-1===A.snapshot._lastPathIndex){const oe=A.snapshot._urlSegment;return new Ar(oe,oe===M.root,0)}const V=Ao(L.commands[0])?0:1;return function(L,M,A){let V=L,W=M,oe=A;for(;oe>W;){if(oe-=W,V=V.parent,!V)throw new Error("Invalid number of '../'");W=V.segments.length}return new Ar(V,!1,W-oe)}(A.snapshot._urlSegment,A.snapshot._lastPathIndex+V,L.numberOfDoubleDots)}(oe,M,L),Le=we.processChildren?Hi(we.segmentGroup,we.index,oe.commands):an(we.segmentGroup,we.index,oe.commands);return mn(we.segmentGroup,Le,M,V,W)}(en,this.currentUrlTree,A,wn,null!=Rr?Rr:null)}navigateByUrl(A,V={skipLocationChange:!1}){const W=yt(A)?A:this.parseUrl(A),oe=this.urlHandlingStrategy.merge(W,this.rawUrlTree);return this.scheduleNavigation(oe,"imperative",null,V)}navigate(A,V={skipLocationChange:!1}){return function(L){for(let M=0;M<L.length;M++){const A=L[M];if(null==A)throw new Error(`The requested path contains ${A} segment at index ${M}`)}}(A),this.navigateByUrl(this.createUrlTree(A,V),V)}serializeUrl(A){return this.urlSerializer.serialize(A)}parseUrl(A){let V;try{V=this.urlSerializer.parse(A)}catch(W){V=this.malformedUriErrorHandler(W,this.urlSerializer,A)}return V}isActive(A,V){let W;if(W=!0===V?Object.assign({},Fc):!1===V?Object.assign({},fu):V,yt(A))return Kn(this.currentUrlTree,A,W);const oe=this.parseUrl(A);return Kn(this.currentUrlTree,oe,W)}removeEmptyProps(A){return Object.keys(A).reduce((V,W)=>{const oe=A[W];return null!=oe&&(V[W]=oe),V},{})}processNavigations(){this.navigations.subscribe(A=>{this.navigated=!0,this.lastSuccessfulId=A.id,this.currentPageId=A.targetPageId,this.events.next(new Nn(A.id,this.serializeUrl(A.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,A.resolve(!0)},A=>{this.console.warn(`Unhandled Navigation Error: ${A}`)})}scheduleNavigation(A,V,W,oe,we){var Le,ft;if(this.disposed)return Promise.resolve(!1);const en=this.getTransition(),Rr=yo(V)&&en&&!yo(en.source),gr=(this.lastSuccessfulId===en.id||this.currentNavigation?en.rawUrl:en.urlAfterRedirects).toString()===A.toString();if(Rr&&gr)return Promise.resolve(!0);let gs,kr,Ht;we?(gs=we.resolve,kr=we.reject,Ht=we.promise):Ht=new Promise((zs,fa)=>{gs=zs,kr=fa});const Ns=++this.navigationId;let pa;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(W=this.location.getState()),pa=W&&W.\u0275routerPageId?W.\u0275routerPageId:oe.replaceUrl||oe.skipLocationChange?null!==(Le=this.browserPageId)&&void 0!==Le?Le:0:(null!==(ft=this.browserPageId)&&void 0!==ft?ft:0)+1):pa=0,this.setTransition({id:Ns,targetPageId:pa,source:V,restoredState:W,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:A,extras:oe,resolve:gs,reject:kr,promise:Ht,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Ht.catch(zs=>Promise.reject(zs))}setBrowserUrl(A,V){const W=this.urlSerializer.serialize(A),oe=Object.assign(Object.assign({},V.extras.state),this.generateNgRouterState(V.id,V.targetPageId));this.location.isCurrentPathEqualTo(W)||V.extras.replaceUrl?this.location.replaceState(W,"",oe):this.location.go(W,"",oe)}restoreHistory(A,V=!1){var W,oe;if("computed"===this.canceledNavigationResolution){const we=this.currentPageId-A.targetPageId;"popstate"!==A.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(W=this.currentNavigation)||void 0===W?void 0:W.finalUrl)||0===we?this.currentUrlTree===(null===(oe=this.currentNavigation)||void 0===oe?void 0:oe.finalUrl)&&0===we&&(this.resetState(A),this.browserUrlTree=A.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(we)}else"replace"===this.canceledNavigationResolution&&(V&&this.resetState(A),this.resetUrlToCurrentUrlTree())}resetState(A){this.routerState=A.currentRouterState,this.currentUrlTree=A.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,A.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(A,V){const W=new Nr(A.id,this.serializeUrl(A.extractedUrl),V);this.triggerEvent(W),A.resolve(!1)}generateNgRouterState(A,V){return"computed"===this.canceledNavigationResolution?{navigationId:A,\u0275routerPageId:V}:{navigationId:A}}}return L.\u0275fac=function(A){return new(A||L)(y.LFG(y.DyG),y.LFG(Eo),y.LFG(ns),y.LFG($.Ye),y.LFG(y.zs3),y.LFG(y.v3s),y.LFG(y.Sil),y.LFG(void 0))},L.\u0275prov=y.Yz7({token:L,factory:L.\u0275fac}),L})();function yo(L){return"imperative"!==L}let Ua=(()=>{class L{constructor(A,V,W,oe,we){this.router=A,this.route=V,this.commands=[],this.onChanges=new Rt.xQ,null==W&&oe.setAttribute(we.nativeElement,"tabindex","0")}ngOnChanges(A){this.onChanges.next(this)}set routerLink(A){this.commands=null!=A?Array.isArray(A)?A:[A]:[]}onClick(){const A={skipLocationChange:Es(this.skipLocationChange),replaceUrl:Es(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,A),!0}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Es(this.preserveFragment)})}}return L.\u0275fac=function(A){return new(A||L)(y.Y36(ro),y.Y36(mi),y.$8M("tabindex"),y.Y36(y.Qsj),y.Y36(y.SBq))},L.\u0275dir=y.lG2({type:L,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(A,V){1&A&&y.NdJ("click",function(){return V.onClick()})},inputs:{routerLink:"routerLink",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[y.TTD]}),L})(),ja=(()=>{class L{constructor(A,V,W){this.router=A,this.route=V,this.locationStrategy=W,this.commands=[],this.onChanges=new Rt.xQ,this.subscription=A.events.subscribe(oe=>{oe instanceof Nn&&this.updateTargetUrlAndHref()})}set routerLink(A){this.commands=null!=A?Array.isArray(A)?A:[A]:[]}ngOnChanges(A){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(A,V,W,oe,we){if(0!==A||V||W||oe||we||"string"==typeof this.target&&"_self"!=this.target)return!0;const Le={skipLocationChange:Es(this.skipLocationChange),replaceUrl:Es(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,Le),!1}updateTargetUrlAndHref(){this.href=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree))}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Es(this.preserveFragment)})}}return L.\u0275fac=function(A){return new(A||L)(y.Y36(ro),y.Y36(mi),y.Y36($.S$))},L.\u0275dir=y.lG2({type:L,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(A,V){1&A&&y.NdJ("click",function(oe){return V.onClick(oe.button,oe.ctrlKey,oe.shiftKey,oe.altKey,oe.metaKey)}),2&A&&(y.Ikx("href",V.href,y.LSH),y.uIk("target",V.target))},inputs:{routerLink:"routerLink",target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[y.TTD]}),L})();function Es(L){return""===L||!!L}let Ls=(()=>{class L{constructor(A,V,W,oe,we){this.parentContexts=A,this.location=V,this.resolver=W,this.changeDetector=we,this.activated=null,this._activatedRoute=null,this.activateEvents=new y.vpe,this.deactivateEvents=new y.vpe,this.name=oe||Z,A.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const A=this.parentContexts.getContext(this.name);A&&A.route&&(A.attachRef?this.attach(A.attachRef,A.route):this.activateWith(A.route,A.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const A=this.activated;return this.activated=null,this._activatedRoute=null,A}attach(A,V){this.activated=A,this._activatedRoute=V,this.location.insert(A.hostView)}deactivate(){if(this.activated){const A=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(A)}}activateWith(A,V){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=A;const we=(V=V||this.resolver).resolveComponentFactory(A._futureSnapshot.routeConfig.component),Le=this.parentContexts.getOrCreateContext(this.name).children,ft=new nc(A,Le,this.location.injector);this.activated=this.location.createComponent(we,this.location.length,ft),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return L.\u0275fac=function(A){return new(A||L)(y.Y36(ns),y.Y36(y.s_b),y.Y36(y._Vd),y.$8M("name"),y.Y36(y.sBO))},L.\u0275dir=y.lG2({type:L,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),L})();class nc{constructor(M,A,V){this.route=M,this.childContexts=A,this.parent=V}get(M,A){return M===mi?this.route:M===ns?this.childContexts:this.parent.get(M,A)}}class ta{}class ll{preload(M,A){return(0,hn.of)(null)}}let cl=(()=>{class L{constructor(A,V,W,oe,we){this.router=A,this.injector=oe,this.preloadingStrategy=we,this.loader=new ol(V,W,en=>A.triggerEvent(new di(en)),en=>A.triggerEvent(new Qn(en)))}setUpPreloading(){this.subscription=this.router.events.pipe((0,Ki.h)(A=>A instanceof Nn),(0,Je.b)(()=>this.preload())).subscribe(()=>{})}preload(){const A=this.injector.get(y.h0i);return this.processRoutes(A,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(A,V){const W=[];for(const oe of V)if(oe.loadChildren&&!oe.canLoad&&oe._loadedConfig){const we=oe._loadedConfig;W.push(this.processRoutes(we.module,we.routes))}else oe.loadChildren&&!oe.canLoad?W.push(this.preloadConfig(A,oe)):oe.children&&W.push(this.processRoutes(A,oe.children));return(0,vr.D)(W).pipe((0,Xt.J)(),(0,Fe.U)(oe=>{}))}preloadConfig(A,V){return this.preloadingStrategy.preload(V,()=>(V._loadedConfig?(0,hn.of)(V._loadedConfig):this.loader.load(A.injector,V)).pipe((0,Zt.zg)(oe=>(V._loadedConfig=oe,this.processRoutes(oe.module,oe.routes)))))}}return L.\u0275fac=function(A){return new(A||L)(y.LFG(ro),y.LFG(y.v3s),y.LFG(y.Sil),y.LFG(y.zs3),y.LFG(ta))},L.\u0275prov=y.Yz7({token:L,factory:L.\u0275fac}),L})(),rc=(()=>{class L{constructor(A,V,W={}){this.router=A,this.viewportScroller=V,this.options=W,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},W.scrollPositionRestoration=W.scrollPositionRestoration||"disabled",W.anchorScrolling=W.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(A=>{A instanceof Sr?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=A.navigationTrigger,this.restoredId=A.restoredState?A.restoredState.navigationId:0):A instanceof Nn&&(this.lastId=A.id,this.scheduleScrollEvent(A,this.router.parseUrl(A.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(A=>{A instanceof me&&(A.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(A.position):A.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(A.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(A,V){this.router.triggerEvent(new me(A,"popstate"===this.lastSource?this.store[this.restoredId]:null,V))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return L.\u0275fac=function(A){return new(A||L)(y.LFG(ro),y.LFG($.EM),y.LFG(void 0))},L.\u0275prov=y.Yz7({token:L,factory:L.\u0275fac}),L})();const da=new y.OlP("ROUTER_CONFIGURATION"),Ll=new y.OlP("ROUTER_FORROOT_GUARD"),ic=[$.Ye,{provide:Eo,useClass:to},{provide:ro,useFactory:function(L,M,A,V,W,oe,we,Le={},ft,en){const Rr=new ro(null,L,M,A,V,W,oe,ot(we));return ft&&(Rr.urlHandlingStrategy=ft),en&&(Rr.routeReuseStrategy=en),function(L,M){L.errorHandler&&(M.errorHandler=L.errorHandler),L.malformedUriErrorHandler&&(M.malformedUriErrorHandler=L.malformedUriErrorHandler),L.onSameUrlNavigation&&(M.onSameUrlNavigation=L.onSameUrlNavigation),L.paramsInheritanceStrategy&&(M.paramsInheritanceStrategy=L.paramsInheritanceStrategy),L.relativeLinkResolution&&(M.relativeLinkResolution=L.relativeLinkResolution),L.urlUpdateStrategy&&(M.urlUpdateStrategy=L.urlUpdateStrategy)}(Le,Rr),Le.enableTracing&&Rr.events.subscribe(wn=>{var rr,gr;null===(rr=console.group)||void 0===rr||rr.call(console,`Router Event: ${wn.constructor.name}`),console.log(wn.toString()),console.log(wn),null===(gr=console.groupEnd)||void 0===gr||gr.call(console)}),Rr},deps:[Eo,ns,$.Ye,y.zs3,y.v3s,y.Sil,zi,da,[class{},new y.FiY],[class{},new y.FiY]]},ns,{provide:mi,useFactory:function(L){return L.routerState.root},deps:[ro]},{provide:y.v3s,useClass:y.EAV},cl,ll,class{preload(M,A){return A().pipe($t(()=>(0,hn.of)(null)))}},{provide:da,useValue:{enableTracing:!1}}];function oc(){return new y.PXZ("Router",ro)}let Za=(()=>{class L{constructor(A,V){}static forRoot(A,V){return{ngModule:L,providers:[ic,sc(A),{provide:Ll,useFactory:hl,deps:[[ro,new y.FiY,new y.tp0]]},{provide:da,useValue:V||{}},{provide:$.S$,useFactory:mu,deps:[$.lw,[new y.tBr($.mr),new y.FiY],da]},{provide:rc,useFactory:ul,deps:[ro,$.EM,da]},{provide:ta,useExisting:V&&V.preloadingStrategy?V.preloadingStrategy:ll},{provide:y.PXZ,multi:!0,useFactory:oc},[Nl,{provide:y.ip1,multi:!0,useFactory:zl,deps:[Nl]},{provide:ac,useFactory:Ga,deps:[Nl]},{provide:y.tb,multi:!0,useExisting:ac}]]}}static forChild(A){return{ngModule:L,providers:[sc(A)]}}}return L.\u0275fac=function(A){return new(A||L)(y.LFG(Ll,8),y.LFG(ro,8))},L.\u0275mod=y.oAB({type:L}),L.\u0275inj=y.cJS({}),L})();function ul(L,M,A){return A.scrollOffset&&M.setOffset(A.scrollOffset),new rc(L,M,A)}function mu(L,M,A={}){return A.useHash?new $.Do(L,M):new $.b0(L,M)}function hl(L){return"guarded"}function sc(L){return[{provide:y.deG,multi:!0,useValue:L},{provide:zi,multi:!0,useValue:L}]}let Nl=(()=>{class L{constructor(A){this.injector=A,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Rt.xQ}appInitializer(){return this.injector.get($.V_,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let V=null;const W=new Promise(Le=>V=Le),oe=this.injector.get(ro),we=this.injector.get(da);return"disabled"===we.initialNavigation?(oe.setUpLocationChangeListener(),V(!0)):"enabled"===we.initialNavigation||"enabledBlocking"===we.initialNavigation?(oe.hooks.afterPreactivation=()=>this.initNavigation?(0,hn.of)(null):(this.initNavigation=!0,V(!0),this.resultOfPreactivationDone),oe.initialNavigation()):V(!0),W})}bootstrapListener(A){const V=this.injector.get(da),W=this.injector.get(cl),oe=this.injector.get(rc),we=this.injector.get(ro),Le=this.injector.get(y.z2F);A===Le.components[0]&&(("enabledNonBlocking"===V.initialNavigation||void 0===V.initialNavigation)&&we.initialNavigation(),W.setUpPreloading(),oe.init(),we.resetRootComponentType(Le.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return L.\u0275fac=function(A){return new(A||L)(y.LFG(y.zs3))},L.\u0275prov=y.Yz7({token:L,factory:L.\u0275fac}),L})();function zl(L){return L.appInitializer.bind(L)}function Ga(L){return L.bootstrapListener.bind(L)}const ac=new y.OlP("Router Initializer")},2958:function(Cn){Cn.exports=function(){"use strict";var Dt,xe,$;function y(h,Qe){if(Dt)if(xe){var nt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Dt+")(sharedChunk); ("+xe+")(sharedChunk); self.onerror = null;",ze={};Dt(ze),$=Qe(ze),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&($.workerUrl=window.URL.createObjectURL(new Blob([nt],{type:"text/javascript"})))}else xe=Qe;else Dt=Qe}return y(0,function(h){var nt=ze;function ze(r,e,o,a){this.cx=3*r,this.bx=3*(o-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=a,this.p2x=o,this.p2y=a}ze.prototype.sampleCurveX=function(r){return((this.ax*r+this.bx)*r+this.cx)*r},ze.prototype.sampleCurveY=function(r){return((this.ay*r+this.by)*r+this.cy)*r},ze.prototype.sampleCurveDerivativeX=function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},ze.prototype.solveCurveX=function(r,e){var o,a,u,p,_;for(void 0===e&&(e=1e-6),u=r,_=0;_<8;_++){if(p=this.sampleCurveX(u)-r,Math.abs(p)<e)return u;var x=this.sampleCurveDerivativeX(u);if(Math.abs(x)<1e-6)break;u-=p/x}if((u=r)<(o=0))return o;if(u>(a=1))return a;for(;o<a;){if(p=this.sampleCurveX(u),Math.abs(p-r)<e)return u;r>p?o=u:a=u,u=.5*(a-o)+o}return u},ze.prototype.solve=function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))};var Me=qe;function qe(r,e){this.x=r,this.y=e}qe.prototype={clone:function(){return new qe(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,o=r.y-this.y;return e*e+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),o=Math.sin(r),a=o*this.x+e*this.y;return this.x=e*this.x-o*this.y,this.y=a,this},_rotateAround:function(r,e){var o=Math.cos(r),a=Math.sin(r),u=e.y+a*(this.x-e.x)+o*(this.y-e.y);return this.x=e.x+o*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},qe.convert=function(r){return r instanceof qe?r:Array.isArray(r)?new qe(r[0],r[1]):r};var ge="undefined"!=typeof self?self:{},Ye=1e-6,Xe="undefined"!=typeof Float32Array?Float32Array:Array;function Ct(){var r=new Xe(9);return Xe!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function _t(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Vt(r,e,o){var a=e[0],u=e[1],p=e[2],_=e[3],x=e[4],C=e[5],D=e[6],O=e[7],N=e[8],B=e[9],X=e[10],ne=e[11],ae=e[12],le=e[13],ye=e[14],De=e[15],Re=o[0],Ve=o[1],$e=o[2],Ge=o[3];return r[0]=Re*a+Ve*x+$e*N+Ge*ae,r[1]=Re*u+Ve*C+$e*B+Ge*le,r[2]=Re*p+Ve*D+$e*X+Ge*ye,r[3]=Re*_+Ve*O+$e*ne+Ge*De,r[4]=(Re=o[4])*a+(Ve=o[5])*x+($e=o[6])*N+(Ge=o[7])*ae,r[5]=Re*u+Ve*C+$e*B+Ge*le,r[6]=Re*p+Ve*D+$e*X+Ge*ye,r[7]=Re*_+Ve*O+$e*ne+Ge*De,r[8]=(Re=o[8])*a+(Ve=o[9])*x+($e=o[10])*N+(Ge=o[11])*ae,r[9]=Re*u+Ve*C+$e*B+Ge*le,r[10]=Re*p+Ve*D+$e*X+Ge*ye,r[11]=Re*_+Ve*O+$e*ne+Ge*De,r[12]=(Re=o[12])*a+(Ve=o[13])*x+($e=o[14])*N+(Ge=o[15])*ae,r[13]=Re*u+Ve*C+$e*B+Ge*le,r[14]=Re*p+Ve*D+$e*X+Ge*ye,r[15]=Re*_+Ve*O+$e*ne+Ge*De,r}function ut(r,e,o){var a,u,p,_,x,C,D,O,N,B,X,ne,ae=o[0],le=o[1],ye=o[2];return e===r?(r[12]=e[0]*ae+e[4]*le+e[8]*ye+e[12],r[13]=e[1]*ae+e[5]*le+e[9]*ye+e[13],r[14]=e[2]*ae+e[6]*le+e[10]*ye+e[14],r[15]=e[3]*ae+e[7]*le+e[11]*ye+e[15]):(u=e[1],p=e[2],_=e[3],x=e[4],C=e[5],D=e[6],O=e[7],N=e[8],B=e[9],X=e[10],ne=e[11],r[0]=a=e[0],r[1]=u,r[2]=p,r[3]=_,r[4]=x,r[5]=C,r[6]=D,r[7]=O,r[8]=N,r[9]=B,r[10]=X,r[11]=ne,r[12]=a*ae+x*le+N*ye+e[12],r[13]=u*ae+C*le+B*ye+e[13],r[14]=p*ae+D*le+X*ye+e[14],r[15]=_*ae+O*le+ne*ye+e[15]),r}function qt(r,e,o){var a=o[0],u=o[1],p=o[2];return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r[3]=e[3]*a,r[4]=e[4]*u,r[5]=e[5]*u,r[6]=e[6]*u,r[7]=e[7]*u,r[8]=e[8]*p,r[9]=e[9]*p,r[10]=e[10]*p,r[11]=e[11]*p,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Dn(r,e,o){var a=Math.sin(o),u=Math.cos(o),p=e[4],_=e[5],x=e[6],C=e[7],D=e[8],O=e[9],N=e[10],B=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=p*u+D*a,r[5]=_*u+O*a,r[6]=x*u+N*a,r[7]=C*u+B*a,r[8]=D*u-p*a,r[9]=O*u-_*a,r[10]=N*u-x*a,r[11]=B*u-C*a,r}function cn(r,e,o){var a=Math.sin(o),u=Math.cos(o),p=e[0],_=e[1],x=e[2],C=e[3],D=e[8],O=e[9],N=e[10],B=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=p*u-D*a,r[1]=_*u-O*a,r[2]=x*u-N*a,r[3]=C*u-B*a,r[8]=p*a+D*u,r[9]=_*a+O*u,r[10]=x*a+N*u,r[11]=C*a+B*u,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var jt=Vt;function vr(){var r=new Xe(3);return Xe!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function hn(r){var e=new Xe(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function Kr(r){return Math.hypot(r[0],r[1],r[2])}function ao(r,e,o){var a=new Xe(3);return a[0]=r,a[1]=e,a[2]=o,a}function li(r,e,o){return r[0]=e[0]+o[0],r[1]=e[1]+o[1],r[2]=e[2]+o[2],r}function Jt(r,e,o){return r[0]=e[0]-o[0],r[1]=e[1]-o[1],r[2]=e[2]-o[2],r}function qn(r,e,o){return r[0]=e[0]*o[0],r[1]=e[1]*o[1],r[2]=e[2]*o[2],r}function Mr(r,e,o){return r[0]=Math.max(e[0],o[0]),r[1]=Math.max(e[1],o[1]),r[2]=Math.max(e[2],o[2]),r}function In(r,e,o){return r[0]=e[0]*o,r[1]=e[1]*o,r[2]=e[2]*o,r}function dn(r,e,o,a){return r[0]=e[0]+o[0]*a,r[1]=e[1]+o[1]*a,r[2]=e[2]+o[2]*a,r}function Un(r,e){var o=e[0],a=e[1],u=e[2],p=o*o+a*a+u*u;return p>0&&(p=1/Math.sqrt(p)),r[0]=e[0]*p,r[1]=e[1]*p,r[2]=e[2]*p,r}function $t(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function lo(r,e,o){var a=e[0],u=e[1],p=e[2],_=o[0],x=o[1],C=o[2];return r[0]=u*C-p*x,r[1]=p*_-a*C,r[2]=a*x-u*_,r}function Ln(r,e,o){var a=e[0],u=e[1],p=e[2],_=o[3]*a+o[7]*u+o[11]*p+o[15];return r[0]=(o[0]*a+o[4]*u+o[8]*p+o[12])/(_=_||1),r[1]=(o[1]*a+o[5]*u+o[9]*p+o[13])/_,r[2]=(o[2]*a+o[6]*u+o[10]*p+o[14])/_,r}function Ki(r,e,o){var a=o[0],u=o[1],p=o[2],_=e[0],x=e[1],C=e[2],D=u*C-p*x,O=p*_-a*C,N=a*x-u*_,B=u*N-p*O,X=p*D-a*N,ne=a*O-u*D,ae=2*o[3];return O*=ae,N*=ae,X*=2,ne*=2,r[0]=_+(D*=ae)+(B*=2),r[1]=x+O+X,r[2]=C+N+ne,r}var hi,r,co=Jt,Os=qn,hs=Kr;function bo(r,e,o){var a=e[0],u=e[1],p=e[2],_=e[3];return r[0]=o[0]*a+o[4]*u+o[8]*p+o[12]*_,r[1]=o[1]*a+o[5]*u+o[9]*p+o[13]*_,r[2]=o[2]*a+o[6]*u+o[10]*p+o[14]*_,r[3]=o[3]*a+o[7]*u+o[11]*p+o[15]*_,r}function Fo(){var r=new Xe(4);return Xe!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Ko(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function ji(r,e,o){o*=.5;var a=e[0],u=e[1],p=e[2],_=e[3],x=Math.sin(o),C=Math.cos(o);return r[0]=a*C+_*x,r[1]=u*C+p*x,r[2]=p*C-u*x,r[3]=_*C-a*x,r}function Jr(r,e){return r[0]===e[0]&&r[1]===e[1]}vr(),hi=new Xe(4),Xe!=Float32Array&&(hi[0]=0,hi[1]=0,hi[2]=0,hi[3]=0),vr(),ao(1,0,0),ao(0,1,0),Fo(),Fo(),Ct(),r=new Xe(2),Xe!=Float32Array&&(r[0]=0,r[1]=0);const ii=Math.PI/180,Xn=180/Math.PI;function An(r){return r*ii}function Lr(r){return r*Xn}const Ci=[[0,0],[1,0],[1,1],[0,1]];function hr(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,o=e*r;return 4*(r<.5?o:3*(r-e)+o-.75)}function Ji(r,e,o,a){const u=new nt(r,e,o,a);return function(p){return u.solve(p)}}const Uo=Ji(.25,.1,.25,1);function pn(r,e,o){return Math.min(o,Math.max(e,r))}function wo(r,e,o){return(o=pn((o-r)/(e-r),0,1))*o*(3-2*o)}function Br(r,e,o){const a=o-e,u=((r-e)%a+a)%a+e;return u===e?o:u}function $i(r,e,o){if(!r.length)return o(null,[]);let a=r.length;const u=new Array(r.length);let p=null;r.forEach((_,x)=>{e(_,(C,D)=>{C&&(p=C),u[x]=D,0==--a&&o(p,u)})})}function Jo(r){const e=[];for(const o in r)e.push(r[o]);return e}function st(r,...e){for(const o of e)for(const a in o)r[a]=o[a];return r}let Ne=1;function Fe(){return Ne++}function At(){return function r(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()}function Je(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Zt(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)}function Wt(r,e){r.forEach(o=>{e[o]&&(e[o]=e[o].bind(e))})}function Xt(r,e){return-1!==r.indexOf(e,r.length-e.length)}function _n(r,e,o){const a={};for(const u in r)a[u]=e.call(o||this,r[u],u,r);return a}function Sr(r,e,o){const a={};for(const u in r)e.call(o||this,r[u],u,r)&&(a[u]=r[u]);return a}function Nn(r){return Array.isArray(r)?r.map(Nn):"object"==typeof r&&r?_n(r,Nn):r}const Nr={};function kn(r){Nr[r]||("undefined"!=typeof console&&console.warn(r),Nr[r]=!0)}function On(r,e,o){return(o.y-r.y)*(e.x-r.x)>(e.y-r.y)*(o.x-r.x)}function rn(r){let e=0;for(let o,a,u=0,p=r.length,_=p-1;u<p;_=u++)o=r[u],a=r[_],e+=(a.x-o.x)*(o.y+a.y);return e}function ci(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Gn(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,a,u,p)=>{const _=u||p;return e[a]=!_||_.toLowerCase(),""}),e["max-age"]){const o=parseInt(e["max-age"],10);isNaN(o)?delete e["max-age"]:e["max-age"]=o}return e}let Qr,di,Qn,Qi=null;function jo(r){if(null==Qi){const e=r.navigator?r.navigator.userAgent:null;Qi=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Qi}function Co(r){try{const e=ge[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(e){return!1}}const zn={now:()=>void 0!==Qn?Qn:ge.performance.now(),setNow(r){Qn=r},restoreNow(){Qn=void 0},frame(r){const e=ge.requestAnimationFrame(r);return{cancel:()=>ge.cancelAnimationFrame(e)}},getImageData(r,e=0){const o=ge.document.createElement("canvas"),a=o.getContext("2d");if(!a)throw new Error("failed to create canvas 2d context");return o.width=r.width,o.height=r.height,a.drawImage(r,0,0,r.width,r.height),a.getImageData(-e,-e,r.width+2*e,r.height+2*e)},resolveURL:r=>(Qr||(Qr=ge.document.createElement("a")),Qr.href=r,Qr.href),get devicePixelRatio(){return ge.devicePixelRatio},get prefersReducedMotion(){return!!ge.matchMedia&&(null==di&&(di=ge.matchMedia("(prefers-reduced-motion: reduce)")),di.matches)}};let me;const Z={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==me){const r=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{me=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):r}catch(e){me=r}}return me},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},re={supported:!1,testSupport:function(r){!Ie&&ve&&(Be?je(r):pe=r)}};let pe,ve,Ie=!1,Be=!1;function je(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,ve),r.isContextLost())return;re.supported=!0}catch(o){}r.deleteTexture(e),Ie=!0}ge.document&&(ve=ge.document.createElement("img"),ve.onload=function(){pe&&je(pe),pe=null,Be=!0},ve.onerror=function(){Ie=!0,pe=null},ve.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Oe="01",Ze="NO_ACCESS_TOKEN";function lt(r){return 0===r.indexOf("mapbox:")}function ot(r){return Z.API_URL_REGEX.test(r)}const mt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Qt(r){const e=r.match(mt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Gt(r){const e=r.params.length?`?${r.params.join("&")}`:"";return`${r.protocol}://${r.authority}${r.path}${e}`}function Yt(r){if(!r)return null;const e=r.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(ge.atob(e[1]).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(o){return null}}class sn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const o=Yt(Z.ACCESS_TOKEN);let a="";return a=o&&o.u?ge.btoa(encodeURIComponent(o.u).replace(/%([0-9A-F]{2})/g,(u,p)=>String.fromCharCode(Number("0x"+p)))):Z.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${a}`:`mapbox.eventData:${a}`}fetchEventData(){const e=Co("localStorage"),o=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const u=ge.localStorage.getItem(o);u&&(this.eventData=JSON.parse(u));const p=ge.localStorage.getItem(a);p&&(this.anonId=p)}catch(u){kn("Unable to read from LocalStorage")}}saveEventData(){const e=Co("localStorage"),o=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{ge.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&ge.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(u){kn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,o,a,u){if(!Z.EVENTS_URL)return;const p=Qt(Z.EVENTS_URL);p.params.push(`access_token=${u||Z.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.7.0",skuId:Oe,userId:this.anonId},x=o?st(_,o):_,C={url:Gt(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=Ni(C,D=>{this.pendingRequest=null,a(D),this.saveEventData(),this.processRequests(u)})}queueRequest(e,o){this.queue.push(e),this.processRequests(o)}}const Mn=new class extends sn{constructor(r){super("appUserTurnstile"),this._customAccessToken=r}postTurnstileEvent(r,e){Z.EVENTS_URL&&Z.ACCESS_TOKEN&&Array.isArray(r)&&r.some(o=>lt(o)||ot(o))&&this.queueRequest(Date.now(),e)}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Yt(Z.ACCESS_TOKEN),o=e?e.u:Z.ACCESS_TOKEN;let a=o!==this.eventData.tokenU;Zt(this.anonId)||(this.anonId=At(),a=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),_=new Date(u),x=(u-this.eventData.lastSuccess)/864e5;a=a||x>=1||x<-1||p.getDate()!==_.getDate()}else a=!0;if(!a)return this.processRequests();this.postEvent(u,{"enabled.telemetry":!1},p=>{p||(this.eventData.lastSuccess=u,this.eventData.tokenU=o)},r)}},xn=Mn.postTurnstileEvent.bind(Mn),Kn=new class extends sn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(r,e,o,a){this.skuToken=e,this.errorCb=a,Z.EVENTS_URL&&(o||Z.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},o):this.errorCb(new Error(Ze)))}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:o}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Zt(this.anonId)||(this.anonId=At()),this.postEvent(o,{skuToken:this.skuToken},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},r))}},tr=Kn.postMapLoadEvent.bind(Kn),Wn=new class extends sn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(r,e,o,a){if(!Z.API_URL||!Z.SESSION_PATH)return;const u=Qt(Z.API_URL+Z.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${a||Z.ACCESS_TOKEN||""}`);const p={url:Gt(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Lo(p,_=>{this.pendingRequest=null,o(_),this.saveEventData(),this.processRequests(a)})}getSessionAPI(r,e,o,a){this.skuToken=e,this.errorCb=a,Z.SESSION_PATH&&Z.API_URL&&(o||Z.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},o):this.errorCb(new Error(Ze)))}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:o}=this.queue.shift();e&&this.success[e]||this.getSession(o,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},r)}},eo=Wn.getSessionAPI.bind(Wn),ei=new Set,Nt="mapbox-tiles";let yn,sr,un=500,oi=50;function Zr(){ge.caches&&!yn&&(yn=ge.caches.open(Nt))}function si(r){const e=r.indexOf("?");return e<0?r:r.slice(0,e)}let Gr=1/0;const Eo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Eo);class to extends Error{constructor(e,o,a){401===o&&ot(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=o,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const bn=ci()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ge.location.protocol?ge.parent:ge).location.href,pi=function(r,e){if(!(/^file:/.test(o=r.url)||/^file:/.test(bn())&&!/^\w+:/.test(o))){if(ge.fetch&&ge.Request&&ge.AbortController&&ge.Request.prototype.hasOwnProperty("signal"))return function(a,u){const p=new ge.AbortController,_=new ge.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:bn(),signal:p.signal});let x=!1,C=!1;const D=(O=_.url).indexOf("sku=")>0&&ot(O);var O;"json"===a.type&&_.headers.set("Accept","application/json");const N=(X,ne,ae)=>{if(C)return;if(X&&"SecurityError"!==X.message&&kn(X),ne&&ae)return B(ne);const le=Date.now();ge.fetch(_).then(ye=>{if(ye.ok){const De=D?ye.clone():null;return B(ye,De,le)}return u(new to(ye.statusText,ye.status,a.url))}).catch(ye=>{20!==ye.code&&u(new Error(ye.message))})},B=(X,ne,ae)=>{("arrayBuffer"===a.type?X.arrayBuffer():"json"===a.type?X.json():X.text()).then(le=>{C||(ne&&ae&&function(ye,De,Re){if(Zr(),!yn)return;const Ve={status:De.status,statusText:De.statusText,headers:new ge.Headers};De.headers.forEach((Ge,dt)=>Ve.headers.set(dt,Ge));const $e=Gn(De.headers.get("Cache-Control")||"");$e["no-store"]||($e["max-age"]&&Ve.headers.set("Expires",new Date(Re+1e3*$e["max-age"]).toUTCString()),new Date(Ve.headers.get("Expires")).getTime()-Re<42e4||function(Ge,dt){if(void 0===sr)try{new Response(new ReadableStream),sr=!0}catch(ct){sr=!1}sr?dt(Ge.body):Ge.blob().then(dt)}(De,Ge=>{const dt=new ge.Response(Ge,Ve);Zr(),yn&&yn.then(ct=>ct.put(si(ye.url),dt)).catch(ct=>kn(ct.message))}))}(_,ne,ae),x=!0,u(null,le,X.headers.get("Cache-Control"),X.headers.get("Expires")))}).catch(le=>{C||u(new Error(le.message))})};return D?function(X,ne){if(Zr(),!yn)return ne(null);const ae=si(X.url);yn.then(le=>{le.match(ae).then(ye=>{const De=function(Re){if(!Re)return!1;const Ve=new Date(Re.headers.get("Expires")||0),$e=Gn(Re.headers.get("Cache-Control")||"");return Ve>Date.now()&&!$e["no-cache"]}(ye);le.delete(ae),De&&le.put(ae,ye.clone()),ne(null,ye,De)}).catch(ne)}).catch(ne)}(_,N):N(null,null),{cancel:()=>{C=!0,x||p.abort()}}}(r,e);if(ci()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var o;return function(a,u){const p=new ge.XMLHttpRequest;p.open(a.method||"GET",a.url,!0),"arrayBuffer"===a.type&&(p.responseType="arraybuffer");for(const _ in a.headers)p.setRequestHeader(_,a.headers[_]);return"json"===a.type&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials="include"===a.credentials,p.onerror=()=>{u(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||0===p.status)&&null!==p.response){let _=p.response;if("json"===a.type)try{_=JSON.parse(p.response)}catch(x){return u(x)}u(null,_,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else u(new to(p.statusText,p.status,a.url))},p.send(a.body),{cancel:()=>p.abort()}}(r,e)},Li=function(r,e){return pi(st(r,{type:"arrayBuffer"}),e)},Ni=function(r,e){return pi(st(r,{method:"POST"}),e)},Lo=function(r,e){return pi(st(r,{method:"GET"}),e)};function Zi(r){const e=ge.document.createElement("a");return e.href=r,e.protocol===ge.document.location.protocol&&e.host===ge.document.location.host}const no="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Mi,fi;Mi=[],fi=0;const Ir=function(r,e){if(re.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),fi>=Z.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Mi.push(p),p}fi++;let o=!1;const a=()=>{if(!o)for(o=!0,fi--;Mi.length&&fi<Z.MAX_PARALLEL_IMAGE_REQUESTS;){const p=Mi.shift(),{requestParameters:_,callback:x,cancelled:C}=p;C||(p.cancel=Ir(_,x).cancel)}},u=Li(r,(p,_,x,C)=>{a(),p?e(p):_&&(ge.createImageBitmap?function(D,O){const N=new ge.Blob([new Uint8Array(D)],{type:"image/png"});ge.createImageBitmap(N).then(B=>{O(null,B)}).catch(B=>{O(new Error(`Could not load image because of ${B.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(D,O)=>e(D,O,x,C)):function(D,O){const N=new ge.Image,B=ge.URL;N.onload=()=>{O(null,N),B.revokeObjectURL(N.src),N.onload=null,ge.requestAnimationFrame(()=>{N.src=no})},N.onerror=()=>O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const X=new ge.Blob([new Uint8Array(D)],{type:"image/png"});N.src=D.byteLength?B.createObjectURL(X):no}(_,(D,O)=>e(D,O,x,C)))});return{cancel:()=>{u.cancel(),a()}}};function la(r,e,o){o[r]&&-1!==o[r].indexOf(e)||(o[r]=o[r]||[],o[r].push(e))}function Fs(r,e,o){if(o&&o[r]){const a=o[r].indexOf(e);-1!==a&&o[r].splice(a,1)}}class uo{constructor(e,o={}){st(this,o),this.type=e}}class $o extends uo{constructor(e,o={}){super("error",st({error:e},o))}}class qr{on(e,o){return this._listeners=this._listeners||{},la(e,o,this._listeners),this}off(e,o){return Fs(e,o,this._listeners),Fs(e,o,this._oneTimeListeners),this}once(e,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},la(e,o,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,o){"string"==typeof e&&(e=new uo(e,o||{}));const a=e.type;if(this.listens(a)){e.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const x of u)x.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const x of p)Fs(a,x,this._oneTimeListeners),x.call(this,e);const _=this._eventedParent;_&&(st(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof $o&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,o){return this._eventedParent=e,this._eventedParentData=o,this}}var rt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class zt{constructor(e,o,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),null!=o&&o.__line__&&(this.line=o.__line__)}}function dr(r){const e=r.value;return e?[new zt(r.key,e,"constants have been deprecated as of v8")]:[]}function Qo(r,...e){for(const o of e)for(const a in o)r[a]=o[a];return r}function nr(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function ti(r){if(Array.isArray(r))return r.map(ti);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const o in r)e[o]=ti(r[o]);return e}return nr(r)}class Gi extends Error{constructor(e,o){super(o),this.message=o,this.key=e}}class Ei{constructor(e,o=[]){this.parent=e,this.bindings={};for(const[a,u]of o)this.bindings[a]=u}concat(e){return new Ei(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Si={kind:"null"},kt={kind:"number"},Bn={kind:"string"},Rn={kind:"boolean"},mi={kind:"color"},ho={kind:"object"},Fn={kind:"value"},Zo={kind:"collator"},es={kind:"formatted"},To={kind:"resolvedImage"};function ui(r,e){return{kind:"array",itemType:r,N:e}}function Dr(r){if("array"===r.kind){const e=Dr(r.itemType);return"number"==typeof r.N?`array<${e}, ${r.N}>`:"value"===r.itemType.kind?"array":`array<${e}>`}return r.kind}const Gs=[Si,kt,Bn,Rn,mi,es,ho,ui(Fn),To];function Ii(r,e){if("error"===e.kind)return null;if("array"===r.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Ii(r.itemType,e.itemType))&&("number"!=typeof r.N||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if("value"===r.kind)for(const o of Gs)if(!Ii(o,e))return null}return`Expected ${Dr(r)} but found ${Dr(e)} instead.`}function Go(r,e){return e.some(o=>o.kind===r.kind)}function Do(r,e){return e.some(o=>"null"===o?null===r:"array"===o?Array.isArray(r):"object"===o?r&&!Array.isArray(r)&&"object"==typeof r:o===typeof r)}function Ho(r){var e={exports:{}};return r(e,e.exports),e.exports}var bs=Ho(function(r,e){var o={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(x){return(x=Math.round(x))<0?0:x>255?255:x}function u(x){return a("%"===x[x.length-1]?parseFloat(x)/100*255:parseInt(x))}function p(x){return(C="%"===x[x.length-1]?parseFloat(x)/100:parseFloat(x))<0?0:C>1?1:C;var C}function _(x,C,D){return D<0?D+=1:D>1&&(D-=1),6*D<1?x+(C-x)*D*6:2*D<1?C:3*D<2?x+(C-x)*(2/3-D)*6:x}try{e.parseCSSColor=function(x){var C,D=x.replace(/ /g,"").toLowerCase();if(D in o)return o[D].slice();if("#"===D[0])return 4===D.length?(C=parseInt(D.substr(1),16))>=0&&C<=4095?[(3840&C)>>4|(3840&C)>>8,240&C|(240&C)>>4,15&C|(15&C)<<4,1]:null:7===D.length&&(C=parseInt(D.substr(1),16))>=0&&C<=16777215?[(16711680&C)>>16,(65280&C)>>8,255&C,1]:null;var O=D.indexOf("("),N=D.indexOf(")");if(-1!==O&&N+1===D.length){var B=D.substr(0,O),X=D.substr(O+1,N-(O+1)).split(","),ne=1;switch(B){case"rgba":if(4!==X.length)return null;ne=p(X.pop());case"rgb":return 3!==X.length?null:[u(X[0]),u(X[1]),u(X[2]),ne];case"hsla":if(4!==X.length)return null;ne=p(X.pop());case"hsl":if(3!==X.length)return null;var ae=(parseFloat(X[0])%360+360)%360/360,le=p(X[1]),ye=p(X[2]),De=ye<=.5?ye*(le+1):ye+le-ye*le,Re=2*ye-De;return[a(255*_(Re,De,ae+1/3)),a(255*_(Re,De,ae)),a(255*_(Re,De,ae-1/3)),ne];default:return null}}return null}}catch(x){}});class Jn{constructor(e,o,a,u=1){this.r=e,this.g=o,this.b=a,this.a=u}static parse(e){if(!e)return;if(e instanceof Jn)return e;if("string"!=typeof e)return;const o=bs.parseCSSColor(e);return o?new Jn(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[e,o,a,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(o)},${Math.round(a)},${u})`}toArray(){const{r:e,g:o,b:a,a:u}=this;return 0===u?[0,0,0,0]:[255*e/u,255*o/u,255*a/u,u]}}Jn.black=new Jn(0,0,0,1),Jn.white=new Jn(1,1,1,1),Jn.transparent=new Jn(0,0,0,0),Jn.red=new Jn(1,0,0,1),Jn.blue=new Jn(0,0,1,1);class Ao{constructor(e,o,a){this.sensitivity=e?o?"variant":"case":o?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,o){return this.collator.compare(e,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class po{constructor(e,o,a,u,p){this.text=e.normalize?e.normalize():e,this.image=o,this.scale=a,this.fontStack=u,this.textColor=p}}class mn{constructor(e){this.sections=e}static fromString(e){return new mn([new po(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof mn?e:mn.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const o of this.sections){if(o.image){e.push(["image",o.image.name]);continue}e.push(o.text);const a={};o.fontStack&&(a["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(a["font-scale"]=o.scale),o.textColor&&(a["text-color"]=["rgba"].concat(o.textColor.toArray())),e.push(a)}return e}}class Pi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Pi({name:e,available:!1}):null}serialize(){return["image",this.name]}}function ka(r,e,o,a){return"number"==typeof r&&r>=0&&r<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof o&&o>=0&&o<=255?void 0===a||"number"==typeof a&&a>=0&&a<=1?null:`Invalid rgba value [${[r,e,o,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof a?[r,e,o,a]:[r,e,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fo(r){if(null===r||"string"==typeof r||"boolean"==typeof r||"number"==typeof r||r instanceof Jn||r instanceof Ao||r instanceof mn||r instanceof Pi)return!0;if(Array.isArray(r)){for(const e of r)if(!fo(e))return!1;return!0}if("object"==typeof r){for(const e in r)if(!fo(r[e]))return!1;return!0}return!1}function Ar(r){if(null===r)return Si;if("string"==typeof r)return Bn;if("boolean"==typeof r)return Rn;if("number"==typeof r)return kt;if(r instanceof Jn)return mi;if(r instanceof Ao)return Zo;if(r instanceof mn)return es;if(r instanceof Pi)return To;if(Array.isArray(r)){const e=r.length;let o;for(const a of r){const u=Ar(a);if(o){if(o===u)continue;o=Fn;break}o=u}return ui(o||Fn,e)}return ho}function Wr(r){const e=typeof r;return null===r?"":"string"===e||"number"===e||"boolean"===e?String(r):r instanceof Jn||r instanceof mn||r instanceof Pi?r.toString():JSON.stringify(r)}class qo{constructor(e,o){this.type=e,this.value=o}static parse(e,o){if(2!==e.length)return o.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!fo(e[1]))return o.error("invalid value");const a=e[1];let u=Ar(a);const p=o.expectedType;return"array"!==u.kind||0!==u.N||!p||"array"!==p.kind||"number"==typeof p.N&&0!==p.N||(u=p),new qo(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Jn?["rgba"].concat(this.value.toArray()):this.value instanceof mn?this.value.serialize():this.value}}class gi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const an={string:Bn,number:kt,boolean:Rn,object:ho};class Hi{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");let a,u=1;const p=e[0];if("array"===p){let x,C;if(e.length>2){const D=e[1];if("string"!=typeof D||!(D in an)||"object"===D)return o.error('The item type argument of "array" must be one of string, number, boolean',1);x=an[D],u++}else x=Fn;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return o.error('The length argument to "array" must be a positive integer literal',2);C=e[2],u++}a=ui(x,C)}else a=an[p];const _=[];for(;u<e.length;u++){const x=o.parse(e[u],u,Fn);if(!x)return null;_.push(x)}return new Hi(a,_)}evaluate(e){for(let o=0;o<this.args.length;o++){const a=this.args[o].evaluate(e);if(!Ii(this.type,Ar(a)))return a;if(o===this.args.length-1)throw new gi(`Expected value to be of type ${Dr(this.type)}, but found ${Dr(Ar(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,o=[e.kind];if("array"===e.kind){const a=e.itemType;if("string"===a.kind||"number"===a.kind||"boolean"===a.kind){o.push(a.kind);const u=e.N;("number"==typeof u||this.args.length>1)&&o.push(u)}}return o.concat(this.args.map(a=>a.serialize()))}}class Mo{constructor(e){this.type=es,this.sections=e}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&"object"==typeof a)return o.error("First argument must be an image or text section.");const u=[];let p=!1;for(let _=1;_<=e.length-1;++_){const x=e[_];if(p&&"object"==typeof x&&!Array.isArray(x)){p=!1;let C=null;if(x["font-scale"]&&(C=o.parse(x["font-scale"],1,kt),!C))return null;let D=null;if(x["text-font"]&&(D=o.parse(x["text-font"],1,ui(Bn)),!D))return null;let O=null;if(x["text-color"]&&(O=o.parse(x["text-color"],1,mi),!O))return null;const N=u[u.length-1];N.scale=C,N.font=D,N.textColor=O}else{const C=o.parse(e[_],1,Fn);if(!C)return null;const D=C.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:C,scale:null,font:null,textColor:null})}}return new Mo(u)}evaluate(e){return new mn(this.sections.map(o=>{const a=o.content.evaluate(e);return Ar(a)===To?new po("",a,null,null,null):new po(Wr(a),null,o.scale?o.scale.evaluate(e):null,o.font?o.font.evaluate(e).join(","):null,o.textColor?o.textColor.evaluate(e):null)}))}eachChild(e){for(const o of this.sections)e(o.content),o.scale&&e(o.scale),o.font&&e(o.font),o.textColor&&e(o.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const o of this.sections){e.push(o.content.serialize());const a={};o.scale&&(a["font-scale"]=o.scale.serialize()),o.font&&(a["text-font"]=o.font.serialize()),o.textColor&&(a["text-color"]=o.textColor.serialize()),e.push(a)}return e}}class mo{constructor(e){this.type=To,this.input=e}static parse(e,o){if(2!==e.length)return o.error("Expected two arguments.");const a=o.parse(e[1],1,Bn);return a?new mo(a):o.error("No image name provided.")}evaluate(e){const o=this.input.evaluate(e),a=Pi.fromString(o);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(o)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Hs={"to-boolean":Rn,"to-color":mi,"to-number":kt,"to-string":Bn};class Ti{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const a=e[0];if(("to-boolean"===a||"to-string"===a)&&2!==e.length)return o.error("Expected one argument.");const u=Hs[a],p=[];for(let _=1;_<e.length;_++){const x=o.parse(e[_],_,Fn);if(!x)return null;p.push(x)}return new Ti(u,p)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let o,a;for(const u of this.args){if(o=u.evaluate(e),a=null,o instanceof Jn)return o;if("string"==typeof o){const p=e.parseColor(o);if(p)return p}else if(Array.isArray(o)&&(a=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:ka(o[0],o[1],o[2],o[3]),!a))return new Jn(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new gi(a||`Could not parse color from value '${"string"==typeof o?o:String(JSON.stringify(o))}'`)}if("number"===this.type.kind){let o=null;for(const a of this.args){if(o=a.evaluate(e),null===o)return 0;const u=Number(o);if(!isNaN(u))return u}throw new gi(`Could not convert ${JSON.stringify(o)} to number.`)}return"formatted"===this.type.kind?mn.fromString(Wr(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Pi.fromString(Wr(this.args[0].evaluate(e))):Wr(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Mo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new mo(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(o=>{e.push(o.serialize())}),e}}const H=["Unknown","Point","LineString","Polygon"];class ie{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?H[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:a,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*o-e[0])+this.featureDistanceData.bearing[1]*(u*o-e[1])}return 0}parseColor(e){let o=this._parseColorCache[e];return o||(o=this._parseColorCache[e]=Jn.parse(e)),o}}class G{constructor(e,o,a,u){this.name=e,this.type=o,this._evaluate=a,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,o){const a=e[0],u=G.definitions[a];if(!u)return o.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,_=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,x=_.filter(([D])=>!Array.isArray(D)||D.length===e.length-1);let C=null;for(const[D,O]of x){C=new Oa(o.registry,o.path,null,o.scope);const N=[];let B=!1;for(let X=1;X<e.length;X++){const ne=e[X],ae=Array.isArray(D)?D[X-1]:D.type,le=C.parse(ne,1+N.length,ae);if(!le){B=!0;break}N.push(le)}if(!B)if(Array.isArray(D)&&D.length!==N.length)C.error(`Expected ${D.length} arguments, but found ${N.length} instead.`);else{for(let X=0;X<N.length;X++){const ne=Array.isArray(D)?D[X]:D.type,ae=N[X];C.concat(X+1).checkSubtype(ne,ae.type)}if(0===C.errors.length)return new G(a,p,O,N)}}if(1===x.length)o.errors.push(...C.errors);else{const D=(x.length?x:_).map(([N])=>{return B=N,Array.isArray(B)?`(${B.map(Dr).join(", ")})`:`(${Dr(B.type)}...)`;var B}).join(" | "),O=[];for(let N=1;N<e.length;N++){const B=o.parse(e[N],1+O.length);if(!B)return null;O.push(Dr(B.type))}o.error(`Expected arguments of type ${D}, but found (${O.join(", ")}) instead.`)}return null}static register(e,o){G.definitions=o;for(const a in o)e[a]=G}}class S{constructor(e,o,a){this.type=Zo,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=o}static parse(e,o){if(2!==e.length)return o.error("Expected one argument.");const a=e[1];if("object"!=typeof a||Array.isArray(a))return o.error("Collator options argument must be an object.");const u=o.parse(void 0!==a["case-sensitive"]&&a["case-sensitive"],1,Rn);if(!u)return null;const p=o.parse(void 0!==a["diacritic-sensitive"]&&a["diacritic-sensitive"],1,Rn);if(!p)return null;let _=null;return a.locale&&(_=o.parse(a.locale,1,Bn),!_)?null:new S(u,p,_)}evaluate(e){return new Ao(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const k=8192;function I(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function K(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function He(r,e){const o=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(o*u*k),Math.round(a*u*k)]}function yt(r,e,o){const a=r[0]-e[0],u=r[1]-e[1],p=r[0]-o[0],_=r[1]-o[1];return a*_-p*u==0&&a*p<=0&&u*_<=0}function Pn(r,e){let o=!1;for(let _=0,x=e.length;_<x;_++){const C=e[_];for(let D=0,O=C.length;D<O-1;D++){if(yt(r,C[D],C[D+1]))return!1;(u=C[D])[1]>(a=r)[1]!=(p=C[D+1])[1]>a[1]&&a[0]<(p[0]-u[0])*(a[1]-u[1])/(p[1]-u[1])+u[0]&&(o=!o)}}var a,u,p;return o}function pr(r,e){for(let o=0;o<e.length;o++)if(Pn(r,e[o]))return!0;return!1}function Hn(r,e,o,a){const u=a[0]-o[0],p=a[1]-o[1],_=(r[0]-o[0])*p-u*(r[1]-o[1]),x=(e[0]-o[0])*p-u*(e[1]-o[1]);return _>0&&x<0||_<0&&x>0}function ar(r,e,o){for(const D of o)for(let O=0;O<D.length-1;++O)if((x=[(_=D[O+1])[0]-(p=D[O])[0],_[1]-p[1]])[0]*(C=[(u=e)[0]-(a=r)[0],u[1]-a[1]])[1]-x[1]*C[0]!=0&&Hn(a,u,p,_)&&Hn(p,_,a,u))return!0;var a,u,p,_,x,C;return!1}function Vr(r,e){for(let o=0;o<r.length;++o)if(!Pn(r[o],e))return!1;for(let o=0;o<r.length-1;++o)if(ar(r[o],r[o+1],e))return!1;return!0}function Ri(r,e){for(let o=0;o<e.length;o++)if(Vr(r,e[o]))return!0;return!1}function So(r,e,o){const a=[];for(let u=0;u<r.length;u++){const p=[];for(let _=0;_<r[u].length;_++){const x=He(r[u][_],o);I(e,x),p.push(x)}a.push(p)}return a}function _i(r,e,o){const a=[];for(let u=0;u<r.length;u++){const p=So(r[u],e,o);a.push(p)}return a}function qs(r,e,o,a){if(r[0]<o[0]||r[0]>o[2]){const u=.5*a;let p=r[0]-o[0]>u?-a:o[0]-r[0]>u?a:0;0===p&&(p=r[0]-o[2]>u?-a:o[2]-r[0]>u?a:0),r[0]+=p}I(e,r)}function ds(r,e,o,a){const u=Math.pow(2,a.z)*k,p=[a.x*k,a.y*k],_=[];for(const x of r)for(const C of x){const D=[C.x+p[0],C.y+p[1]];qs(D,e,o,u),_.push(D)}return _}function ts(r,e,o,a){const u=Math.pow(2,a.z)*k,p=[a.x*k,a.y*k],_=[];for(const C of r){const D=[];for(const O of C){const N=[O.x+p[0],O.y+p[1]];I(e,N),D.push(N)}_.push(D)}if(e[2]-e[0]<=u/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const C of _)for(const D of C)qs(D,e,o,u)}var x;return _}class xr{constructor(e,o){this.type=Rn,this.geojson=e,this.geometries=o}static parse(e,o){if(2!==e.length)return o.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(fo(e[1])){const a=e[1];if("FeatureCollection"===a.type)for(let u=0;u<a.features.length;++u){const p=a.features[u].geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new xr(a,a.features[u].geometry)}else if("Feature"===a.type){const u=a.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new xr(a,a.geometry)}else if("Polygon"===a.type||"MultiPolygon"===a.type)return new xr(a,a)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(o,a){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=o.canonicalID();if("Polygon"===a.type){const x=So(a.coordinates,p,_),C=ds(o.geometry(),u,p,_);if(!K(u,p))return!1;for(const D of C)if(!Pn(D,x))return!1}if("MultiPolygon"===a.type){const x=_i(a.coordinates,p,_),C=ds(o.geometry(),u,p,_);if(!K(u,p))return!1;for(const D of C)if(!pr(D,x))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(o,a){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=o.canonicalID();if("Polygon"===a.type){const x=So(a.coordinates,p,_),C=ts(o.geometry(),u,p,_);if(!K(u,p))return!1;for(const D of C)if(!Vr(D,x))return!1}if("MultiPolygon"===a.type){const x=_i(a.coordinates,p,_),C=ts(o.geometry(),u,p,_);if(!K(u,p))return!1;for(const D of C)if(!Ri(D,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function ps(r){if(r instanceof G&&("get"===r.name&&1===r.args.length||"feature-state"===r.name||"has"===r.name&&1===r.args.length||"properties"===r.name||"geometry-type"===r.name||"id"===r.name||/^filter-/.test(r.name))||r instanceof xr)return!1;let e=!0;return r.eachChild(o=>{e&&!ps(o)&&(e=!1)}),e}function Ws(r){if(r instanceof G&&"feature-state"===r.name)return!1;let e=!0;return r.eachChild(o=>{e&&!Ws(o)&&(e=!1)}),e}function Ys(r,e){if(r instanceof G&&e.indexOf(r.name)>=0)return!1;let o=!0;return r.eachChild(a=>{o&&!Ys(a,e)&&(o=!1)}),o}class No{constructor(e,o){this.type=o.type,this.name=e,this.boundExpression=o}static parse(e,o){if(2!==e.length||"string"!=typeof e[1])return o.error("'var' expression requires exactly one string literal argument.");const a=e[1];return o.scope.has(a)?new No(a,o.scope.get(a)):o.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Oa{constructor(e,o=[],a,u=new Ei,p=[]){this.registry=e,this.path=o,this.key=o.map(_=>`[${_}]`).join(""),this.scope=u,this.errors=p,this.expectedType=a}parse(e,o,a,u,p={}){return o?this.concat(o,a,u)._parse(e,p):this._parse(e,p)}_parse(e,o){function a(u,p,_){return"assert"===_?new Hi(p,[u]):"coerce"===_?new Ti(p,[u]):u}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if("string"!=typeof u)return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let _=p.parse(e,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,C=_.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==C.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==C.kind&&"string"!==C.kind){if(this.checkSubtype(x,C))return null}else _=a(_,x,o.typeAnnotation||"coerce");else _=a(_,x,o.typeAnnotation||"assert")}if(!(_ instanceof qo)&&"resolvedImage"!==_.type.kind&&Ca(_)){const x=new ie;try{_=new qo(_.type,_.evaluate(x))}catch(C){return this.error(C.message),null}}return _}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,o,a){const u="number"==typeof e?this.path.concat(e):this.path,p=a?this.scope.concat(a):this.scope;return new Oa(this.registry,u,o||null,p,this.errors)}error(e,...o){const a=`${this.key}${o.map(u=>`[${u}]`).join("")}`;this.errors.push(new Gi(a,e))}checkSubtype(e,o){const a=Ii(e,o);return a&&this.error(a),a}}function Ca(r){if(r instanceof No)return Ca(r.boundExpression);if(r instanceof G&&"error"===r.name||r instanceof S||r instanceof xr)return!1;const e=r instanceof Ti||r instanceof Hi;let o=!0;return r.eachChild(a=>{o=e?o&&Ca(a):o&&a instanceof qo}),!!o&&ps(r)&&Ys(r,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Sn(r,e){const o=r.length-1;let a,u,p=0,_=o,x=0;for(;p<=_;)if(x=Math.floor((p+_)/2),a=r[x],u=r[x+1],a<=e){if(x===o||e<u)return x;p=x+1}else{if(!(a>e))throw new gi("Input is not a number.");_=x-1}return 0}class Sl{constructor(e,o,a){this.type=e,this.input=o,this.labels=[],this.outputs=[];for(const[u,p]of a)this.labels.push(u),this.outputs.push(p)}static parse(e,o){if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");const a=o.parse(e[1],1,kt);if(!a)return null;const u=[];let p=null;o.expectedType&&"value"!==o.expectedType.kind&&(p=o.expectedType);for(let _=1;_<e.length;_+=2){const x=1===_?-1/0:e[_],C=e[_+1],D=_,O=_+1;if("number"!=typeof x)return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(u.length&&u[u.length-1][0]>=x)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const N=o.parse(C,O,p);if(!N)return null;p=p||N.type,u.push([x,N])}return new Sl(p,a,u)}evaluate(e){const o=this.labels,a=this.outputs;if(1===o.length)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=o[0])return a[0].evaluate(e);const p=o.length;return u>=o[p-1]?a[p-1].evaluate(e):a[Sn(o,u)].evaluate(e)}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&e.push(this.labels[o]),e.push(this.outputs[o].serialize());return e}}function fr(r,e,o){return r*(1-o)+e*o}var Fa=Object.freeze({__proto__:null,number:fr,color:function(r,e,o){return new Jn(fr(r.r,e.r,o),fr(r.g,e.g,o),fr(r.b,e.b,o),fr(r.a,e.a,o))},array:function(r,e,o){return r.map((a,u)=>fr(a,e[u],o))}});const Pl=4/29,ca=6/29,Mt=3*ca*ca,br=Math.PI/180,Jl=180/Math.PI;function yi(r){return r>.008856451679035631?Math.pow(r,1/3):r/Mt+Pl}function La(r){return r>ca?r*r*r:Mt*(r-Pl)}function Xs(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function go(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function nl(r){const e=go(r.r),o=go(r.g),a=go(r.b),u=yi((.4124564*e+.3575761*o+.1804375*a)/.95047),p=yi((.2126729*e+.7151522*o+.072175*a)/1);return{l:116*p-16,a:500*(u-p),b:200*(p-yi((.0193339*e+.119192*o+.9503041*a)/1.08883)),alpha:r.a}}function Na(r){let e=(r.l+16)/116,o=isNaN(r.a)?e:e+r.a/500,a=isNaN(r.b)?e:e-r.b/200;return e=1*La(e),o=.95047*La(o),a=1.08883*La(a),new Jn(Xs(3.2404542*o-1.5371385*e-.4985314*a),Xs(-.969266*o+1.8760108*e+.041556*a),Xs(.0556434*o-.2040259*e+1.0572252*a),r.alpha)}function Rl(r,e,o){const a=e-r;return r+o*(a>180||a<-180?a-360*Math.round(a/360):a)}const za={forward:nl,reverse:Na,interpolate:function(r,e,o){return{l:fr(r.l,e.l,o),a:fr(r.a,e.a,o),b:fr(r.b,e.b,o),alpha:fr(r.alpha,e.alpha,o)}}},Ks={forward:function(r){const{l:e,a:o,b:a}=nl(r),u=Math.atan2(a,o)*Jl;return{h:u<0?u+360:u,c:Math.sqrt(o*o+a*a),l:e,alpha:r.a}},reverse:function(r){const e=r.h*br,o=r.c;return Na({l:r.l,a:Math.cos(e)*o,b:Math.sin(e)*o,alpha:r.alpha})},interpolate:function(r,e,o){return{h:Rl(r.h,e.h,o),c:fr(r.c,e.c,o),l:fr(r.l,e.l,o),alpha:fr(r.alpha,e.alpha,o)}}};var Js=Object.freeze({__proto__:null,lab:za,hcl:Ks});class Y{constructor(e,o,a,u,p){this.type=e,this.operator=o,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[_,x]of p)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(e,o,a,u){let p=0;if("exponential"===e.name)p=te(o,e.base,a,u);else if("linear"===e.name)p=te(o,1,a,u);else if("cubic-bezier"===e.name){const _=e.controlPoints;p=new nt(_[0],_[1],_[2],_[3]).solve(te(o,1,a,u))}return p}static parse(e,o){let[a,u,p,..._]=e;if(!Array.isArray(u)||0===u.length)return o.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const D=u[1];if("number"!=typeof D)return o.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:D}}else{if("cubic-bezier"!==u[0])return o.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const D=u.slice(1);if(4!==D.length||D.some(O=>"number"!=typeof O||O<0||O>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:D}}}if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(p=o.parse(p,2,kt),!p)return null;const x=[];let C=null;"interpolate-hcl"===a||"interpolate-lab"===a?C=mi:o.expectedType&&"value"!==o.expectedType.kind&&(C=o.expectedType);for(let D=0;D<_.length;D+=2){const O=_[D],N=_[D+1],B=D+3,X=D+4;if("number"!=typeof O)return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(x.length&&x[x.length-1][0]>=O)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const ne=o.parse(N,X,C);if(!ne)return null;C=C||ne.type,x.push([O,ne])}return"number"===C.kind||"color"===C.kind||"array"===C.kind&&"number"===C.itemType.kind&&"number"==typeof C.N?new Y(C,a,u,p,x):o.error(`Type ${Dr(C)} is not interpolatable.`)}evaluate(e){const o=this.labels,a=this.outputs;if(1===o.length)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=o[0])return a[0].evaluate(e);const p=o.length;if(u>=o[p-1])return a[p-1].evaluate(e);const _=Sn(o,u),x=Y.interpolationFactor(this.interpolation,u,o[_],o[_+1]),C=a[_].evaluate(e),D=a[_+1].evaluate(e);return"interpolate"===this.operator?Fa[this.type.kind.toLowerCase()](C,D,x):"interpolate-hcl"===this.operator?Ks.reverse(Ks.interpolate(Ks.forward(C),Ks.forward(D),x)):za.reverse(za.interpolate(za.forward(C),za.forward(D),x))}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)o.push(this.labels[a],this.outputs[a].serialize());return o}}function te(r,e,o,a){const u=a-o,p=r-o;return 0===u?0:1===e?p/u:(Math.pow(e,p)-1)/(Math.pow(e,u)-1)}class F{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expectected at least one argument.");let a=null;const u=o.expectedType;u&&"value"!==u.kind&&(a=u);const p=[];for(const x of e.slice(1)){const C=o.parse(x,1+p.length,a,void 0,{typeAnnotation:"omit"});if(!C)return null;a=a||C.type,p.push(C)}const _=u&&p.some(x=>Ii(u,x.type));return new F(_?Fn:a,p)}evaluate(e){let o,a=null,u=0;for(const p of this.args){if(u++,a=p.evaluate(e),a&&a instanceof Pi&&!a.available&&(o||(o=a),a=null,u===this.args.length))return o;if(null!==a)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(o=>{e.push(o.serialize())}),e}}class ee{constructor(e,o){this.type=o.type,this.bindings=[].concat(e),this.result=o}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const o of this.bindings)e(o[1]);e(this.result)}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let p=1;p<e.length-1;p+=2){const _=e[p];if("string"!=typeof _)return o.error(`Expected string, but found ${typeof _} instead.`,p);if(/[^a-zA-Z0-9_]/.test(_))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);const x=o.parse(e[p+1],p+1);if(!x)return null;a.push([_,x])}const u=o.parse(e[e.length-1],e.length-1,o.expectedType,a);return u?new ee(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[o,a]of this.bindings)e.push(o,a.serialize());return e.push(this.result.serialize()),e}}class Te{constructor(e,o,a){this.type=e,this.index=o,this.input=a}static parse(e,o){if(3!==e.length)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=o.parse(e[1],1,kt),u=o.parse(e[2],2,ui(o.expectedType||Fn));return a&&u?new Te(u.type.itemType,a,u):null}evaluate(e){const o=this.index.evaluate(e),a=this.input.evaluate(e);if(o<0)throw new gi(`Array index out of bounds: ${o} < 0.`);if(o>=a.length)throw new gi(`Array index out of bounds: ${o} > ${a.length-1}.`);if(o!==Math.floor(o))throw new gi(`Array index must be an integer, but found ${o} instead.`);return a[o]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class it{constructor(e,o){this.type=Rn,this.needle=e,this.haystack=o}static parse(e,o){if(3!==e.length)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=o.parse(e[1],1,Fn),u=o.parse(e[2],2,Fn);return a&&u?Go(a.type,[Rn,Bn,kt,Si,Fn])?new it(a,u):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(a.type)} instead`):null}evaluate(e){const o=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!Do(o,["boolean","string","number","null"]))throw new gi(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(Ar(o))} instead.`);if(!Do(a,["string","array"]))throw new gi(`Expected second argument to be of type array or string, but found ${Dr(Ar(a))} instead.`);return a.indexOf(o)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Et{constructor(e,o,a){this.type=kt,this.needle=e,this.haystack=o,this.fromIndex=a}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=o.parse(e[1],1,Fn),u=o.parse(e[2],2,Fn);if(!a||!u)return null;if(!Go(a.type,[Rn,Bn,kt,Si,Fn]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(a.type)} instead`);if(4===e.length){const p=o.parse(e[3],3,kt);return p?new Et(a,u,p):null}return new Et(a,u)}evaluate(e){const o=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Do(o,["boolean","string","number","null"]))throw new gi(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(Ar(o))} instead.`);if(!Do(a,["string","array"]))throw new gi(`Expected second argument to be of type array or string, but found ${Dr(Ar(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return a.indexOf(o,u)}return a.indexOf(o)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class jn{constructor(e,o,a,u,p,_){this.inputType=e,this.type=o,this.input=a,this.cases=u,this.outputs=p,this.otherwise=_}static parse(e,o){if(e.length<5)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return o.error("Expected an even number of arguments.");let a,u;o.expectedType&&"value"!==o.expectedType.kind&&(u=o.expectedType);const p={},_=[];for(let D=2;D<e.length-1;D+=2){let O=e[D];const N=e[D+1];Array.isArray(O)||(O=[O]);const B=o.concat(D);if(0===O.length)return B.error("Expected at least one branch label.");for(const ne of O){if("number"!=typeof ne&&"string"!=typeof ne)return B.error("Branch labels must be numbers or strings.");if("number"==typeof ne&&Math.abs(ne)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof ne&&Math.floor(ne)!==ne)return B.error("Numeric branch labels must be integer values.");if(a){if(B.checkSubtype(a,Ar(ne)))return null}else a=Ar(ne);if(void 0!==p[String(ne)])return B.error("Branch labels must be unique.");p[String(ne)]=_.length}const X=o.parse(N,D,u);if(!X)return null;u=u||X.type,_.push(X)}const x=o.parse(e[1],1,Fn);if(!x)return null;const C=o.parse(e[e.length-1],e.length-1,u);return C?"value"!==x.type.kind&&o.concat(1).checkSubtype(a,x.type)?null:new jn(a,u,x,p,_,C):null}evaluate(e){const o=this.input.evaluate(e);return(Ar(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),a=[],u={};for(const _ of o){const x=u[this.cases[_]];void 0===x?(u[this.cases[_]]=a.length,a.push([this.cases[_],[_]])):a[x][1].push(_)}const p=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,x]of a)e.push(1===x.length?p(x[0]):x.map(p)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class Pr{constructor(e,o,a){this.type=e,this.branches=o,this.otherwise=a}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return o.error("Expected an odd number of arguments.");let a;o.expectedType&&"value"!==o.expectedType.kind&&(a=o.expectedType);const u=[];for(let _=1;_<e.length-1;_+=2){const x=o.parse(e[_],_,Rn);if(!x)return null;const C=o.parse(e[_+1],_+1,a);if(!C)return null;u.push([x,C]),a=a||C.type}const p=o.parse(e[e.length-1],e.length-1,a);return p?new Pr(a,u,p):null}evaluate(e){for(const[o,a]of this.branches)if(o.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[o,a]of this.branches)e(o),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(o=>{e.push(o.serialize())}),e}}class qi{constructor(e,o,a,u){this.type=e,this.input=o,this.beginIndex=a,this.endIndex=u}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=o.parse(e[1],1,Fn),u=o.parse(e[2],2,kt);if(!a||!u)return null;if(!Go(a.type,[ui(Fn),Bn,Fn]))return o.error(`Expected first argument to be of type array or string, but found ${Dr(a.type)} instead`);if(4===e.length){const p=o.parse(e[3],3,kt);return p?new qi(a.type,a,u,p):null}return new qi(a.type,a,u)}evaluate(e){const o=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Do(o,["string","array"]))throw new gi(`Expected first argument to be of type array or string, but found ${Dr(Ar(o))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return o.slice(a,u)}return o.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ws(r,e){return"=="===r||"!="===r?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Cs(r,e,o,a){return 0===a.compare(e,o)}function zo(r,e,o){const a="=="!==r&&"!="!==r;return class m1{constructor(p,_,x){this.type=Rn,this.lhs=p,this.rhs=_,this.collator=x,this.hasUntypedArgument="value"===p.type.kind||"value"===_.type.kind}static parse(p,_){if(3!==p.length&&4!==p.length)return _.error("Expected two or three arguments.");const x=p[0];let C=_.parse(p[1],1,Fn);if(!C)return null;if(!ws(x,C.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${Dr(C.type)}'.`);let D=_.parse(p[2],2,Fn);if(!D)return null;if(!ws(x,D.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${Dr(D.type)}'.`);if(C.type.kind!==D.type.kind&&"value"!==C.type.kind&&"value"!==D.type.kind)return _.error(`Cannot compare types '${Dr(C.type)}' and '${Dr(D.type)}'.`);a&&("value"===C.type.kind&&"value"!==D.type.kind?C=new Hi(D.type,[C]):"value"!==C.type.kind&&"value"===D.type.kind&&(D=new Hi(C.type,[D])));let O=null;if(4===p.length){if("string"!==C.type.kind&&"string"!==D.type.kind&&"value"!==C.type.kind&&"value"!==D.type.kind)return _.error("Cannot use collator to compare non-string types.");if(O=_.parse(p[3],3,Zo),!O)return null}return new m1(C,D,O)}evaluate(p){const _=this.lhs.evaluate(p),x=this.rhs.evaluate(p);if(a&&this.hasUntypedArgument){const C=Ar(_),D=Ar(x);if(C.kind!==D.kind||"string"!==C.kind&&"number"!==C.kind)throw new gi(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${C.kind}, ${D.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const C=Ar(_),D=Ar(x);if("string"!==C.kind||"string"!==D.kind)return e(p,_,x)}return this.collator?o(p,_,x,this.collator.evaluate(p)):e(p,_,x)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[r];return this.eachChild(_=>{p.push(_.serialize())}),p}}}const hu=zo("==",function(r,e,o){return e===o},Cs),kl=zo("!=",function(r,e,o){return e!==o},function(r,e,o,a){return!Cs(0,e,o,a)}),rl=zo("<",function(r,e,o){return e<o},function(r,e,o,a){return a.compare(e,o)<0}),Pc=zo(">",function(r,e,o){return e>o},function(r,e,o,a){return a.compare(e,o)>0}),Ql=zo("<=",function(r,e,o){return e<=o},function(r,e,o,a){return a.compare(e,o)<=0}),Rc=zo(">=",function(r,e,o){return e>=o},function(r,e,o,a){return a.compare(e,o)>=0});class Ol{constructor(e,o,a,u,p){this.type=Bn,this.number=e,this.locale=o,this.currency=a,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(e,o){if(3!==e.length)return o.error("Expected two arguments.");const a=o.parse(e[1],1,kt);if(!a)return null;const u=e[2];if("object"!=typeof u||Array.isArray(u))return o.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=o.parse(u.locale,1,Bn),!p))return null;let _=null;if(u.currency&&(_=o.parse(u.currency,1,Bn),!_))return null;let x=null;if(u["min-fraction-digits"]&&(x=o.parse(u["min-fraction-digits"],1,kt),!x))return null;let C=null;return u["max-fraction-digits"]&&(C=o.parse(u["max-fraction-digits"],1,kt),!C)?null:new Ol(a,p,_,x,C)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ea{constructor(e){this.type=kt,this.input=e}static parse(e,o){if(2!==e.length)return o.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=o.parse(e[1],1);return a?"array"!==a.type.kind&&"string"!==a.type.kind&&"value"!==a.type.kind?o.error(`Expected argument of type string or array, but found ${Dr(a.type)} instead.`):new Ea(a):null}evaluate(e){const o=this.input.evaluate(e);if("string"==typeof o||Array.isArray(o))return o.length;throw new gi(`Expected value to be of type string or array, but found ${Dr(Ar(o))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(o=>{e.push(o.serialize())}),e}}const Qs={"==":hu,"!=":kl,">":Pc,"<":rl,">=":Rc,"<=":Ql,array:Hi,at:Te,boolean:Hi,case:Pr,coalesce:F,collator:S,format:Mo,image:mo,in:it,"index-of":Et,interpolate:Y,"interpolate-hcl":Y,"interpolate-lab":Y,length:Ea,let:ee,literal:qo,match:jn,number:Hi,"number-format":Ol,object:Hi,slice:qi,step:Sl,string:Hi,"to-boolean":Ti,"to-color":Ti,"to-number":Ti,"to-string":Ti,var:No,within:xr};function ec(r,[e,o,a,u]){e=e.evaluate(r),o=o.evaluate(r),a=a.evaluate(r);const p=u?u.evaluate(r):1,_=ka(e,o,a,p);if(_)throw new gi(_);return new Jn(e/255*p,o/255*p,a/255*p,p)}function _o(r,e){return r in e}function ms(r,e){const o=e[r];return void 0===o?null:o}function Hr(r){return{type:r}}function du(r){return{result:"success",value:r}}function ua(r){return{result:"error",value:r}}function il(r){return"data-driven"===r["property-type"]||"cross-faded-data-driven"===r["property-type"]}function pu(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function kc(r){return!!r.expression&&r.expression.interpolated}function wr(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":null===r?"null":typeof r}function Ba(r){return"object"==typeof r&&null!==r&&!Array.isArray(r)}function Va(r){return r}function Ta(r,e){const o="color"===e.type,a=r.stops&&"object"==typeof r.stops[0][0],u=a||!(a||void 0!==r.property),p=r.type||(kc(e)?"exponential":"interval");if(o&&((r=Qo({},r)).stops&&(r.stops=r.stops.map(D=>[D[0],Jn.parse(D[1])])),r.default=Jn.parse(r.default?r.default:e.default)),r.colorSpace&&"rgb"!==r.colorSpace&&!Js[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let _,x,C;if("exponential"===p)_=ns;else if("interval"===p)_=zu;else if("categorical"===p){_=ol,x=Object.create(null);for(const D of r.stops)x[D[0]]=D[1];C=typeof r.stops[0][0]}else{if("identity"!==p)throw new Error(`Unknown function type "${p}"`);_=Fl}if(a){const D={},O=[];for(let X=0;X<r.stops.length;X++){const ne=r.stops[X],ae=ne[0].zoom;void 0===D[ae]&&(D[ae]={zoom:ae,type:r.type,property:r.property,default:r.default,stops:[]},O.push(ae)),D[ae].stops.push([ne[0].value,ne[1]])}const N=[];for(const X of O)N.push([D[X].zoom,Ta(D[X],e)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:Y.interpolationFactor.bind(void 0,B),zoomStops:N.map(X=>X[0]),evaluate:({zoom:X},ne)=>ns({stops:N,base:r.base},e,X).evaluate(X,ne)}}if(u){const D="exponential"===p?{name:"exponential",base:void 0!==r.base?r.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Y.interpolationFactor.bind(void 0,D),zoomStops:r.stops.map(O=>O[0]),evaluate:({zoom:O})=>_(r,e,O,x,C)}}return{kind:"source",evaluate(D,O){const N=O&&O.properties?O.properties[r.property]:void 0;return void 0===N?zi(r.default,e.default):_(r,e,N,x,C)}}}function zi(r,e,o){return void 0!==r?r:void 0!==e?e:void 0!==o?o:void 0}function ol(r,e,o,a,u){return zi(typeof o===u?a[o]:void 0,r.default,e.default)}function zu(r,e,o){if("number"!==wr(o))return zi(r.default,e.default);const a=r.stops.length;if(1===a||o<=r.stops[0][0])return r.stops[0][1];if(o>=r.stops[a-1][0])return r.stops[a-1][1];const u=Sn(r.stops.map(p=>p[0]),o);return r.stops[u][1]}function ns(r,e,o){const a=void 0!==r.base?r.base:1;if("number"!==wr(o))return zi(r.default,e.default);const u=r.stops.length;if(1===u||o<=r.stops[0][0])return r.stops[0][1];if(o>=r.stops[u-1][0])return r.stops[u-1][1];const p=Sn(r.stops.map(O=>O[0]),o),_=function(O,N,B,X){const ne=X-B,ae=O-B;return 0===ne?0:1===N?ae/ne:(Math.pow(N,ae)-1)/(Math.pow(N,ne)-1)}(o,a,r.stops[p][0],r.stops[p+1][0]),x=r.stops[p][1],C=r.stops[p+1][1];let D=Fa[e.type]||Va;if(r.colorSpace&&"rgb"!==r.colorSpace){const O=Js[r.colorSpace];D=(N,B)=>O.reverse(O.interpolate(O.forward(N),O.forward(B),_))}return"function"==typeof x.evaluate?{evaluate(...O){const N=x.evaluate.apply(void 0,O),B=C.evaluate.apply(void 0,O);if(void 0!==N&&void 0!==B)return D(N,B,_)}}:D(x,C,_)}function Fl(r,e,o){return"color"===e.type?o=Jn.parse(o):"formatted"===e.type?o=mn.fromString(o.toString()):"resolvedImage"===e.type?o=Pi.fromString(o.toString()):wr(o)===e.type||"enum"===e.type&&e.values[o]||(o=void 0),zi(o,r.default,e.default)}G.register(Qs,{error:[{kind:"error"},[Bn],(r,[e])=>{throw new gi(e.evaluate(r))}],typeof:[Bn,[Fn],(r,[e])=>Dr(Ar(e.evaluate(r)))],"to-rgba":[ui(kt,4),[mi],(r,[e])=>e.evaluate(r).toArray()],rgb:[mi,[kt,kt,kt],ec],rgba:[mi,[kt,kt,kt,kt],ec],has:{type:Rn,overloads:[[[Bn],(r,[e])=>_o(e.evaluate(r),r.properties())],[[Bn,ho],(r,[e,o])=>_o(e.evaluate(r),o.evaluate(r))]]},get:{type:Fn,overloads:[[[Bn],(r,[e])=>ms(e.evaluate(r),r.properties())],[[Bn,ho],(r,[e,o])=>ms(e.evaluate(r),o.evaluate(r))]]},"feature-state":[Fn,[Bn],(r,[e])=>ms(e.evaluate(r),r.featureState||{})],properties:[ho,[],r=>r.properties()],"geometry-type":[Bn,[],r=>r.geometryType()],id:[Fn,[],r=>r.id()],zoom:[kt,[],r=>r.globals.zoom],pitch:[kt,[],r=>r.globals.pitch||0],"distance-from-center":[kt,[],r=>r.distanceFromCenter()],"heatmap-density":[kt,[],r=>r.globals.heatmapDensity||0],"line-progress":[kt,[],r=>r.globals.lineProgress||0],"sky-radial-progress":[kt,[],r=>r.globals.skyRadialProgress||0],accumulated:[Fn,[],r=>void 0===r.globals.accumulated?null:r.globals.accumulated],"+":[kt,Hr(kt),(r,e)=>{let o=0;for(const a of e)o+=a.evaluate(r);return o}],"*":[kt,Hr(kt),(r,e)=>{let o=1;for(const a of e)o*=a.evaluate(r);return o}],"-":{type:kt,overloads:[[[kt,kt],(r,[e,o])=>e.evaluate(r)-o.evaluate(r)],[[kt],(r,[e])=>-e.evaluate(r)]]},"/":[kt,[kt,kt],(r,[e,o])=>e.evaluate(r)/o.evaluate(r)],"%":[kt,[kt,kt],(r,[e,o])=>e.evaluate(r)%o.evaluate(r)],ln2:[kt,[],()=>Math.LN2],pi:[kt,[],()=>Math.PI],e:[kt,[],()=>Math.E],"^":[kt,[kt,kt],(r,[e,o])=>Math.pow(e.evaluate(r),o.evaluate(r))],sqrt:[kt,[kt],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[kt,[kt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[kt,[kt],(r,[e])=>Math.log(e.evaluate(r))],log2:[kt,[kt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[kt,[kt],(r,[e])=>Math.sin(e.evaluate(r))],cos:[kt,[kt],(r,[e])=>Math.cos(e.evaluate(r))],tan:[kt,[kt],(r,[e])=>Math.tan(e.evaluate(r))],asin:[kt,[kt],(r,[e])=>Math.asin(e.evaluate(r))],acos:[kt,[kt],(r,[e])=>Math.acos(e.evaluate(r))],atan:[kt,[kt],(r,[e])=>Math.atan(e.evaluate(r))],min:[kt,Hr(kt),(r,e)=>Math.min(...e.map(o=>o.evaluate(r)))],max:[kt,Hr(kt),(r,e)=>Math.max(...e.map(o=>o.evaluate(r)))],abs:[kt,[kt],(r,[e])=>Math.abs(e.evaluate(r))],round:[kt,[kt],(r,[e])=>{const o=e.evaluate(r);return o<0?-Math.round(-o):Math.round(o)}],floor:[kt,[kt],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[kt,[kt],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Rn,[Bn,Fn],(r,[e,o])=>r.properties()[e.value]===o.value],"filter-id-==":[Rn,[Fn],(r,[e])=>r.id()===e.value],"filter-type-==":[Rn,[Bn],(r,[e])=>r.geometryType()===e.value],"filter-<":[Rn,[Bn,Fn],(r,[e,o])=>{const a=r.properties()[e.value],u=o.value;return typeof a==typeof u&&a<u}],"filter-id-<":[Rn,[Fn],(r,[e])=>{const o=r.id(),a=e.value;return typeof o==typeof a&&o<a}],"filter->":[Rn,[Bn,Fn],(r,[e,o])=>{const a=r.properties()[e.value],u=o.value;return typeof a==typeof u&&a>u}],"filter-id->":[Rn,[Fn],(r,[e])=>{const o=r.id(),a=e.value;return typeof o==typeof a&&o>a}],"filter-<=":[Rn,[Bn,Fn],(r,[e,o])=>{const a=r.properties()[e.value],u=o.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[Rn,[Fn],(r,[e])=>{const o=r.id(),a=e.value;return typeof o==typeof a&&o<=a}],"filter->=":[Rn,[Bn,Fn],(r,[e,o])=>{const a=r.properties()[e.value],u=o.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[Rn,[Fn],(r,[e])=>{const o=r.id(),a=e.value;return typeof o==typeof a&&o>=a}],"filter-has":[Rn,[Fn],(r,[e])=>e.value in r.properties()],"filter-has-id":[Rn,[],r=>null!==r.id()&&void 0!==r.id()],"filter-type-in":[Rn,[ui(Bn)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Rn,[ui(Fn)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Rn,[Bn,ui(Fn)],(r,[e,o])=>o.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Rn,[Bn,ui(Fn)],(r,[e,o])=>function(a,u,p,_){for(;p<=_;){const x=p+_>>1;if(u[x]===a)return!0;u[x]>a?_=x-1:p=x+1}return!1}(r.properties()[e.value],o.value,0,o.value.length-1)],all:{type:Rn,overloads:[[[Rn,Rn],(r,[e,o])=>e.evaluate(r)&&o.evaluate(r)],[Hr(Rn),(r,e)=>{for(const o of e)if(!o.evaluate(r))return!1;return!0}]]},any:{type:Rn,overloads:[[[Rn,Rn],(r,[e,o])=>e.evaluate(r)||o.evaluate(r)],[Hr(Rn),(r,e)=>{for(const o of e)if(o.evaluate(r))return!0;return!1}]]},"!":[Rn,[Rn],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Rn,[Bn],(r,[e])=>{const o=r.globals&&r.globals.isSupportedScript;return!o||o(e.evaluate(r))}],upcase:[Bn,[Bn],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Bn,[Bn],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Bn,Hr(Fn),(r,e)=>e.map(o=>Wr(o.evaluate(r))).join("")],"resolved-locale":[Bn,[Zo],(r,[e])=>e.evaluate(r).resolvedLocale()]});class Oc{constructor(e,o){var a;this.expression=e,this._warningHistory={},this._evaluator=new ie,this._defaultValue=o?"color"===(a=o).type&&Ba(a.default)?new Jn(0,0,0,0):"color"===a.type?Jn.parse(a.default)||null:void 0===a.default?null:a.default:null,this._enumValues=o&&"enum"===o.type?o.values:null}evaluateWithoutErrorHandling(e,o,a,u,p,_,x,C){return this._evaluator.globals=e,this._evaluator.feature=o,this._evaluator.featureState=a,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(e,o,a,u,p,_,x,C){this._evaluator.globals=e,this._evaluator.feature=o||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=C||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new gi(`Expected value to be one of ${Object.keys(this._enumValues).map(O=>JSON.stringify(O)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,"undefined"!=typeof console&&console.warn(D.message)),this._defaultValue}}}function sl(r){return Array.isArray(r)&&r.length>0&&"string"==typeof r[0]&&r[0]in Qs}function ha(r,e){const o=new Oa(Qs,[],e?function(u){const p={color:mi,string:Bn,number:kt,enum:Bn,boolean:Rn,formatted:es,resolvedImage:To};return"array"===u.type?ui(p[u.value]||Fn,u.length):p[u.type]}(e):void 0),a=o.parse(r,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return a?du(new Oc(a,e)):ua(o.errors)}class Da{constructor(e,o){this.kind=e,this._styleExpression=o,this.isStateDependent="constant"!==e&&!Ws(o.expression)}evaluateWithoutErrorHandling(e,o,a,u,p,_){return this._styleExpression.evaluateWithoutErrorHandling(e,o,a,u,p,_)}evaluate(e,o,a,u,p,_){return this._styleExpression.evaluate(e,o,a,u,p,_)}}class Fc{constructor(e,o,a,u){this.kind=e,this.zoomStops=a,this._styleExpression=o,this.isStateDependent="camera"!==e&&!Ws(o.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,o,a,u,p,_){return this._styleExpression.evaluateWithoutErrorHandling(e,o,a,u,p,_)}evaluate(e,o,a,u,p,_){return this._styleExpression.evaluate(e,o,a,u,p,_)}interpolationFactor(e,o,a){return this.interpolationType?Y.interpolationFactor(this.interpolationType,e,o,a):0}}function fu(r,e){if("error"===(r=ha(r,e)).result)return r;const o=r.value.expression,a=ps(o);if(!a&&!il(e))return ua([new Gi("","data expressions not supported")]);const u=Ys(o,["zoom","pitch","distance-from-center"]);if(!u&&!pu(e))return ua([new Gi("","zoom expressions not supported")]);const p=Lc(o);return p||u?p instanceof Gi?ua([p]):p instanceof Y&&!kc(e)?ua([new Gi("",'"interpolate" expressions cannot be used with this property')]):du(p?new Fc(a?"camera":"composite",r.value,p.labels,p instanceof Y?p.interpolation:void 0):new Da(a?"constant":"source",r.value)):ua([new Gi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ro{constructor(e,o){this._parameters=e,this._specification=o,Qo(this,Ta(this._parameters,this._specification))}static deserialize(e){return new ro(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Lc(r){let e=null;if(r instanceof ee)e=Lc(r.result);else if(r instanceof F){for(const o of r.args)if(e=Lc(o),e)break}else(r instanceof Sl||r instanceof Y)&&r.input instanceof G&&"zoom"===r.input.name&&(e=r);return e instanceof Gi||r.eachChild(o=>{const a=Lc(o);a instanceof Gi?e=a:!e&&a?e=new Gi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new Gi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function yo(r){const e=r.key,o=r.value,a=r.valueSpec||{},u=r.objectElementValidators||{},p=r.style,_=r.styleSpec;let x=[];const C=wr(o);if("object"!==C)return[new zt(e,o,`object expected, ${C} found`)];for(const D in o){const O=D.split(".")[0],N=a[O]||a["*"];let B;if(u[O])B=u[O];else if(a[O])B=L;else if(u["*"])B=u["*"];else{if(!a["*"]){x.push(new zt(e,o[D],`unknown property "${D}"`));continue}B=L}x=x.concat(B({key:(e&&`${e}.`)+D,value:o[D],valueSpec:N,style:p,styleSpec:_,object:o,objectKey:D},o))}for(const D in a)u[D]||a[D].required&&void 0===a[D].default&&void 0===o[D]&&x.push(new zt(e,o,`missing required property "${D}"`));return x}function Ua(r){const e=r.value,o=r.valueSpec,a=r.style,u=r.styleSpec,p=r.key,_=r.arrayElementValidator||L;if("array"!==wr(e))return[new zt(p,e,`array expected, ${wr(e)} found`)];if(o.length&&e.length!==o.length)return[new zt(p,e,`array length ${o.length} expected, length ${e.length} found`)];if(o["min-length"]&&e.length<o["min-length"])return[new zt(p,e,`array length at least ${o["min-length"]} expected, length ${e.length} found`)];let x={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum};u.$version<7&&(x.function=o.function),"object"===wr(o.value)&&(x=o.value);let C=[];for(let D=0;D<e.length;D++)C=C.concat(_({array:e,arrayIndex:D,value:e[D],valueSpec:x,style:a,styleSpec:u,key:`${p}[${D}]`}));return C}function ja(r){const e=r.key,o=r.value,a=r.valueSpec;let u=wr(o);if("number"===u&&o!=o&&(u="NaN"),"number"!==u)return[new zt(e,o,`number expected, ${u} found`)];if("minimum"in a){let p=a.minimum;if("array"===wr(a.minimum)&&(p=a.minimum[r.arrayIndex]),o<p)return[new zt(e,o,`${o} is less than the minimum value ${p}`)]}if("maximum"in a){let p=a.maximum;if("array"===wr(a.maximum)&&(p=a.maximum[r.arrayIndex]),o>p)return[new zt(e,o,`${o} is greater than the maximum value ${p}`)]}return[]}function Es(r){const e=r.valueSpec,o=nr(r.value.type);let a,u,p,_={};const x="categorical"!==o&&void 0===r.value.property,C=!x,D="array"===wr(r.value.stops)&&"array"===wr(r.value.stops[0])&&"object"===wr(r.value.stops[0][0]),O=yo({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(X){if("identity"===o)return[new zt(X.key,X.value,'identity function may not have a "stops" property')];let ne=[];const ae=X.value;return ne=ne.concat(Ua({key:X.key,value:ae,valueSpec:X.valueSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:N})),"array"===wr(ae)&&0===ae.length&&ne.push(new zt(X.key,ae,"array must have at least one stop")),ne},default:function(X){return L({key:X.key,value:X.value,valueSpec:e,style:X.style,styleSpec:X.styleSpec})}}});return"identity"===o&&x&&O.push(new zt(r.key,r.value,'missing required property "property"')),"identity"===o||r.value.stops||O.push(new zt(r.key,r.value,'missing required property "stops"')),"exponential"===o&&r.valueSpec.expression&&!kc(r.valueSpec)&&O.push(new zt(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(C&&!il(r.valueSpec)?O.push(new zt(r.key,r.value,"property functions not supported")):x&&!pu(r.valueSpec)&&O.push(new zt(r.key,r.value,"zoom functions not supported"))),"categorical"!==o&&!D||void 0!==r.value.property||O.push(new zt(r.key,r.value,'"property" property is required')),O;function N(X){let ne=[];const ae=X.value,le=X.key;if("array"!==wr(ae))return[new zt(le,ae,`array expected, ${wr(ae)} found`)];if(2!==ae.length)return[new zt(le,ae,`array length 2 expected, length ${ae.length} found`)];if(D){if("object"!==wr(ae[0]))return[new zt(le,ae,`object expected, ${wr(ae[0])} found`)];if(void 0===ae[0].zoom)return[new zt(le,ae,"object stop key must have zoom")];if(void 0===ae[0].value)return[new zt(le,ae,"object stop key must have value")];if(p&&p>nr(ae[0].zoom))return[new zt(le,ae[0].zoom,"stop zoom values must appear in ascending order")];nr(ae[0].zoom)!==p&&(p=nr(ae[0].zoom),u=void 0,_={}),ne=ne.concat(yo({key:`${le}[0]`,value:ae[0],valueSpec:{zoom:{}},style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:ja,value:B}}))}else ne=ne.concat(B({key:`${le}[0]`,value:ae[0],valueSpec:{},style:X.style,styleSpec:X.styleSpec},ae));return sl(ti(ae[1]))?ne.concat([new zt(`${le}[1]`,ae[1],"expressions are not allowed in function stops.")]):ne.concat(L({key:`${le}[1]`,value:ae[1],valueSpec:e,style:X.style,styleSpec:X.styleSpec}))}function B(X,ne){const ae=wr(X.value),le=nr(X.value),ye=null!==X.value?X.value:ne;if(a){if(ae!==a)return[new zt(X.key,ye,`${ae} stop domain type must match previous stop domain type ${a}`)]}else a=ae;if("number"!==ae&&"string"!==ae&&"boolean"!==ae)return[new zt(X.key,ye,"stop domain value must be a number, string, or boolean")];if("number"!==ae&&"categorical"!==o){let De=`number expected, ${ae} found`;return il(e)&&void 0===o&&(De+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new zt(X.key,ye,De)]}return"categorical"!==o||"number"!==ae||isFinite(le)&&Math.floor(le)===le?"categorical"!==o&&"number"===ae&&void 0!==u&&le<u?[new zt(X.key,ye,"stop domain values must appear in ascending order")]:(u=le,"categorical"===o&&le in _?[new zt(X.key,ye,"stop domain values must be unique")]:(_[le]=!0,[])):[new zt(X.key,ye,`integer expected, found ${le}`)]}}function ea(r){const e=("property"===r.expressionContext?fu:ha)(ti(r.value),r.valueSpec);if("error"===e.result)return e.value.map(a=>new zt(`${r.key}${a.key}`,r.value,a.message));const o=e.value.expression||e.value._styleExpression.expression;if("property"===r.expressionContext&&"text-font"===r.propertyKey&&!o.outputDefined())return[new zt(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===r.expressionContext&&"layout"===r.propertyType&&!Ws(o))return[new zt(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===r.expressionContext)return tc(o,r);if(r.expressionContext&&0===r.expressionContext.indexOf("cluster")){if(!Ys(o,["zoom","feature-state"]))return[new zt(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===r.expressionContext&&!ps(o))return[new zt(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function tc(r,e){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const u of e.valueSpec.expression.parameters)o.delete(u);if(0===o.size)return[];const a=[];return r instanceof G&&o.has(r.name)?[new zt(e.key,e.value,`["${r.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(r.eachChild(u=>{a.push(...tc(u,e))}),a)}function Ls(r){const e=r.key,o=r.value,a=r.valueSpec,u=[];return Array.isArray(a.values)?-1===a.values.indexOf(nr(o))&&u.push(new zt(e,o,`expected one of [${a.values.join(", ")}], ${JSON.stringify(o)} found`)):-1===Object.keys(a.values).indexOf(nr(o))&&u.push(new zt(e,o,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(o)} found`)),u}function nc(r){if(!0===r||!1===r)return!0;if(!Array.isArray(r)||0===r.length)return!1;switch(r[0]){case"has":return r.length>=2&&"$id"!==r[1]&&"$type"!==r[1];case"in":return r.length>=3&&("string"!=typeof r[1]||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==r.length||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!nc(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function ta(r,e="fill"){if(null==r)return{filter:()=>!0,needGeometry:!1,needFeature:!1};nc(r)||(r=Ll(r));const o=r;let a=!0;try{a=function(D){if(!cl(D))return D;let O=ti(D);return ll(O),O=al(O),O}(o)}catch(D){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(o,null,2)}\n        `)}const u=rt[`filter_${e}`],p=ha(a,u);let _=null;if("error"===p.result)throw new Error(p.value.map(D=>`${D.key}: ${D.message}`).join(", "));_=(D,O,N)=>p.value.evaluate(D,O,{},N);let x=null,C=null;if(a!==o){const D=ha(o,u);if("error"===D.result)throw new Error(D.value.map(O=>`${O.key}: ${O.message}`).join(", "));x=(O,N,B,X,ne)=>D.value.evaluate(O,N,{},B,void 0,void 0,X,ne),C=!ps(D.value.expression)}return _=_,{filter:_,dynamicFilter:x||void 0,needGeometry:da(a),needFeature:!!C}}function al(r){if(!Array.isArray(r))return r;const e=function(o){if(rc.has(o[0]))for(let a=1;a<o.length;a++)if(cl(o[a]))return!0;return o}(r);return!0===e?e:e.map(o=>al(o))}function ll(r){let e=!1;const o=[];if("case"===r[0]){for(let a=1;a<r.length-1;a+=2)e=e||cl(r[a]),o.push(r[a+1]);o.push(r[r.length-1])}else if("match"===r[0]){e=e||cl(r[1]);for(let a=2;a<r.length-1;a+=2)o.push(r[a+1]);o.push(r[r.length-1])}else if("step"===r[0]){e=e||cl(r[1]);for(let a=1;a<r.length-1;a+=2)o.push(r[a+1])}e&&(r.length=0,r.push("any",...o));for(let a=1;a<r.length;a++)ll(r[a])}function cl(r){if(!Array.isArray(r))return!1;if("pitch"===(e=r[0])||"distance-from-center"===e)return!0;var e;for(let o=1;o<r.length;o++)if(cl(r[o]))return!0;return!1}const rc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Bu(r,e){return r<e?-1:r>e?1:0}function da(r){if(!Array.isArray(r))return!1;if("within"===r[0])return!0;for(let e=1;e<r.length;e++)if(da(r[e]))return!0;return!1}function Ll(r){if(!r)return!0;const e=r[0];return r.length<=1?"any"!==e:"=="===e?$a(r[1],r[2],"=="):"!="===e?Za($a(r[1],r[2],"==")):"<"===e||">"===e||"<="===e||">="===e?$a(r[1],r[2],e):"any"===e?(o=r.slice(1),["any"].concat(o.map(Ll))):"all"===e?["all"].concat(r.slice(1).map(Ll)):"none"===e?["all"].concat(r.slice(1).map(Ll).map(Za)):"in"===e?ic(r[1],r.slice(2)):"!in"===e?Za(ic(r[1],r.slice(2))):"has"===e?oc(r[1]):"!has"===e?Za(oc(r[1])):"within"!==e||r;var o}function $a(r,e,o){switch(r){case"$type":return[`filter-type-${o}`,e];case"$id":return[`filter-id-${o}`,e];default:return[`filter-${o}`,r,e]}}function ic(r,e){if(0===e.length)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(o=>typeof o!=typeof e[0])?["filter-in-large",r,["literal",e.sort(Bu)]]:["filter-in-small",r,["literal",e]]}}function oc(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Za(r){return["!",r]}function ul(r){if(nc(ti(r.value))){const e=ti(r.layerType);return ea(Qo({},r,{expressionContext:"filter",valueSpec:r.styleSpec[`filter_${e||"fill"}`]}))}return mu(r)}function mu(r){const e=r.value,o=r.key;if("array"!==wr(e))return[new zt(o,e,`array expected, ${wr(e)} found`)];const a=r.styleSpec;let u,p=[];if(e.length<1)return[new zt(o,e,"filter array must have at least 1 element")];switch(p=p.concat(Ls({key:`${o}[0]`,value:e[0],valueSpec:a.filter_operator,style:r.style,styleSpec:r.styleSpec})),nr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===nr(e[1])&&p.push(new zt(o,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&p.push(new zt(o,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=wr(e[1]),"string"!==u&&p.push(new zt(`${o}[1]`,e[1],`string expected, ${u} found`)));for(let _=2;_<e.length;_++)u=wr(e[_]),"$type"===nr(e[1])?p=p.concat(Ls({key:`${o}[${_}]`,value:e[_],valueSpec:a.geometry_type,style:r.style,styleSpec:r.styleSpec})):"string"!==u&&"number"!==u&&"boolean"!==u&&p.push(new zt(`${o}[${_}]`,e[_],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)p=p.concat(mu({key:`${o}[${_}]`,value:e[_],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":u=wr(e[1]),2!==e.length?p.push(new zt(o,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==u&&p.push(new zt(`${o}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=wr(e[1]),2!==e.length?p.push(new zt(o,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==u&&p.push(new zt(`${o}[1]`,e[1],`object expected, ${u} found`))}return p}function hl(r,e){const o=r.key,a=r.style,u=r.styleSpec,p=r.value,_=r.objectKey,x=u[`${e}_${r.layerType}`];if(!x)return[];const C=_.match(/^(.*)-transition$/);if("paint"===e&&C&&x[C[1]]&&x[C[1]].transition)return L({key:o,value:p,valueSpec:u.transition,style:a,styleSpec:u});const D=r.valueSpec||x[_];if(!D)return[new zt(o,p,`unknown property "${_}"`)];let O;if("string"===wr(p)&&il(D)&&!D.tokens&&(O=/^{([^}]+)}$/.exec(p)))return[new zt(o,p,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const N=[];return"symbol"===r.layerType&&("text-field"===_&&a&&!a.glyphs&&N.push(new zt(o,p,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&Ba(ti(p))&&"identity"===nr(p.type)&&N.push(new zt(o,p,'"text-font" does not support identity functions'))),N.concat(L({key:r.key,value:p,valueSpec:D,style:a,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:_}))}function sc(r){return hl(r,"paint")}function Nc(r){return hl(r,"layout")}function dl(r){let e=[];const o=r.value,a=r.key,u=r.style,p=r.styleSpec;o.type||o.ref||e.push(new zt(a,o,'either "type" or "ref" is required'));let _=nr(o.type);const x=nr(o.ref);if(o.id){const C=nr(o.id);for(let D=0;D<r.arrayIndex;D++){const O=u.layers[D];nr(O.id)===C&&e.push(new zt(a,o.id,`duplicate layer id "${o.id}", previously used at line ${O.id.__line__}`))}}if("ref"in o){let C;["type","source","source-layer","filter","layout"].forEach(D=>{D in o&&e.push(new zt(a,o[D],`"${D}" is prohibited for ref layers`))}),u.layers.forEach(D=>{nr(D.id)===x&&(C=D)}),C?C.ref?e.push(new zt(a,o.ref,"ref cannot reference another ref layer")):_=nr(C.type):e.push(new zt(a,o.ref,`ref layer "${x}" not found`))}else if("background"!==_&&"sky"!==_)if(o.source){const C=u.sources&&u.sources[o.source],D=C&&nr(C.type);C?"vector"===D&&"raster"===_?e.push(new zt(a,o.source,`layer "${o.id}" requires a raster source`)):"raster"===D&&"raster"!==_?e.push(new zt(a,o.source,`layer "${o.id}" requires a vector source`)):"vector"!==D||o["source-layer"]?"raster-dem"===D&&"hillshade"!==_?e.push(new zt(a,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!o.paint||!o.paint["line-gradient"]||"geojson"===D&&C.lineMetrics||e.push(new zt(a,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new zt(a,o,`layer "${o.id}" must specify a "source-layer"`)):e.push(new zt(a,o.source,`source "${o.source}" not found`))}else e.push(new zt(a,o,'missing required property "source"'));return e=e.concat(yo({key:a,value:o,valueSpec:p.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>L({key:`${a}.type`,value:o.type,valueSpec:p.layer.type,style:r.style,styleSpec:r.styleSpec,object:o,objectKey:"type"}),filter:C=>ul(Qo({layerType:_},C)),layout:C=>yo({layer:o,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":D=>Nc(Qo({layerType:_},D))}}),paint:C=>yo({layer:o,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":D=>sc(Qo({layerType:_},D))}})}})),e}function pl(r){const e=r.value,o=r.key,a=wr(e);return"string"!==a?[new zt(o,e,`string expected, ${a} found`)]:[]}const Nl={promoteId:function({key:r,value:e}){if("string"===wr(e))return pl({key:r,value:e});{const o=[];for(const a in e)o.push(...pl({key:`${r}.${a}`,value:e[a]}));return o}}};function zl(r){const e=r.value,o=r.key,a=r.styleSpec,u=r.style;if(!e.type)return[new zt(o,e,'"type" is required')];const p=nr(e.type);let _;switch(p){case"vector":case"raster":case"raster-dem":return _=yo({key:o,value:e,valueSpec:a[`source_${p.replace("-","_")}`],style:r.style,styleSpec:a,objectElementValidators:Nl}),_;case"geojson":if(_=yo({key:o,value:e,valueSpec:a.source_geojson,style:u,styleSpec:a,objectElementValidators:Nl}),e.cluster)for(const x in e.clusterProperties){const[C,D]=e.clusterProperties[x],O="string"==typeof C?[C,["accumulated"],["get",x]]:C;_.push(...ea({key:`${o}.${x}.map`,value:D,expressionContext:"cluster-map"})),_.push(...ea({key:`${o}.${x}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return _;case"video":return yo({key:o,value:e,valueSpec:a.source_video,style:u,styleSpec:a});case"image":return yo({key:o,value:e,valueSpec:a.source_image,style:u,styleSpec:a});case"canvas":return[new zt(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ls({key:`${o}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:a})}}function Ga(r){const e=r.value,o=r.styleSpec,a=o.light,u=r.style;let p=[];const _=wr(e);if(void 0===e)return p;if("object"!==_)return p=p.concat([new zt("light",e,`object expected, ${_} found`)]),p;for(const x in e){const C=x.match(/^(.*)-transition$/);p=p.concat(C&&a[C[1]]&&a[C[1]].transition?L({key:x,value:e[x],valueSpec:o.transition,style:u,styleSpec:o}):a[x]?L({key:x,value:e[x],valueSpec:a[x],style:u,styleSpec:o}):[new zt(x,e[x],`unknown property "${x}"`)])}return p}function ac(r){const e=r.value,o=r.key,a=r.style,u=r.styleSpec,p=u.terrain;let _=[];const x=wr(e);if(void 0===e)return _;if("object"!==x)return _=_.concat([new zt("terrain",e,`object expected, ${x} found`)]),_;for(const C in e){const D=C.match(/^(.*)-transition$/);_=_.concat(D&&p[D[1]]&&p[D[1]].transition?L({key:C,value:e[C],valueSpec:u.transition,style:a,styleSpec:u}):p[C]?L({key:C,value:e[C],valueSpec:p[C],style:a,styleSpec:u}):[new zt(C,e[C],`unknown property "${C}"`)])}if(e.source){const C=a.sources&&a.sources[e.source],D=C&&nr(C.type);C?"raster-dem"!==D&&_.push(new zt(o,e.source,`terrain cannot be used with a source of type ${D}, it only be used with a "raster-dem" source type`)):_.push(new zt(o,e.source,`source "${e.source}" not found`))}else _.push(new zt(o,e,'terrain is missing required property "source"'));return _}function lc(r){const e=r.value,o=r.style,a=r.styleSpec,u=a.fog;let p=[];const _=wr(e);if(void 0===e)return p;if("object"!==_)return p=p.concat([new zt("fog",e,`object expected, ${_} found`)]),p;for(const x in e){const C=x.match(/^(.*)-transition$/);p=p.concat(C&&u[C[1]]&&u[C[1]].transition?L({key:x,value:e[x],valueSpec:a.transition,style:o,styleSpec:a}):u[x]?L({key:x,value:e[x],valueSpec:u[x],style:o,styleSpec:a}):[new zt(x,e[x],`unknown property "${x}"`)])}return p}const zc={"*":()=>[],array:Ua,boolean:function(r){const e=r.value,o=r.key,a=wr(e);return"boolean"!==a?[new zt(o,e,`boolean expected, ${a} found`)]:[]},number:ja,color:function(r){const e=r.key,o=r.value,a=wr(o);return"string"!==a?[new zt(e,o,`color expected, ${a} found`)]:null===bs.parseCSSColor(o)?[new zt(e,o,`color expected, "${o}" found`)]:[]},constants:dr,enum:Ls,filter:ul,function:Es,layer:dl,object:yo,source:zl,light:Ga,terrain:ac,fog:lc,string:pl,formatted:function(r){return 0===pl(r).length?[]:ea(r)},resolvedImage:function(r){return 0===pl(r).length?[]:ea(r)},projection:function(r){const e=r.value,o=r.styleSpec,a=o.projection,u=r.style;let p=[];const _=wr(e);if("object"===_)for(const x in e)p=p.concat(L({key:x,value:e[x],valueSpec:a[x],style:u,styleSpec:o}));else"string"!==_&&(p=p.concat([new zt("projection",e,`object or string expected, ${_} found`)]));return p}};function L(r){const e=r.value,o=r.valueSpec,a=r.styleSpec;return o.expression&&Ba(nr(e))?Es(r):o.expression&&sl(ti(e))?ea(r):o.type&&zc[o.type]?zc[o.type](r):yo(Qo({},r,{valueSpec:o.type?a[o.type]:o}))}function M(r){const e=r.value,o=r.key,a=pl(r);return a.length||(-1===e.indexOf("{fontstack}")&&a.push(new zt(o,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&a.push(new zt(o,e,'"glyphs" url must include a "{range}" token'))),a}function A(r,e=rt){let o=[];return o=o.concat(L({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,objectElementValidators:{glyphs:M,"*":()=>[]}})),r.constants&&(o=o.concat(dr({key:"constants",value:r.constants,style:r,styleSpec:e}))),V(o)}function V(r){return[].concat(r).sort((e,o)=>e.line-o.line)}function W(r){return function(...e){return V(r.apply(this,e))}}A.source=W(zl),A.light=W(Ga),A.terrain=W(ac),A.fog=W(lc),A.layer=W(dl),A.filter=W(ul),A.paintProperty=W(sc),A.layoutProperty=W(Nc);const oe=A,we=oe.light,Le=oe.fog,ft=oe.paintProperty,en=oe.layoutProperty;function Rr(r,e){let o=!1;if(e&&e.length)for(const a of e)r.fire(new $o(new Error(a.message))),o=!0;return o}var wn=rr;function rr(r,e,o){var a=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var u=new Int32Array(this.arrayBuffer);r=u[0],this.d=(e=u[1])+2*(o=u[2]);for(var p=0;p<this.d*this.d;p++){var _=u[3+p],x=u[3+p+1];a.push(_===x?null:u.subarray(_,x))}var C=u[3+a.length+1];this.keys=u.subarray(u[3+a.length],C),this.bboxes=u.subarray(C),this.insert=this._insertReadonly}else{this.d=e+2*o;for(var D=0;D<this.d*this.d;D++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=r,this.padding=o,this.scale=e/r,this.uid=0;var O=o/e*r;this.min=-O,this.max=r+O}rr.prototype.insert=function(r,e,o,a,u){this._forEachCell(e,o,a,u,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(e),this.bboxes.push(o),this.bboxes.push(a),this.bboxes.push(u)},rr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},rr.prototype._insertCell=function(r,e,o,a,u,p){this.cells[u].push(p)},rr.prototype.query=function(r,e,o,a,u){var p=this.min,_=this.max;if(r<=p&&e<=p&&_<=o&&_<=a&&!u)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(r,e,o,a,this._queryCell,x,{},u),x},rr.prototype._queryCell=function(r,e,o,a,u,p,_,x){var C=this.cells[u];if(null!==C)for(var D=this.keys,O=this.bboxes,N=0;N<C.length;N++){var B=C[N];if(void 0===_[B]){var X=4*B;(x?x(O[X+0],O[X+1],O[X+2],O[X+3]):r<=O[X+2]&&e<=O[X+3]&&o>=O[X+0]&&a>=O[X+1])?(_[B]=!0,p.push(D[B])):_[B]=!1}}},rr.prototype._forEachCell=function(r,e,o,a,u,p,_,x){for(var C=this._convertToCellCoord(r),D=this._convertToCellCoord(e),O=this._convertToCellCoord(o),N=this._convertToCellCoord(a),B=C;B<=O;B++)for(var X=D;X<=N;X++){var ne=this.d*X+B;if((!x||x(this._convertFromCellCoord(B),this._convertFromCellCoord(X),this._convertFromCellCoord(B+1),this._convertFromCellCoord(X+1)))&&u.call(this,r,e,o,a,ne,p,_,x))return}},rr.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},rr.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},rr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,e=3+this.cells.length+1+1,o=0,a=0;a<this.cells.length;a++)o+=this.cells[a].length;var u=new Int32Array(e+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var p=e,_=0;_<r.length;_++){var x=r[_];u[3+_]=p,u.set(x,p),p+=x.length}return u[3+r.length]=p,u.set(this.keys,p),u[3+r.length+1]=p+=this.keys.length,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer};const{ImageData:gr,ImageBitmap:gs}=ge,kr={};function Ht(r,e,o={}){Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),kr[r]={klass:e,omit:o.omit||[],shallow:o.shallow||[]}}Ht("Object",Object),wn.serialize=function(r,e){const o=r.toArrayBuffer();return e&&e.push(o),{buffer:o}},wn.deserialize=function(r){return new wn(r.buffer)},Ht("Grid",wn),Ht("Color",Jn),Ht("Error",Error),Ht("ResolvedImage",Pi),Ht("StylePropertyFunction",ro),Ht("StyleExpression",Oc,{omit:["_evaluator"]}),Ht("ZoomDependentExpression",Fc),Ht("ZoomConstantExpression",Da),Ht("CompoundExpression",G,{omit:["_evaluate"]});for(const r in Qs)Qs[r]._classRegistryKey||Ht(`Expression_${r}`,Qs[r]);function Ns(r){return r&&"undefined"!=typeof ArrayBuffer&&(r instanceof ArrayBuffer||r.constructor&&"ArrayBuffer"===r.constructor.name)}function pa(r){return gs&&r instanceof gs}function zs(r,e){if(null==r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(Ns(r)||pa(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const o=r;return e&&e.push(o.buffer),o}if(r instanceof gr)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const o=[];for(const a of r)o.push(zs(a,e));return o}if("object"==typeof r){const o=r.constructor,a=o._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");const u=o.serialize?o.serialize(r,e):{};if(!o.serialize){for(const p in r){if(!r.hasOwnProperty(p)||kr[a].omit.indexOf(p)>=0)continue;const _=r[p];u[p]=kr[a].shallow.indexOf(p)>=0?_:zs(_,e)}r instanceof Error&&(u.message=r.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==a&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof r)}function fa(r){if(null==r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||Ns(r)||pa(r)||ArrayBuffer.isView(r)||r instanceof gr)return r;if(Array.isArray(r))return r.map(fa);if("object"==typeof r){const e=r.$name||"Object",{klass:o}=kr[e];if(!o)throw new Error(`can't deserialize unregistered class ${e}`);if(o.deserialize)return o.deserialize(r);const a=Object.create(o.prototype);for(const u of Object.keys(r)){if("$name"===u)continue;const p=r[u];a[u]=kr[e].shallow.indexOf(u)>=0?p:fa(p)}return a}throw new Error("can't deserialize object of type "+typeof r)}class f{constructor(){this.first=!0}update(e,o){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=o),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const i=r=>r>=1536&&r<=1791,c=r=>r>=1872&&r<=1919,m=r=>r>=2208&&r<=2303,v=r=>r>=11904&&r<=12031,b=r=>r>=12032&&r<=12255,T=r=>r>=12272&&r<=12287,R=r=>r>=12288&&r<=12351,z=r=>r>=12352&&r<=12447,j=r=>r>=12448&&r<=12543,q=r=>r>=12544&&r<=12591,Q=r=>r>=12704&&r<=12735,se=r=>r>=12736&&r<=12783,he=r=>r>=12784&&r<=12799,ue=r=>r>=12800&&r<=13055,fe=r=>r>=13056&&r<=13311,Se=r=>r>=13312&&r<=19903,de=r=>r>=19968&&r<=40959,Ee=r=>r>=40960&&r<=42127,Ae=r=>r>=42128&&r<=42191,be=r=>r>=44032&&r<=55215,Ce=r=>r>=63744&&r<=64255,Pe=r=>r>=64336&&r<=65023,We=r=>r>=65040&&r<=65055,et=r=>r>=65072&&r<=65103,Ft=r=>r>=65104&&r<=65135,bt=r=>r>=65136&&r<=65279,Tt=r=>r>=65280&&r<=65519;function pt(r){for(const e of r)if(gt(e.charCodeAt(0)))return!0;return!1}function tt(r){for(const e of r)if(!vt(e.charCodeAt(0)))return!1;return!0}function vt(r){return!(i(r)||c(r)||m(r)||Pe(r)||bt(r))}function gt(r){return!(746!==r&&747!==r&&(r<4352||!(Q(r)||q(r)||et(r)&&!(r>=65097&&r<=65103)||Ce(r)||fe(r)||v(r)||se(r)||!(!R(r)||r>=12296&&r<=12305||r>=12308&&r<=12319||12336===r)||Se(r)||de(r)||ue(r)||(e=r,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(r)||(e=>e>=55216&&e<=55295)(r)||(e=>e>=4352&&e<=4607)(r)||be(r)||z(r)||T(r)||(e=>e>=12688&&e<=12703)(r)||b(r)||he(r)||j(r)&&12540!==r||!(!Tt(r)||65288===r||65289===r||65293===r||r>=65306&&r<=65310||65339===r||65341===r||65343===r||r>=65371&&r<=65503||65507===r||r>=65512&&r<=65519)||!(!Ft(r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||(e=>e>=5120&&e<=5759)(r)||(e=>e>=6320&&e<=6399)(r)||We(r)||(e=>e>=19904&&e<=19967)(r)||Ee(r)||Ae(r))));var e}function on(r){return!(gt(r)||(e=r,(o=e)>=128&&o<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(o=>o>=8192&&o<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(o=>o>=8448&&o<=8527)(e)||(o=>o>=8528&&o<=8591)(e)||(o=>o>=8960&&o<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(o=>o>=9216&&o<=9279)(e)&&9251!==e||(o=>o>=9280&&o<=9311)(e)||(o=>o>=9312&&o<=9471)(e)||(o=>o>=9632&&o<=9727)(e)||(o=>o>=9728&&o<=9983)(e)&&!(e>=9754&&e<=9759)||(o=>o>=11008&&o<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||R(e)||j(e)||(o=>o>=57344&&o<=63743)(e)||et(e)||Ft(e)||Tt(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,o}function gn(r){return r>=1424&&r<=2303||Pe(r)||bt(r)}function Zn(r,e){return!(!e&&gn(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||(o=r,o>=6016&&o<=6143));var o}function Ot(r){for(const e of r)if(gn(e.charCodeAt(0)))return!0;return!1}const ln="deferred",Vn="loading",Or="loaded";let Yr=null,vn="unavailable",lr=null;const vi=function(r){r&&"string"==typeof r&&r.indexOf("NetworkError")>-1&&(vn="error"),Yr&&Yr(r)};function vo(){rs.fire(new uo("pluginStateChange",{pluginStatus:vn,pluginURL:lr}))}const rs=new qr,ma=function(){return vn},Bs=function(){if(vn!==ln||!lr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");vn=Vn,vo(),lr&&Li({url:lr},r=>{r?vi(r):(vn=Or,vo())})},cr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>vn===Or||null!=cr.applyArabicShaping,isLoading:()=>vn===Vn,setState(r){vn=r.pluginStatus,lr=r.pluginURL},isParsed:()=>null!=cr.applyArabicShaping&&null!=cr.processBidirectionalText&&null!=cr.processStyledBidirectionalText,getPluginURL:()=>lr};class En{constructor(e,o){this.zoom=e,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition,this.pitch=o.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new f,this.transition={},this.pitch=0)}isSupportedScript(e){return function(o,a){for(const u of o)if(!Zn(u.charCodeAt(0),a))return!1;return!0}(e,cr.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,o=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*o}}}class _r{constructor(e,o){this.property=e,this.value=o,this.expression=function(a,u){if(Ba(a))return new ro(a,u);if(sl(a)){const p=fu(a,u);if("error"===p.result)throw new Error(p.value.map(_=>`${_.key}: ${_.message}`).join(", "));return p.value}{let p=a;return"string"==typeof a&&"color"===u.type&&(p=Jn.parse(a)),{kind:"constant",evaluate:()=>p}}}(void 0===o?e.specification.default:o,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,o,a){return this.property.possiblyEvaluate(this,e,o,a)}}class ir{constructor(e){this.property=e,this.value=new _r(e,void 0)}transitioned(e,o){return new xi(this.property,this.value,o,st({},e.transition,this.transition),e.now)}untransitioned(){return new xi(this.property,this.value,null,{},0)}}class Ts{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Nn(this._values[e].value.value)}setValue(e,o){this._values.hasOwnProperty(e)||(this._values[e]=new ir(this._values[e].property)),this._values[e].value=new _r(this._values[e].property,null===o?void 0:Nn(o))}getTransition(e){return Nn(this._values[e].transition)}setTransition(e,o){this._values.hasOwnProperty(e)||(this._values[e]=new ir(this._values[e].property)),this._values[e].transition=Nn(o)||void 0}serialize(){const e={};for(const o of Object.keys(this._values)){const a=this.getValue(o);void 0!==a&&(e[o]=a);const u=this.getTransition(o);void 0!==u&&(e[`${o}-transition`]=u)}return e}transitioned(e,o){const a=new Io(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,o._values[u]);return a}untransitioned(){const e=new Io(this._properties);for(const o of Object.keys(this._values))e._values[o]=this._values[o].untransitioned();return e}}class xi{constructor(e,o,a,u,p){const _=u.delay||0,x=u.duration||0;p=p||0,this.property=e,this.value=o,this.begin=p+_,this.end=this.begin+x,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,o,a){const u=e.now||0,p=this.value.possiblyEvaluate(e,o,a),_=this.prior;if(_){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return _.possiblyEvaluate(e,o,a);{const x=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,o,a),p,hr(x))}}return p}}class Io{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,o,a){const u=new fl(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,o,a);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ha{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Nn(this._values[e].value)}setValue(e,o){this._values[e]=new _r(this._values[e].property,null===o?void 0:Nn(o))}serialize(){const e={};for(const o of Object.keys(this._values)){const a=this.getValue(o);void 0!==a&&(e[o]=a)}return e}possiblyEvaluate(e,o,a){const u=new fl(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,o,a);return u}}class Ds{constructor(e,o,a){this.property=e,this.value=o,this.parameters=a}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,o,a,u){return this.property.evaluate(this.value,this.parameters,e,o,a,u)}}class fl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class tn{constructor(e){this.specification=e}possiblyEvaluate(e,o){return e.expression.evaluate(o)}interpolate(e,o,a){const u=Fa[this.specification.type];return u?u(e,o,a):e}}class fn{constructor(e,o){this.specification=e,this.overrides=o}possiblyEvaluate(e,o,a,u){return new Ds(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(o,null,{},a,u)}:e.expression,o)}interpolate(e,o,a){if("constant"!==e.value.kind||"constant"!==o.value.kind)return e;if(void 0===e.value.value||void 0===o.value.value)return new Ds(this,{kind:"constant",value:void 0},e.parameters);const u=Fa[this.specification.type];return u?new Ds(this,{kind:"constant",value:u(e.value.value,o.value.value,a)},e.parameters):e}evaluate(e,o,a,u,p,_){return"constant"===e.kind?e.value:e.evaluate(o,a,u,p,_)}}class Bi extends fn{possiblyEvaluate(e,o,a,u){if(void 0===e.value)return new Ds(this,{kind:"constant",value:void 0},o);if("constant"===e.expression.kind){const p=e.expression.evaluate(o,null,{},a,u),_="resolvedImage"===e.property.specification.type&&"string"!=typeof p?p.name:p,x=this._calculate(_,_,_,o);return new Ds(this,{kind:"constant",value:x},o)}if("camera"===e.expression.kind){const p=this._calculate(e.expression.evaluate({zoom:o.zoom-1}),e.expression.evaluate({zoom:o.zoom}),e.expression.evaluate({zoom:o.zoom+1}),o);return new Ds(this,{kind:"constant",value:p},o)}return new Ds(this,e.expression,o)}evaluate(e,o,a,u,p,_){if("source"===e.kind){const x=e.evaluate(o,a,u,p,_);return this._calculate(x,x,x,o)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(o.zoom)-1},a,u),e.evaluate({zoom:Math.floor(o.zoom)},a,u),e.evaluate({zoom:Math.floor(o.zoom)+1},a,u),o):e.value}_calculate(e,o,a,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:o,other:a}:{from:a,to:o,other:e}}interpolate(e){return e}}class _s{constructor(e){this.specification=e}possiblyEvaluate(e,o,a,u){if(void 0!==e.value){if("constant"===e.expression.kind){const p=e.expression.evaluate(o,null,{},a,u);return this._calculate(p,p,p,o)}return this._calculate(e.expression.evaluate(new En(Math.floor(o.zoom-1),o)),e.expression.evaluate(new En(Math.floor(o.zoom),o)),e.expression.evaluate(new En(Math.floor(o.zoom+1),o)),o)}}_calculate(e,o,a,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:o}:{from:a,to:o}}interpolate(e){return e}}class ga{constructor(e){this.specification=e}possiblyEvaluate(e,o,a,u){return!!e.expression.evaluate(o,null,{},a,u)}interpolate(){return!1}}class ki{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in e){const a=e[o];a.specification.overridable&&this.overridableProperties.push(o);const u=this.defaultPropertyValues[o]=new _r(a,void 0),p=this.defaultTransitionablePropertyValues[o]=new ir(a);this.defaultTransitioningPropertyValues[o]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=u.possiblyEvaluate({})}}}function If(r,e){return 256*(r=pn(Math.floor(r),0,255))+pn(Math.floor(e),0,255)}Ht("DataDrivenProperty",fn),Ht("DataConstantProperty",tn),Ht("CrossFadedDataDrivenProperty",Bi),Ht("CrossFadedProperty",_s),Ht("ColorRampProperty",ga);const Pf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Bc{constructor(e,o){this._structArray=e,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Oi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,o){return e._trim(),o&&(e.isTransferred=!0,o.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const o=Object.create(this.prototype);return o.arrayBuffer=e.arrayBuffer,o.length=e.length,o.capacity=e.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Di(r,e=1){let o=0,a=0;return{members:r.map(u=>{const p=Pf[u.type].BYTES_PER_ELEMENT,_=o=Rf(o,Math.max(e,p)),x=u.components||1;return a=Math.max(a,p),o+=p*x,{name:u.name,type:u.type,components:x,offset:_}}),size:Rf(o,Math.max(a,e)),alignment:e}}function Rf(r,e){return Math.ceil(r/e)*e}class gu extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,o)}emplace(e,o,a){const u=2*e;return this.int16[u+0]=o,this.int16[u+1]=a,e}}gu.prototype.bytesPerElement=4,Ht("StructArrayLayout2i4",gu);class qa extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,o,a,u)}emplace(e,o,a,u,p){const _=4*e;return this.int16[_+0]=o,this.int16[_+1]=a,this.int16[_+2]=u,this.int16[_+3]=p,e}}qa.prototype.bytesPerElement=8,Ht("StructArrayLayout4i8",qa);class Vc extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,a,u,p,_,x){const C=this.length;return this.resize(C+1),this.emplace(C,e,o,a,u,p,_,x)}emplace(e,o,a,u,p,_,x,C){const D=6*e,O=12*e,N=3*e;return this.int16[D+0]=o,this.int16[D+1]=a,this.uint8[O+4]=u,this.uint8[O+5]=p,this.uint8[O+6]=_,this.uint8[O+7]=x,this.float32[N+2]=C,e}}Vc.prototype.bytesPerElement=12,Ht("StructArrayLayout2i4ub1f12",Vc);class _u extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,o,a)}emplace(e,o,a,u){const p=3*e;return this.float32[p+0]=o,this.float32[p+1]=a,this.float32[p+2]=u,e}}_u.prototype.bytesPerElement=12,Ht("StructArrayLayout3f12",_u);class Uc extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,a,u,p,_,x,C,D,O){const N=this.length;return this.resize(N+1),this.emplace(N,e,o,a,u,p,_,x,C,D,O)}emplace(e,o,a,u,p,_,x,C,D,O,N){const B=10*e;return this.uint16[B+0]=o,this.uint16[B+1]=a,this.uint16[B+2]=u,this.uint16[B+3]=p,this.uint16[B+4]=_,this.uint16[B+5]=x,this.uint16[B+6]=C,this.uint16[B+7]=D,this.uint16[B+8]=O,this.uint16[B+9]=N,e}}Uc.prototype.bytesPerElement=20,Ht("StructArrayLayout10ui20",Uc);class Vu extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,a,u,p,_,x,C){const D=this.length;return this.resize(D+1),this.emplace(D,e,o,a,u,p,_,x,C)}emplace(e,o,a,u,p,_,x,C,D){const O=8*e;return this.uint16[O+0]=o,this.uint16[O+1]=a,this.uint16[O+2]=u,this.uint16[O+3]=p,this.uint16[O+4]=_,this.uint16[O+5]=x,this.uint16[O+6]=C,this.uint16[O+7]=D,e}}Vu.prototype.bytesPerElement=16,Ht("StructArrayLayout8ui16",Vu);class Gd extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,a,u,p,_,x,C,D,O,N,B,X,ne,ae,le){const ye=this.length;return this.resize(ye+1),this.emplace(ye,e,o,a,u,p,_,x,C,D,O,N,B,X,ne,ae,le)}emplace(e,o,a,u,p,_,x,C,D,O,N,B,X,ne,ae,le,ye){const De=16*e;return this.int16[De+0]=o,this.int16[De+1]=a,this.int16[De+2]=u,this.int16[De+3]=p,this.uint16[De+4]=_,this.uint16[De+5]=x,this.uint16[De+6]=C,this.uint16[De+7]=D,this.int16[De+8]=O,this.int16[De+9]=N,this.int16[De+10]=B,this.int16[De+11]=X,this.int16[De+12]=ne,this.int16[De+13]=ae,this.int16[De+14]=le,this.int16[De+15]=ye,e}}Gd.prototype.bytesPerElement=32,Ht("StructArrayLayout4i4ui4i4i32",Gd);class kf extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint32[1*e+0]=o,e}}kf.prototype.bytesPerElement=4,Ht("StructArrayLayout1ul4",kf);class Hd extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,a,u,p,_,x,C,D,O,N,B,X){const ne=this.length;return this.resize(ne+1),this.emplace(ne,e,o,a,u,p,_,x,C,D,O,N,B,X)}emplace(e,o,a,u,p,_,x,C,D,O,N,B,X,ne){const ae=20*e,le=10*e;return this.int16[ae+0]=o,this.int16[ae+1]=a,this.int16[ae+2]=u,this.int16[ae+3]=p,this.int16[ae+4]=_,this.float32[le+3]=x,this.float32[le+4]=C,this.float32[le+5]=D,this.float32[le+6]=O,this.int16[ae+14]=N,this.uint32[le+8]=B,this.uint16[ae+18]=X,this.uint16[ae+19]=ne,e}}Hd.prototype.bytesPerElement=40,Ht("StructArrayLayout5i4f1i1ul2ui40",Hd);class Rh extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,a,u,p,_,x){const C=this.length;return this.resize(C+1),this.emplace(C,e,o,a,u,p,_,x)}emplace(e,o,a,u,p,_,x,C){const D=8*e;return this.int16[D+0]=o,this.int16[D+1]=a,this.int16[D+2]=u,this.int16[D+4]=p,this.int16[D+5]=_,this.int16[D+6]=x,this.int16[D+7]=C,e}}Rh.prototype.bytesPerElement=16,Ht("StructArrayLayout3i2i2i16",Rh);class qd extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,a,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,o,a,u,p)}emplace(e,o,a,u,p,_){const x=4*e,C=8*e;return this.float32[x+0]=o,this.float32[x+1]=a,this.float32[x+2]=u,this.int16[C+6]=p,this.int16[C+7]=_,e}}qd.prototype.bytesPerElement=16,Ht("StructArrayLayout2f1f2i16",qd);class yu extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,o,a,u)}emplace(e,o,a,u,p){const _=12*e,x=3*e;return this.uint8[_+0]=o,this.uint8[_+1]=a,this.float32[x+1]=u,this.float32[x+2]=p,e}}yu.prototype.bytesPerElement=12,Ht("StructArrayLayout2ub2f12",yu);class Vs extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,o,a)}emplace(e,o,a,u){const p=3*e;return this.uint16[p+0]=o,this.uint16[p+1]=a,this.uint16[p+2]=u,e}}Vs.prototype.bytesPerElement=6,Ht("StructArrayLayout3ui6",Vs);class cc extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,o,a,u,p,_,x,C,D,O,N,B,X,ne,ae,le,ye,De,Re,Ve,$e){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,e,o,a,u,p,_,x,C,D,O,N,B,X,ne,ae,le,ye,De,Re,Ve,$e)}emplace(e,o,a,u,p,_,x,C,D,O,N,B,X,ne,ae,le,ye,De,Re,Ve,$e,Ge){const dt=30*e,ct=15*e,Lt=60*e;return this.int16[dt+0]=o,this.int16[dt+1]=a,this.int16[dt+2]=u,this.float32[ct+2]=p,this.float32[ct+3]=_,this.uint16[dt+8]=x,this.uint16[dt+9]=C,this.uint32[ct+5]=D,this.uint32[ct+6]=O,this.uint32[ct+7]=N,this.uint16[dt+16]=B,this.uint16[dt+17]=X,this.uint16[dt+18]=ne,this.float32[ct+10]=ae,this.float32[ct+11]=le,this.uint8[Lt+48]=ye,this.uint8[Lt+49]=De,this.uint8[Lt+50]=Re,this.uint32[ct+13]=Ve,this.int16[dt+28]=$e,this.uint8[Lt+58]=Ge,e}}cc.prototype.bytesPerElement=60,Ht("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",cc);class Wd extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,o,a,u,p,_,x,C,D,O,N,B,X,ne,ae,le,ye,De,Re,Ve,$e,Ge,dt,ct,Lt,St,ht,Pt,Bt,xt){const Kt=this.length;return this.resize(Kt+1),this.emplace(Kt,e,o,a,u,p,_,x,C,D,O,N,B,X,ne,ae,le,ye,De,Re,Ve,$e,Ge,dt,ct,Lt,St,ht,Pt,Bt,xt)}emplace(e,o,a,u,p,_,x,C,D,O,N,B,X,ne,ae,le,ye,De,Re,Ve,$e,Ge,dt,ct,Lt,St,ht,Pt,Bt,xt,Kt){const nn=38*e,yr=19*e;return this.int16[nn+0]=o,this.int16[nn+1]=a,this.int16[nn+2]=u,this.float32[yr+2]=p,this.float32[yr+3]=_,this.int16[nn+8]=x,this.int16[nn+9]=C,this.int16[nn+10]=D,this.int16[nn+11]=O,this.int16[nn+12]=N,this.int16[nn+13]=B,this.uint16[nn+14]=X,this.uint16[nn+15]=ne,this.uint16[nn+16]=ae,this.uint16[nn+17]=le,this.uint16[nn+18]=ye,this.uint16[nn+19]=De,this.uint16[nn+20]=Re,this.uint16[nn+21]=Ve,this.uint16[nn+22]=$e,this.uint16[nn+23]=Ge,this.uint16[nn+24]=dt,this.uint16[nn+25]=ct,this.uint16[nn+26]=Lt,this.uint16[nn+27]=St,this.uint16[nn+28]=ht,this.uint32[yr+15]=Pt,this.float32[yr+16]=Bt,this.float32[yr+17]=xt,this.float32[yr+18]=Kt,e}}Wd.prototype.bytesPerElement=76,Ht("StructArrayLayout3i2f6i15ui1ul3f76",Wd);class kh extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.float32[1*e+0]=o,e}}kh.prototype.bytesPerElement=4,Ht("StructArrayLayout1f4",kh);class Of extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,o,a)}emplace(e,o,a,u){const p=3*e;return this.int16[p+0]=o,this.int16[p+1]=a,this.int16[p+2]=u,e}}Of.prototype.bytesPerElement=6,Ht("StructArrayLayout3i6",Of);class uc extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,a,u,p,_,x){const C=this.length;return this.resize(C+1),this.emplace(C,e,o,a,u,p,_,x)}emplace(e,o,a,u,p,_,x,C){const D=7*e;return this.float32[D+0]=o,this.float32[D+1]=a,this.float32[D+2]=u,this.float32[D+3]=p,this.float32[D+4]=_,this.float32[D+5]=x,this.float32[D+6]=C,e}}uc.prototype.bytesPerElement=28,Ht("StructArrayLayout7f28",uc);class Uu extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,o,a,u)}emplace(e,o,a,u,p){const _=6*e;return this.uint32[3*e+0]=o,this.uint16[_+2]=a,this.uint16[_+3]=u,this.uint16[_+4]=p,e}}Uu.prototype.bytesPerElement=12,Ht("StructArrayLayout1ul3ui12",Uu);class Bl extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,o)}emplace(e,o,a){const u=2*e;return this.uint16[u+0]=o,this.uint16[u+1]=a,e}}Bl.prototype.bytesPerElement=4,Ht("StructArrayLayout2ui4",Bl);class ju extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint16[1*e+0]=o,e}}ju.prototype.bytesPerElement=2,Ht("StructArrayLayout1ui2",ju);class $u extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,o)}emplace(e,o,a){const u=2*e;return this.float32[u+0]=o,this.float32[u+1]=a,e}}$u.prototype.bytesPerElement=8,Ht("StructArrayLayout2f8",$u);class Vl extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,o,a,u)}emplace(e,o,a,u,p){const _=4*e;return this.float32[_+0]=o,this.float32[_+1]=a,this.float32[_+2]=u,this.float32[_+3]=p,e}}Vl.prototype.bytesPerElement=16,Ht("StructArrayLayout4f16",Vl);class Ff extends Bc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ff.prototype.size=40;class Yd extends Hd{get(e){return new Ff(this,e)}}Ht("CollisionBoxArray",Yd);class Lf extends Bc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Lf.prototype.size=60;class Nf extends cc{get(e){return new Lf(this,e)}}Ht("PlacedSymbolArray",Nf);class zf extends Bc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}zf.prototype.size=76;class ml extends Wd{get(e){return new zf(this,e)}}Ht("SymbolInstanceArray",ml);class jc extends kh{getoffsetX(e){return this.float32[1*e+0]}}Ht("GlyphOffsetArray",jc);class Xd extends Of{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ht("SymbolLineVertexArray",Xd);class Bf extends Bc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Bf.prototype.size=12;class Vf extends Uu{get(e){return new Bf(this,e)}}Ht("FeatureIndexArray",Vf);class Uf extends Bc{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Uf.prototype.size=4;class jf extends Bl{get(e){return new Uf(this,e)}}Ht("FillExtrusionCentroidArray",jf);const qg=Di([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),$f=Di([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Zf=Ho(function(r){r.exports=function(e,o){var a,u,p,_,x,C,D,O;for(u=e.length-(a=3&e.length),p=o,x=3432918353,C=461845907,O=0;O<u;)D=255&e.charCodeAt(O)|(255&e.charCodeAt(++O))<<8|(255&e.charCodeAt(++O))<<16|(255&e.charCodeAt(++O))<<24,++O,p=27492+(65535&(_=5*(65535&(p=(p^=D=(65535&(D=(D=(65535&D)*x+(((D>>>16)*x&65535)<<16)&4294967295)<<15|D>>>17))*C+(((D>>>16)*C&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(D=0,a){case 3:D^=(255&e.charCodeAt(O+2))<<16;case 2:D^=(255&e.charCodeAt(O+1))<<8;case 1:p^=D=(65535&(D=(D=(65535&(D^=255&e.charCodeAt(O)))*x+(((D>>>16)*x&65535)<<16)&4294967295)<<15|D>>>17))*C+(((D>>>16)*C&65535)<<16)&4294967295}return p^=e.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}}),Wg=Ho(function(r){r.exports=function(e,o){for(var a,u=e.length,p=o^u,_=0;u>=4;)a=1540483477*(65535&(a=255&e.charCodeAt(_)|(255&e.charCodeAt(++_))<<8|(255&e.charCodeAt(++_))<<16|(255&e.charCodeAt(++_))<<24))+((1540483477*(a>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++_;switch(u){case 3:p^=(255&e.charCodeAt(_+2))<<16;case 2:p^=(255&e.charCodeAt(_+1))<<8;case 1:p=1540483477*(65535&(p^=255&e.charCodeAt(_)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}}),Zu=Zf,Yg=Wg;Zu.murmur3=Zf,Zu.murmur2=Yg;class Kd{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,o,a,u){this.ids.push(Gf(e)),this.positions.push(o,a,u)}getPositions(e){const o=Gf(e);let a=0,u=this.ids.length-1;for(;a<u;){const _=a+u>>1;this.ids[_]>=o?u=_:a=_+1}const p=[];for(;this.ids[a]===o;)p.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return p}static serialize(e,o){const a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return $c(a,u,0,a.length-1),o&&o.push(a.buffer,u.buffer),{ids:a,positions:u}}static deserialize(e){const o=new Kd;return o.ids=e.ids,o.positions=e.positions,o.indexed=!0,o}}function Gf(r){const e=+r;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Zu(String(r))}function $c(r,e,o,a){for(;o<a;){const u=r[o+a>>1];let p=o-1,_=a+1;for(;;){do{p++}while(r[p]<u);do{_--}while(r[_]>u);if(p>=_)break;Gu(r,p,_),Gu(e,3*p,3*_),Gu(e,3*p+1,3*_+1),Gu(e,3*p+2,3*_+2)}_-o<a-_?($c(r,e,o,_),o=_+1):($c(r,e,_+1,a),a=_)}}function Gu(r,e,o){const a=r[e];r[e]=r[o],r[o]=a}Ht("FeaturePositionMap",Kd);class is{constructor(e,o){this.gl=e.gl,this.location=o}}class hc extends is{constructor(e,o){super(e,o),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Jd extends is{constructor(e,o){super(e,o),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Qd extends is{constructor(e,o){super(e,o),this.current=Jn.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Hf=new Float32Array(16),pv=new Float32Array(9),fv=new Float32Array(4);function qf(r){return[If(255*r.r,255*r.g),If(255*r.b,255*r.a)]}class Zc{constructor(e,o,a){this.value=e,this.uniformNames=o.map(u=>`u_${u}`),this.type=a}setUniform(e,o,a){e.set(a.constantOr(this.value))}getBinding(e,o,a){return"color"===this.type?new Qd(e,o):new hc(e,o)}}class dc{constructor(e,o){this.uniformNames=o.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=o.tl.concat(o.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,o,a,u){const p="u_pattern_to"===u||"u_dash_to"===u?this.patternTo:"u_pattern_from"===u||"u_dash_from"===u?this.patternFrom:"u_pixel_ratio_to"===u?this.pixelRatioTo:"u_pixel_ratio_from"===u?this.pixelRatioFrom:null;p&&e.set(p)}getBinding(e,o,a){return"u_pattern_from"===a||"u_pattern_to"===a||"u_dash_from"===a||"u_dash_to"===a?new Jd(e,o):new hc(e,o)}}class Wa{constructor(e,o,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=o.map(p=>({name:`a_${p}`,type:"Float32",components:"color"===a?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,o,a,u,p,_){const x=this.paintVertexArray.length,C=this.expression.evaluate(new En(0),o,{},p,u,_);this.paintVertexArray.resize(e),this._setPaintValue(x,e,C)}updatePaintArray(e,o,a,u,p){const _=this.expression.evaluate({zoom:0},a,u,void 0,p);this._setPaintValue(e,o,_)}_setPaintValue(e,o,a){if("color"===this.type){const u=qf(a);for(let p=e;p<o;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=e;u<o;u++)this.paintVertexArray.emplace(u,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class gl{constructor(e,o,a,u,p,_){this.expression=e,this.uniformNames=o.map(x=>`u_${x}_t`),this.type=a,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=o.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===a?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,o,a,u,p,_){const x=this.expression.evaluate(new En(this.zoom),o,{},p,u,_),C=this.expression.evaluate(new En(this.zoom+1),o,{},p,u,_),D=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(D,e,x,C)}updatePaintArray(e,o,a,u,p){const _=this.expression.evaluate({zoom:this.zoom},a,u,void 0,p),x=this.expression.evaluate({zoom:this.zoom+1},a,u,void 0,p);this._setPaintValue(e,o,_,x)}_setPaintValue(e,o,a,u){if("color"===this.type){const p=qf(a),_=qf(u);for(let x=e;x<o;x++)this.paintVertexArray.emplace(x,p[0],p[1],_[0],_[1])}else{for(let p=e;p<o;p++)this.paintVertexArray.emplace(p,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,o){const a=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,u=pn(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,o,a){return new hc(e,o)}}class Gc{constructor(e,o,a,u,p,_,x){this.expression=e,this.type=a,this.useIntegerZoom=u,this.zoom=p,this.layerId=x,this.paintVertexAttributes=("array"===a?$f:qg).members;for(let C=0;C<o.length;++C);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,o,a){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,o.patterns&&o.patterns[this.layerId],a)}updatePaintArray(e,o,a,u,p,_){this._setPaintValues(e,o,a.patterns&&a.patterns[this.layerId],_)}_setPaintValues(e,o,a,u){if(!u||!a)return;const{min:p,mid:_,max:x}=a,C=u[p],D=u[_],O=u[x];if(C&&D&&O)for(let N=e;N<o;N++)this._setPaintValue(this.zoomInPaintVertexArray,N,D,C),this._setPaintValue(this.zoomOutPaintVertexArray,N,D,O)}_setPaintValue(e,o,a,u){e.emplace(o,a.tl[0],a.tl[1],a.br[0],a.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],a.pixelRatio,u.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class _l{constructor(e,o,a=(()=>!0)){this.binders={},this._buffers=[];const u=[];for(const p in e.paint._values){if(!a(p))continue;const _=e.paint.get(p);if(!(_ instanceof Ds&&il(_.property.specification)))continue;const x=Kg(p,e.type),C=_.value,D=_.property.specification.type,O=_.property.useIntegerZoom,N=_.property.specification["property-type"],B="cross-faded"===N||"cross-faded-data-driven"===N,X="line-dasharray"===String(p)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==C.kind||X)if("source"===C.kind||X||B){const ne=Hu(p,D,"source");this.binders[p]=B?new Gc(C,x,D,O,o,ne,e.id):new Wa(C,x,D,ne),u.push(`/a_${p}`)}else{const ne=Hu(p,D,"composite");this.binders[p]=new gl(C,x,D,O,o,ne),u.push(`/z_${p}`)}else this.binders[p]=B?new dc(C.value,x):new Zc(C.value,x,D),u.push(`/u_${p}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const o=this.binders[e];return o instanceof Wa||o instanceof gl?o.maxValue:0}populatePaintArrays(e,o,a,u,p,_){for(const x in this.binders){const C=this.binders[x];(C instanceof Wa||C instanceof gl||C instanceof Gc)&&C.populatePaintArray(e,o,a,u,p,_)}}setConstantPatternPositions(e,o){for(const a in this.binders){const u=this.binders[a];u instanceof dc&&u.setConstantPatternPositions(e,o)}}updatePaintArrays(e,o,a,u,p,_){let x=!1;for(const C in e){const D=o.getPositions(C);for(const O of D){const N=a.feature(O.index);for(const B in this.binders){const X=this.binders[B];if((X instanceof Wa||X instanceof gl||X instanceof Gc)&&!0===X.expression.isStateDependent){const ne=u.paint.get(B);X.expression=ne.value,X.updatePaintArray(O.start,O.end,N,e[C],p,_),x=!0}}}}return x}defines(){const e=[];for(const o in this.binders){const a=this.binders[o];(a instanceof Zc||a instanceof dc)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const o in this.binders){const a=this.binders[o];if(a instanceof Wa||a instanceof gl||a instanceof Gc)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const o in this.binders){const a=this.binders[o];if(a instanceof Zc||a instanceof dc||a instanceof gl)for(const u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,o){const a=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof Zc||p instanceof dc||p instanceof gl)for(const _ of p.uniformNames)if(o[_]){const x=p.getBinding(e,o[_],_);a.push({name:_,property:u,binding:x})}}return a}setUniforms(e,o,a,u){for(const{name:p,property:_,binding:x}of o)this.binders[_].setUniform(x,u,a.get(_),p)}updatePaintBuffers(e){this._buffers=[];for(const o in this.binders){const a=this.binders[o];if(e&&a instanceof Gc){const u=2===e.fromScale?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(a instanceof Wa||a instanceof gl)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const o in this.binders){const a=this.binders[o];(a instanceof Wa||a instanceof gl||a instanceof Gc)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const o=this.binders[e];(o instanceof Wa||o instanceof gl||o instanceof Gc)&&o.destroy()}}}class Hc{constructor(e,o,a=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new _l(u,o,a);this.needsUpload=!1,this._featureMap=new Kd,this._bufferOffset=0}populatePaintArrays(e,o,a,u,p,_,x){for(const C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(e,o,u,p,_,x);void 0!==o.id&&this._featureMap.add(o.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,o,a,u,p){for(const _ of a)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,o,_,u,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Xg={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Kg(r,e){return Xg[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const Jg={"line-pattern":{source:Uc,composite:Uc},"fill-pattern":{source:Uc,composite:Uc},"fill-extrusion-pattern":{source:Uc,composite:Uc},"line-dasharray":{source:Vu,composite:Vu}},Wf={color:{source:$u,composite:Vl},number:{source:kh,composite:$u}};function Hu(r,e,o){const a=Jg[r];return a&&a[o]||Wf[e][o]}Ht("ConstantBinder",Zc),Ht("CrossFadedConstantBinder",dc),Ht("SourceExpressionBinder",Wa),Ht("CrossFadedCompositeBinder",Gc),Ht("CompositeExpressionBinder",gl),Ht("ProgramConfiguration",_l,{omit:["_buffers"]}),Ht("ProgramConfigurationSet",Hc);const qu="-transition";class _a extends qr{constructor(e,o){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),o.layout&&(this._unevaluatedLayout=new Ha(o.layout)),o.paint)){this._transitionablePaint=new Ts(o.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fl(o.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,o,a={}){null!=o&&this._validate(en,`layers.${this.id}.layout.${e}`,e,o,a)||("visibility"!==e?this._unevaluatedLayout.setValue(e,o):this.visibility=o)}getPaintProperty(e){return Xt(e,qu)?this._transitionablePaint.getTransition(e.slice(0,-qu.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,o,a={}){if(null!=o&&this._validate(ft,`layers.${this.id}.paint.${e}`,e,o,a))return!1;if(Xt(e,qu))return this._transitionablePaint.setTransition(e.slice(0,-qu.length),o||void 0),!1;{const u=this._transitionablePaint._values[e],p="cross-faded-data-driven"===u.property.specification["property-type"],_=u.value.isDataDriven(),x=u.value;this._transitionablePaint.setValue(e,o),this._handleSpecialPaintPropertyUpdate(e);const C=this._transitionablePaint._values[e].value;return C.isDataDriven()||_||p||this._handleOverridablePaintPropertyUpdate(e,x,C)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,o,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,o){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,o)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Sr(e,(o,a)=>!(void 0===o||"layout"===a&&!Object.keys(o).length||"paint"===a&&!Object.keys(o).length))}_validate(e,o,a,u,p={}){return(!p||!1!==p.validate)&&Rr(this,e.call(oe,{key:o,layerType:this.type,objectKey:a,value:u,styleSpec:rt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const o=this.paint.get(e);if(o instanceof Ds&&il(o.property.specification)&&("source"===o.value.kind||"composite"===o.value.kind)&&o.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ta(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Qg=Di([{name:"a_pos",components:2,type:"Int16"}],4),{members:xo}=Qg;class io{constructor(e=[]){this.segments=e}prepareSegment(e,o,a,u){let p=this.segments[this.segments.length-1];return e>io.MAX_VERTEX_ARRAY_LENGTH&&kn(`Max vertices per segment is ${io.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>io.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u)&&(p={vertexOffset:o.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},void 0!==u&&(p.sortKey=u),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const e of this.segments)for(const o in e.vaos)e.vaos[o].destroy()}static simpleSegment(e,o,a,u){return new io([{vertexOffset:e,primitiveOffset:o,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}io.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ht("SegmentVector",io);var mr=8192;class Ul{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ni?new ni(e.lng,e.lat):ni.convert(e),this}setSouthWest(e){return this._sw=e instanceof ni?new ni(e.lng,e.lat):ni.convert(e),this}extend(e){const o=this._sw,a=this._ne;let u,p;if(e instanceof ni)u=e,p=e;else{if(!(e instanceof Ul))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Ul.convert(e)):this.extend(ni.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return o||a?(o.lng=Math.min(u.lng,o.lng),o.lat=Math.min(u.lat,o.lat),a.lng=Math.max(p.lng,a.lng),a.lat=Math.max(p.lat,a.lat)):(this._sw=new ni(u.lng,u.lat),this._ne=new ni(p.lng,p.lat)),this}getCenter(){return new ni((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ni(this.getWest(),this.getNorth())}getSouthEast(){return new ni(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:o,lat:a}=ni.convert(e);let u=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){return!e||e instanceof Ul?e:new Ul(e)}}const ep=6371008.8;class ni{constructor(e,o){if(isNaN(e)||isNaN(o))throw new Error(`Invalid LngLat object: (${e}, ${o})`);if(this.lng=+e,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ni(Br(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const o=Math.PI/180,a=this.lat*o,u=e.lat*o,p=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*o);return ep*Math.acos(Math.min(p,1))}toBounds(e=0){const o=360*e/40075017,a=o/Math.cos(Math.PI/180*this.lat);return new Ul(new ni(this.lng-a,this.lat-o),new ni(this.lng+a,this.lat+o))}static convert(e){if(e instanceof ni)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new ni(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new ni(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Yf=2*Math.PI*ep;function Xf(r){return Yf*Math.cos(r*Math.PI/180)}function vu(r){return(180+r)/360}function xu(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function yl(r,e){return r/Xf(e)}function pc(r){return 360*r-180}function As(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Ms(r,e){return r*Xf(As(e))}const Aa=85.051129;class Wu{constructor(e,o,a=0){this.x=+e,this.y=+o,this.z=+a}static fromLngLat(e,o=0){const a=ni.convert(e);return new Wu(vu(a.lng),xu(a.lat),yl(o,a.lat))}toLngLat(){return new ni(pc(this.x),As(this.y))}toAltitude(){return Ms(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Yf*(e=As(this.y),1/Math.cos(e*Math.PI/180));var e}}function Oh(r,e,o,a,u,p,_,x,C){const D=(e+a)/2,O=(o+u)/2,N=new Me(D,O);x(N),function(B,X,ne,ae,le,ye){const De=ne-le,Re=ae-ye;return Math.abs((ae-X)*De-(ne-B)*Re)/Math.hypot(De,Re)}(N.x,N.y,p.x,p.y,_.x,_.y)>=C?(Oh(r,e,o,D,O,p,N,x,C),Oh(r,D,O,a,u,N,_,x,C)):r.push(_)}function Ss(r,e,o){const a=[];let u,p,_;for(const x of r){const{x:C,y:D}=x;e(x),_?Oh(a,u,p,C,D,_,x,e,o):a.push(x),u=C,p=D,_=x}return a}const qc=Math.pow(2,14)-1,Fh=-qc-1;function e_(r,e){const o=Math.round(r.x*e),a=Math.round(r.y*e);return r.x=pn(o,Fh,qc),r.y=pn(a,Fh,qc),(o<r.x||o>r.x+1||a<r.y||a>r.y+1)&&kn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function jl(r,e,o){const a=r.loadGeometry(),u=r.extent,p=mr/u;if(e&&o&&o.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:x,x:C,y:D,projection:O}=o,N=B=>{const X=pc((e.x+B.x/u)/_),ne=As((e.y+B.y/u)/_),ae=O.project(X,ne);B.x=(ae.x*x-C)*u,B.y=(ae.y*x-D)*u};for(let B=0;B<a.length;B++)if(1!==r.type)a[B]=Ss(a[B],N,1);else{const X=[];for(const ne of a[B])ne.x<0||ne.x>=u||ne.y<0||ne.y>=u||(N(ne),X.push(ne));a[B]=X}}for(const _ of a)for(const x of _)e_(x,p);return a}function fc(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?jl(r):[]}}function Lh(r,e,o,a,u){r.emplaceBack(2*e+(a+1)/2,2*o+(u+1)/2)}class Nh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new gu,this.indexArray=new Vs,this.segments=new io,this.programConfigurations=new Hc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,a,u){const p=this.layers[0],_=[];let x=null;"circle"===p.type&&(x=p.layout.get("circle-sort-key"));for(const{feature:C,id:D,index:O,sourceLayerIndex:N}of e){const B=this.layers[0]._featureFilter.needGeometry,X=fc(C,B);if(!this.layers[0]._featureFilter.filter(new En(this.zoom),X,a))continue;const ne=x?x.evaluate(X,{},a):void 0,ae={id:D,properties:C.properties,type:C.type,sourceLayerIndex:N,index:O,geometry:B?X.geometry:jl(C,a,u),patterns:{},sortKey:ne};_.push(ae)}x&&_.sort((C,D)=>C.sortKey-D.sortKey);for(const C of _){const{geometry:D,index:O,sourceLayerIndex:N}=C,B=e[O].feature;this.addFeature(C,D,O,o.availableImages,a),o.featureIndex.insert(B,D,O,N,this.index)}}update(e,o,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xo),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,o,a,u,p){for(const _ of o)for(const x of _){const C=x.x,D=x.y;if(C<0||C>=mr||D<0||D>=mr)continue;const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),N=O.vertexLength;Lh(this.layoutVertexArray,C,D,-1,-1),Lh(this.layoutVertexArray,C,D,1,-1),Lh(this.layoutVertexArray,C,D,1,1),Lh(this.layoutVertexArray,C,D,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+3,N+2),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u,p)}}function Kf(r,e){for(let o=0;o<r.length;o++)if(Xu(e,r[o]))return!0;for(let o=0;o<e.length;o++)if(Xu(r,e[o]))return!0;return!!tp(r,e)}function Jf(r,e,o){return!!Xu(r,e)||!!Yu(e,r,o)}function Qf(r,e){if(1===r.length)return tm(e,r[0]);for(let o=0;o<e.length;o++){const a=e[o];for(let u=0;u<a.length;u++)if(Xu(r,a[u]))return!0}for(let o=0;o<r.length;o++)if(tm(e,r[o]))return!0;for(let o=0;o<e.length;o++)if(tp(r,e[o]))return!0;return!1}function t_(r,e,o){if(r.length>1){if(tp(r,e))return!0;for(let a=0;a<e.length;a++)if(Yu(e[a],r,o))return!0}for(let a=0;a<r.length;a++)if(Yu(r[a],e,o))return!0;return!1}function tp(r,e){if(0===r.length||0===e.length)return!1;for(let o=0;o<r.length-1;o++){const a=r[o],u=r[o+1];for(let p=0;p<e.length-1;p++)if(em(a,u,e[p],e[p+1]))return!0}return!1}function em(r,e,o,a){return On(r,o,a)!==On(e,o,a)&&On(r,e,o)!==On(r,e,a)}function Yu(r,e,o){const a=o*o;if(1===e.length)return r.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(np(r,e[u-1],e[u])<a)return!0;return!1}function np(r,e,o){const a=e.distSqr(o);if(0===a)return r.distSqr(e);const u=((r.x-e.x)*(o.x-e.x)+(r.y-e.y)*(o.y-e.y))/a;return r.distSqr(u<0?e:u>1?o:o.sub(e)._mult(u)._add(e))}function tm(r,e){let o,a,u,p=!1;for(let _=0;_<r.length;_++){o=r[_];for(let x=0,C=o.length-1;x<o.length;C=x++)a=o[x],u=o[C],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(p=!p)}return p}function Xu(r,e){let o=!1;for(let a=0,u=r.length-1;a<r.length;u=a++){const p=r[a],_=r[u];p.y>e.y!=_.y>e.y&&e.x<(_.x-p.x)*(e.y-p.y)/(_.y-p.y)+p.x&&(o=!o)}return o}function rp(r,e,o,a,u){for(const _ of r)if(e<=_.x&&o<=_.y&&a>=_.x&&u>=_.y)return!0;const p=[new Me(e,o),new Me(e,u),new Me(a,u),new Me(a,o)];if(r.length>2)for(const _ of p)if(Xu(r,_))return!0;for(let _=0;_<r.length-1;_++)if(zh(r[_],r[_+1],p))return!0;return!1}function zh(r,e,o){const a=o[0],u=o[2];if(r.x<a.x&&e.x<a.x||r.x>u.x&&e.x>u.x||r.y<a.y&&e.y<a.y||r.y>u.y&&e.y>u.y)return!1;const p=On(r,e,o[0]);return p!==On(r,e,o[1])||p!==On(r,e,o[2])||p!==On(r,e,o[3])}function bu(r,e,o){const a=e.paint.get(r).value;return"constant"===a.kind?a.value:o.programConfigurations.get(e.id).getMaxValue(r)}function Bh(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Wc(r,e,o,a,u){if(!e[0]&&!e[1])return r;const p=Me.convert(e)._mult(u);"viewport"===o&&p._rotate(-a);const _=[];for(let x=0;x<r.length;x++)_.push(r[x].sub(p));return _}function nm(r,e,o,a){const u=Me.convert(r)._mult(a);return"viewport"===e&&u._rotate(-o),u}Ht("CircleBucket",Nh,{omit:["layers"]});const n_=new ki({"circle-sort-key":new fn(rt.layout_circle["circle-sort-key"])});var r_={paint:new ki({"circle-radius":new fn(rt.paint_circle["circle-radius"]),"circle-color":new fn(rt.paint_circle["circle-color"]),"circle-blur":new fn(rt.paint_circle["circle-blur"]),"circle-opacity":new fn(rt.paint_circle["circle-opacity"]),"circle-translate":new tn(rt.paint_circle["circle-translate"]),"circle-translate-anchor":new tn(rt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new tn(rt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new tn(rt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new fn(rt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new fn(rt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new fn(rt.paint_circle["circle-stroke-opacity"])}),layout:n_};class ip{constructor(e,o){this.points=e,this.planes=o}static fromInvProjectionMatrix(e,o,a,u){const p=Math.pow(2,a),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const D=bo([],C,e),O=1/D[3]/o*p;return(N=D)[0]=(B=D)[0]*(X=[O,O,u?1/D[3]:O,O])[0],N[1]=B[1]*X[1],N[2]=B[2]*X[2],N[3]=B[3]*X[3],N;var N,B,X}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const D=Un([],lo([],co([],_[C[0]],_[C[1]]),co([],_[C[2]],_[C[1]]))),O=-$t(D,_[C[1]]);return D.concat(O)});return new ip(_,x)}}class Ya{constructor(e,o){this.min=e,this.max=o,this.center=In([],li([],this.min,this.max),.5)}quadrant(e){const o=[e%2==0,e<2],a=hn(this.min),u=hn(this.max);for(let p=0;p<o.length;p++)a[p]=o[p]?this.min[p]:this.center[p],u[p]=o[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new Ya(a,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,o=this.max;return[[e[0],e[1],e[2]],[o[0],e[1],e[2]],[o[0],o[1],e[2]],[e[0],o[1],e[2]],[e[0],e[1],o[2]],[o[0],e[1],o[2]],[o[0],o[1],o[2]],[e[0],o[1],o[2]]]}intersects(e){const o=this.getCorners();let a=!0;for(let u=0;u<e.planes.length;u++){const p=e.planes[u];let _=0;for(let x=0;x<o.length;x++)_+=$t(p,o[x])+p[3]>=0;if(0===_)return 0;_!==o.length&&(a=!1)}if(a)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let x=0;x<e.points.length;x++){const C=e.points[x][u]-this.min[u];p=Math.min(p,C),_=Math.max(_,C)}if(_<0||p>this.max[u]-this.min[u])return 0}return 1}}function Ku(r,e,o,a,u,p,_,x,C){if(p&&r.queryGeometry.isAboveHorizon)return!1;p&&(C*=r.pixelToTileUnitsFactor);for(const D of e)for(const O of D){const N=O.add(x),B=u&&o.elevation?o.elevation.exaggeration()*u.getElevationAt(N.x,N.y,!0):0,X=p?N:Ma(N,B,a),ne=p?r.tilespaceRays.map(le=>o_(le,B)):r.queryGeometry.screenGeometry,ae=bo([],[O.x,O.y,B,1],a);if(!_&&p?C*=ae[3]/o.cameraToCenterDistance:_&&!p&&(C*=o.cameraToCenterDistance/ae[3]),Jf(ne,X,C))return!0}return!1}function Ma(r,e,o){const a=bo([],[r.x,r.y,e,1],o);return new Me(a[0]/a[3],a[1]/a[3])}const op=ao(0,0,0),i_=ao(0,0,1);function o_(r,e){const o=vr();return op[2]=e,r.intersectsPlane(op,i_,o),new Me(o[0],o[1])}class sp extends Nh{}function rm(r,{width:e,height:o},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*o*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*o*a);return r.width=e,r.height=o,r.data=u,r}function ap(r,{width:e,height:o},a){if(e===r.width&&o===r.height)return;const u=rm({},{width:e,height:o},a);lp(r,u,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,o)},a),r.width=e,r.height=o,r.data=u.data}function lp(r,e,o,a,u,p){if(0===u.width||0===u.height)return e;if(u.width>r.width||u.height>r.height||o.x>r.width-u.width||o.y>r.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const _=r.data,x=e.data;for(let C=0;C<u.height;C++){const D=((o.y+C)*r.width+o.x)*p,O=((a.y+C)*e.width+a.x)*p;for(let N=0;N<u.width*p;N++)x[O+N]=_[D+N]}return e}Ht("HeatmapBucket",sp,{omit:["layers"]});class mc{constructor(e,o){rm(this,e,1,o)}resize(e){ap(this,e,1)}clone(){return new mc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,a,u,p){lp(e,o,a,u,p,1)}}class ya{constructor(e,o){rm(this,e,4,o)}resize(e){ap(this,e,4)}replace(e,o){o?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ya({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,a,u,p){lp(e,o,a,u,p,4)}}Ht("AlphaImage",mc),Ht("RGBAImage",ya);var wu={paint:new ki({"heatmap-radius":new fn(rt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new fn(rt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new tn(rt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ga(rt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new tn(rt.paint_heatmap["heatmap-opacity"])})};function Sa(r){const e={},o=r.resolution||256,a=r.clips?r.clips.length:1,u=r.image||new ya({width:o,height:a}),p=(_,x,C)=>{e[r.evaluationKey]=C;const D=r.expression.evaluate(e);u.data[_+x+0]=Math.floor(255*D.r/D.a),u.data[_+x+1]=Math.floor(255*D.g/D.a),u.data[_+x+2]=Math.floor(255*D.b/D.a),u.data[_+x+3]=Math.floor(255*D.a)};if(r.clips)for(let _=0,x=0;_<a;++_,x+=4*o)for(let C=0,D=0;C<o;C++,D+=4){const O=C/(o-1),{start:N,end:B}=r.clips[_];p(x,D,N*(1-O)+B*O)}else for(let _=0,x=0;_<o;_++,x+=4)p(0,x,_/(o-1));return u}var mv={paint:new ki({"hillshade-illumination-direction":new tn(rt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new tn(rt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new tn(rt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new tn(rt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new tn(rt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new tn(rt.paint_hillshade["hillshade-accent-color"])})};const gv=Di([{name:"a_pos",components:2,type:"Int16"}],4),{members:im}=gv;var cp=Cu,vl=Cu;function Cu(r,e,o){o=o||2;var a,u,p,_,x,C,D,O=e&&e.length,N=O?e[0]*o:r.length,B=Vh(r,0,N,o,!0),X=[];if(!B||B.next===B.prev)return X;if(O&&(B=function(ae,le,ye,De){var Re,Ve,$e,Ge=[];for(Re=0,Ve=le.length;Re<Ve;Re++)($e=Vh(ae,le[Re]*De,Re<Ve-1?le[Re+1]*De:ae.length,De,!1))===$e.next&&($e.steiner=!0),Ge.push(dp($e));for(Ge.sort(hp),Re=0;Re<Ge.length;Re++)ye=gc(ye=am(Ge[Re],ye),ye.next);return ye}(r,e,B,o)),r.length>80*o){a=p=r[0],u=_=r[1];for(var ne=o;ne<N;ne+=o)(x=r[ne])<a&&(a=x),(C=r[ne+1])<u&&(u=C),x>p&&(p=x),C>_&&(_=C);D=0!==(D=Math.max(p-a,_-u))?1/D:0}return Eu(B,X,o,a,u,D),X}function Vh(r,e,o,a,u){var p,_;if(u===eh(r,e,o,a)>0)for(p=e;p<o;p+=a)_=pp(p,r[p],r[p+1],_);else for(p=o-a;p>=e;p-=a)_=pp(p,r[p],r[p+1],_);return _&&Uh(_,_.next)&&(Xc(_),_=_.next),_}function gc(r,e){if(!r)return r;e||(e=r);var o,a=r;do{if(o=!1,a.steiner||!Uh(a,a.next)&&0!==Vi(a.prev,a,a.next))a=a.next;else{if(Xc(a),(a=e=a.prev)===a.next)break;o=!0}}while(o||a!==e);return e}function Eu(r,e,o,a,u,p,_){if(r){!_&&p&&function(O,N,B,X){var ne=O;do{null===ne.z&&(ne.z=_c(ne.x,ne.y,N,B,X)),ne.prevZ=ne.prev,ne.nextZ=ne.next,ne=ne.next}while(ne!==O);ne.prevZ.nextZ=null,ne.prevZ=null,function(ae){var le,ye,De,Re,Ve,$e,Ge,dt,ct=1;do{for(ye=ae,ae=null,Ve=null,$e=0;ye;){for($e++,De=ye,Ge=0,le=0;le<ct&&(Ge++,De=De.nextZ);le++);for(dt=ct;Ge>0||dt>0&&De;)0!==Ge&&(0===dt||!De||ye.z<=De.z)?(Re=ye,ye=ye.nextZ,Ge--):(Re=De,De=De.nextZ,dt--),Ve?Ve.nextZ=Re:ae=Re,Re.prevZ=Ve,Ve=Re;ye=De}Ve.nextZ=null,ct*=2}while($e>1)}(ne)}(r,a,u,p);for(var x,C,D=r;r.prev!==r.next;)if(x=r.prev,C=r.next,p?om(r,a,u,p):Ju(r))e.push(x.i/o),e.push(r.i/o),e.push(C.i/o),Xc(r),r=C.next,D=C.next;else if((r=C)===D){_?1===_?Eu(r=sm(gc(r),e,o),e,o,a,u,p,2):2===_&&up(r,e,o,a,u,p):Eu(gc(r),e,o,a,u,p,1);break}}}function Ju(r){var e=r.prev,o=r,a=r.next;if(Vi(e,o,a)>=0)return!1;for(var u=r.next.next;u!==r.prev;){if(Yc(e.x,e.y,o.x,o.y,a.x,a.y,u.x,u.y)&&Vi(u.prev,u,u.next)>=0)return!1;u=u.next}return!0}function om(r,e,o,a){var u=r.prev,p=r,_=r.next;if(Vi(u,p,_)>=0)return!1;for(var x=u.x>p.x?u.x>_.x?u.x:_.x:p.x>_.x?p.x:_.x,C=u.y>p.y?u.y>_.y?u.y:_.y:p.y>_.y?p.y:_.y,D=_c(u.x<p.x?u.x<_.x?u.x:_.x:p.x<_.x?p.x:_.x,u.y<p.y?u.y<_.y?u.y:_.y:p.y<_.y?p.y:_.y,e,o,a),O=_c(x,C,e,o,a),N=r.prevZ,B=r.nextZ;N&&N.z>=D&&B&&B.z<=O;){if(N!==r.prev&&N!==r.next&&Yc(u.x,u.y,p.x,p.y,_.x,_.y,N.x,N.y)&&Vi(N.prev,N,N.next)>=0||(N=N.prevZ,B!==r.prev&&B!==r.next&&Yc(u.x,u.y,p.x,p.y,_.x,_.y,B.x,B.y)&&Vi(B.prev,B,B.next)>=0))return!1;B=B.nextZ}for(;N&&N.z>=D;){if(N!==r.prev&&N!==r.next&&Yc(u.x,u.y,p.x,p.y,_.x,_.y,N.x,N.y)&&Vi(N.prev,N,N.next)>=0)return!1;N=N.prevZ}for(;B&&B.z<=O;){if(B!==r.prev&&B!==r.next&&Yc(u.x,u.y,p.x,p.y,_.x,_.y,B.x,B.y)&&Vi(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0}function sm(r,e,o){var a=r;do{var u=a.prev,p=a.next.next;!Uh(u,p)&&lm(u,a,a.next,p)&&Qu(u,p)&&Qu(p,u)&&(e.push(u.i/o),e.push(a.i/o),e.push(p.i/o),Xc(a),Xc(a.next),a=r=p),a=a.next}while(a!==r);return gc(a)}function up(r,e,o,a,u,p){var _=r;do{for(var x=_.next.next;x!==_.prev;){if(_.i!==x.i&&s_(_,x)){var C=cm(_,x);return _=gc(_,_.next),C=gc(C,C.next),Eu(_,e,o,a,u,p),void Eu(C,e,o,a,u,p)}x=x.next}_=_.next}while(_!==r)}function hp(r,e){return r.x-e.x}function am(r,e){var o=function(p,_){var x,C=_,D=p.x,O=p.y,N=-1/0;do{if(O<=C.y&&O>=C.next.y&&C.next.y!==C.y){var B=C.x+(O-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(B<=D&&B>N){if(N=B,B===D){if(O===C.y)return C;if(O===C.next.y)return C.next}x=C.x<C.next.x?C:C.next}}C=C.next}while(C!==_);if(!x)return null;if(D===N)return x;var X,ne=x,ae=x.x,le=x.y,ye=1/0;C=x;do{D>=C.x&&C.x>=ae&&D!==C.x&&Yc(O<le?D:N,O,ae,le,O<le?N:D,O,C.x,C.y)&&(X=Math.abs(O-C.y)/(D-C.x),Qu(C,p)&&(X<ye||X===ye&&(C.x>x.x||C.x===x.x&&_v(x,C)))&&(x=C,ye=X)),C=C.next}while(C!==ne);return x}(r,e);if(!o)return e;var a=cm(o,r),u=gc(o,o.next);return gc(a,a.next),e===o?u:e}function _v(r,e){return Vi(r.prev,r,e.prev)<0&&Vi(e.next,r,r.next)<0}function _c(r,e,o,a,u){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-o)*u)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-a)*u)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function dp(r){var e=r,o=r;do{(e.x<o.x||e.x===o.x&&e.y<o.y)&&(o=e),e=e.next}while(e!==r);return o}function Yc(r,e,o,a,u,p,_,x){return(u-_)*(e-x)-(r-_)*(p-x)>=0&&(r-_)*(a-x)-(o-_)*(e-x)>=0&&(o-_)*(p-x)-(u-_)*(a-x)>=0}function s_(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(o,a){var u=o;do{if(u.i!==o.i&&u.next.i!==o.i&&u.i!==a.i&&u.next.i!==a.i&&lm(u,u.next,o,a))return!0;u=u.next}while(u!==o);return!1}(r,e)&&(Qu(r,e)&&Qu(e,r)&&function(o,a){var u=o,p=!1,_=(o.x+a.x)/2,x=(o.y+a.y)/2;do{u.y>x!=u.next.y>x&&u.next.y!==u.y&&_<(u.next.x-u.x)*(x-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next}while(u!==o);return p}(r,e)&&(Vi(r.prev,r,e.prev)||Vi(r,e.prev,e))||Uh(r,e)&&Vi(r.prev,r,r.next)>0&&Vi(e.prev,e,e.next)>0)}function Vi(r,e,o){return(e.y-r.y)*(o.x-e.x)-(e.x-r.x)*(o.y-e.y)}function Uh(r,e){return r.x===e.x&&r.y===e.y}function lm(r,e,o,a){var u=$h(Vi(r,e,o)),p=$h(Vi(r,e,a)),_=$h(Vi(o,a,r)),x=$h(Vi(o,a,e));return u!==p&&_!==x||!(0!==u||!jh(r,o,e))||!(0!==p||!jh(r,a,e))||!(0!==_||!jh(o,r,a))||!(0!==x||!jh(o,e,a))}function jh(r,e,o){return e.x<=Math.max(r.x,o.x)&&e.x>=Math.min(r.x,o.x)&&e.y<=Math.max(r.y,o.y)&&e.y>=Math.min(r.y,o.y)}function $h(r){return r>0?1:r<0?-1:0}function Qu(r,e){return Vi(r.prev,r,r.next)<0?Vi(r,e,r.next)>=0&&Vi(r,r.prev,e)>=0:Vi(r,e,r.prev)<0||Vi(r,r.next,e)<0}function cm(r,e){var o=new Zh(r.i,r.x,r.y),a=new Zh(e.i,e.x,e.y),u=r.next,p=e.prev;return r.next=e,e.prev=r,o.next=u,u.prev=o,a.next=o,o.prev=a,p.next=a,a.prev=p,a}function pp(r,e,o,a){var u=new Zh(r,e,o);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function Xc(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Zh(r,e,o){this.i=r,this.x=e,this.y=o,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function eh(r,e,o,a){for(var u=0,p=e,_=o-a;p<o;p+=a)u+=(r[_]-r[p])*(r[p+1]+r[_+1]),_=p;return u}function a_(r,e,o,a,u){um(r,e,o||0,a||r.length-1,u||hm)}function um(r,e,o,a,u){for(;a>o;){if(a-o>600){var p=a-o+1,_=e-o+1,x=Math.log(p),C=.5*Math.exp(2*x/3),D=.5*Math.sqrt(x*C*(p-C)/p)*(_-p/2<0?-1:1);um(r,e,Math.max(o,Math.floor(e-_*C/p+D)),Math.min(a,Math.floor(e+(p-_)*C/p+D)),u)}var O=r[e],N=o,B=a;for(Tu(r,o,e),u(r[a],O)>0&&Tu(r,o,a);N<B;){for(Tu(r,N,B),N++,B--;u(r[N],O)<0;)N++;for(;u(r[B],O)>0;)B--}0===u(r[o],O)?Tu(r,o,B):Tu(r,++B,a),B<=e&&(o=B+1),e<=B&&(a=B-1)}}function Tu(r,e,o){var a=r[e];r[e]=r[o],r[o]=a}function hm(r,e){return r<e?-1:r>e?1:0}function $l(r,e){const o=r.length;if(o<=1)return[r];const a=[];let u,p;for(let _=0;_<o;_++){const x=rn(r[_]);0!==x&&(r[_].area=Math.abs(x),void 0===p&&(p=x<0),p===x<0?(u&&a.push(u),u=[r[_]]):u.push(r[_]))}if(u&&a.push(u),e>1)for(let _=0;_<a.length;_++)a[_].length<=e||(a_(a[_],e,1,a[_].length-1,dm),a[_]=a[_].slice(0,e));return a}function dm(r,e){return e.area-r.area}function Gh(r,e,o){const a=o.patternDependencies;let u=!1;for(const p of e){const _=p.paint.get(`${r}-pattern`);_.isConstant()||(u=!0);const x=_.constantOr(null);x&&(u=!0,a[x.to]=!0,a[x.from]=!0)}return u}function fp(r,e,o,a,u){const p=u.patternDependencies;for(const _ of e){const x=_.paint.get(`${r}-pattern`).value;if("constant"!==x.kind){let C=x.evaluate({zoom:a-1},o,{},u.availableImages),D=x.evaluate({zoom:a},o,{},u.availableImages),O=x.evaluate({zoom:a+1},o,{},u.availableImages);C=C&&C.name?C.name:C,D=D&&D.name?D.name:D,O=O&&O.name?O.name:O,p[C]=!0,p[D]=!0,p[O]=!0,o.patterns[_.id]={min:C,mid:D,max:O}}}return o}Cu.deviation=function(r,e,o,a){var u=e&&e.length,p=Math.abs(eh(r,0,u?e[0]*o:r.length,o));if(u)for(var _=0,x=e.length;_<x;_++)p-=Math.abs(eh(r,e[_]*o,_<x-1?e[_+1]*o:r.length,o));var C=0;for(_=0;_<a.length;_+=3){var D=a[_]*o,O=a[_+1]*o,N=a[_+2]*o;C+=Math.abs((r[D]-r[N])*(r[O+1]-r[D+1])-(r[D]-r[O])*(r[N+1]-r[D+1]))}return 0===p&&0===C?0:Math.abs((C-p)/p)},Cu.flatten=function(r){for(var e=r[0][0].length,o={vertices:[],holes:[],dimensions:e},a=0,u=0;u<r.length;u++){for(var p=0;p<r[u].length;p++)for(var _=0;_<e;_++)o.vertices.push(r[u][p][_]);u>0&&o.holes.push(a+=r[u-1].length)}return o},cp.default=vl;class Kc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new gu,this.indexArray=new Vs,this.indexArray2=new Bl,this.programConfigurations=new Hc(e.layers,e.zoom),this.segments=new io,this.segments2=new io,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,a,u){this.hasPattern=Gh("fill",this.layers,o);const p=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:C,index:D,sourceLayerIndex:O}of e){const N=this.layers[0]._featureFilter.needGeometry,B=fc(x,N);if(!this.layers[0]._featureFilter.filter(new En(this.zoom),B,a))continue;const X=p?p.evaluate(B,{},a,o.availableImages):void 0,ne={id:C,properties:x.properties,type:x.type,sourceLayerIndex:O,index:D,geometry:N?B.geometry:jl(x,a,u),patterns:{},sortKey:X};_.push(ne)}p&&_.sort((x,C)=>x.sortKey-C.sortKey);for(const x of _){const{geometry:C,index:D,sourceLayerIndex:O}=x;if(this.hasPattern){const N=fp("fill",this.layers,x,this.zoom,o);this.patternFeatures.push(N)}else this.addFeature(x,C,D,a,{},o.availableImages);o.featureIndex.insert(e[D].feature,C,D,O,this.index)}}update(e,o,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,a,u)}addFeatures(e,o,a,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,o,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,im),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,o,a,u,p,_=[]){for(const x of $l(o,500)){let C=0;for(const ne of x)C+=ne.length;const D=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray),O=D.vertexLength,N=[],B=[];for(const ne of x){if(0===ne.length)continue;ne!==x[0]&&B.push(N.length/2);const ae=this.segments2.prepareSegment(ne.length,this.layoutVertexArray,this.indexArray2),le=ae.vertexLength;this.layoutVertexArray.emplaceBack(ne[0].x,ne[0].y),this.indexArray2.emplaceBack(le+ne.length-1,le),N.push(ne[0].x),N.push(ne[0].y);for(let ye=1;ye<ne.length;ye++)this.layoutVertexArray.emplaceBack(ne[ye].x,ne[ye].y),this.indexArray2.emplaceBack(le+ye-1,le+ye),N.push(ne[ye].x),N.push(ne[ye].y);ae.vertexLength+=ne.length,ae.primitiveLength+=ne.length}const X=cp(N,B);for(let ne=0;ne<X.length;ne+=3)this.indexArray.emplaceBack(O+X[ne],O+X[ne+1],O+X[ne+2]);D.vertexLength+=C,D.primitiveLength+=X.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,p,_,u)}}Ht("FillBucket",Kc,{omit:["layers","patternFeatures"]});const l_=new ki({"fill-sort-key":new fn(rt.layout_fill["fill-sort-key"])});var pm={paint:new ki({"fill-antialias":new tn(rt.paint_fill["fill-antialias"]),"fill-opacity":new fn(rt.paint_fill["fill-opacity"]),"fill-color":new fn(rt.paint_fill["fill-color"]),"fill-outline-color":new fn(rt.paint_fill["fill-outline-color"]),"fill-translate":new tn(rt.paint_fill["fill-translate"]),"fill-translate-anchor":new tn(rt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bi(rt.paint_fill["fill-pattern"])}),layout:l_};const fm=Di([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),mm=Di([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:mp}=fm;var gp=Zl;function Zl(r,e,o,a,u){this.properties={},this.extent=o,this.type=0,this._pbf=r,this._geometry=-1,this._keys=a,this._values=u,r.readFields(Hh,this,e)}function Hh(r,e,o){1==r?e.id=o.readVarint():2==r?function(a,u){for(var p=a.readVarint()+a.pos;a.pos<p;){var _=u._keys[a.readVarint()],x=u._values[a.readVarint()];u.properties[_]=x}}(o,e):3==r?e.type=o.readVarint():4==r&&(e._geometry=o.pos)}function gm(r){for(var e,o,a=0,u=0,p=r.length,_=p-1;u<p;_=u++)a+=((o=r[_]).x-(e=r[u]).x)*(e.y+o.y);return a}Zl.types=["Unknown","Point","LineString","Polygon"],Zl.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,o=r.readVarint()+r.pos,a=1,u=0,p=0,_=0,x=[];r.pos<o;){if(u<=0){var C=r.readVarint();a=7&C,u=C>>3}if(u--,1===a||2===a)p+=r.readSVarint(),_+=r.readSVarint(),1===a&&(e&&x.push(e),e=[]),e.push(new Me(p,_));else{if(7!==a)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&x.push(e),x},Zl.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,o=1,a=0,u=0,p=0,_=1/0,x=-1/0,C=1/0,D=-1/0;r.pos<e;){if(a<=0){var O=r.readVarint();o=7&O,a=O>>3}if(a--,1===o||2===o)(u+=r.readSVarint())<_&&(_=u),u>x&&(x=u),(p+=r.readSVarint())<C&&(C=p),p>D&&(D=p);else if(7!==o)throw new Error("unknown command "+o)}return[_,C,x,D]},Zl.prototype.toGeoJSON=function(r,e,o){var a,u,p=this.extent*Math.pow(2,o),_=this.extent*r,x=this.extent*e,C=this.loadGeometry(),D=Zl.types[this.type];function O(X){for(var ne=0;ne<X.length;ne++){var ae=X[ne];X[ne]=[360*(ae.x+_)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(ae.y+x)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var N=[];for(a=0;a<C.length;a++)N[a]=C[a][0];O(C=N);break;case 2:for(a=0;a<C.length;a++)O(C[a]);break;case 3:for(C=function(X){var ne=X.length;if(ne<=1)return[X];for(var ae,le,ye=[],De=0;De<ne;De++){var Re=gm(X[De]);0!==Re&&(void 0===le&&(le=Re<0),le===Re<0?(ae&&ye.push(ae),ae=[X[De]]):ae.push(X[De]))}return ae&&ye.push(ae),ye}(C),a=0;a<C.length;a++)for(u=0;u<C[a].length;u++)O(C[a][u])}1===C.length?C=C[0]:D="Multi"+D;var B={type:"Feature",geometry:{type:D,coordinates:C},properties:this.properties};return"id"in this&&(B.id=this.id),B};var qh=_p;function _p(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(yp,this,e),this.length=this._features.length}function yp(r,e,o){15===r?e.version=o.readVarint():1===r?e.name=o.readString():5===r?e.extent=o.readVarint():2===r?e._features.push(o.pos):3===r?e._keys.push(o.readString()):4===r&&e._values.push(function(a){for(var u=null,p=a.readVarint()+a.pos;a.pos<p;){var _=a.readVarint()>>3;u=1===_?a.readString():2===_?a.readFloat():3===_?a.readDouble():4===_?a.readVarint64():5===_?a.readVarint():6===_?a.readSVarint():7===_?a.readBoolean():null}return u}(o))}function th(r,e,o){if(3===r){var a=new qh(o,o.readVarint()+o.pos);a.length&&(e[a.name]=a)}}_p.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new gp(this._pbf,e,this.extent,this._keys,this._values)};var Jc={VectorTile:function(r,e){this.layers=r.readFields(th,{},e)},VectorTileFeature:gp,VectorTileLayer:qh};const _m=Jc.VectorTileFeature.types,c_=Math.pow(2,13);function nh(r,e,o,a,u,p,_,x){r.emplaceBack((e<<1)+_,(o<<1)+p,(Math.floor(a*c_)<<1)+u,Math.round(x))}class vp{constructor(){this.acc=new Me(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Me(e.x,e.y),this.max=new Me(e.x,e.y))}append(e,o){this.currentPolyCount.edges++,this.acc._add(e);let a=!!this.borders;const u=this.min,p=this.max;e.x<u.x?(u.x=e.x,a=!0):e.x>p.x&&(p.x=e.x,a=!0),e.y<u.y?(u.y=e.y,a=!0):e.y>p.y&&(p.y=e.y,a=!0),((0===e.x||e.x===mr)&&e.x===o.x)!=((0===e.y||e.y===mr)&&e.y===o.y)&&this.processBorderOverlap(e,o),a&&this.checkBorderIntersection(e,o)}checkBorderIntersection(e,o){o.x<0!=e.x<0&&this.addBorderIntersection(0,fr(o.y,e.y,(0-o.x)/(e.x-o.x))),o.x>mr!=e.x>mr&&this.addBorderIntersection(1,fr(o.y,e.y,(mr-o.x)/(e.x-o.x))),o.y<0!=e.y<0&&this.addBorderIntersection(2,fr(o.x,e.x,(0-o.y)/(e.y-o.y))),o.y>mr!=e.y>mr&&this.addBorderIntersection(3,fr(o.x,e.x,(mr-o.y)/(e.y-o.y)))}addBorderIntersection(e,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];o<a[0]&&(a[0]=o),o>a[1]&&(a[1]=o)}processBorderOverlap(e,o){if(e.x===o.x){if(e.y===o.y)return;const a=0===e.x?0:1;this.addBorderIntersection(a,o.y),this.addBorderIntersection(a,e.y)}else{const a=0===e.y?2:3;this.addBorderIntersection(a,o.x),this.addBorderIntersection(a,e.x)}}centroid(){const e=this.polyCount.reduce((o,a)=>o+a.edges,0);return 0!==e?this.acc.div(e)._round():new Me(0,0)}span(){return new Me(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,o)=>e+ +(o[0]!==Number.MAX_VALUE),0)}}class rh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new qa,this.centroidVertexArray=new jf,this.indexArray=new Vs,this.programConfigurations=new Hc(e.layers,e.zoom),this.segments=new io,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.enableTerrain=e.enableTerrain}populate(e,o,a,u){this.features=[],this.hasPattern=Gh("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(p){const _=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*_/(_*_+1)/mr/(1<<p.z)}(a);for(const{feature:p,id:_,index:x,sourceLayerIndex:C}of e){const D=this.layers[0]._featureFilter.needGeometry,O=fc(p,D);if(!this.layers[0]._featureFilter.filter(new En(this.zoom),O,a))continue;const N={id:_,sourceLayerIndex:C,index:x,geometry:D?O.geometry:jl(p,a,u),properties:p.properties,type:p.type,patterns:{}},B=this.layoutVertexArray.length;this.hasPattern?this.features.push(fp("fill-extrusion",this.layers,N,this.zoom,o)):this.addFeature(N,N.geometry,x,a,{},o.availableImages),o.featureIndex.insert(p,N.geometry,x,C,this.index,B)}this.sortBorders()}addFeatures(e,o,a,u){for(const p of this.features){const{geometry:_}=p;this.addFeature(p,_,p.index,o,a,u)}this.sortBorders()}update(e,o,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mp),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,mm.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,o,a,u,p,_){const x=this.enableTerrain?new vp:null;for(const D of $l(o,500)){let O=0,N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===D.length||(C=D[0]).every(le=>le.x<=0)||C.every(le=>le.x>=mr)||C.every(le=>le.y<=0)||C.every(le=>le.y>=mr))continue;for(let le=0;le<D.length;le++){const ye=D[le];if(0===ye.length)continue;O+=ye.length;let De=0;x&&x.startRing(ye[0]);for(let Re=0;Re<ye.length;Re++){const Ve=ye[Re];if(Re>=1){const $e=ye[Re-1];if(!ym(Ve,$e)){x&&x.append(Ve,$e),N.vertexLength+4>io.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ge=Ve.sub($e)._perp(),dt=Ge.x/(Math.abs(Ge.x)+Math.abs(Ge.y)),ct=Ge.y>0?1:0,Lt=$e.dist(Ve);De+Lt>32768&&(De=0),nh(this.layoutVertexArray,Ve.x,Ve.y,dt,ct,0,0,De),nh(this.layoutVertexArray,Ve.x,Ve.y,dt,ct,0,1,De),De+=Lt,nh(this.layoutVertexArray,$e.x,$e.y,dt,ct,0,0,De),nh(this.layoutVertexArray,$e.x,$e.y,dt,ct,0,1,De);const St=N.vertexLength;this.indexArray.emplaceBack(St,St+2,St+1),this.indexArray.emplaceBack(St+1,St+2,St+3),N.vertexLength+=4,N.primitiveLength+=2}}}}if(N.vertexLength+O>io.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(O,this.layoutVertexArray,this.indexArray)),"Polygon"!==_m[e.type])continue;const B=[],X=[],ne=N.vertexLength;for(let le=0;le<D.length;le++){const ye=D[le];if(0!==ye.length){ye!==D[0]&&X.push(B.length/2);for(let De=0;De<ye.length;De++){const Re=ye[De];nh(this.layoutVertexArray,Re.x,Re.y,0,0,1,1,0),B.push(Re.x),B.push(Re.y),x&&x.currentPolyCount.top++}}}const ae=cp(B,X);for(let le=0;le<ae.length;le+=3)this.indexArray.emplaceBack(ne+ae[le],ne+ae[le+2],ne+ae[le+1]);N.primitiveLength+=ae.length/3,N.vertexLength+=O}var C;if(x&&x.polyCount.length>0){if(x.borders){x.vertexArrayOffset=this.centroidVertexArray.length;const D=x.borders,O=this.featuresOnBorder.push(x)-1;for(let N=0;N<4;N++)D[N][0]!==Number.MAX_VALUE&&this.borders[N].push(O)}this.encodeCentroid(x.borders?void 0:x.centroid(),x)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,p,_,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((o,a)=>this.featuresOnBorder[o].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}encodeCentroid(e,o,a=!0){let u,p;if(e)if(0!==e.y){const x=o.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(x.x/10)),p=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else u=Math.ceil(7*(e.x+450)),p=0;else u=0,p=+a;let _=a?this.centroidVertexArray.length:o.vertexArrayOffset;for(const x of o.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let C=0;C<2*x.edges;C++)this.centroidVertexArray.emplace(_++,0,p),this.centroidVertexArray.emplace(_++,u,p);for(let C=0;C<x.top;C++)this.centroidVertexArray.emplace(_++,u,p)}}}function ym(r,e){return r.x===e.x&&(r.x<0||r.x>mr)||r.y===e.y&&(r.y<0||r.y>mr)}Ht("FillExtrusionBucket",rh,{omit:["layers","features"]}),Ht("PartMetadata",vp);var yv={paint:new ki({"fill-extrusion-opacity":new tn(rt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new fn(rt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new tn(rt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new tn(rt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bi(rt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new fn(rt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new fn(rt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new tn(rt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Du(r,e){return r.x*e.x+r.y*e.y}function vm(r,e){if(1===r.length){let o=0;const a=e[o++];let u;for(;!u||a.equals(u);)if(u=e[o++],!u)return 1/0;for(;o<e.length;o++){const p=e[o],_=r[0],x=u.sub(a),C=p.sub(a),D=_.sub(a),O=Du(x,x),N=Du(x,C),B=Du(C,C),X=Du(D,x),ne=Du(D,C),ae=O*B-N*N,le=(B*X-N*ne)/ae,ye=(O*ne-N*X)/ae,De=a.z*(1-le-ye)+u.z*le+p.z*ye;if(isFinite(De))return De}return 1/0}{let o=1/0;for(const a of e)o=Math.min(o,a.z);return o}}function xp(r){const e=new Me(r[0],r[1]);return e.z=r[2],e}function u_(r,e,o,a,u,p,_,x){const C=_*u.getElevationAt(r,e,!0,!0),D=0!==p[0],O=D?0===p[1]?_*(p[0]/7-450):_*function(N,B,X){const ne=Math.floor(B[0]/8),ae=Math.floor(B[1]/8),le=10*(B[0]-8*ne),ye=10*(B[1]-8*ae),De=N.getElevationAt(ne,ae,!0,!0),Re=N.getMeterToDEM(X),Ve=Math.floor(.5*(le*Re-1)),$e=Math.floor(.5*(ye*Re-1)),Ge=N.tileCoordToPixel(ne,ae),dt=2*Ve+1,ct=2*$e+1,Lt=(ri=dt,Cr=ct,[(Kt=N).getElevationAtPixel(nn=Ge.x-Ve,yr=Ge.y-$e,!0),Kt.getElevationAtPixel(nn+Cr,yr,!0),Kt.getElevationAtPixel(nn,yr+Cr,!0),Kt.getElevationAtPixel(nn+ri,yr+Cr,!0)]),St=Math.abs(Lt[0]-Lt[1]),ht=Math.abs(Lt[2]-Lt[3]),Pt=Math.abs(Lt[0]-Lt[2])+Math.abs(Lt[1]-Lt[3]),Bt=Math.min(.25,.5*Re*(St+ht)/dt),xt=Math.min(.25,.5*Re*Pt/ct);var Kt,nn,yr,ri,Cr;return De+Math.max(Bt*le,xt*ye)}(u,p,x):C;return{base:C+(0===o)?-1:o,top:D?Math.max(O+a,C+o+2):C+a}}const h_=Di([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Xa}=h_,d_=Di([{name:"a_packed",components:3,type:"Float32"}]),{members:xm}=d_,p_=Jc.VectorTileFeature.types,f_=Math.cos(Math.PI/180*37.5);class Wh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Vc,this.layoutVertexArray2=new _u,this.indexArray=new Vs,this.programConfigurations=new Hc(e.layers,e.zoom),this.segments=new io,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,a,u){this.hasPattern=Gh("line",this.layers,o);const p=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:O,id:N,index:B,sourceLayerIndex:X}of e){const ne=this.layers[0]._featureFilter.needGeometry,ae=fc(O,ne);if(!this.layers[0]._featureFilter.filter(new En(this.zoom),ae,a))continue;const le=p?p.evaluate(ae,{},a):void 0,ye={id:N,properties:O.properties,type:O.type,sourceLayerIndex:X,index:B,geometry:ne?ae.geometry:jl(O,a,u),patterns:{},sortKey:le};_.push(ye)}p&&_.sort((O,N)=>O.sortKey-N.sortKey);const{lineAtlas:x,featureIndex:C}=o,D=this.addConstantDashes(x);for(const O of _){const{geometry:N,index:B,sourceLayerIndex:X}=O;if(D&&this.addFeatureDashes(O,x),this.hasPattern){const ne=fp("line",this.layers,O,this.zoom,o);this.patternFeatures.push(ne)}else this.addFeature(O,N,B,a,x.positions,o.availableImages);C.insert(e[B].feature,N,B,X,this.index)}}addConstantDashes(e){let o=!1;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,p=a.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==p.kind)o=!0;else{const _=p.value,x=u.value;if(!x)continue;e.addDash(x.from,_),e.addDash(x.to,_),x.other&&e.addDash(x.other,_)}}return o}addFeatureDashes(e,o){const a=this.zoom;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,_=u.layout.get("line-cap").value;if("constant"===p.kind&&"constant"===_.kind)continue;let x,C,D,O,N,B;if("constant"===p.kind){const le=p.value;if(!le)continue;x=le.other||le.to,C=le.to,D=le.from}else x=p.evaluate({zoom:a-1},e),C=p.evaluate({zoom:a},e),D=p.evaluate({zoom:a+1},e);"constant"===_.kind?O=N=B=_.value:(O=_.evaluate({zoom:a-1},e),N=_.evaluate({zoom:a},e),B=_.evaluate({zoom:a+1},e)),o.addDash(x,O),o.addDash(C,N),o.addDash(D,B);const X=o.getKey(x,O),ne=o.getKey(C,N),ae=o.getKey(D,B);e.patterns[u.id]={min:X,mid:ne,max:ae}}}update(e,o,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,a,u)}addFeatures(e,o,a,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,o,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,xm)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xa),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,o,a,u,p,_){const x=this.layers[0].layout,C=x.get("line-join").evaluate(e,{}),D=x.get("line-cap").evaluate(e,{}),O=x.get("line-miter-limit"),N=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const B of o)this.addLine(B,e,C,D,O,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,p,_,u)}addLine(e,o,a,u,p,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ye=0;ye<e.length-1;ye++)this.totalDistance+=e[ye].dist(e[ye+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===p_[o.type];let C=e.length;for(;C>=2&&e[C-1].equals(e[C-2]);)C--;let D=0;for(;D<C-1&&e[D].equals(e[D+1]);)D++;if(C<(x?3:2))return;"bevel"===a&&(p=1.05);const O=this.overscaling<=16?122880/(512*this.overscaling):0,N=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let B,X,ne,ae,le;this.e1=this.e2=-1,x&&(B=e[C-2],le=e[D].sub(B)._unit()._perp());for(let ye=D;ye<C;ye++){if(ne=ye===C-1?x?e[D+1]:void 0:e[ye+1],ne&&e[ye].equals(ne))continue;le&&(ae=le),B&&(X=B),B=e[ye],le=ne?ne.sub(B)._unit()._perp():ae,ae=ae||le;let De=ae.add(le);0===De.x&&0===De.y||De._unit();const Re=ae.x*le.x+ae.y*le.y,Ve=De.x*le.x+De.y*le.y,$e=0!==Ve?1/Ve:1/0,Ge=2*Math.sqrt(2-2*Ve),dt=Ve<f_&&X&&ne,ct=ae.x*le.y-ae.y*le.x>0;if(dt&&ye>D){const ht=B.dist(X);if(ht>2*O){const Pt=B.sub(B.sub(X)._mult(O/ht)._round());this.updateDistance(X,Pt),this.addCurrentVertex(Pt,ae,0,0,N),X=Pt}}const Lt=X&&ne;let St=Lt?a:x?"butt":u;if(Lt&&"round"===St&&($e<_?St="miter":$e<=2&&(St="fakeround")),"miter"===St&&$e>p&&(St="bevel"),"bevel"===St&&($e>2&&(St="flipbevel"),$e<p&&(St="miter")),X&&this.updateDistance(X,B),"miter"===St)De._mult($e),this.addCurrentVertex(B,De,0,0,N);else if("flipbevel"===St){if($e>100)De=le.mult(-1);else{const ht=$e*ae.add(le).mag()/ae.sub(le).mag();De._perp()._mult(ht*(ct?-1:1))}this.addCurrentVertex(B,De,0,0,N),this.addCurrentVertex(B,De.mult(-1),0,0,N)}else if("bevel"===St||"fakeround"===St){const ht=-Math.sqrt($e*$e-1),Pt=ct?ht:0,Bt=ct?0:ht;if(X&&this.addCurrentVertex(B,ae,Pt,Bt,N),"fakeround"===St){const xt=Math.round(180*Ge/Math.PI/20);for(let Kt=1;Kt<xt;Kt++){let nn=Kt/xt;if(.5!==nn){const ri=nn-.5;nn+=nn*ri*(nn-1)*((1.0904+Re*(Re*(3.55645-1.43519*Re)-3.2452))*ri*ri+(.848013+Re*(.215638*Re-1.06021)))}const yr=le.sub(ae)._mult(nn)._add(ae)._unit()._mult(ct?-1:1);this.addHalfVertex(B,yr.x,yr.y,!1,ct,0,N)}}ne&&this.addCurrentVertex(B,le,-Pt,-Bt,N)}else if("butt"===St)this.addCurrentVertex(B,De,0,0,N);else if("square"===St){const ht=X?1:-1;X||this.addCurrentVertex(B,De,ht,ht,N),this.addCurrentVertex(B,De,0,0,N),X&&this.addCurrentVertex(B,De,ht,ht,N)}else"round"===St&&(X&&(this.addCurrentVertex(B,ae,0,0,N),this.addCurrentVertex(B,ae,1,1,N,!0)),ne&&(this.addCurrentVertex(B,le,-1,-1,N,!0),this.addCurrentVertex(B,le,0,0,N)));if(dt&&ye<C-1){const ht=B.dist(ne);if(ht>2*O){const Pt=B.add(ne.sub(B)._mult(O/ht)._round());this.updateDistance(B,Pt),this.addCurrentVertex(Pt,le,0,0,N),B=Pt}}}}addCurrentVertex(e,o,a,u,p,_=!1){const x=o.y*u-o.x,C=-o.y-o.x*u;this.addHalfVertex(e,o.x+o.y*a,o.y-o.x*a,_,!1,a,p),this.addHalfVertex(e,x,C,_,!0,-u,p)}addHalfVertex({x:e,y:o},a,u,p,_,x,C){this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(o<<1)+(_?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const D=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),C.primitiveLength++),_?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,o){this.distance+=e.dist(o),this.updateScaledDistance()}}Ht("LineBucket",Wh,{omit:["layers","patternFeatures"]});const m_=new ki({"line-cap":new fn(rt.layout_line["line-cap"]),"line-join":new fn(rt.layout_line["line-join"]),"line-miter-limit":new tn(rt.layout_line["line-miter-limit"]),"line-round-limit":new tn(rt.layout_line["line-round-limit"]),"line-sort-key":new fn(rt.layout_line["line-sort-key"])});var bp={paint:new ki({"line-opacity":new fn(rt.paint_line["line-opacity"]),"line-color":new fn(rt.paint_line["line-color"]),"line-translate":new tn(rt.paint_line["line-translate"]),"line-translate-anchor":new tn(rt.paint_line["line-translate-anchor"]),"line-width":new fn(rt.paint_line["line-width"]),"line-gap-width":new fn(rt.paint_line["line-gap-width"]),"line-offset":new fn(rt.paint_line["line-offset"]),"line-blur":new fn(rt.paint_line["line-blur"]),"line-dasharray":new Bi(rt.paint_line["line-dasharray"]),"line-pattern":new Bi(rt.paint_line["line-pattern"]),"line-gradient":new ga(rt.paint_line["line-gradient"])}),layout:m_};const bm=new class extends fn{possiblyEvaluate(r,e){return e=new En(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(r,e)}evaluate(r,e,o,a){return e=st({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(r,e,o,a)}}(bp.paint.properties["line-width"].specification);function wm(r,e){return e>0?e+2*r:r}bm.useIntegerZoom=!0;const g_=Di([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),er=Di([{name:"a_projected_pos",components:3,type:"Float32"}],4);Di([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Cm=Di([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Em=Di([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Di([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ih=Di([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ka=Di([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Di([{name:"triangle",components:3,type:"Uint16"}]),Di([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Di([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Di([{type:"Float32",name:"offsetX"}]),Di([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const xl=128;function oh(r,e){const{expression:o}=e;if("constant"===o.kind)return{kind:"constant",layoutSize:o.evaluate(new En(r+1))};if("source"===o.kind)return{kind:"source"};{const{zoomStops:a,interpolationType:u}=o;let p=0;for(;p<a.length&&a[p]<=r;)p++;p=Math.max(0,p-1);let _=p;for(;_<a.length&&a[_]<r+1;)_++;_=Math.min(a.length-1,_);const x=a[p],C=a[_];return"composite"===o.kind?{kind:"composite",minZoom:x,maxZoom:C,interpolationType:u}:{kind:"camera",minZoom:x,maxZoom:C,minSize:o.evaluate(new En(x)),maxSize:o.evaluate(new En(C)),interpolationType:u}}}function Ia(r,{uSize:e,uSizeT:o},{lowerSize:a,upperSize:u}){return"source"===r.kind?a/xl:"composite"===r.kind?fr(a/xl,u/xl,o):e}function yc(r,e){let o=0,a=0;if("constant"===r.kind)a=r.layoutSize;else if("source"!==r.kind){const{interpolationType:u,minZoom:p,maxZoom:_}=r,x=u?pn(Y.interpolationFactor(u,e,p,_),0,1):0;"camera"===r.kind?a=fr(r.minSize,r.maxSize,x):o=x}return{uSizeT:o,uSize:a}}var Tm=Object.freeze({__proto__:null,getSizeData:oh,evaluateSizeForFeature:Ia,evaluateSizeForZoom:yc,SIZE_PACK_FACTOR:xl});function wp(r,e,o){return r.sections.forEach(a=>{a.text=function(u,p,_){const x=p.layout.get("text-transform").evaluate(_,{});return"uppercase"===x?u=u.toLocaleUpperCase():"lowercase"===x&&(u=u.toLocaleLowerCase()),cr.applyArabicShaping&&(u=cr.applyArabicShaping(u)),u}(a.text,e,o)}),r}const Yh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Dm(r){return"\ufe36"===r||"\ufe48"===r||"\ufe38"===r||"\ufe44"===r||"\ufe42"===r||"\ufe3e"===r||"\ufe3c"===r||"\ufe3a"===r||"\ufe18"===r||"\ufe40"===r||"\ufe10"===r||"\ufe13"===r||"\ufe14"===r||"\uff40"===r||"\uffe3"===r||"\ufe11"===r||"\ufe12"===r}function vv(r){return"\ufe35"===r||"\ufe47"===r||"\ufe37"===r||"\ufe43"===r||"\ufe41"===r||"\ufe3d"===r||"\ufe3b"===r||"\ufe39"===r||"\ufe17"===r||"\ufe3f"===r}var bl=function(r,e,o,a,u){var p,_,x=8*u-a-1,C=(1<<x)-1,D=C>>1,O=-7,N=o?u-1:0,B=o?-1:1,X=r[e+N];for(N+=B,p=X&(1<<-O)-1,X>>=-O,O+=x;O>0;p=256*p+r[e+N],N+=B,O-=8);for(_=p&(1<<-O)-1,p>>=-O,O+=a;O>0;_=256*_+r[e+N],N+=B,O-=8);if(0===p)p=1-D;else{if(p===C)return _?NaN:1/0*(X?-1:1);_+=Math.pow(2,a),p-=D}return(X?-1:1)*_*Math.pow(2,p-a)},sh=function(r,e,o,a,u,p){var _,x,C,D=8*p-u-1,O=(1<<D)-1,N=O>>1,B=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,X=a?0:p-1,ne=a?1:-1,ae=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,_=O):(_=Math.floor(Math.log(e)/Math.LN2),e*(C=Math.pow(2,-_))<1&&(_--,C*=2),(e+=_+N>=1?B/C:B*Math.pow(2,1-N))*C>=2&&(_++,C/=2),_+N>=O?(x=0,_=O):_+N>=1?(x=(e*C-1)*Math.pow(2,u),_+=N):(x=e*Math.pow(2,N-1)*Math.pow(2,u),_=0));u>=8;r[o+X]=255&x,X+=ne,x/=256,u-=8);for(_=_<<u|x,D+=u;D>0;r[o+X]=255&_,X+=ne,_/=256,D-=8);r[o+X-ne]|=128*ae},vc=Xr;function Xr(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Xr.Varint=0,Xr.Fixed64=1,Xr.Bytes=2,Xr.Fixed32=5;var Am=4294967296,Mm=1/Am,Cp="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function xc(r){return r.type===Xr.Bytes?r.readVarint()+r.pos:r.pos+1}function __(r,e,o){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));o.realloc(a);for(var u=o.pos-1;u>=r;u--)o.buf[u+a]=o.buf[u]}function Sm(r,e){for(var o=0;o<r.length;o++)e.writeVarint(r[o])}function Im(r,e){for(var o=0;o<r.length;o++)e.writeSVarint(r[o])}function y_(r,e){for(var o=0;o<r.length;o++)e.writeFloat(r[o])}function Ep(r,e){for(var o=0;o<r.length;o++)e.writeDouble(r[o])}function xv(r,e){for(var o=0;o<r.length;o++)e.writeBoolean(r[o])}function bv(r,e){for(var o=0;o<r.length;o++)e.writeFixed32(r[o])}function wv(r,e){for(var o=0;o<r.length;o++)e.writeSFixed32(r[o])}function Cv(r,e){for(var o=0;o<r.length;o++)e.writeFixed64(r[o])}function Ev(r,e){for(var o=0;o<r.length;o++)e.writeSFixed64(r[o])}function Tp(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function ah(r,e,o){r[o]=e,r[o+1]=e>>>8,r[o+2]=e>>>16,r[o+3]=e>>>24}function v_(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}function Tv(r,e,o){e.glyphs=[],1===r&&o.readMessage(Dv,e)}function Dv(r,e,o){if(3===r){const{id:a,bitmap:u,width:p,height:_,left:x,top:C,advance:D}=o.readMessage(Av,{});e.glyphs.push({id:a,bitmap:new mc({width:p+6,height:_+6},u),metrics:{width:p,height:_,left:x,top:C,advance:D}})}else 4===r?e.ascender=o.readSVarint():5===r&&(e.descender=o.readSVarint())}function Av(r,e,o){1===r?e.id=o.readVarint():2===r?e.bitmap=o.readBytes():3===r?e.width=o.readVarint():4===r?e.height=o.readVarint():5===r?e.left=o.readSVarint():6===r?e.top=o.readSVarint():7===r&&(e.advance=o.readVarint())}function wl(r){let e=0,o=0;for(const _ of r)e+=_.w*_.h,o=Math.max(o,_.w);r.sort((_,x)=>x.h-_.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),o),h:1/0}];let u=0,p=0;for(const _ of r)for(let x=a.length-1;x>=0;x--){const C=a[x];if(!(_.w>C.w||_.h>C.h)){if(_.x=C.x,_.y=C.y,p=Math.max(p,_.y+_.h),u=Math.max(u,_.x+_.w),_.w===C.w&&_.h===C.h){const D=a.pop();x<a.length&&(a[x]=D)}else _.h===C.h?(C.x+=_.w,C.w-=_.w):_.w===C.w?(C.y+=_.h,C.h-=_.h):(a.push({x:C.x+_.w,y:C.y,w:C.w-_.w,h:_.h}),C.y+=_.h,C.h-=_.h);break}}return{w:u,h:p,fill:e/(u*p)||0}}Xr.prototype={destroy:function(){this.buf=null},readFields:function(r,e,o){for(o=o||this.length;this.pos<o;){var a=this.readVarint(),u=a>>3,p=this.pos;this.type=7&a,r(u,e,this),this.pos===p&&this.skip(a)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=Tp(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=v_(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Tp(this.buf,this.pos)+Tp(this.buf,this.pos+4)*Am;return this.pos+=8,r},readSFixed64:function(){var r=Tp(this.buf,this.pos)+v_(this.buf,this.pos+4)*Am;return this.pos+=8,r},readFloat:function(){var r=bl(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=bl(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,o,a=this.buf;return e=127&(o=a[this.pos++]),o<128?e:(e|=(127&(o=a[this.pos++]))<<7,o<128?e:(e|=(127&(o=a[this.pos++]))<<14,o<128?e:(e|=(127&(o=a[this.pos++]))<<21,o<128?e:function(u,p,_){var x,C,D=_.buf;if(x=(112&(C=D[_.pos++]))>>4,C<128||(x|=(127&(C=D[_.pos++]))<<3,C<128)||(x|=(127&(C=D[_.pos++]))<<10,C<128)||(x|=(127&(C=D[_.pos++]))<<17,C<128)||(x|=(127&(C=D[_.pos++]))<<24,C<128)||(x|=(1&(C=D[_.pos++]))<<31,C<128))return function(r,e,o){return o?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}(u,x,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(o=a[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&Cp?Cp.decode(this.buf.subarray(e,r)):function(o,a,u){for(var p="",_=a;_<u;){var x,C,D,O=o[_],N=null,B=O>239?4:O>223?3:O>191?2:1;if(_+B>u)break;1===B?O<128&&(N=O):2===B?128==(192&(x=o[_+1]))&&(N=(31&O)<<6|63&x)<=127&&(N=null):3===B?(C=o[_+2],128==(192&(x=o[_+1]))&&128==(192&C)&&((N=(15&O)<<12|(63&x)<<6|63&C)<=2047||N>=55296&&N<=57343)&&(N=null)):4===B&&(C=o[_+2],D=o[_+3],128==(192&(x=o[_+1]))&&128==(192&C)&&128==(192&D)&&((N=(15&O)<<18|(63&x)<<12|(63&C)<<6|63&D)<=65535||N>=1114112)&&(N=null)),null===N?(N=65533,B=1):N>65535&&(N-=65536,p+=String.fromCharCode(N>>>10&1023|55296),N=56320|1023&N),p+=String.fromCharCode(N),_+=B}return p}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Xr.Bytes)return r.push(this.readVarint(e));var o=xc(this);for(r=r||[];this.pos<o;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Xr.Bytes)return r.push(this.readSVarint());var e=xc(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Xr.Bytes)return r.push(this.readBoolean());var e=xc(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Xr.Bytes)return r.push(this.readFloat());var e=xc(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Xr.Bytes)return r.push(this.readDouble());var e=xc(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Xr.Bytes)return r.push(this.readFixed32());var e=xc(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Xr.Bytes)return r.push(this.readSFixed32());var e=xc(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Xr.Bytes)return r.push(this.readFixed64());var e=xc(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Xr.Bytes)return r.push(this.readSFixed64());var e=xc(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===Xr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Xr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Xr.Fixed32)this.pos+=4;else{if(e!==Xr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var o=new Uint8Array(e);o.set(this.buf),this.buf=o,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),ah(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),ah(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),ah(this.buf,-1&r,this.pos),ah(this.buf,Math.floor(r*Mm),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),ah(this.buf,-1&r,this.pos),ah(this.buf,Math.floor(r*Mm),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,o){var a,u,p,x;if(e>=0?(a=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,u=u+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),p=a,(x=o).buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7),function(p,_){var x=(7&p)<<4;_.buf[_.pos++]|=x|((p>>>=3)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p)))))}(u,o)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(Boolean(r))},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(a,u,p){for(var _,x,C=0;C<u.length;C++){if((_=u.charCodeAt(C))>55295&&_<57344){if(!x){_>56319||C+1===u.length?(a[p++]=239,a[p++]=191,a[p++]=189):x=_;continue}if(_<56320){a[p++]=239,a[p++]=191,a[p++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(a[p++]=239,a[p++]=191,a[p++]=189,x=null);_<128?a[p++]=_:(_<2048?a[p++]=_>>6|192:(_<65536?a[p++]=_>>12|224:(a[p++]=_>>18|240,a[p++]=_>>12&63|128),a[p++]=_>>6&63|128),a[p++]=63&_|128)}return p}(this.buf,r,this.pos);var o=this.pos-e;o>=128&&__(e,o,this),this.pos=e-1,this.writeVarint(o),this.pos+=o},writeFloat:function(r){this.realloc(4),sh(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),sh(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var o=0;o<e;o++)this.buf[this.pos++]=r[o]},writeRawMessage:function(r,e){this.pos++;var o=this.pos;r(e,this);var a=this.pos-o;a>=128&&__(o,a,this),this.pos=o-1,this.writeVarint(a),this.pos+=a},writeMessage:function(r,e,o){this.writeTag(r,Xr.Bytes),this.writeRawMessage(e,o)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,Sm,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,Im,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,xv,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,y_,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,Ep,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,bv,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,wv,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,Cv,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,Ev,e)},writeBytesField:function(r,e){this.writeTag(r,Xr.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Xr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Xr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Xr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Xr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Xr.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Xr.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Xr.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Xr.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Xr.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,Boolean(e))}};class lh{constructor(e,{pixelRatio:o,version:a,stretchX:u,stretchY:p,content:_}){this.paddedRect=e,this.pixelRatio=o,this.stretchX=u,this.stretchY=p,this.content=_,this.version=a}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Pm{constructor(e,o){const a={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,a,p),this.addImages(o,u,p);const{w:_,h:x}=wl(p),C=new ya({width:_||1,height:x||1});for(const D in e){const O=e[D],N=a[D].paddedRect;ya.copy(O.data,C,{x:0,y:0},{x:N.x+1,y:N.y+1},O.data)}for(const D in o){const O=o[D],N=u[D].paddedRect,B=N.x+1,X=N.y+1,ne=O.data.width,ae=O.data.height;ya.copy(O.data,C,{x:0,y:0},{x:B,y:X},O.data),ya.copy(O.data,C,{x:0,y:ae-1},{x:B,y:X-1},{width:ne,height:1}),ya.copy(O.data,C,{x:0,y:0},{x:B,y:X+ae},{width:ne,height:1}),ya.copy(O.data,C,{x:ne-1,y:0},{x:B-1,y:X},{width:1,height:ae}),ya.copy(O.data,C,{x:0,y:0},{x:B+ne,y:X},{width:1,height:ae})}this.image=C,this.iconPositions=a,this.patternPositions=u}addImages(e,o,a){for(const u in e){const p=e[u],_={x:0,y:0,w:p.data.width+2,h:p.data.height+2};a.push(_),o[u]=new lh(_,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,o){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),o),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),o)}patchUpdatedImage(e,o,a){if(!e||!o||e.version===o.version)return;e.version=o.version;const[u,p]=e.tl;a.update(o.data,void 0,{x:u,y:p})}}Ht("ImagePosition",lh),Ht("ImageAtlas",Pm);const na={horizontal:1,vertical:2,horizontalOnly:3};class Qc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,o){const a=new Qc;return a.scale=e||1,a.fontStack=o,a}static forImage(e){const o=new Qc;return o.imageName=e,o}}class eu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,o){const a=new eu;for(let u=0;u<e.sections.length;u++){const p=e.sections[u];p.image?a.addImageSection(p):a.addTextSection(p,o)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(o,a){let u="";for(let p=0;p<o.length;p++){const _=o.charCodeAt(p+1)||null,x=o.charCodeAt(p-1)||null;u+=!a&&(_&&on(_)&&!Yh[o[p+1]]||x&&on(x)&&!Yh[o[p-1]])||!Yh[o[p]]?o[p]:Yh[o[p]]}return u}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&Xh[this.text.charCodeAt(a)];a++)e++;let o=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&Xh[this.text.charCodeAt(a)];a--)o--;this.text=this.text.substring(e,o),this.sectionIndex=this.sectionIndex.slice(e,o)}substring(e,o){const a=new eu;return a.text=this.text.substring(e,o),a.sectionIndex=this.sectionIndex.slice(e,o),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,o)=>Math.max(e,this.sections[o].scale),0)}addTextSection(e,o){this.text+=e.text,this.sections.push(Qc.forText(e.scale,e.fontStack||o));const a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e){const o=e.image?e.image.name:"";if(0===o.length)return void kn("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Qc.forImage(o)),this.sectionIndex.push(this.sections.length-1)):kn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ch(r,e,o,a,u,p,_,x,C,D,O,N,B,X,ne,ae){const le=eu.fromFeature(r,u);let ye;N===na.vertical&&le.verticalizePunctuation(B);const{processBidirectionalText:De,processStyledBidirectionalText:Re}=cr;if(De&&1===le.sections.length){ye=[];const Ge=De(le.toString(),Jh(le,D,p,e,a,X,ne));for(const dt of Ge){const ct=new eu;ct.text=dt,ct.sections=le.sections;for(let Lt=0;Lt<dt.length;Lt++)ct.sectionIndex.push(0);ye.push(ct)}}else if(Re){ye=[];const Ge=Re(le.text,le.sectionIndex,Jh(le,D,p,e,a,X,ne));for(const dt of Ge){const ct=new eu;ct.text=dt[0],ct.sectionIndex=dt[1],ct.sections=le.sections,ye.push(ct)}}else ye=function(Ge,dt){const ct=[],Lt=Ge.text;let St=0;for(const ht of dt)ct.push(Ge.substring(St,ht)),St=ht;return St<Lt.length&&ct.push(Ge.substring(St,Lt.length)),ct}(le,Jh(le,D,p,e,a,X,ne));const Ve=[],$e={positionedLines:Ve,text:le.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:N,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ge,dt,ct,Lt,St,ht,Pt,Bt,xt,Kt,nn,yr){let ri=0,Cr=0,Er=0;const It="right"===Bt?1:"left"===Bt?0:.5;let zr=!1;for(const Ur of St){const Tr=Ur.getSections();for(const Ai of Tr){if(Ai.imageName)continue;const Yi=dt[Ai.fontStack];if(Yi&&(zr=void 0!==Yi.ascender&&void 0!==Yi.descender,!zr))break}if(!zr)break}let Fr=0;for(const Ur of St){Ur.trim();const Tr=Ur.getMaxScale(),Ai=24*(Tr-1),Yi={positionedGlyphs:[],lineOffset:0};Ge.positionedLines[Fr]=Yi;const Xi=Yi.positionedGlyphs;let so=0;if(!Ur.length()){Cr+=ht,++Fr;continue}let ls=0,Zs=0;for(let bi=0;bi<Ur.length();bi++){const Ro=Ur.getSection(bi),Qa=Ur.getSectionIndex(bi),cs=Ur.getCharCode(bi);let ai=Ro.scale,Bo=null,Fi=null,ys=null,ko=24,Yo=0;const us=!(xt===na.horizontal||!nn&&!gt(cs)||nn&&(Xh[cs]||(Wi=cs,i(Wi)||c(Wi)||m(Wi)||Pe(Wi)||bt(Wi))));if(Ro.imageName){const Ps=Lt[Ro.imageName];if(!Ps)continue;ys=Ro.imageName,Ge.iconsInText=Ge.iconsInText||!0,Fi=Ps.paddedRect;const Xo=Ps.displaySize;ai=24*ai/yr,Bo={width:Xo[0],height:Xo[1],left:1,top:-3,advance:us?Xo[1]:Xo[0],localGlyph:!1},Yo=zr?-Bo.height*ai:24*Tr-17-Xo[1]*ai,ko=Bo.advance;const Tl=(us?Xo[0]:Xo[1])*ai-24*Tr;Tl>0&&Tl>so&&(so=Tl)}else{const Ps=ct[Ro.fontStack];if(!Ps)continue;Ps[cs]&&(Fi=Ps[cs]);const Xo=dt[Ro.fontStack];if(!Xo)continue;const Tl=Xo.glyphs[cs];if(!Tl)continue;if(Bo=Tl.metrics,ko=8203!==cs?24:0,zr){const Ch=void 0!==Xo.ascender?Math.abs(Xo.ascender):0,Eh=void 0!==Xo.descender?Math.abs(Xo.descender):0,Ou=(Ch+Eh)*ai;ls<Ou&&(ls=Ou,Zs=(Ch-Eh)/2*ai),Yo=-Ch*ai}else Yo=24*(Tr-ai)-17}us?(Ge.verticalizable=!0,Xi.push({glyph:cs,imageName:ys,x:ri,y:Cr+Yo,vertical:us,scale:ai,localGlyph:Bo.localGlyph,fontStack:Ro.fontStack,sectionIndex:Qa,metrics:Bo,rect:Fi}),ri+=ko*ai+Kt):(Xi.push({glyph:cs,imageName:ys,x:ri,y:Cr+Yo,vertical:us,scale:ai,localGlyph:Bo.localGlyph,fontStack:Ro.fontStack,sectionIndex:Qa,metrics:Bo,rect:Fi}),ri+=Bo.advance*ai+Kt)}0!==Xi.length&&(Er=Math.max(ri-Kt,Er),zr?Om(Xi,It,so,Zs,ht*Tr/2):Om(Xi,It,so,0,ht/2)),ri=0;const ra=ht*Tr+so;Yi.lineOffset=Math.max(so,Ai),Cr+=ra,++Fr}var Wi;const Ui=Cr,{horizontalAlign:Po,verticalAlign:as}=Ap(Pt);(function(Ur,Tr,Ai,Yi,Xi,so){const ls=(Tr-Ai)*Xi,Zs=-so*Yi;for(const ra of Ur)for(const bi of ra.positionedGlyphs)bi.x+=ls,bi.y+=Zs})(Ge.positionedLines,It,Po,as,Er,Ui),Ge.top+=-as*Ui,Ge.bottom=Ge.top+Ui,Ge.left+=-Po*Er,Ge.right=Ge.left+Er,Ge.hasBaseline=zr}($e,e,o,a,ye,_,x,C,N,D,B,ae),!function(Ge){for(const dt of Ge)if(0!==dt.positionedGlyphs.length)return!1;return!0}(Ve)&&$e}const Xh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},bc={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Dp(r,e,o,a,u,p){if(e.imageName){const _=a[e.imageName];return _?_.displaySize[0]*e.scale*24/p+u:0}{const _=o[e.fontStack],x=_&&_.glyphs[r];return x?x.metrics.advance*e.scale+u:0}}function Rm(r,e,o,a){const u=Math.pow(r-e,2);return a?r<e?u/2:2*u:u+Math.abs(o)*o}function Mv(r,e,o){let a=0;return 10===r&&(a-=1e4),o&&(a+=150),40!==r&&65288!==r||(a+=50),41!==e&&65289!==e||(a+=50),a}function Kh(r,e,o,a,u,p){let _=null,x=Rm(e,o,u,p);for(const C of a){const D=Rm(e-C.x,o,u,p)+C.badness;D<=x&&(_=C,x=D)}return{index:r,x:e,priorBreak:_,badness:x}}function km(r){return r?km(r.priorBreak).concat(r.index):[]}function Jh(r,e,o,a,u,p,_){if("point"!==p)return[];if(!r)return[];const x=[],C=function(B,X,ne,ae,le,ye){let De=0;for(let Re=0;Re<B.length();Re++){const Ve=B.getSection(Re);De+=Dp(B.getCharCode(Re),Ve,ae,le,X,ye)}return De/Math.max(1,Math.ceil(De/ne))}(r,e,o,a,u,_),D=r.text.indexOf("\u200b")>=0;let O=0;for(let B=0;B<r.length();B++){const X=r.getSection(B),ne=r.getCharCode(B);if(Xh[ne]||(O+=Dp(ne,X,a,u,e,_)),B<r.length()-1){const ae=!((N=ne)<11904||!(Q(N)||q(N)||et(N)||Ce(N)||fe(N)||v(N)||se(N)||R(N)||Se(N)||de(N)||ue(N)||Tt(N)||z(N)||T(N)||b(N)||he(N)||j(N)||We(N)||Ae(N)||Ee(N)));(bc[ne]||ae||X.imageName)&&x.push(Kh(B+1,O,C,x,Mv(ne,r.getCharCode(B+1),ae&&D),!1))}}var N;return km(Kh(r.length(),O,C,x,0,!0))}function Ap(r){let e=.5,o=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:e,verticalAlign:o}}function Om(r,e,o,a,u){if(!(e||o||a||u))return;const p=r.length-1,_=r[p],x=(_.x+_.metrics.advance*_.scale)*e;for(let C=0;C<=p;C++)r[C].x-=x,r[C].y+=o+a+u}function uh(r,e,o){const{horizontalAlign:a,verticalAlign:u}=Ap(o),p=e[0]-r.displaySize[0]*a,_=e[1]-r.displaySize[1]*u;return{image:r,top:_,bottom:_+r.displaySize[1],left:p,right:p+r.displaySize[0]}}function tu(r,e,o,a,u,p){const _=r.image;let x;if(_.content){const le=_.content,ye=_.pixelRatio||1;x=[le[0]/ye,le[1]/ye,_.displaySize[0]-le[2]/ye,_.displaySize[1]-le[3]/ye]}const C=e.left*p,D=e.right*p;let O,N,B,X;"width"===o||"both"===o?(X=u[0]+C-a[3],N=u[0]+D+a[1]):(X=u[0]+(C+D-_.displaySize[0])/2,N=X+_.displaySize[0]);const ne=e.top*p,ae=e.bottom*p;return"height"===o||"both"===o?(O=u[1]+ne-a[0],B=u[1]+ae+a[2]):(O=u[1]+(ne+ae-_.displaySize[1])/2,B=O+_.displaySize[1]),{image:_,top:O,right:N,bottom:B,left:X,collisionPadding:x}}class Ja extends Me{constructor(e,o,a,u,p){super(e,o),this.angle=u,this.z=a,void 0!==p&&(this.segment=p)}clone(){return new Ja(this.x,this.y,this.z,this.angle,this.segment)}}function nu(r,e,o,a,u){if(void 0===e.segment)return!0;let p=e,_=e.segment+1,x=0;for(;x>-o/2;){if(_--,_<0)return!1;x-=r[_].dist(p),p=r[_]}x+=r[_].dist(r[_+1]),_++;const C=[];let D=0;for(;x<o/2;){const O=r[_],N=r[_+1];if(!N)return!1;let B=r[_-1].angleTo(O)-O.angleTo(N);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:x,angleDelta:B}),D+=B;x-C[0].distance>a;)D-=C.shift().angleDelta;if(D>u)return!1;_++,x+=O.dist(N)}return!0}function Mu(r){let e=0;for(let o=0;o<r.length-1;o++)e+=r[o].dist(r[o+1]);return e}function ru(r,e,o){return r?.6*e*o:0}function Fm(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function Lm(r,e,o,a,u,p){const _=ru(o,u,p),x=Fm(o,a)*p;let C=0;const D=Mu(r)/2;for(let O=0;O<r.length-1;O++){const N=r[O],B=r[O+1],X=N.dist(B);if(C+X>D){const ne=(D-C)/X,ae=fr(N.x,B.x,ne),le=fr(N.y,B.y,ne),ye=new Ja(ae,le,0,B.angleTo(N),O);return!_||nu(r,ye,x,_,e)?ye:void 0}C+=X}}function Nm(r,e,o,a,u,p,_,x,C){const D=ru(a,p,_),O=Fm(a,u),N=O*_,B=0===r[0].x||r[0].x===C||0===r[0].y||r[0].y===C;return e-N<e/4&&(e=N+e/4),Qh(r,B?e/2*x%e:(O/2+2*p)*_*x%e,e,D,o,N,B,!1,C)}function Qh(r,e,o,a,u,p,_,x,C){const D=p/2,O=Mu(r);let N=0,B=e-o,X=[];for(let ne=0;ne<r.length-1;ne++){const ae=r[ne],le=r[ne+1],ye=ae.dist(le),De=le.angleTo(ae);for(;B+o<N+ye;){B+=o;const Re=(B-N)/ye,Ve=fr(ae.x,le.x,Re),$e=fr(ae.y,le.y,Re);if(Ve>=0&&Ve<C&&$e>=0&&$e<C&&B-D>=0&&B+D<=O){const Ge=new Ja(Ve,$e,0,De,ne);Ge._round(),a&&!nu(r,Ge,p,a,u)||X.push(Ge)}}N+=ye}return x||X.length||_||(X=Qh(r,N/2,o,a,u,p,_,!0,C)),X}function ed(r,e,o,a,u){const p=[];for(let _=0;_<r.length;_++){const x=r[_];let C;for(let D=0;D<x.length-1;D++){let O=x[D],N=x[D+1];O.x<e&&N.x<e||(O.x<e?O=new Me(e,O.y+(e-O.x)/(N.x-O.x)*(N.y-O.y))._round():N.x<e&&(N=new Me(e,O.y+(e-O.x)/(N.x-O.x)*(N.y-O.y))._round()),O.y<o&&N.y<o||(O.y<o?O=new Me(O.x+(o-O.y)/(N.y-O.y)*(N.x-O.x),o)._round():N.y<o&&(N=new Me(O.x+(o-O.y)/(N.y-O.y)*(N.x-O.x),o)._round()),O.x>=a&&N.x>=a||(O.x>=a?O=new Me(a,O.y+(a-O.x)/(N.x-O.x)*(N.y-O.y))._round():N.x>=a&&(N=new Me(a,O.y+(a-O.x)/(N.x-O.x)*(N.y-O.y))._round()),O.y>=u&&N.y>=u||(O.y>=u?O=new Me(O.x+(u-O.y)/(N.y-O.y)*(N.x-O.x),u)._round():N.y>=u&&(N=new Me(O.x+(u-O.y)/(N.y-O.y)*(N.x-O.x),u)._round()),C&&O.equals(C[C.length-1])||(C=[O],p.push(C)),C.push(N)))))}}return p}Ht("Anchor",Ja);const Su=1e20;function hh(r,e,o,a,u,p,_,x,C){for(let D=e;D<e+a;D++)zm(r,o*p+D,p,u,_,x,C);for(let D=o;D<o+u;D++)zm(r,D*p+e,1,a,_,x,C)}function zm(r,e,o,a,u,p,_){p[0]=0,_[0]=-Su,_[1]=Su,u[0]=r[e];for(let x=1,C=0,D=0;x<a;x++){u[x]=r[e+x*o];const O=x*x;do{const N=p[C];D=(u[x]-u[N]+O-N*N)/(x-N)/2}while(D<=_[C]&&--C>-1);C++,p[C]=x,_[C]=D,_[C+1]=Su}for(let x=0,C=0;x<a;x++){for(;_[C+1]<x;)C++;const D=p[C],O=x-D;r[e+x*o]=u[D]+O*O}}const td={none:0,ideographs:1,all:2};class dh{constructor(e,o,a){this.requestManager=e,this.localGlyphMode=o,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,o){const a=[];for(const u in e)for(const p of e[u])a.push({stack:u,id:p});$i(a,({stack:u,id:p},_)=>{let x=this.entries[u];x||(x=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=x.glyphs[p];if(void 0!==C)return void _(null,{stack:u,id:p,glyph:C});if(C=this._tinySDF(x,u,p),C)return x.glyphs[p]=C,void _(null,{stack:u,id:p,glyph:C});const D=Math.floor(p/256);if(256*D>65535)return void _(new Error("glyphs > 65535 not supported"));if(x.ranges[D])return void _(null,{stack:u,id:p,glyph:C});let O=x.requests[D];O||(O=x.requests[D]=[],dh.loadGlyphRange(u,D,this.url,this.requestManager,(N,B)=>{if(B){x.ascender=B.ascender,x.descender=B.descender;for(const X in B.glyphs)this._doesCharSupportLocalGlyph(+X)||(x.glyphs[+X]=B.glyphs[+X]);x.ranges[D]=!0}for(const X of O)X(N,B);delete x.requests[D]})),O.push((N,B)=>{N?_(N):B&&_(null,{stack:u,id:p,glyph:B.glyphs[p]||null})})},(u,p)=>{if(u)o(u);else if(p){const _={};for(const{stack:x,id:C,glyph:D}of p)void 0===_[x]&&(_[x]={}),void 0===_[x].glyphs&&(_[x].glyphs={}),_[x].glyphs[C]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},_[x].ascender=this.entries[x].ascender,_[x].descender=this.entries[x].descender;o(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==td.none&&(this.localGlyphMode===td.all?!!this.localFontFamily:!!this.localFontFamily&&(de(e)||be(e)||z(e)||j(e))||R(e))}_tinySDF(e,o,a){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let p=e.tinySDF;if(!p){let ae="400";/bold/i.test(o)?ae="900":/medium/i.test(o)?ae="500":/light/i.test(o)&&(ae="200"),p=e.tinySDF=new dh.TinySDF({fontFamily:u,fontWeight:ae,fontSize:48,buffer:6,radius:16}),p.fontWeight=ae}if(this.localGlyphs[p.fontWeight][a])return this.localGlyphs[p.fontWeight][a];const _=String.fromCharCode(a),{data:x,width:C,height:D,glyphWidth:O,glyphHeight:N,glyphLeft:B,glyphTop:X,glyphAdvance:ne}=p.draw(_);return this.localGlyphs[p.fontWeight][a]={id:a,bitmap:new mc({width:C,height:D},x),metrics:{width:O/2,height:N/2,left:B/2,top:X/2-27,advance:ne/2,localGlyph:!0}}}}function Mp(r,e,o,a){const u=[],p=r.image,_=p.pixelRatio,x=p.paddedRect.w-2,C=p.paddedRect.h-2,D=r.right-r.left,O=r.bottom-r.top,N=p.stretchX||[[0,x]],B=p.stretchY||[[0,C]],X=(ht,Pt)=>ht+Pt[1]-Pt[0],ne=N.reduce(X,0),ae=B.reduce(X,0),le=x-ne,ye=C-ae;let De=0,Re=ne,Ve=0,$e=ae,Ge=0,dt=le,ct=0,Lt=ye;if(p.content&&a){const ht=p.content;De=ph(N,0,ht[0]),Ve=ph(B,0,ht[1]),Re=ph(N,ht[0],ht[2]),$e=ph(B,ht[1],ht[3]),Ge=ht[0]-De,ct=ht[1]-Ve,dt=ht[2]-ht[0]-Re,Lt=ht[3]-ht[1]-$e}const St=(ht,Pt,Bt,xt)=>{const Kt=fh(ht.stretch-De,Re,D,r.left),nn=nd(ht.fixed-Ge,dt,ht.stretch,ne),yr=fh(Pt.stretch-Ve,$e,O,r.top),ri=nd(Pt.fixed-ct,Lt,Pt.stretch,ae),Cr=fh(Bt.stretch-De,Re,D,r.left),Er=nd(Bt.fixed-Ge,dt,Bt.stretch,ne),It=fh(xt.stretch-Ve,$e,O,r.top),zr=nd(xt.fixed-ct,Lt,xt.stretch,ae),Fr=new Me(Kt,yr),Wi=new Me(Cr,yr),Ui=new Me(Cr,It),Po=new Me(Kt,It),as=new Me(nn/_,ri/_),Ur=new Me(Er/_,zr/_),Tr=e*Math.PI/180;if(Tr){const Xi=Math.sin(Tr),so=Math.cos(Tr),ls=[so,-Xi,Xi,so];Fr._matMult(ls),Wi._matMult(ls),Po._matMult(ls),Ui._matMult(ls)}const Ai=ht.stretch+ht.fixed,Yi=Pt.stretch+Pt.fixed;return{tl:Fr,tr:Wi,bl:Po,br:Ui,tex:{x:p.paddedRect.x+1+Ai,y:p.paddedRect.y+1+Yi,w:Bt.stretch+Bt.fixed-Ai,h:xt.stretch+xt.fixed-Yi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:as,pixelOffsetBR:Ur,minFontScaleX:dt/_/D,minFontScaleY:Lt/_/O,isSDF:o}};if(a&&(p.stretchX||p.stretchY)){const ht=Bm(N,le,ne),Pt=Bm(B,ye,ae);for(let Bt=0;Bt<ht.length-1;Bt++){const xt=ht[Bt],Kt=ht[Bt+1];for(let nn=0;nn<Pt.length-1;nn++)u.push(St(xt,Pt[nn],Kt,Pt[nn+1]))}}else u.push(St({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:C+1}));return u}function ph(r,e,o){let a=0;for(const u of r)a+=Math.max(e,Math.min(o,u[1]))-Math.max(e,Math.min(o,u[0]));return a}function Bm(r,e,o){const a=[{fixed:-1,stretch:0}];for(const[u,p]of r){const _=a[a.length-1];a.push({fixed:u-_.stretch,stretch:_.stretch}),a.push({fixed:u-_.stretch,stretch:_.stretch+(p-u)})}return a.push({fixed:e+1,stretch:o}),a}function fh(r,e,o,a){return r/e*o+a}function nd(r,e,o,a){return r-e*o/a}function x_(r,e,o,a){const u=e+r.positionedLines[a].lineOffset;return 0===a?o+u/2:o+(u+(e+r.positionedLines[a-1].lineOffset))/2}dh.loadGlyphRange=function(r,e,o,a,u){const p=256*e,_=p+255,x=a.transformRequest(a.normalizeGlyphsURL(o).replace("{fontstack}",r).replace("{range}",`${p}-${_}`),Eo.Glyphs);Li(x,(C,D)=>{if(C)u(C);else if(D){const O={},N=new vc(D).readFields(Tv,{});for(const B of N.glyphs)O[B.id]=B;u(null,{glyphs:O,ascender:N.ascender,descender:N.descender})}})},dh.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:o=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:_="normal"}){this.buffer=e,this.cutoff=a,this.radius=o;const x=this.size=r+4*e,C=this._createCanvas(x),D=this.ctx=C.getContext("2d",{willReadFrequently:!0});D.font=`${_} ${p} ${r}px ${u}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(r),_=Math.floor(o),x=Math.min(this.size-this.buffer,Math.ceil(p-u)),C=Math.min(this.size-this.buffer,Math.ceil(o)+Math.ceil(a)),D=x+2*this.buffer,O=C+2*this.buffer,N=D*O,B=new Uint8ClampedArray(N),X={data:B,width:D,height:O,glyphWidth:x,glyphHeight:C,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(0===x||0===C)return X;const{ctx:ne,buffer:ae,gridInner:le,gridOuter:ye}=this;ne.clearRect(ae,ae,x,C),ne.fillText(r,ae,ae+_+1);const De=ne.getImageData(ae,ae,x,C);ye.fill(Su,0,N),le.fill(0,0,N);for(let Re=0;Re<C;Re++)for(let Ve=0;Ve<x;Ve++){const $e=De.data[4*(Re*x+Ve)+3]/255;if(0===$e)continue;const Ge=(Re+ae)*D+Ve+ae;if(1===$e)ye[Ge]=0,le[Ge]=Su;else{const dt=.5-$e;ye[Ge]=dt>0?dt*dt:0,le[Ge]=dt<0?dt*dt:0}}hh(ye,0,0,D,O,D,this.f,this.v,this.z),hh(le,ae,ae,x,C,D,this.f,this.v,this.z);for(let Re=0;Re<N;Re++){const Ve=Math.sqrt(ye[Re])-Math.sqrt(le[Re]);B[Re]=Math.round(255-255*(Ve/this.radius+this.cutoff))}return X}};class va{constructor(e=[],o=b_){if(this.data=e,this.length=this.data.length,this.compare=o,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:o,compare:a}=this,u=o[e];for(;e>0;){const p=e-1>>1,_=o[p];if(a(u,_)>=0)break;o[e]=_,e=p}o[e]=u}_down(e){const{data:o,compare:a}=this,u=this.length>>1,p=o[e];for(;e<u;){let _=1+(e<<1),x=o[_];const C=_+1;if(C<this.length&&a(o[C],x)<0&&(_=C,x=o[C]),a(x,p)>=0)break;o[e]=x,e=_}o[e]=p}}function b_(r,e){return r<e?-1:r>e?1:0}function w_(r,e=1,o=!1){let a=1/0,u=1/0,p=-1/0,_=-1/0;const x=r[0];for(let X=0;X<x.length;X++){const ne=x[X];(!X||ne.x<a)&&(a=ne.x),(!X||ne.y<u)&&(u=ne.y),(!X||ne.x>p)&&(p=ne.x),(!X||ne.y>_)&&(_=ne.y)}const C=Math.min(p-a,_-u);let D=C/2;const O=new va([],Sv);if(0===C)return new Me(a,u);for(let X=a;X<p;X+=C)for(let ne=u;ne<_;ne+=C)O.push(new mh(X+D,ne+D,D,r));let N=function(X){let ne=0,ae=0,le=0;const ye=X[0];for(let De=0,Re=ye.length,Ve=Re-1;De<Re;Ve=De++){const $e=ye[De],Ge=ye[Ve],dt=$e.x*Ge.y-Ge.x*$e.y;ae+=($e.x+Ge.x)*dt,le+=($e.y+Ge.y)*dt,ne+=3*dt}return new mh(ae/ne,le/ne,0,X)}(r),B=O.length;for(;O.length;){const X=O.pop();(X.d>N.d||!N.d)&&(N=X,o&&console.log("found best %d after %d probes",Math.round(1e4*X.d)/1e4,B)),X.max-N.d<=e||(D=X.h/2,O.push(new mh(X.p.x-D,X.p.y-D,D,r)),O.push(new mh(X.p.x+D,X.p.y-D,D,r)),O.push(new mh(X.p.x-D,X.p.y+D,D,r)),O.push(new mh(X.p.x+D,X.p.y+D,D,r)),B+=4)}return o&&(console.log(`num probes: ${B}`),console.log(`best distance: ${N.d}`)),N.p}function Sv(r,e){return e.max-r.max}function mh(r,e,o,a){this.p=new Me(r,e),this.h=o,this.d=function(u,p){let _=!1,x=1/0;for(let C=0;C<p.length;C++){const D=p[C];for(let O=0,N=D.length,B=N-1;O<N;B=O++){const X=D[O],ne=D[B];X.y>u.y!=ne.y>u.y&&u.x<(ne.x-X.x)*(u.y-X.y)/(ne.y-X.y)+X.x&&(_=!_),x=Math.min(x,np(u,X,ne))}}return(_?1:-1)*Math.sqrt(x)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}const rd=Number.POSITIVE_INFINITY,Iv=Math.sqrt(2);function Vm(r,e){return e[1]!==rd?function(o,a,u){let p=0,_=0;switch(a=Math.abs(a),u=Math.abs(u),o){case"top-right":case"top-left":case"top":_=u-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-u}switch(o){case"top-right":case"bottom-right":case"right":p=-a;break;case"top-left":case"bottom-left":case"left":p=a}return[p,_]}(r,e[0],e[1]):function(o,a){let u=0,p=0;a<0&&(a=0);const _=a/Iv;switch(o){case"top-right":case"top-left":p=_-7;break;case"bottom-right":case"bottom-left":p=7-_;break;case"bottom":p=7-a;break;case"top":p=a-7}switch(o){case"top-right":case"bottom-right":u=-_;break;case"top-left":case"bottom-left":u=_;break;case"left":u=a;break;case"right":u=-a}return[u,p]}(r,e[0])}function Sp(r,e,o,a,u,p,_,x,C,D){r.createArrays(),r.tilePixelRatio=mr/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const O=r.layers[0].layout,N=r.layers[0]._unevaluatedLayout._values,B={};if("composite"===r.textSizeData.kind){const{minZoom:ae,maxZoom:le}=r.textSizeData;B.compositeTextSizes=[N["text-size"].possiblyEvaluate(new En(ae),x),N["text-size"].possiblyEvaluate(new En(le),x)]}if("composite"===r.iconSizeData.kind){const{minZoom:ae,maxZoom:le}=r.iconSizeData;B.compositeIconSizes=[N["icon-size"].possiblyEvaluate(new En(ae),x),N["icon-size"].possiblyEvaluate(new En(le),x)]}B.layoutTextSize=N["text-size"].possiblyEvaluate(new En(C+1),x),B.layoutIconSize=N["icon-size"].possiblyEvaluate(new En(C+1),x),B.textMaxSize=N["text-size"].possiblyEvaluate(new En(18),x);const X="map"===O.get("text-rotation-alignment")&&"point"!==O.get("symbol-placement"),ne=O.get("text-size");for(const ae of r.features){const le=O.get("text-font").evaluate(ae,{},x).join(","),ye=ne.evaluate(ae,{},x),De=B.layoutTextSize.evaluate(ae,{},x),Re=(B.layoutIconSize.evaluate(ae,{},x),{horizontal:{},vertical:void 0}),Ve=ae.text;let $e,Ge=[0,0];if(Ve){const Lt=Ve.toString(),St=24*O.get("text-letter-spacing").evaluate(ae,{},x),ht=24*O.get("text-line-height").evaluate(ae,{},x),Pt=tt(Lt)?St:0,Bt=O.get("text-anchor").evaluate(ae,{},x),xt=O.get("text-variable-anchor");if(!xt){const Er=O.get("text-radial-offset").evaluate(ae,{},x);Ge=Er?Vm(Bt,[24*Er,rd]):O.get("text-offset").evaluate(ae,{},x).map(It=>24*It)}let Kt=X?"center":O.get("text-justify").evaluate(ae,{},x);const nn=O.get("symbol-placement"),yr="point"===nn,ri="point"===nn?24*O.get("text-max-width").evaluate(ae,{},x):0,Cr=Er=>{r.allowVerticalPlacement&&pt(Lt)&&(Re.vertical=ch(Ve,e,o,u,le,ri,ht,Bt,Er,Pt,Ge,na.vertical,!0,nn,De,ye))};if(!X&&xt){const Er="auto"===Kt?xt.map(zr=>id(zr)):[Kt];let It=!1;for(let zr=0;zr<Er.length;zr++){const Fr=Er[zr];if(!Re.horizontal[Fr])if(It)Re.horizontal[Fr]=Re.horizontal[0];else{const Wi=ch(Ve,e,o,u,le,ri,ht,"center",Fr,Pt,Ge,na.horizontal,!1,nn,De,ye);Wi&&(Re.horizontal[Fr]=Wi,It=1===Wi.positionedLines.length)}}Cr("left")}else{if("auto"===Kt&&(Kt=id(Bt)),yr||O.get("text-writing-mode").indexOf("horizontal")>=0||!pt(Lt)){const Er=ch(Ve,e,o,u,le,ri,ht,Bt,Kt,Pt,Ge,na.horizontal,!1,nn,De,ye);Er&&(Re.horizontal[Kt]=Er)}Cr("point"===nn?"left":Kt)}}let dt=!1;if(ae.icon&&ae.icon.name){const Lt=a[ae.icon.name];Lt&&($e=uh(u[ae.icon.name],O.get("icon-offset").evaluate(ae,{},x),O.get("icon-anchor").evaluate(ae,{},x)),dt=Lt.sdf,void 0===r.sdfIcons?r.sdfIcons=Lt.sdf:r.sdfIcons!==Lt.sdf&&kn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Lt.pixelRatio!==r.pixelRatio||0!==O.get("icon-rotate").constantOr(1))&&(r.iconsNeedLinear=!0))}const ct=Ip(Re.horizontal)||Re.vertical;r.iconsInText||(r.iconsInText=!!ct&&ct.iconsInText),(ct||$e)&&C_(r,ae,Re,$e,a,B,De,0,Ge,dt,_,x,D)}p&&r.generateCollisionDebugBuffers(C,r.collisionBoxArray)}function id(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function C_(r,e,o,a,u,p,_,x,C,D,O,N,B){let X=p.textMaxSize.evaluate(e,{},N);void 0===X&&(X=_);const ne=r.layers[0].layout,ae=ne.get("icon-offset").evaluate(e,{},N),le=Ip(o.horizontal)||o.vertical,ye=_/24,De=r.tilePixelRatio*X/24,Re=r.tilePixelRatio*ne.get("symbol-spacing"),Ve=ne.get("text-padding")*r.tilePixelRatio,$e=ne.get("icon-padding")*r.tilePixelRatio,Ge=An(ne.get("text-max-angle")),dt="map"===ne.get("text-rotation-alignment")&&"point"!==ne.get("symbol-placement"),ct="map"===ne.get("icon-rotation-alignment")&&"point"!==ne.get("symbol-placement"),Lt=ne.get("symbol-placement"),St=Re/2,ht=ne.get("icon-text-fit");let Pt;a&&"none"!==ht&&(r.allowVerticalPlacement&&o.vertical&&(Pt=tu(a,o.vertical,ht,ne.get("icon-text-fit-padding"),ae,ye)),le&&(a=tu(a,le,ht,ne.get("icon-text-fit-padding"),ae,ye)));const Bt=(xt,Kt,nn)=>{if(Kt.x<0||Kt.x>=mr||Kt.y<0||Kt.y>=mr)return;const{x:yr,y:ri,z:Cr}=B.projectTilePoint(Kt.x,Kt.y,nn),Er=new Ja(yr,ri,Cr,0,void 0);!function(It,zr,Fr,Wi,Ui,Po,as,Ur,Tr,Ai,Yi,Xi,so,ls,Zs,ra,bi,Ro,Qa,cs,ai,Bo,Fi,ys,ko){const Yo=It.addToLineVertexArray(zr,Wi);let us,Ps,Xo,Tl,Ch,Eh,Ou,z_=0,pg=0,cu=0,fg=0,Dd=-1,Jp=-1;const el={};let Th=Zu(""),Qp=0,Ad=0;if(void 0===Tr._unevaluatedLayout.getValue("text-radial-offset")?[Qp,Ad]=Tr.layout.get("text-offset").evaluate(ai,{},ko).map(ia=>24*ia):(Qp=24*Tr.layout.get("text-radial-offset").evaluate(ai,{},ko),Ad=rd),It.allowVerticalPlacement&&Ui.vertical){const ia=Ui.vertical;if(Zs)Eh=sd(ia),Ur&&(Ou=sd(Ur));else{const oa=Tr.layout.get("text-rotate").evaluate(ai,{},ko)+90;Xo=od(Ai,Fr,zr,Yi,Xi,so,ia,ls,oa,ra),Ur&&(Tl=od(Ai,Fr,zr,Yi,Xi,so,Ur,Ro,oa))}}if(Po){const ia=Tr.layout.get("icon-rotate").evaluate(ai,{},ko),oa="none"!==Tr.layout.get("icon-text-fit"),Fu=Mp(Po,ia,Fi,oa),tf=Ur?Mp(Ur,ia,Fi,oa):void 0;Ps=od(Ai,Fr,zr,Yi,Xi,so,Po,Ro,ia),z_=4*Fu.length;const nf=It.iconSizeData;let Dc=null;"source"===nf.kind?(Dc=[xl*Tr.layout.get("icon-size").evaluate(ai,{},ko)],Dc[0]>wc&&kn(`${It.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===nf.kind&&(Dc=[xl*Bo.compositeIconSizes[0].evaluate(ai,{},ko),xl*Bo.compositeIconSizes[1].evaluate(ai,{},ko)],(Dc[0]>wc||Dc[1]>wc)&&kn(`${It.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),It.addSymbols(It.icon,Fu,Dc,cs,Qa,ai,!1,Fr,zr,Yo.lineStartIndex,Yo.lineLength,-1,ys,ko),Dd=It.icon.placedSymbolArray.length-1,tf&&(pg=4*tf.length,It.addSymbols(It.icon,tf,Dc,cs,Qa,ai,na.vertical,Fr,zr,Yo.lineStartIndex,Yo.lineLength,-1,ys,ko),Jp=It.icon.placedSymbolArray.length-1)}for(const ia in Ui.horizontal){const oa=Ui.horizontal[ia];us||(Th=Zu(oa.text),Zs?Ch=sd(oa):us=od(Ai,Fr,zr,Yi,Xi,so,oa,ls,Tr.layout.get("text-rotate").evaluate(ai,{},ko),ra));const Fu=1===oa.positionedLines.length;if(cu+=Um(It,Fr,zr,oa,as,Tr,Zs,ai,ra,Yo,Ui.vertical?na.horizontal:na.horizontalOnly,Fu?Object.keys(Ui.horizontal):[ia],el,Dd,Bo,ys,ko),Fu)break}Ui.vertical&&(fg+=Um(It,Fr,zr,Ui.vertical,as,Tr,Zs,ai,ra,Yo,na.vertical,["vertical"],el,Jp,Bo,ys,ko));let Tc=-1;const ef=(ia,oa)=>ia?Math.max(ia,oa):oa;Tc=ef(Ch,Tc),Tc=ef(Eh,Tc),Tc=ef(Ou,Tc);const B_=Tc>-1?1:0;It.glyphOffsetArray.length>=Cc.MAX_GLYPHS&&kn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==ai.sortKey&&It.addToSortKeyRanges(It.symbolInstances.length,ai.sortKey),It.symbolInstances.emplaceBack(Fr.x,Fr.y,Fr.z,zr.x,zr.y,el.right>=0?el.right:-1,el.center>=0?el.center:-1,el.left>=0?el.left:-1,el.vertical>=0?el.vertical:-1,Dd,Jp,Th,void 0!==us?us:It.collisionBoxArray.length,void 0!==us?us+1:It.collisionBoxArray.length,void 0!==Xo?Xo:It.collisionBoxArray.length,void 0!==Xo?Xo+1:It.collisionBoxArray.length,void 0!==Ps?Ps:It.collisionBoxArray.length,void 0!==Ps?Ps+1:It.collisionBoxArray.length,Tl||It.collisionBoxArray.length,Tl?Tl+1:It.collisionBoxArray.length,Yi,cu,fg,z_,pg,B_,0,Qp,Ad,Tc)}(r,Kt,Er,xt,o,a,u,Pt,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,Ve,dt,C,0,$e,ct,ae,e,p,D,O,N)};if("line"===Lt)for(const xt of ed(e.geometry,0,0,mr,mr)){const Kt=Nm(xt,Re,Ge,o.vertical||le,a,24,De,r.overscaling,mr);for(const nn of Kt){const yr=le;yr&&E_(r,yr.text,St,nn)||Bt(xt,nn,N)}}else if("line-center"===Lt){for(const xt of e.geometry)if(xt.length>1){const Kt=Lm(xt,Ge,o.vertical||le,a,24,De);Kt&&Bt(xt,Kt,N)}}else if("Polygon"===e.type)for(const xt of $l(e.geometry,0)){const Kt=w_(xt,16);Bt(xt[0],new Ja(Kt.x,Kt.y,0,0,void 0),N)}else if("LineString"===e.type)for(const xt of e.geometry)Bt(xt,new Ja(xt[0].x,xt[0].y,0,0,void 0),N);else if("Point"===e.type)for(const xt of e.geometry)for(const Kt of xt)Bt([Kt],new Ja(Kt.x,Kt.y,0,0,void 0),N)}const wc=32640;function Um(r,e,o,a,u,p,_,x,C,D,O,N,B,X,ne,ae,le){const ye=function(Ve,$e,Ge,dt,ct,Lt,St,ht){const Pt=[];if(0===$e.positionedLines.length)return Pt;const Bt=dt.layout.get("text-rotate").evaluate(Lt,{})*Math.PI/180,xt=function(Cr){const Er=Cr[0],It=Cr[1],zr=Er*It;return zr>0?[Er,-It]:zr<0?[-Er,It]:0===Er?[It,Er]:[It,-Er]}(Ge);let Kt=Math.abs($e.top-$e.bottom);for(const Cr of $e.positionedLines)Kt-=Cr.lineOffset;const nn=$e.positionedLines.length,yr=Kt/nn;let ri=$e.top-Ge[1];for(let Cr=0;Cr<nn;++Cr){const Er=$e.positionedLines[Cr];ri=x_($e,yr,ri,Cr);for(const It of Er.positionedGlyphs){if(!It.rect)continue;const zr=It.rect||{};let Fr=4,Wi=!0,Ui=1,Po=0;if(It.imageName){const Fi=St[It.imageName];if(!Fi)continue;if(Fi.sdf){kn("SDF images are not supported in formatted text and will be ignored.");continue}Wi=!1,Ui=Fi.pixelRatio,Fr=1/Ui}const as=(ct||ht)&&It.vertical,Ur=It.metrics.advance*It.scale/2,Tr=It.metrics,Ai=It.rect;if(null===Ai)continue;ht&&$e.verticalizable&&(Po=It.imageName?Ur-It.metrics.width*It.scale/2:0);const Yi=ct?[It.x+Ur,It.y]:[0,0];let Xi=[0,0],so=[0,0],ls=!1;ct||(as?(so=[It.x+Ur+xt[0],It.y+xt[1]-Po],ls=!0):Xi=[It.x+Ur+Ge[0],It.y+Ge[1]-Po]);const Zs=Ai.w*It.scale/(Ui*(It.localGlyph?2:1)),ra=Ai.h*It.scale/(Ui*(It.localGlyph?2:1));let bi,Ro,Qa,cs;if(as){const Fi=It.y-ri,ys=new Me(-Ur,Ur-Fi),ko=-Math.PI/2,Yo=new Me(...so);bi=new Me(-Ur+Xi[0],Xi[1]),bi._rotateAround(ko,ys)._add(Yo),bi.x+=-Fi+Ur,bi.y-=(Tr.left-Fr)*It.scale;const us=It.imageName?Tr.advance*It.scale:24*It.scale,Ps=String.fromCharCode(It.glyph);Dm(Ps)?bi.x+=(1-Fr)*It.scale:vv(Ps)?bi.x+=us-Tr.height*It.scale+(-Fr-1)*It.scale:bi.x+=It.imageName||Tr.width+2*Fr===Ai.w&&Tr.height+2*Fr===Ai.h?(us-ra)/2:(us-(Tr.height+2*Fr)*It.scale)/2,Ro=new Me(bi.x,bi.y-Zs),Qa=new Me(bi.x+ra,bi.y),cs=new Me(bi.x+ra,bi.y-Zs)}else{const Fi=(Tr.left-Fr)*It.scale-Ur+Xi[0],ys=(-Tr.top-Fr)*It.scale+Xi[1],ko=Fi+Zs,Yo=ys+ra;bi=new Me(Fi,ys),Ro=new Me(ko,ys),Qa=new Me(Fi,Yo),cs=new Me(ko,Yo)}if(Bt){let Fi;Fi=ct?new Me(0,0):ls?new Me(xt[0],xt[1]):new Me(Ge[0],Ge[1]),bi._rotateAround(Bt,Fi),Ro._rotateAround(Bt,Fi),Qa._rotateAround(Bt,Fi),cs._rotateAround(Bt,Fi)}const ai=new Me(0,0),Bo=new Me(0,0);Pt.push({tl:bi,tr:Ro,bl:Qa,br:cs,tex:zr,writingMode:$e.writingMode,glyphOffset:Yi,sectionIndex:It.sectionIndex,isSDF:Wi,pixelOffsetTL:ai,pixelOffsetBR:Bo,minFontScaleX:0,minFontScaleY:0})}}return Pt}(0,a,C,p,_,x,u,r.allowVerticalPlacement),De=r.textSizeData;let Re=null;"source"===De.kind?(Re=[xl*p.layout.get("text-size").evaluate(x,{},le)],Re[0]>wc&&kn(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===De.kind&&(Re=[xl*ne.compositeTextSizes[0].evaluate(x,{},le),xl*ne.compositeTextSizes[1].evaluate(x,{},le)],(Re[0]>wc||Re[1]>wc)&&kn(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,ye,Re,C,_,x,O,e,o,D.lineStartIndex,D.lineLength,X,ae,le);for(const Ve of N)B[Ve]=r.text.placedSymbolArray.length-1;return 4*ye.length}function Ip(r){for(const e in r)return r[e];return null}function od(r,e,o,a,u,p,_,x,C,D){let O=_.top,N=_.bottom,B=_.left,X=_.right;const ne=_.collisionPadding;if(ne&&(B-=ne[0],O-=ne[1],X+=ne[2],N+=ne[3]),C){const ae=new Me(B,O),le=new Me(X,O),ye=new Me(B,N),De=new Me(X,N),Re=An(C);let Ve=new Me(0,0);D&&(Ve=new Me(D[0],D[1])),ae._rotateAround(Re,Ve),le._rotateAround(Re,Ve),ye._rotateAround(Re,Ve),De._rotateAround(Re,Ve),B=Math.min(ae.x,le.x,ye.x,De.x),X=Math.max(ae.x,le.x,ye.x,De.x),O=Math.min(ae.y,le.y,ye.y,De.y),N=Math.max(ae.y,le.y,ye.y,De.y)}return r.emplaceBack(e.x,e.y,e.z,o.x,o.y,B,O,X,N,x,a,u,p),r.length-1}function sd(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function E_(r,e,o,a){const u=r.compareText;if(e in u){const p=u[e];for(let _=p.length-1;_>=0;_--)if(a.dist(p[_])<o)return!0}else u[e]=[];return u[e].push(a),!1}const T_=Jc.VectorTileFeature.types,jm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function gh(r,e,o,a,u,p,_,x,C,D,O,N,B,X,ne,ae){const le=O?Math.min(wc,Math.round(O[0])):0,ye=O?Math.min(wc,Math.round(O[1])):0;r.emplaceBack(e,o,Math.round(32*_),Math.round(32*x),C,D,(le<<1)+(N?1:0),ye,16*B,16*X,256*ne,256*ae,a,u,p,0)}function Pp(r,e,o){r.emplaceBack(e.x,e.y,o),r.emplaceBack(e.x,e.y,o),r.emplaceBack(e.x,e.y,o),r.emplaceBack(e.x,e.y,o)}function Cl(r){for(const e of r.sections)if(Ot(e.text))return!0;return!1}class _h{constructor(e){this.layoutVertexArray=new Gd,this.indexArray=new Vs,this.programConfigurations=e,this.segments=new io,this.dynamicLayoutVertexArray=new _u,this.opacityVertexArray=new kf,this.placedSymbolArray=new Nf}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,o,a,u){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,g_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,er.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,jm,!0),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ht("SymbolBuffers",_h);class Rp{constructor(e,o,a){this.layoutVertexArray=new e,this.layoutAttributes=o,this.indexArray=new a,this.segments=new io,this.collisionVertexArray=new yu,this.collisionVertexArrayExt=new _u}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Cm.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Em.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ht("CollisionBuffers",Rp);class Cc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=_t([]),this.placementViewportMatrix=_t([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=oh(this.zoom,o["text-size"]),this.iconSizeData=oh(this.zoom,o["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),p=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==p&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===p||"auto"===p&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(_=>na[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID}createArrays(){this.text=new _h(new Hc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new _h(new Hc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new jc,this.lineVertexArray=new Xd,this.symbolInstances=new ml}calculateGlyphDependencies(e,o,a,u,p){for(let _=0;_<e.length;_++)if(o[e.charCodeAt(_)]=!0,u&&p){const x=Yh[e.charAt(_)];x&&(o[x.charCodeAt(0)]=!0)}}populate(e,o,a,u){const p=this.layers[0],_=p.layout,x=_.get("text-font"),C=_.get("text-field"),D=_.get("icon-image"),O=("constant"!==C.value.kind||C.value.value instanceof mn&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),N="constant"!==D.value.kind||!!D.value.value||Object.keys(D.parameters).length>0,B=_.get("symbol-sort-key");if(this.features=[],!O&&!N)return;const X=o.iconDependencies,ne=o.glyphDependencies,ae=o.availableImages,le=new En(this.zoom);for(const{feature:ye,id:De,index:Re,sourceLayerIndex:Ve}of e){const $e=p._featureFilter.needGeometry,Ge=fc(ye,$e);if(!p._featureFilter.filter(le,Ge,a))continue;let dt,ct;if($e||(Ge.geometry=jl(ye,a,u)),O){const St=p.getValueAndResolveTokens("text-field",Ge,a,ae),ht=mn.factory(St);Cl(ht)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ma()||this.hasRTLText&&cr.isParsed())&&(dt=wp(ht,p,Ge))}if(N){const St=p.getValueAndResolveTokens("icon-image",Ge,a,ae);ct=St instanceof Pi?St:Pi.fromString(St)}if(!dt&&!ct)continue;const Lt=this.sortFeaturesByKey?B.evaluate(Ge,{},a):void 0;if(this.features.push({id:De,text:dt,icon:ct,index:Re,sourceLayerIndex:Ve,geometry:Ge.geometry,properties:ye.properties,type:T_[ye.type],sortKey:Lt}),ct&&(X[ct.name]=!0),dt){const St=x.evaluate(Ge,{},a).join(","),ht="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(na.vertical)>=0;for(const Pt of dt.sections)if(Pt.image)X[Pt.image.name]=!0;else{const Bt=pt(dt.toString()),xt=Pt.fontStack||St,Kt=ne[xt]=ne[xt]||{};this.calculateGlyphDependencies(Pt.text,Kt,ht,this.allowVerticalPlacement,Bt)}}}"line"===_.get("symbol-placement")&&(this.features=function(ye){const De={},Re={},Ve=[];let $e=0;function Ge(St){Ve.push(ye[St]),$e++}function dt(St,ht,Pt){const Bt=Re[St];return delete Re[St],Re[ht]=Bt,Ve[Bt].geometry[0].pop(),Ve[Bt].geometry[0]=Ve[Bt].geometry[0].concat(Pt[0]),Bt}function ct(St,ht,Pt){const Bt=De[ht];return delete De[ht],De[St]=Bt,Ve[Bt].geometry[0].shift(),Ve[Bt].geometry[0]=Pt[0].concat(Ve[Bt].geometry[0]),Bt}function Lt(St,ht,Pt){const Bt=Pt?ht[0][ht[0].length-1]:ht[0][0];return`${St}:${Bt.x}:${Bt.y}`}for(let St=0;St<ye.length;St++){const ht=ye[St],Pt=ht.geometry,Bt=ht.text?ht.text.toString():null;if(!Bt){Ge(St);continue}const xt=Lt(Bt,Pt),Kt=Lt(Bt,Pt,!0);if(xt in Re&&Kt in De&&Re[xt]!==De[Kt]){const nn=ct(xt,Kt,Pt),yr=dt(xt,Kt,Ve[nn].geometry);delete De[xt],delete Re[Kt],Re[Lt(Bt,Ve[yr].geometry,!0)]=yr,Ve[nn].geometry=null}else xt in Re?dt(xt,Kt,Pt):Kt in De?ct(xt,Kt,Pt):(Ge(St),De[xt]=$e-1,Re[Kt]=$e-1)}return Ve.filter(St=>St.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ye,De)=>ye.sortKey-De.sortKey)}update(e,o,a,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,o,this.layers,a,u),this.icon.programConfigurations.updatePaintArrays(e,o,this.layers,a,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,o){const a=this.lineVertexArray.length;if(void 0!==e.segment){let u=e.dist(o[e.segment+1]),p=e.dist(o[e.segment]);const _={};for(let x=e.segment+1;x<o.length;x++)_[x]={x:o[x].x,y:o[x].y,tileUnitDistanceFromAnchor:u},x<o.length-1&&(u+=o[x+1].dist(o[x]));for(let x=e.segment||0;x>=0;x--)_[x]={x:o[x].x,y:o[x].y,tileUnitDistanceFromAnchor:p},x>0&&(p+=o[x-1].dist(o[x]));for(let x=0;x<o.length;x++){const C=_[x];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,o,a,u,p,_,x,C,D,O,N,B,X,ne){const ae=e.indexArray,le=e.layoutVertexArray,ye=e.segments.prepareSegment(4*o.length,le,ae,this.canOverlap?_.sortKey:void 0),De=this.glyphOffsetArray.length,Re=ye.vertexLength,Ve=this.allowVerticalPlacement&&x===na.vertical?Math.PI/2:0,$e=_.text&&_.text.sections;for(let Ge=0;Ge<o.length;Ge++){const{tl:dt,tr:ct,bl:Lt,br:St,tex:ht,pixelOffsetTL:Pt,pixelOffsetBR:Bt,minFontScaleX:xt,minFontScaleY:Kt,glyphOffset:nn,isSDF:yr,sectionIndex:ri}=o[Ge],Cr=ye.vertexLength,Er=nn[1];gh(le,C.x,C.y,C.z,D.x,D.y,dt.x,Er+dt.y,ht.x,ht.y,a,yr,Pt.x,Pt.y,xt,Kt),gh(le,C.x,C.y,C.z,D.x,D.y,ct.x,Er+ct.y,ht.x+ht.w,ht.y,a,yr,Bt.x,Pt.y,xt,Kt),gh(le,C.x,C.y,C.z,D.x,D.y,Lt.x,Er+Lt.y,ht.x,ht.y+ht.h,a,yr,Pt.x,Bt.y,xt,Kt),gh(le,C.x,C.y,C.z,D.x,D.y,St.x,Er+St.y,ht.x+ht.w,ht.y+ht.h,a,yr,Bt.x,Bt.y,xt,Kt),Pp(e.dynamicLayoutVertexArray,C,Ve),ae.emplaceBack(Cr,Cr+1,Cr+2),ae.emplaceBack(Cr+1,Cr+2,Cr+3),ye.vertexLength+=4,ye.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(nn[0]),Ge!==o.length-1&&ri===o[Ge+1].sectionIndex||e.programConfigurations.populatePaintArrays(le.length,_,_.index,{},X,ne,$e&&$e[ri])}e.placedSymbolArray.emplaceBack(C.x,C.y,C.z,D.x,D.y,De,this.glyphOffsetArray.length-De,Re,O,N,D.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],x,0,!1,0,B,0)}_commitLayoutVertex(e,o,a,u,p,_,x){e.emplaceBack(o,a,u,p,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,o,a,u,p,_,x){const C=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),D=C.vertexLength,O=x.tileAnchorX,N=x.tileAnchorY;for(let X=0;X<4;X++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(o,-e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(o,e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(o,e.padding,e.padding),a.collisionVertexArrayExt.emplaceBack(o,-e.padding,e.padding),this._commitLayoutVertex(a.layoutVertexArray,u,p,_,O,N,new Me(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,p,_,O,N,new Me(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,p,_,O,N,new Me(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,p,_,O,N,new Me(e.x1,e.y2)),C.vertexLength+=4;const B=a.indexArray;B.emplaceBack(D,D+1),B.emplaceBack(D+1,D+2),B.emplaceBack(D+2,D+3),B.emplaceBack(D+3,D),C.primitiveLength+=4}_addTextDebugCollisionBoxes(e,o,a,u,p,_){for(let x=u;x<p;x++){const C=a.get(x),D=this.getSymbolInstanceTextSize(e,_,o,x);this._addCollisionDebugVertices(C,D,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,o,a,u,p,_){for(let x=u;x<p;x++){const C=a.get(x),D=this.getSymbolInstanceIconSize(e,o,x);this._addCollisionDebugVertices(C,D,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Rp(Rh,ih.members,Bl),this.iconCollisionBox=new Rp(Rh,ih.members,Bl);const a=yc(this.iconSizeData,e),u=yc(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const _=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(u,e,o,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(u,e,o,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(a,e,o,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(a,e,o,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,o,a,u){const p=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:u),_=Ia(this.textSizeData,e,p)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,o,a){const u=this.icon.placedSymbolArray.get(a),p=Ia(this.iconSizeData,e,u);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,o,a){e.emplaceBack(o,-a,-a),e.emplaceBack(o,a,-a),e.emplaceBack(o,a,a),e.emplaceBack(o,-a,a)}_updateTextDebugCollisionBoxes(e,o,a,u,p,_){for(let x=u;x<p;x++){const C=a.get(x),D=this.getSymbolInstanceTextSize(e,_,o,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,C.padding)}}_updateIconDebugCollisionBoxes(e,o,a,u,p){for(let _=u;_<p;_++){const x=a.get(_),C=this.getSymbolInstanceIconSize(e,o,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,C,x.padding)}}updateCollisionDebugBuffers(e,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=yc(this.iconSizeData,e),u=yc(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const _=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(u,e,o,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(u,e,o,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(a,e,o,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(a,e,o,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,o,a,u,p,_,x,C,D){const O={};for(let N=o;N<a;N++){const B=e.get(N);O.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,padding:B.padding,projectedAnchorX:B.projectedAnchorX,projectedAnchorY:B.projectedAnchorY,projectedAnchorZ:B.projectedAnchorZ,tileAnchorX:B.tileAnchorX,tileAnchorY:B.tileAnchorY},O.textFeatureIndex=B.featureIndex;break}for(let N=u;N<p;N++){const B=e.get(N);O.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,padding:B.padding,projectedAnchorX:B.projectedAnchorX,projectedAnchorY:B.projectedAnchorY,projectedAnchorZ:B.projectedAnchorZ,tileAnchorX:B.tileAnchorX,tileAnchorY:B.tileAnchorY},O.verticalTextFeatureIndex=B.featureIndex;break}for(let N=_;N<x;N++){const B=e.get(N);O.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,padding:B.padding,projectedAnchorX:B.projectedAnchorX,projectedAnchorY:B.projectedAnchorY,projectedAnchorZ:B.projectedAnchorZ,tileAnchorX:B.tileAnchorX,tileAnchorY:B.tileAnchorY},O.iconFeatureIndex=B.featureIndex;break}for(let N=C;N<D;N++){const B=e.get(N);O.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,padding:B.padding,projectedAnchorX:B.projectedAnchorX,projectedAnchorY:B.projectedAnchorY,projectedAnchorZ:B.projectedAnchorZ,tileAnchorX:B.tileAnchorX,tileAnchorY:B.tileAnchorY},O.verticalIconFeatureIndex=B.featureIndex;break}return O}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const a=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,o){const a=e.placedSymbolArray.get(o),u=a.vertexStartIndex+4*a.numGlyphs;for(let p=a.vertexStartIndex;p<u;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const o=Math.sin(e),a=Math.cos(e),u=[],p=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const C=this.symbolInstances.get(x);u.push(0|Math.round(o*C.tileAnchorX+a*C.tileAnchorY)),p.push(C.featureIndex)}return _.sort((x,C)=>u[x]-u[C]||p[C]-p[x]),_}addToSortKeyRanges(e,o){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===o?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const a=this.symbolInstances.get(o);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((u,p,_)=>{u>=0&&_.indexOf(u)===p&&this.addIndicesForPlacedSymbol(this.text,u)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ht("SymbolBucket",Cc,{omit:["layers","collisionBoxArray","features","compareText"]}),Cc.MAX_GLYPHS=65535,Cc.addDynamicAttributes=Pp;const Pv=new ki({"symbol-placement":new tn(rt.layout_symbol["symbol-placement"]),"symbol-spacing":new tn(rt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new tn(rt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new fn(rt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new tn(rt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new tn(rt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new tn(rt.layout_symbol["icon-ignore-placement"]),"icon-optional":new tn(rt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new tn(rt.layout_symbol["icon-rotation-alignment"]),"icon-size":new fn(rt.layout_symbol["icon-size"]),"icon-text-fit":new tn(rt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new tn(rt.layout_symbol["icon-text-fit-padding"]),"icon-image":new fn(rt.layout_symbol["icon-image"]),"icon-rotate":new fn(rt.layout_symbol["icon-rotate"]),"icon-padding":new tn(rt.layout_symbol["icon-padding"]),"icon-keep-upright":new tn(rt.layout_symbol["icon-keep-upright"]),"icon-offset":new fn(rt.layout_symbol["icon-offset"]),"icon-anchor":new fn(rt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new tn(rt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new tn(rt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new tn(rt.layout_symbol["text-rotation-alignment"]),"text-field":new fn(rt.layout_symbol["text-field"]),"text-font":new fn(rt.layout_symbol["text-font"]),"text-size":new fn(rt.layout_symbol["text-size"]),"text-max-width":new fn(rt.layout_symbol["text-max-width"]),"text-line-height":new fn(rt.layout_symbol["text-line-height"]),"text-letter-spacing":new fn(rt.layout_symbol["text-letter-spacing"]),"text-justify":new fn(rt.layout_symbol["text-justify"]),"text-radial-offset":new fn(rt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new tn(rt.layout_symbol["text-variable-anchor"]),"text-anchor":new fn(rt.layout_symbol["text-anchor"]),"text-max-angle":new tn(rt.layout_symbol["text-max-angle"]),"text-writing-mode":new tn(rt.layout_symbol["text-writing-mode"]),"text-rotate":new fn(rt.layout_symbol["text-rotate"]),"text-padding":new tn(rt.layout_symbol["text-padding"]),"text-keep-upright":new tn(rt.layout_symbol["text-keep-upright"]),"text-transform":new fn(rt.layout_symbol["text-transform"]),"text-offset":new fn(rt.layout_symbol["text-offset"]),"text-allow-overlap":new tn(rt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new tn(rt.layout_symbol["text-ignore-placement"]),"text-optional":new tn(rt.layout_symbol["text-optional"])});var ad={paint:new ki({"icon-opacity":new fn(rt.paint_symbol["icon-opacity"]),"icon-color":new fn(rt.paint_symbol["icon-color"]),"icon-halo-color":new fn(rt.paint_symbol["icon-halo-color"]),"icon-halo-width":new fn(rt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new fn(rt.paint_symbol["icon-halo-blur"]),"icon-translate":new tn(rt.paint_symbol["icon-translate"]),"icon-translate-anchor":new tn(rt.paint_symbol["icon-translate-anchor"]),"text-opacity":new fn(rt.paint_symbol["text-opacity"]),"text-color":new fn(rt.paint_symbol["text-color"],{runtimeType:mi,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new fn(rt.paint_symbol["text-halo-color"]),"text-halo-width":new fn(rt.paint_symbol["text-halo-width"]),"text-halo-blur":new fn(rt.paint_symbol["text-halo-blur"]),"text-translate":new tn(rt.paint_symbol["text-translate"]),"text-translate-anchor":new tn(rt.paint_symbol["text-translate-anchor"])}),layout:Pv};class $m{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Si,this.defaultValue=e}evaluate(e){if(e.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(e.formattedSection))return o.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ht("FormatSectionOverride",$m,{omit:["defaultValue"]});class ld extends _a{constructor(e){super(e,ad)}recalculate(e,o){super.recalculate(e,o),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const p of a)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,o,a,u){const p=this.layout.get(e).evaluate(o,{},a,u),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||sl(_.value)||!p?p:(x=o.properties,p.replace(/{([^{}]+)}/g,(D,O)=>O in x?String(x[O]):""));var x}createBucket(e){return new Cc(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of ad.paint.overridableProperties){if(!ld.hasPaintOverride(this.layout,e))continue;const o=this.paint.get(e),a=new $m(o),u=new Oc(a,o.property.specification);let p=null;p="constant"===o.value.kind||"source"===o.value.kind?new Da("source",u):new Fc("composite",u,o.value.zoomStops,o.value._interpolationType),this.paint._values[e]=new Ds(o.property,p,o.parameters)}}_handleOverridablePaintPropertyUpdate(e,o,a){return!(!this.layout||o.isDataDriven()||a.isDataDriven())&&ld.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,o){const a=e.get("text-field"),u=ad.paint.properties[o];let p=!1;const _=x=>{for(const C of x)if(u.overrides&&u.overrides.hasOverride(C))return void(p=!0)};if("constant"===a.value.kind&&a.value.value instanceof mn)_(a.value.value.sections);else if("source"===a.value.kind){const x=D=>{p||(D instanceof qo&&Ar(D.value)===es?_(D.value.sections):D instanceof Mo?_(D.sections):D.eachChild(x))},C=a.value;C._styleExpression&&x(C._styleExpression.expression)}return p}getProgramConfiguration(e){return new _l(this,e)}}var D_={paint:new ki({"background-color":new tn(rt.paint_background["background-color"]),"background-pattern":new _s(rt.paint_background["background-pattern"]),"background-opacity":new tn(rt.paint_background["background-opacity"])})},kp={paint:new ki({"raster-opacity":new tn(rt.paint_raster["raster-opacity"]),"raster-hue-rotate":new tn(rt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new tn(rt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new tn(rt.paint_raster["raster-brightness-max"]),"raster-saturation":new tn(rt.paint_raster["raster-saturation"]),"raster-contrast":new tn(rt.paint_raster["raster-contrast"]),"raster-resampling":new tn(rt.paint_raster["raster-resampling"]),"raster-fade-duration":new tn(rt.paint_raster["raster-fade-duration"])})};class A_ extends _a{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var M_={paint:new ki({"sky-type":new tn(rt.paint_sky["sky-type"]),"sky-atmosphere-sun":new tn(rt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new tn(rt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new tn(rt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new tn(rt.paint_sky["sky-gradient-radius"]),"sky-gradient":new ga(rt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new tn(rt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new tn(rt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new tn(rt.paint_sky["sky-opacity"])})};function Iu(r,e,o){const a=ao(0,0,1),u=Ko(Fo());return function(p,_,x){x*=.5;var C=_[0],D=_[1],O=_[2],N=_[3],B=Math.sin(x),X=Math.cos(x);p[0]=C*X-O*B,p[1]=D*X+N*B,p[2]=O*X+C*B,p[3]=N*X-D*B}(u,u,o?-An(r)+Math.PI:An(r)),ji(u,u,-An(e)),Ki(a,a,u),Un(a,a)}const Op={circle:class extends _a{constructor(r){super(r,r_)}createBucket(r){return new Nh(r)}queryRadius(r){const e=r;return bu("circle-radius",this,e)+bu("circle-stroke-width",this,e)+Bh(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,o,a,u,p,_,x){const C=nm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(e,o)+this.paint.get("circle-stroke-width").evaluate(e,o);return Ku(r,a,p,_,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),C,D)}getProgramIds(){return["circle"]}getProgramConfiguration(r){return new _l(this,r)}},heatmap:class extends _a{createBucket(r){return new sp(r)}constructor(r){super(r,wu),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){"heatmap-color"===r&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Sa({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return bu("heatmap-radius",this,r)}queryIntersectsFeature(r,e,o,a,u,p,_,x){const C=this.paint.get("heatmap-radius").evaluate(e,o);return Ku(r,a,p,_,x,!0,!0,new Me(0,0),C)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(r){return new _l(this,r)}},hillshade:class extends _a{constructor(r){super(r,mv)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(r){return new _l(this,r)}},fill:class extends _a{constructor(r){super(r,pm)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),o=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getProgramConfiguration(r){return new _l(this,r)}recalculate(r,e){super.recalculate(r,e);const o=this.paint._values["fill-outline-color"];"constant"===o.value.kind&&void 0===o.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Kc(r)}queryRadius(){return Bh(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,o,a,u,p){return!r.queryGeometry.isAboveHorizon&&Qf(Wc(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends _a{constructor(r){super(r,yv)}createBucket(r){return new rh(r)}queryRadius(){return Bh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(r){return new _l(this,r)}queryIntersectsFeature(r,e,o,a,u,p,_,x,C){const D=nm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),O=this.paint.get("fill-extrusion-height").evaluate(e,o),N=this.paint.get("fill-extrusion-base").evaluate(e,o),B=[0,0],X=x&&p.elevation,ne=p.elevation?p.elevation.exaggeration():1;if(X){const ye=r.tile.getBucket(this).centroidVertexArray,De=C+1;if(De<ye.length){const Re=ye.get(De);B[0]=Re.a_centroid_pos0,B[1]=Re.a_centroid_pos1}}if(0===B[0]&&1===B[1])return!1;const ae=(ye=a,De=N,Re=O,Ve=D,$e=_,(Ge=X?x:null)?function(St,ht,Pt,Bt,xt,Kt,nn,yr,ri){const Cr=[],Er=[],It=[0,0,0,1];for(const zr of St){const Fr=[],Wi=[];for(const Ui of zr){const Po=Ui.x+Bt.x,as=Ui.y+Bt.y,Ur=u_(Po,as,ht,Pt,Kt,nn,yr,ri);It[0]=Po,It[1]=as,It[2]=Ur.base,It[3]=1,bo(It,It,xt),It[3]=Math.max(It[3],1e-5);const Tr=xp([It[0]/It[3],It[1]/It[3],It[2]/It[3]]);It[0]=Po,It[1]=as,It[2]=Ur.top,It[3]=1,bo(It,It,xt),It[3]=Math.max(It[3],1e-5);const Ai=xp([It[0]/It[3],It[1]/It[3],It[2]/It[3]]);Fr.push(Tr),Wi.push(Ai)}Cr.push(Fr),Er.push(Wi)}return[Cr,Er]}(ye,De,Re,Ve,$e,Ge,B,ne,p.center.lat):function(St,ht,Pt,Bt,xt){const Kt=[],nn=[],yr=xt[8]*ht,ri=xt[9]*ht,Cr=xt[10]*ht,Er=xt[11]*ht,It=xt[8]*Pt,zr=xt[9]*Pt,Fr=xt[10]*Pt,Wi=xt[11]*Pt;for(const Ui of St){const Po=[],as=[];for(const Ur of Ui){const Tr=Ur.x+Bt.x,Ai=Ur.y+Bt.y,Yi=xt[0]*Tr+xt[4]*Ai+xt[12],Xi=xt[1]*Tr+xt[5]*Ai+xt[13],so=xt[2]*Tr+xt[6]*Ai+xt[14],ls=xt[3]*Tr+xt[7]*Ai+xt[15],Zs=Yi+yr,ra=Xi+ri,bi=so+Cr,Ro=Math.max(ls+Er,1e-5),Qa=Yi+It,cs=Xi+zr,ai=so+Fr,Bo=Math.max(ls+Wi,1e-5),Fi=new Me(Zs/Ro,ra/Ro);Fi.z=bi/Ro,Po.push(Fi);const ys=new Me(Qa/Bo,cs/Bo);ys.z=ai/Bo,as.push(ys)}Kt.push(Po),nn.push(as)}return[Kt,nn]}(ye,De,Re,Ve,$e)),le=r.queryGeometry;var ye,De,Re,Ve,$e,Ge;return function(ye,De,Re){let Ve=1/0;Qf(Re,De)&&(Ve=vm(Re,De[0]));for(let $e=0;$e<De.length;$e++){const Ge=De[$e],dt=ye[$e];for(let ct=0;ct<Ge.length-1;ct++){const Lt=Ge[ct],St=[Lt,Ge[ct+1],dt[ct+1],dt[ct],Lt];Kf(Re,St)&&(Ve=Math.min(Ve,vm(Re,St)))}}return Ve!==1/0&&Ve}(ae[0],ae[1],le.isPointQuery()?le.screenBounds:le.screenGeometry)}},line:class extends _a{constructor(r){super(r,bp),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){if("line-gradient"===r){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Sl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=bm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Wh(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(r){return new _l(this,r)}queryRadius(r){const e=r,o=wm(bu("line-width",this,e),bu("line-gap-width",this,e)),a=bu("line-offset",this,e);return o/2+Math.abs(a)+Bh(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,o,a,u,p){if(r.queryGeometry.isAboveHorizon)return!1;const _=Wc(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),x=r.pixelToTileUnitsFactor/2*wm(this.paint.get("line-width").evaluate(e,o),this.paint.get("line-gap-width").evaluate(e,o)),C=this.paint.get("line-offset").evaluate(e,o);return C&&(a=function(D,O){const N=[],B=new Me(0,0);for(let X=0;X<D.length;X++){const ne=D[X],ae=[];for(let le=0;le<ne.length;le++){const ye=ne[le-1],De=ne[le],Re=ne[le+1],Ve=0===le?B:De.sub(ye)._unit()._perp(),$e=le===ne.length-1?B:Re.sub(De)._unit()._perp(),Ge=Ve._add($e)._unit();Ge._mult(1/(Ge.x*$e.x+Ge.y*$e.y)),ae.push(Ge._mult(O)._add(De))}N.push(ae)}return N}(a,C*r.pixelToTileUnitsFactor)),function(D,O,N){for(let B=0;B<O.length;B++){const X=O[B];if(D.length>=3)for(let ne=0;ne<X.length;ne++)if(Xu(D,X[ne]))return!0;if(t_(D,X,N))return!0}return!1}(_,a,x)}isTileClipped(){return!0}},symbol:ld,background:class extends _a{constructor(r){super(r,D_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends _a{constructor(r){super(r,kp)}getProgramIds(){return["raster"]}},sky:class extends _a{constructor(r){super(r,M_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){"sky-gradient"===r?this._updateColorRamp():"sky-atmosphere-sun"!==r&&"sky-atmosphere-halo-color"!==r&&"sky-atmosphere-color"!==r&&"sky-atmosphere-sun-intensity"!==r||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Sa({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(r,e){const o=this.paint.get("sky-type");if("atmosphere"===o){const a=this.paint.get("sky-atmosphere-sun"),u=!a,p=r.style.light,_=p.properties.get("position");return u&&"viewport"===p.properties.get("anchor")&&kn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Iu(_.azimuthal,90-_.polar,e):Iu(a[0],90-a[1],e)}if("gradient"===o){const a=this.paint.get("sky-gradient-center");return Iu(a[0],90-a[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return"atmosphere"===r?["skyboxCapture","skybox"]:"gradient"===r?["skyboxGradient"]:null}}},{HTMLImageElement:Zm,HTMLCanvasElement:cd,HTMLVideoElement:ud,ImageData:Fp,ImageBitmap:hd}=ge;class dd{constructor(e,o,a,u){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(o,u)}update(e,o,a){const{width:u,height:p}=e,{context:_}=this,{gl:x}=_;if(x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!o||!1!==o.premultiply)),a||this.size&&this.size[0]===u&&this.size[1]===p){const{x:C,y:D}=a||{x:0,y:0};e instanceof Zm||e instanceof cd||e instanceof ud||e instanceof Fp||hd&&e instanceof hd?x.texSubImage2D(x.TEXTURE_2D,0,C,D,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,C,D,u,p,x.RGBA,x.UNSIGNED_BYTE,e.data)}else this.size=[u,p],e instanceof Zm||e instanceof cd||e instanceof ud||e instanceof Fp||hd&&e instanceof hd?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,u,p,0,this.format,x.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(o&&o.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(e,o){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),o!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,o),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class yh{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.image=new mc({width:e,height:o}),this.positions={},this.uploaded=!1}getDash(e,o){const a=this.getKey(e,o);return this.positions[a]}trim(){const e=this.width,o=this.height=Je(this.nextRow);this.image.resize({width:e,height:o})}getKey(e,o){return e.join(",")+o}getDashRanges(e,o,a){const u=[];let p=e.length%2==1?-e[e.length-1]*a:0,_=e[0]*a,x=!0;u.push({left:p,right:_,isDash:x,zeroLength:0===e[0]});let C=e[0];for(let D=1;D<e.length;D++){x=!x;const O=e[D];p=C*a,C+=O,_=C*a,u.push({left:p,right:_,isDash:x,zeroLength:0===O})}return u}addRoundDash(e,o,a){const u=o/2;for(let p=-a;p<=a;p++){const _=this.width*(this.nextRow+a+p);let x=0,C=e[x];for(let D=0;D<this.width;D++){D/C.right>1&&(C=e[++x]);const O=Math.abs(D-C.left),N=Math.abs(D-C.right),B=Math.min(O,N);let X;const ne=p/a*(u+1);if(C.isDash){const ae=u-Math.abs(ne);X=Math.sqrt(B*B+ae*ae)}else X=u-Math.sqrt(B*B+ne*ne);this.image.data[_+D]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(e,o){for(let C=e.length-1;C>=0;--C){const D=e[C],O=e[C+1];D.zeroLength?e.splice(C,1):O&&O.isDash===D.isDash&&(O.left=D.left,e.splice(C,1))}const a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const p=this.width*this.nextRow;let _=0,x=e[_];for(let C=0;C<this.width;C++){C/x.right>1&&(x=e[++_]);const D=Math.abs(C-x.left),O=Math.abs(C-x.right),N=Math.min(D,O);this.image.data[p+C]=Math.max(0,Math.min(255,(x.isDash?N:-N)+o+128))}}addDash(e,o){const a=this.getKey(e,o);if(this.positions[a])return this.positions[a];const u="round"===o,p=u?7:0,_=2*p+1;if(this.nextRow+_>this.height)return kn("LineAtlas out of space"),null;0===e.length&&e.push(1);let x=0;for(let O=0;O<e.length;O++)e[O]<0&&(kn("Negative value is found in line dasharray, replacing values with 0"),e[O]=0),x+=e[O];if(0!==x){const O=this.width/x,N=this.getDashRanges(e,this.width,O);u?this.addRoundDash(N,O,p):this.addRegularDash(N,"square"===o?.5*O:0)}const C=this.nextRow+p;this.nextRow+=_;const D={tl:[C,p],br:[x,0]};return this.positions[a]=D,D}}Ht("LineAtlas",yh);class Rv{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const S_=ge.performance;function Lp(r){const e=r?r.url.toString():void 0;return S_.getEntriesByName(e)}class Gm{constructor(){this.tasks={},this.taskQueue=[],Wt(["process"],this),this.invoker=new Rv(this.process),this.nextId=0}add(e,o){const a=this.nextId++,u=function({type:p,isSymbolTile:_,zoom:x}){return x=x||0,"message"===p?0:"maybePrepare"!==p||_?"parseTile"!==p||_?"parseTile"===p&&_?300-x:"maybePrepare"===p&&_?400-x:500:200-x:100-x}(o);if(0===u){ci();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:e,metadata:o,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){ci();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const o=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let e=null,o=1/0;for(let u=0;u<this.taskQueue.length;u++){const p=this.tasks[this.taskQueue[u]];p.priority<o&&(o=p.priority,e=u)}if(null===e)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}function Np(r,e,o){var a=2*Math.PI*6378137/256/Math.pow(2,o);return[r*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class vh{constructor(e,o,a){this.z=e,this.x=o,this.y=a,this.key=Ec(0,e,e,o,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,o){const a=(_=this.y,x=this.z,C=Np(256*(p=this.x),256*(_=Math.pow(2,x)-_-1),x),D=Np(256*(p+1),256*(_+1),x),C[0]+","+C[1]+","+D[0]+","+D[1]),u=function(p,_,x){let C,D="";for(let O=p;O>0;O--)C=1<<O-1,D+=(_&C?1:0)+(x&C?2:0);return D}(this.z,this.x,this.y);var p,_,x,C,D;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===o?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class pd{constructor(e,o){this.wrap=e,this.canonical=o,this.key=Ec(e,o.z,o.z,o.x,o.y)}}class oo{constructor(e,o,a,u,p){this.overscaledZ=e,this.wrap=o,this.canonical=new vh(a,+u,+p),this.key=0===o&&e===a?this.canonical.key:Ec(o,e,a,u,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const o=this.canonical.z-e;return e>this.canonical.z?new oo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new oo(e,this.wrap,e,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(e,o=!0){if(this.overscaledZ===e&&o)return this.key;if(e>this.canonical.z)return Ec(this.wrap*+o,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Ec(this.wrap*+o,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const o=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>o&&e.canonical.y===this.canonical.y>>o}children(e){if(this.overscaledZ>=e)return[new oo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new oo(o,this.wrap,o,a,u),new oo(o,this.wrap,o,a+1,u),new oo(o,this.wrap,o,a,u+1),new oo(o,this.wrap,o,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new oo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new oo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new pd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ec(r,e,o,a,u){const p=1<<Math.min(o,22);let _=p*(u%p)+a%p;return r&&o<22&&(_+=p*p*((r<0?-2*r-1:2*r)%(1<<2*(22-o)))),16*(32*_+o)+(e-o)}Ht("CanonicalTileID",vh),Ht("OverscaledTileID",oo,{omit:["projMatrix"]});class Pu{constructor(e,o,a){this.func=e,this.mask=o,this.range=a}}Pu.ReadOnly=!1,Pu.ReadWrite=!0,Pu.disabled=new Pu(519,Pu.ReadOnly,[0,1]);class Hm{constructor(e,o,a,u,p,_){this.test=e,this.ref=o,this.mask=a,this.fail=u,this.depthFail=p,this.pass=_}}Hm.disabled=new Hm({func:519,mask:0},0,0,7680,7680,7680);class Us{constructor(e,o,a){this.blendFunction=e,this.blendColor=o,this.mask=a}}Us.Replace=[1,0],Us.disabled=new Us(Us.Replace,Jn.transparent,[!1,!1,!1,!1]),Us.unblended=new Us(Us.Replace,Jn.transparent,[!0,!0,!0,!0]),Us.alphaBlended=new Us([1,771],Jn.transparent,[!0,!0,!0,!0]);class js{constructor(e,o,a){this.enable=e,this.mode=o,this.frontFace=a}}js.disabled=new js(!1,1029,2305),js.backCCW=new js(!0,1029,2305),js.backCW=new js(!0,1029,2304),js.frontCW=new js(!0,1028,2304),js.frontCCW=new js(!0,1028,2305);class qm{constructor(e){this._stringToNumber={},this._numberToString=[];for(let o=0;o<e.length;o++){const a=e[o];this._stringToNumber[a]=o,this._numberToString[o]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class md{constructor(e,o,a,u,p){this.type="Feature",this._vectorTileFeature=e,e._z=o,e._x=a,e._y=u,this.properties=e.properties,this.id=p}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const o in this)"_geometry"!==o&&"_vectorTileFeature"!==o&&(e[o]=this[o]);return e}}class Wm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,a){const u=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},st(this.stateChanges[e][u],a),null===this.deletedStates[e]){this.deletedStates[e]={};for(const p in this.state[e])p!==u&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][u]){this.deletedStates[e][u]={};for(const p in this.state[e][u])a[p]||(this.deletedStates[e][u][p]=null)}else for(const p in a)this.deletedStates[e]&&this.deletedStates[e][u]&&null===this.deletedStates[e][u][p]&&delete this.deletedStates[e][u][p]}removeFeatureState(e,o,a){if(null===this.deletedStates[e])return;const u=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&void 0!==o)null!==this.deletedStates[e][u]&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][a]=null);else if(void 0!==o)if(this.stateChanges[e]&&this.stateChanges[e][u])for(a in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][a]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,o){const a=String(o),u=st({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const p=this.deletedStates[e][o];if(null===p)return{};for(const _ in p)delete u[_]}return u}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){const a={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const _ in this.stateChanges[u])this.state[u][_]||(this.state[u][_]={}),st(this.state[u][_],this.stateChanges[u][_]),p[_]=this.state[u][_];a[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(null===this.deletedStates[u])for(const _ in this.state[u])p[_]={},this.state[u][_]={};else for(const _ in this.deletedStates[u]){if(null===this.deletedStates[u][_])this.state[u][_]={};else for(const x of Object.keys(this.deletedStates[u][_]))delete this.state[u][_][x];p[_]=this.state[u][_]}a[u]=a[u]||{},st(a[u],p)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(a).length)for(const u in e)e[u].setFeatureState(a,o)}}class Ym{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,o){const a=this.toIdx(e,o);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,o){return this.leaves[this.toIdx(e,o)]}toIdx(e,o){return o*this.size+e}}function Bp(r,e,o,a){let u=0,p=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(a[_])<1e-15){if(o[_]<r[_]||o[_]>e[_])return null}else{const x=1/a[_];let C=(r[_]-o[_])*x,D=(e[_]-o[_])*x;if(C>D){const O=C;C=D,D=O}if(C>u&&(u=C),D<p&&(p=D),u>p)return null}return u}function Xm(r,e,o,a,u,p,_,x,C,D,O){const N=a-r,B=u-e,X=p-o,ne=_-r,ae=x-e,le=C-o,ye=O[1]*le-O[2]*ae,De=O[2]*ne-O[0]*le,Re=O[0]*ae-O[1]*ne,Ve=N*ye+B*De+X*Re;if(Math.abs(Ve)<1e-15)return null;const $e=1/Ve,Ge=D[0]-r,dt=D[1]-e,ct=D[2]-o,Lt=(Ge*ye+dt*De+ct*Re)*$e;if(Lt<0||Lt>1)return null;const St=dt*X-ct*B,ht=ct*N-Ge*X,Pt=Ge*B-dt*N,Bt=(O[0]*St+O[1]*ht+O[2]*Pt)*$e;return Bt<0||Lt+Bt>1?null:(ne*St+ae*ht+le*Pt)*$e}function gd(r,e,o){return(r-e)/(o-e)}function Km(r,e,o,a,u,p,_,x,C){const D=1<<o,O=p-a,N=_-u,B=(r+1)/D*O+a,X=(e+0)/D*N+u,ne=(e+1)/D*N+u;x[0]=(r+0)/D*O+a,x[1]=X,C[0]=B,C[1]=ne}class Jm{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(p){const _=Math.ceil(Math.log2(p.dim/8)),x=[];let C=Math.ceil(Math.pow(2,_));const D=1/C,O=(X,ne,ae,le,ye)=>{const De=le?1:0,Re=(X+1)*ae-De,Ve=ne*ae,$e=(ne+1)*ae-De;ye[0]=X*ae,ye[1]=Ve,ye[2]=Re,ye[3]=$e};let N=new Ym(C);const B=[];for(let X=0;X<C*C;X++){O(X%C,Math.floor(X/C),D,!1,B);const ne=xa(B[0],B[1],p),ae=xa(B[2],B[1],p),le=xa(B[2],B[3],p),ye=xa(B[0],B[3],p);N.minimums.push(Math.min(ne,ae,le,ye)),N.maximums.push(Math.max(ne,ae,le,ye)),N.leaves.push(1)}for(x.push(N),C/=2;C>=1;C/=2){const X=x[x.length-1];N=new Ym(C);for(let ne=0;ne<C*C;ne++){O(ne%C,Math.floor(ne/C),2,!0,B);const ae=X.getElevation(B[0],B[1]),le=X.getElevation(B[2],B[1]),ye=X.getElevation(B[2],B[3]),De=X.getElevation(B[0],B[3]),Re=X.isLeaf(B[0],B[1]),Ve=X.isLeaf(B[2],B[1]),$e=X.isLeaf(B[2],B[3]),Ge=X.isLeaf(B[0],B[3]),dt=Math.min(ae.min,le.min,ye.min,De.min),ct=Math.max(ae.max,le.max,ye.max,De.max),Lt=Re&&Ve&&$e&&Ge;N.maximums.push(ct),N.minimums.push(dt),N.leaves.push(ct-dt<=5&&Lt?1:0)}x.push(N)}return x}(this.dem),a=o.length-1,u=o[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(o,0,0,a,0)}raycastRoot(e,o,a,u,p,_,x=1){return Bp([e,o,-100],[a,u,this.maximums[0]*x],p,_)}raycast(e,o,a,u,p,_,x=1){if(!this.nodeCount)return null;const C=this.raycastRoot(e,o,a,u,p,_,x);if(null==C)return null;const D=[],O=[],N=[],B=[],X=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;X.length>0;){const{idx:ne,t:ae,nodex:le,nodey:ye,depth:De}=X.pop();if(this.leaves[ne]){Km(le,ye,De,e,o,a,u,N,B);const Ve=1<<De,$e=(le+0)/Ve,Ge=(le+1)/Ve,dt=(ye+0)/Ve,ct=(ye+1)/Ve,Lt=xa($e,dt,this.dem)*x,St=xa(Ge,dt,this.dem)*x,ht=xa(Ge,ct,this.dem)*x,Pt=xa($e,ct,this.dem)*x,Bt=Xm(N[0],N[1],Lt,B[0],N[1],St,B[0],B[1],ht,p,_),xt=Xm(B[0],B[1],ht,N[0],B[1],Pt,N[0],N[1],Lt,p,_),Kt=Math.min(null!==Bt?Bt:Number.MAX_VALUE,null!==xt?xt:Number.MAX_VALUE);if(Kt!==Number.MAX_VALUE)return Kt;{const nn=dn([],p,_,ae);if(Vp(Lt,St,Pt,ht,gd(nn[0],N[0],B[0]),gd(nn[1],N[1],B[1]))>=nn[2])return ae}continue}let Re=0;for(let Ve=0;Ve<this._siblingOffset.length;Ve++){Km((le<<1)+this._siblingOffset[Ve][0],(ye<<1)+this._siblingOffset[Ve][1],De+1,e,o,a,u,N,B),N[2]=-100,B[2]=this.maximums[this.childOffsets[ne]+Ve]*x;const $e=Bp(N,B,p,_);if(null!=$e){const Ge=$e;D[Ve]=Ge;let dt=!1;for(let ct=0;ct<Re&&!dt;ct++)Ge>=D[O[ct]]&&(O.splice(ct,0,Ve),dt=!0);dt||(O[Re]=Ve),Re++}}for(let Ve=0;Ve<Re;Ve++){const $e=O[Ve];X.push({idx:this.childOffsets[ne]+$e,t:D[$e],nodex:(le<<1)+this._siblingOffset[$e][0],nodey:(ye<<1)+this._siblingOffset[$e][1],depth:De+1})}}return null}_addNode(e,o,a){return this.minimums.push(e),this.maximums.push(o),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,o,a,u,p){if(1===e[u].isLeaf(o,a))return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const _=u-1,x=e[_];let C,D=0;for(let O=0;O<this._siblingOffset.length;O++){const N=2*o+this._siblingOffset[O][0],B=2*a+this._siblingOffset[O][1],X=x.getElevation(N,B),ne=x.isLeaf(N,B),ae=this._addNode(X.min,X.max,ne);ne&&(D|=1<<O),C||(C=ae)}for(let O=0;O<this._siblingOffset.length;O++)D&1<<O||this._construct(e,2*o+this._siblingOffset[O][0],2*a+this._siblingOffset[O][1],_,C+O)}}function Vp(r,e,o,a,u,p){return fr(fr(r,o,p),fr(e,a,p),u)}function xa(r,e,o){const a=o.dim,u=pn(r*a-.5,0,a-1),p=pn(e*a-.5,0,a-1),_=Math.floor(u),x=Math.floor(p),C=Math.min(_+1,a-1),D=Math.min(x+1,a-1);return Vp(o.get(_,x),o.get(C,x),o.get(_,D),o.get(C,D),u-_,p-x)}const Up={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class _d{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,o,a,u=!1,p=!1){if(this.uid=e,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(a&&"mapbox"!==a&&"terrarium"!==a)return kn(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const _=this.dim=o.height-2;if(this.data=new Uint32Array(o.data.buffer),this.encoding=a||"mapbox",this.borderReady=u,!u){for(let x=0;x<_;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(_,x)]=this.data[this._idx(_-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,_)]=this.data[this._idx(x,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Jm(this)}get(e,o,a=!1){const u=new Uint8Array(this.data.buffer);a&&(e=pn(e,-1,this.dim),o=pn(o,-1,this.dim));const p=4*this._idx(e,o);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(u[p],u[p+1],u[p+2])}static getUnpackVector(e){return Up[e]}get unpackVector(){return Up[this.encoding]}_idx(e,o){if(e<-1||e>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(e+1)}_unpackMapbox(e,o,a){return(256*e*256+256*o+a)/10-1e4}_unpackTerrarium(e,o,a){return 256*e+o+a/256-32768}static pack(e,o){const a=[0,0,0,0],u=_d.getUnpackVector(o);let p=Math.floor((e+u[3])/u[2]);return a[2]=p%256,p=Math.floor(p/256),a[1]=p%256,p=Math.floor(p/256),a[0]=p,a}getPixels(){return new ya({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,o,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=o*this.dim,p=o*this.dim+this.dim,_=a*this.dim,x=a*this.dim+this.dim;switch(o){case-1:u=p-1;break;case 1:p=u+1}switch(a){case-1:_=x-1;break;case 1:x=_+1}const C=-o*this.dim,D=-a*this.dim;for(let O=_;O<x;O++)for(let N=u;N<p;N++)this.data[this._idx(N,O)]=e.data[this._idx(N+C,O+D)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ht("DEMData",_d),Ht("DemMinMaxQuadTree",Jm,{omit:["dem"]});class I_{constructor(e,o){this.max=e,this.onRemove=o,this.reset()}reset(){for(const e in this.data)for(const o of this.data[e])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(e,o,a){const u=e.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const p={value:o,timeout:void 0};if(void 0!==a&&(p.timeout=setTimeout(()=>{this.remove(e,p)},a)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const o=this.data[e].shift();return o.timeout&&clearTimeout(o.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),o.value}getByKey(e){const o=this.data[e];return o?o[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,o){if(!this.has(e))return this;const a=e.wrapped().key,u=void 0===o?0:this.data[a].indexOf(o),p=this.data[a][u];return this.data[a].splice(u,1),p.timeout&&clearTimeout(p.timeout),0===this.data[a].length&&delete this.data[a],this.onRemove(p.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(e){const o=[];for(const a in this.data)for(const u of this.data[a])e(u.value)||o.push(u);for(const a of o)this.remove(a.value.tileID,a)}}class Pa extends qr{constructor(e,o,a){super(),this.id=e,this._onlySymbols=a,o.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new I_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Wm}onAdd(e){this.map=e,this._minTileCacheSize=e?e._minTileCacheSize:null,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const o=this._tiles[e];if("loaded"!==o.state&&"errored"!==o.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,o){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,o)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const a=this._tiles[o];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Jo(this._tiles).map(e=>e.tileID).sort(Qm).map(e=>e.key)}getRenderableIds(e){const o=[];for(const a in this._tiles)this._isIdRenderable(+a,e)&&o.push(this._tiles[a]);return e?o.sort((a,u)=>{const p=a.tileID,_=u.tileID,x=new Me(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),C=new Me(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-_.overscaledZ||C.y-x.y||C.x-x.x}).map(a=>a.tileID.key):o.map(a=>a.tileID).sort(Qm).map(a=>a.key)}hasRenderableParent(e){const o=this.findLoadedParent(e,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(e,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(o||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,o){const a=this._tiles[e];a&&("loading"!==a.state&&(a.state=o),this._loadTile(a,this._tileLoaded.bind(this,a,e,o)))}_tileLoaded(e,o,a,u){if(u)if(e.state="errored",404!==u.status)this._source.fire(new $o(u,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=zn.now(),"expired"===a&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new uo("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const o=this.getRenderableIds();for(let u=0;u<o.length;u++){const p=o[u];if(e.neighboringTiles&&e.neighboringTiles[p]){const _=this.getTileByID(p);a(e,_),a(_,e)}}function a(u,p){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let _=p.tileID.canonical.x-u.tileID.canonical.x;const x=p.tileID.canonical.y-u.tileID.canonical.y,C=Math.pow(2,u.tileID.canonical.z),D=p.tileID.key;0===_&&0===x||Math.abs(x)>1||(Math.abs(_)>1&&(1===Math.abs(_+C)?_+=C:1===Math.abs(_-C)&&(_-=C)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,_,x),u.neighboringTiles&&u.neighboringTiles[D]&&(u.neighboringTiles[D].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,o,a,u){for(const p in this._tiles){let _=this._tiles[p];if(u[p]||!_.hasData()||_.tileID.overscaledZ<=o||_.tileID.overscaledZ>a)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>o+1;){const D=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[D.key],_&&_.hasData()&&(x=D)}let C=x;for(;C.overscaledZ>o;)if(C=C.scaledTo(C.overscaledZ-1),e[C.key]){u[x.key]=x;break}}}findLoadedParent(e,o){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=o?a:null}for(let a=e.overscaledZ-1;a>=o;a--){const u=e.scaledTo(a),p=this._getLoadedTile(u);if(p)return p}}_getLoadedTile(e){const o=this._tiles[e.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,o){o=o||this._source.tileSize;const a=Math.ceil(e.width/o)+1,u=Math.ceil(e.height/o)+1,p=Math.floor(a*u*5),_="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,p):p,x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(e){const o=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,o){const a={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+o),a[p.tileID.key]=p}this._tiles=a;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,o,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let u;this.updateCacheSize(e,o),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new oo(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(u=e.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(x=>this._source.hasTile(x)))):u=[];const p=this._updateRetainedTiles(u);if(eg(this._source.type)&&0!==u.length){const x={},C={},D=Object.keys(p);for(const N of D){const B=p[N],X=this._tiles[N];if(!X||X.fadeEndTime&&X.fadeEndTime<=zn.now())continue;const ne=this.findLoadedParent(B,Math.max(B.overscaledZ-Pa.maxOverzooming,this._source.minzoom));ne&&(this._addTile(ne.tileID),x[ne.tileID.key]=ne.tileID),C[N]=B}const O=u[u.length-1].overscaledZ;for(const N in this._tiles){const B=this._tiles[N];if(p[N]||!B.hasData())continue;let X=B.tileID;for(;X.overscaledZ>O;){X=X.scaledTo(X.overscaledZ-1);const ne=this._tiles[X.key];if(ne&&ne.hasData()&&C[X.key]){p[N]=B.tileID;break}}}for(const N in x)p[N]||(this._coveredTiles[N]=!0,p[N]=x[N])}for(const x in p)this._tiles[x].clearFadeHold();const _=function(x,C){const D=[];for(const O in x)O in C||D.push(O);return D}(this._tiles,p);for(const x of _){const C=this._tiles[x];C.hasSymbolBuckets&&!C.holdingForFade()?C.setHoldDuration(this.map._fadeDuration):C.hasSymbolBuckets&&!C.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const o={};if(0===e.length)return o;const a={},u=e.reduce((D,O)=>Math.min(D,O.overscaledZ),1/0),p=e[0].overscaledZ,_=Math.max(p-Pa.maxOverzooming,this._source.minzoom),x=Math.max(p+Pa.maxUnderzooming,this._source.minzoom),C={};for(const D of e){const O=this._addTile(D);o[D.key]=D,O.hasData()||u<this._source.maxzoom&&(C[D.key]=D)}this._retainLoadedChildren(C,u,x,o);for(const D of e){let O=this._tiles[D.key];if(O.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const B=D.children(this._source.maxzoom)[0],X=this.getTile(B);if(X&&X.hasData()){o[B.key]=B;continue}}else{const B=D.children(this._source.maxzoom);if(o[B[0].key]&&o[B[1].key]&&o[B[2].key]&&o[B[3].key])continue}let N=O.wasRequested();for(let B=D.overscaledZ-1;B>=_;--B){const X=D.scaledTo(B);if(a[X.key]||(a[X.key]=!0,O=this.getTile(X),!O&&N&&(O=this._addTile(X)),O&&(o[X.key]=X,N=O.wasRequested(),O.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const o=[];let a,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}o.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(p),a)break;u=p}for(const p of o)this._loadedParentTiles[p]=a}}_addTile(e){let o=this._tiles[e.key];if(o)return o;o=this._cache.getAndRemove(e),o&&(this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,o)));const a=Boolean(o);if(!a){const u=this.map?this.map.painter:null,p="raster"===this._source.type||"raster-dem"===this._source.type;o=new vd(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,p),this._loadTile(o,this._tileLoaded.bind(this,o,e.key,o.state))}return o?(o.uses++,this._tiles[e.key]=o,a||this._source.fire(new uo("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(e,o){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=o.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const o=this._tiles[e];o&&(o.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),o.uses>0||(o.hasData()&&"reloading"!==o.state?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,o,a){const u=[],p=this.transform;if(!p)return u;for(const _ in this._tiles){const x=this._tiles[_];if(a&&x.clearQueryDebugViz(),x.holdingForFade())continue;const C=e.containsTile(x,p,o);C&&u.push(C)}return u}getVisibleCoordinates(e){const o=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of o)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(eg(this._source.type))for(const e in this._tiles){const o=this._tiles[e];if(void 0!==o.fadeEndTime&&o.fadeEndTime>=zn.now())return!0}return!1}setFeatureState(e,o,a){this._state.updateState(e=e||"_geojsonTileLayer",o,a)}removeFeatureState(e,o,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",o,a)}getFeatureState(e,o){return this._state.getState(e=e||"_geojsonTileLayer",o)}setDependencies(e,o,a){const u=this._tiles[e];u&&u.setDependencies(o,a)}reloadTilesForDependencies(e,o){for(const a in this._tiles)this._tiles[a].hasDependency(e,o)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,o))}_preloadTiles(e,o){const a=new Map,u=Array.isArray(e)?e:[e],p=this.map.painter.terrain,_=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const D of u){const O=D.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const N of O)a.set(N.key,N);this.usedForTerrain&&D.updateElevation(!1)}const x=Array.from(a.values()),C="raster"===this._source.type||"raster-dem"===this._source.type;$i(x,(D,O)=>{const N=new vd(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,C);this._loadTile(N,B=>{"raster-dem"===this._source.type&&N.dem&&this._backfillDEM(N),O(B,N)})},o)}}function Qm(r,e){const o=Math.abs(2*r.wrap)-+(r.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return r.overscaledZ-e.overscaledZ||a-o||e.canonical.y-r.canonical.y||e.canonical.x-r.canonical.x}function eg(r){return"raster"===r||"image"===r||"video"===r}Pa.maxOverzooming=10,Pa.maxUnderzooming=3;class yd{constructor(e,o,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=o,this._offset=a}static create(e,o,a){const u=a||e.findDEMTileFor(o);if(!u||!u.dem)return;const p=u.dem,_=u.tileID,x=1<<o.canonical.z-_.canonical.z;return new yd(u,u.tileSize/mr/x,[(o.canonical.x/x-_.canonical.x)*p.dim,(o.canonical.y/x-_.canonical.y)*p.dim])}tileCoordToPixel(e,o){const a=o*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(a);return new Me(u,p)}getElevationAt(e,o,a,u){const p=e*this._scale+this._offset[0],_=o*this._scale+this._offset[1],x=Math.floor(p),C=Math.floor(_),D=this._dem;return u=!!u,a?fr(fr(D.get(x,C,u),D.get(x,C+1,u),_-C),fr(D.get(x+1,C,u),D.get(x+1,C+1,u),_-C),p-x):D.get(x,C,u)}getElevationAtPixel(e,o,a){return this._dem.get(e,o,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*yl(1,e)*this._dem.stride}}class tg{constructor(e,o){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new wn(mr,16,0),this.featureIndexArray=new Vf,this.promoteId=o}insert(e,o,a,u,p,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,p,_);const C=this.grid;for(let D=0;D<o.length;D++){const O=o[D],N=[1/0,1/0,-1/0,-1/0];for(let B=0;B<O.length;B++){const X=O[B];N[0]=Math.min(N[0],X.x),N[1]=Math.min(N[1],X.y),N[2]=Math.max(N[2],X.x),N[3]=Math.max(N[3],X.y)}N[0]<mr&&N[1]<mr&&N[2]>=0&&N[3]>=0&&C.insert(x,N[0],N[1],N[2],N[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Jc.VectorTile(new vc(this.rawTileData)).layers,this.sourceLayerCoder=new qm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,o,a,u){this.loadVTLayers();const p=e.params||{},_=ta(p.filter),x=e.tileResult,C=e.transform,D=x.bufferedTilespaceBounds,O=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(ne,ae,le,ye)=>rp(x.bufferedTilespaceGeometry,ne,ae,le,ye));O.sort(R_);let N=null;C.elevation&&O.length>0&&(N=yd.create(C.elevation,this.tileID));const B={};let X;for(let ne=0;ne<O.length;ne++){const ae=O[ne];if(ae===X)continue;X=ae;const le=this.featureIndexArray.get(ae);let ye=null;this.loadMatchingFeature(B,le,_,p.layers,p.availableImages,o,a,u,(De,Re,Ve,$e=0)=>(ye||(ye=jl(De,this.tileID.canonical,e.tileTransform)),Re.queryIntersectsFeature(x,De,Ve,ye,this.z,e.transform,e.pixelPosMatrix,N,$e)))}return B}loadMatchingFeature(e,o,a,u,p,_,x,C,D){const{featureIndex:O,bucketIndex:N,sourceLayerIndex:B,layoutVertexArrayOffset:X}=o,ne=this.bucketLayerIDs[N];if(u&&!function(De,Re){for(let Ve=0;Ve<De.length;Ve++)if(Re.indexOf(De[Ve])>=0)return!0;return!1}(u,ne))return;const ae=this.sourceLayerCoder.decode(B),le=this.vtLayers[ae].feature(O);if(a.needGeometry){const De=fc(le,!0);if(!a.filter(new En(this.tileID.overscaledZ),De,this.tileID.canonical))return}else if(!a.filter(new En(this.tileID.overscaledZ),le))return;const ye=this.getId(le,ae);for(let De=0;De<ne.length;De++){const Re=ne[De];if(u&&u.indexOf(Re)<0)continue;const Ve=_[Re];if(!Ve)continue;let $e={};void 0!==ye&&C&&($e=C.getState(Ve.sourceLayer||"_geojsonTileLayer",ye));const Ge=st({},x[Re]);Ge.paint=P_(Ge.paint,Ve.paint,le,$e,p),Ge.layout=P_(Ge.layout,Ve.layout,le,$e,p);const dt=!D||D(le,Ve,$e,X);if(!dt)continue;const ct=new md(le,this.z,this.x,this.y,ye);ct.layer=Ge;let Lt=e[Re];void 0===Lt&&(Lt=e[Re]=[]),Lt.push({featureIndex:O,feature:ct,intersectionZ:dt})}}lookupSymbolFeatures(e,o,a,u,p,_,x,C){const D={};this.loadVTLayers();const O=ta(p);for(const N of e)this.loadMatchingFeature(D,{bucketIndex:a,sourceLayerIndex:u,featureIndex:N,layoutVertexArrayOffset:0},O,_,x,C,o);return D}loadFeature(e){const{featureIndex:o,sourceLayerIndex:a}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(a),p=this.vtFeatures[u];if(p[o])return p[o];const _=this.vtLayers[u].feature(o);return p[o]=_,_}hasLayer(e){for(const o of this.bucketLayerIDs)for(const a of o)if(e===a)return!0;return!1}getId(e,o){let a=e.id;return this.promoteId&&(a=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[o]],"boolean"==typeof a&&(a=Number(a))),a}}function P_(r,e,o,a,u){return _n(r,(p,_)=>{const x=e instanceof fl?e.get(_):null;return x&&x.evaluate?x.evaluate(o,a,u):x})}function R_(r,e){return e-r}Ht("FeatureIndex",tg,{omit:["rawTileData","sourceLayerCoder"]});var ng=Di([{name:"a_pos",type:"Int16",components:2}]);const ou=new Uint16Array(8184);for(let r=0;r<2046;r++){let e=r+2,o=0,a=0,u=0,p=0,_=0,x=0;for(1&e?u=p=_=32:o=a=x=32;(e>>=1)>1;){const D=o+u>>1,O=a+p>>1;1&e?(u=o,p=a,o=_,a=x):(o=u,a=p,u=_,p=x),_=D,x=O}const C=4*r;ou[C+0]=o,ou[C+1]=a,ou[C+2]=u,ou[C+3]=p}const os=new Uint16Array(2178),El=new Uint8Array(1089),Ru=new Uint16Array(1089);function k_(r){return 0===r?-.03125:32===r?.03125:0}var jp=Di([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const rg={type:2,extent:mr,loadGeometry:()=>[[new Me(0,0),new Me(8193,0),new Me(8193,8193),new Me(0,8193),new Me(0,0)]]};class vd{constructor(e,o,a,u,p){this.tileID=e,this.uid=Fe(),this.uses=0,this.tileSize=o,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const o=e+this.timeAdded;o<zn.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=bh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,o,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,p){const _={};if(!p)return _;for(const x of u){const C=x.layerIds.map(D=>p.getLayer(D)).filter(Boolean);if(0!==C.length){x.layers=C,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(D=>C.filter(O=>O.id===D)[0]));for(const D of C)_[D.id]=x}}return _}(e.buckets,o.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof Cc){if(this.hasSymbolBuckets=!0,!a)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof Cc&&p.hasRTLText){this.hasRTLText=!0,cr.isLoading()||cr.isLoaded()||"deferred"!==ma()||Bs();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(u).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Yd}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const u=this.buckets[a];u.uploadPending()&&u.upload(e)}const o=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new dd(e,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new dd(e,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new dd(e,this.lineAtlas.image,o.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,o,a,u,p,_,x,C){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:x,transform:_,params:p,tileTransform:this.tileTransform},e,o,a):{}}querySourceFeatures(e,o){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const u=a.loadVTLayers(),p=o?o.sourceLayer:"",_=u._geojsonTileLayer||u[p];if(!_)return;const x=ta(o&&o.filter),{z:C,x:D,y:O}=this.tileID.canonical,N={z:C,x:D,y:O};for(let B=0;B<_.length;B++){const X=_.feature(B);if(x.needGeometry){const le=fc(X,!0);if(!x.filter(new En(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!x.filter(new En(this.tileID.overscaledZ),X))continue;const ne=a.getId(X,p),ae=new md(X,C,D,O,ne);ae.tile=N,e.push(ae)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const o=this.expirationTime;if(e.cacheControl){const a=Gn(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let u=!1;if(this.expirationTime>a)u=!1;else if(o)if(this.expirationTime<o)u=!0;else{const p=this.expirationTime-o;p?this.expirationTime=a+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!o)return;const a=this.latestFeatureIndex.loadVTLayers(),u=o.style.listImages();for(const p in this.buckets){if(!o.style.hasLayer(p))continue;const _=this.buckets[p],x=_.layers[0].sourceLayer||"_geojsonTileLayer",C=a[x],D=e[x];if(!C||!D||0===Object.keys(D).length)continue;if(_.update(D,C,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof Wh||_ instanceof Kc){const N=o.style._getSourceCache(_.layers[0].source);o._terrain&&o._terrain.enabled&&N&&_.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(N.id,this.tileID)}const O=o&&o.style&&o.style.getLayer(p);O&&(this.queryPadding=Math.max(this.queryPadding,O.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<zn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=zn.now()+e}setDependencies(e,o){const a={};for(const u of o)a[u]=!0;this.dependencies[e]=a}hasDependency(e,o){for(const a of e){const u=this.dependencies[a];if(u)for(const p of o)if(u[p])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,o){if(!o||"mercator"===o.name||this._tileDebugBuffer)return;const a=jl(rg,this.tileID.canonical,this.tileTransform)[0],u=new gu,p=new ju;for(let _=0;_<a.length;_++){const{x,y:C}=a[_];u.emplaceBack(x,C),p.emplaceBack(_)}p.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(u,jp.members),this._tileDebugSegments=io.simpleSegment(0,0,u.length,p.length)}_makeTileBoundsBuffers(e,o){if(this._tileBoundsBuffer||!o||"mercator"===o.name)return;const a=jl(rg,this.tileID.canonical,this.tileTransform)[0];let u,p;if(this.isRaster){const _=function(x,C){const D=bh(x,C),O=Math.pow(2,x.z);for(let le=0;le<33;le++)for(let ye=0;ye<33;ye++){const De=pc((x.x+(ye+k_(ye))/32)/O),Re=As((x.y+(le+k_(le))/32)/O),Ve=C.project(De,Re),$e=33*le+ye;os[2*$e+0]=Math.round((Ve.x*D.scale-D.x)*mr),os[2*$e+1]=Math.round((Ve.y*D.scale-D.y)*mr)}El.fill(0),Ru.fill(0);for(let le=2045;le>=0;le--){const ye=4*le,De=ou[ye+0],Re=ou[ye+1],Ve=ou[ye+2],$e=ou[ye+3],Ge=De+Ve>>1,dt=Re+$e>>1,ct=Ge+dt-Re,Lt=dt+De-Ge,St=33*Re+De,ht=33*$e+Ve,Pt=33*dt+Ge,Bt=Math.hypot((os[2*St+0]+os[2*ht+0])/2-os[2*Pt+0],(os[2*St+1]+os[2*ht+1])/2-os[2*Pt+1])>=16;if(El[Pt]=El[Pt]||(Bt?1:0),le<1022){const xt=33*(Re+Lt>>1)+(De+ct>>1),Kt=33*($e+Lt>>1)+(Ve+ct>>1);El[Pt]=El[Pt]||El[xt]||El[Kt]}}const N=new qa,B=new Vs;let X=0;function ne(le,ye){const De=33*ye+le;return 0===Ru[De]&&(N.emplaceBack(os[2*De+0],os[2*De+1],le*mr/32,ye*mr/32),Ru[De]=++X),Ru[De]-1}function ae(le,ye,De,Re,Ve,$e){const Ge=le+De>>1,dt=ye+Re>>1;if(Math.abs(le-Ve)+Math.abs(ye-$e)>1&&El[33*dt+Ge])ae(Ve,$e,le,ye,Ge,dt),ae(De,Re,Ve,$e,Ge,dt);else{const ct=ne(le,ye),Lt=ne(De,Re),St=ne(Ve,$e);B.emplaceBack(ct,Lt,St)}}return ae(0,0,32,32,32,0),ae(32,32,0,0,0,32),{vertices:N,indices:B}}(this.tileID.canonical,o);u=_.vertices,p=_.indices}else{u=new qa,p=new Vs;for(const{x,y:C}of a)u.emplaceBack(x,C,0,0);const _=cp(u.int16,void 0,4);for(let x=0;x<_.length;x+=3)p.emplaceBack(_[x],_[x+1],_[x+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,jp.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(p),this._tileBoundsSegments=io.simpleSegment(0,0,u.length,p.length)}}const ig=Di([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),og=Di([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:$p}=ig;function su(r,e){const o=r.fovAboveCenter,a=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,u=(r._camera.position[2]*r.worldSize-a)/Math.cos(r._pitch),p=Math.sin(o)*u/Math.sin(Math.max(Math.PI/2-r._pitch-o,.01)),_=Math.sin(r._pitch)*p+u;return Math.min(1.01*_,u*(1/r._horizonShift))}const Zp=mr/Math.PI/2,ss=-Zp,Is=Zp,sg=[new Ya([ss,ss,ss],[Is,Is,Is]),new Ya([ss,ss,ss],[0,0,Is]),new Ya([0,ss,ss],[Is,0,Is]),new Ya([ss,0,ss],[0,Is,Is]),new Ya([0,0,ss],[Is,Is,Is])];function xh(r){if(r.z<=1)return sg[r.z+2*r.y+r.x];const[e,o]=Gp(r),a=[bd(e[0],e[1]),bd(e[0],o[1]),bd(o[0],e[1]),bd(o[0],o[1])],u=[Is,Is,Is],p=[ss,ss,ss];for(const _ of a)u[0]=Math.min(u[0],_[0]),u[1]=Math.min(u[1],_[1]),u[2]=Math.min(u[2],_[2]),p[0]=Math.max(p[0],_[0]),p[1]=Math.max(p[1],_[1]),p[2]=Math.max(p[2],_[2]);return new Ya(u,p)}function Gp(r){const e=Math.pow(2,r.z),o=r.x/e,a=(r.x+1)/e,u=(r.y+1)/e;return[[As(r.y/e),pc(o)],[As(u),pc(a)]]}function xd(r,e,o,a){return o=An(o),a||(a=Zp),[r*Math.sin(o)*a,-e*a,r*Math.cos(o)*a]}function bd(r,e,o){return xd(Math.cos(An(r)),Math.sin(An(r)),e,o)}function ag(r){return 16383/Math.max(...co([],r.max,r.min))}function lg(r){const e=_t(new Float64Array(16)),o=1/ag(r);return ut(e,e,r.min),qt(e,e,[o,o,o]),e}function cg(r,e,o){const a=e/(2*Math.PI),u=function(_){const x=mr/(2*Math.PI);return _/(2*Math.PI)/x}(e);if(!o){const _=pn(r.center.lat,-85.051129,Aa);o=[vu(r.center.lng)*e,xu(_)*e]}const p=_t(new Float64Array(16));return ut(p,p,[o[0],o[1],-a]),qt(p,p,[u,u,u]),Dn(p,p,An(-r._center.lat)),cn(p,p,An(-r._center.lng)),p}class wd{constructor(e){const o=this._createGridIndices();this.gridIndexBuffer=e.createIndexBuffer(o,!0),this.gridSegments=io.simpleSegment(0,0,4225,8192);const a=this._createPoleTriangleIndices();this.poleIndexBuffer=e.createIndexBuffer(a,!0),this.poleSegments=io.simpleSegment(0,0,66,64);const u=new uc;u.emplaceBack(-1,1,1,0,0,0,0),u.emplaceBack(1,1,1,0,0,1,0),u.emplaceBack(1,-1,1,0,0,1,1),u.emplaceBack(-1,-1,1,0,0,0,1);const p=new Vs;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.atmosphereVertexBuffer=e.createVertexBuffer(u,og.members),this.atmosphereIndexBuffer=e.createIndexBuffer(p),this.atmosphereSegments=io.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(e,o,a){const u=new uc,p=o/Math.PI/2;u.emplaceBack(0,-p,0,0,0,.5,a?0:1);const _=360/e,x=Math.cos(An(85)),C=Math.sin(An(85));for(let O=0;O<=64;O++){const N=O/64,B=xd(x,C,0*(1-(D=N))+_*D,p);u.emplaceBack(B[0],B[1],B[2],0,0,N,a?0:1)}var D;return u}_createPoleTriangleIndices(){const e=new Vs;for(let o=0;o<=64;o++)e.emplaceBack(0,o+1,o+2);return e}static createGridVertices(e){const o=Math.pow(2,e.z),a=(C,D,O)=>C*(1-O)+D*O,[u,p]=Gp(e),_=new uc,x=function(C){const D=_t(new Float64Array(16)),O=ag(C);var N,B;return qt(D,D,[O,O,O]),ut(D,D,((N=[])[0]=-(B=C.min)[0],N[1]=-B[1],N[2]=-B[2],N)),D}(xh(e));_.reserve(4096);for(let C=0;C<65;C++){const D=a(u[0],p[0],C/64),O=xu(D),N=O*o-e.y,B=Math.sin(An(D)),X=Math.cos(An(D));for(let ne=0;ne<65;ne++){const ae=ne/64,le=a(u[1],p[1],ae),ye=xd(X,B,le);Ln(ye,ye,x);const De=vu(le);_.emplaceBack(ye[0],ye[1],ye[2],De,O,ae,N)}}return _}_createGridIndices(){const e=new Vs,o=(a,u)=>{const p=65*u+a;e.emplaceBack(p+1,p,p+65),e.emplaceBack(p+65,p+65+1,p+1)};for(let a=0;a<64;a++)for(let u=0;u<64;u++)o(u,a);return e}getWirefameBuffer(e){if(!this.wireframeSegments){const o=this._createWireframeGrid();this.wireframeIndexBuffer=e.createIndexBuffer(o),this.wireframeSegments=io.simpleSegment(0,0,4096,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const e=new Bl,o=(a,u)=>{const p=65*u+a;e.emplaceBack(p,p+1),e.emplaceBack(p,p+65),e.emplaceBack(p,p+65+1)};for(let a=0;a<64;a++)for(let u=0;u<64;u++)o(u,a);return e}}function bh(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const o=Math.pow(2,-r.z),a=r.x*o,u=(r.x+1)*o,p=r.y*o,_=(r.y+1)*o,x=pc(a),C=pc(u),D=As(p),O=As(_),N=e.project(x,D),B=e.project(C,D),X=e.project(C,O),ne=e.project(x,O);let ae=Math.min(N.x,B.x,X.x,ne.x),le=Math.min(N.y,B.y,X.y,ne.y),ye=Math.max(N.x,B.x,X.x,ne.x),De=Math.max(N.y,B.y,X.y,ne.y);const Re=o/16;function Ve(Ge,dt,ct,Lt,St,ht){const Pt=(ct+St)/2,Bt=(Lt+ht)/2,xt=e.project(pc(Pt),As(Bt)),Kt=Math.max(0,ae-xt.x,le-xt.y,xt.x-ye,xt.y-De);ae=Math.min(ae,xt.x),ye=Math.max(ye,xt.x),le=Math.min(le,xt.y),De=Math.max(De,xt.y),Kt>Re&&(Ve(Ge,xt,ct,Lt,Pt,Bt),Ve(xt,dt,Pt,Bt,St,ht))}Ve(N,B,a,p,u,p),Ve(B,X,u,p,u,_),Ve(X,ne,u,_,a,_),Ve(ne,N,a,_,a,p),ae-=Re,le-=Re,ye+=Re,De+=Re;const $e=1/Math.max(ye-ae,De-le);return{scale:$e,x:ae*$e,y:le*$e,x2:ye*$e,y2:De*$e,projection:e}}class Hp{constructor(e){const o={},a=[];for(const x in e){const C=e[x],D=o[x]={};for(const O in C.glyphs){const N=C.glyphs[+O];if(!N||0===N.bitmap.width||0===N.bitmap.height)continue;const B=N.metrics.localGlyph?2:1,X={x:0,y:0,w:N.bitmap.width+2*B,h:N.bitmap.height+2*B};a.push(X),D[O]=X}}const{w:u,h:p}=wl(a),_=new mc({width:u||1,height:p||1});for(const x in e){const C=e[x];for(const D in C.glyphs){const O=C.glyphs[+D];if(!O||0===O.bitmap.width||0===O.bitmap.height)continue;const N=o[x][D],B=O.metrics.localGlyph?2:1;mc.copy(O.bitmap,_,{x:0,y:0},{x:N.x+B,y:N.y+B},O.bitmap)}}this.image=_,this.positions=o}}Ht("GlyphAtlas",Hp);class O_{constructor(e){this.tileID=new oo(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=bh(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,o,a,u,p){this.status="parsing",this.data=e,this.collisionBoxArray=new Yd;const _=new qm(Object.keys(e.layers).sort()),x=new tg(this.tileID,this.promoteId);x.bucketLayerIDs=[];const C={},D=new yh(256,256),O={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:a},N=o.familiesBySource[this.source];for(const $e in N){const Ge=e.layers[$e];if(!Ge)continue;let dt=!1,ct=!1;for(const ht of N[$e])"symbol"===ht[0].type?dt=!0:ct=!0;if(!0===this.isSymbolTile&&!dt||!1===this.isSymbolTile&&!ct)continue;1===Ge.version&&kn(`Vector tile source "${this.source}" layer "${$e}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Lt=_.encode($e),St=[];for(let ht=0;ht<Ge.length;ht++){const Pt=Ge.feature(ht),Bt=x.getId(Pt,$e);St.push({feature:Pt,id:Bt,index:ht,sourceLayerIndex:Lt})}for(const ht of N[$e]){const Pt=ht[0];void 0!==this.isSymbolTile&&"symbol"===Pt.type!==this.isSymbolTile||Pt.minzoom&&this.zoom<Math.floor(Pt.minzoom)||Pt.maxzoom&&this.zoom>=Pt.maxzoom||"none"!==Pt.visibility&&(qp(ht,this.zoom,a),(C[Pt.id]=Pt.createBucket({index:x.bucketLayerIDs.length,layers:ht,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Lt,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:a})).populate(St,O,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(ht.map(Bt=>Bt.id)))}}let B,X,ne,ae;D.trim();const le={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ye=_n(O.glyphDependencies,$e=>Object.keys($e).map(Number));Object.keys(ye).length?u.send("getGlyphs",{uid:this.uid,stacks:ye},($e,Ge)=>{B||(B=$e,X=Ge,Ve.call(this))},void 0,!1,le):X={};const De=Object.keys(O.iconDependencies);De.length?u.send("getImages",{icons:De,source:this.source,tileID:this.tileID,type:"icons"},($e,Ge)=>{B||(B=$e,ne=Ge,Ve.call(this))},void 0,!1,le):ne={};const Re=Object.keys(O.patternDependencies);function Ve(){if(B)return p(B);if(X&&ne&&ae){const $e=new Hp(X),Ge=new Pm(ne,ae);for(const dt in C){const ct=C[dt];ct instanceof Cc?(qp(ct.layers,this.zoom,a),Sp(ct,X,$e.positions,ne,Ge.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection),ct.projection=this.projection.name):ct.hasPattern&&(ct instanceof Wh||ct instanceof Kc||ct instanceof rh)&&(qp(ct.layers,this.zoom,a),ct.addFeatures(O,this.tileID.canonical,Ge.patternPositions,a))}this.status="done",p(null,{buckets:Jo(C).filter(dt=>!dt.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:$e.image,lineAtlas:D,imageAtlas:Ge,glyphMap:this.returnDependencies?X:null,iconMap:this.returnDependencies?ne:null,glyphPositions:this.returnDependencies?$e.positions:null})}}Re.length?u.send("getImages",{icons:Re,source:this.source,tileID:this.tileID,type:"patterns"},($e,Ge)=>{B||(B=$e,ae=Ge,Ve.call(this))},void 0,!1,le):ae={},Ve.call(this)}}function qp(r,e,o){const a=new En(e);for(const u of r)u.recalculate(a,o)}class F_{constructor(e){this.entries={},this.scheduler=e}request(e,o,a,u){const p=this.entries[e]=this.entries[e]||{callbacks:[]};if(p.result){const[_,x]=p.result;return this.scheduler?this.scheduler.add(()=>{u(_,x)},o):u(_,x),()=>{}}return p.callbacks.push(u),p.cancel||(p.cancel=a((_,x)=>{p.result=[_,x];for(const C of p.callbacks)this.scheduler?this.scheduler.add(()=>{C(_,x)},o):C(_,x);setTimeout(()=>delete this.entries[e],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(_=>_!==u),p.callbacks.length||(p.cancel(),delete this.entries[e]))}}}function L_(r,e,o){const a=JSON.stringify(r.request);return r.data&&(this.deduped.entries[a]={result:[null,r.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},u=>{const p=Li(r.request,(_,x,C,D)=>{_?u(_):x&&u(null,{vectorTile:o?void 0:new Jc.VectorTile(new vc(x)),rawData:x,cacheControl:C,expires:D})});return()=>{p.cancel(),u()}},e)}const Wp=_t(new Float64Array(16));class au{constructor(e,o){this._tr=e,this._worldSize=o}createInversionMatrix(){return Wp}createTileMatrix(e){let o,a,u;const p=e.canonical,_=_t(new Float64Array(16)),x=this._tr.projection;if(x.isReprojectedInTileSpace){const C=bh(p,x);o=1,a=C.x+e.wrap*C.scale,u=C.y,qt(_,_,[o/C.scale,o/C.scale,this._tr.pixelsPerMeter/this._worldSize])}else o=this._worldSize/this._tr.zoomScale(p.z),a=(p.x+Math.pow(2,p.z)*e.wrap)*o,u=p.y*o;return ut(_,_,[a,u,0]),qt(_,_,[o/mr,o/mr,1]),_}pointCoordinate(e,o,a){const u=this._tr.horizonLineFromTop(!1),p=new Me(e,Math.max(u,o));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(p,a))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var ug={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Jr(this.parallels,this.constants.parallels))return;const r=Math.sin(An(this.parallels[0])),e=(r+Math.sin(An(this.parallels[1])))/2,o=1+r*(2*e-r),a=Math.sqrt(o)/e;this.constants={n:e,c:o,r0:a,parallels:this.parallels}},project(r,e){this.initializeConstants();const o=An(r-this.center[0]),a=An(e),{n:u,c:p,r0:_}=this.constants,x=Math.sqrt(p-2*u*Math.sin(a))/u;return{x:x*Math.sin(o*u),y:x*Math.cos(o*u)-_,z:0}},unproject(r,e){this.initializeConstants();const{n:o,c:a,r0:u}=this.constants,p=u+e;let _=Math.atan2(r,Math.abs(p))*Math.sign(p);p*o<0&&(_-=Math.PI*Math.sign(r)*Math.sign(p));const x=An(this.center[0])*o;_=Br(_,-Math.PI-x,Math.PI-x);const C=Lr(_/o)+this.center[0],D=Math.asin(pn((a-(r*r+p*p)*o*o)/(2*o),-1,1)),O=pn(Lr(D),-85.051129,Aa);return new ni(C,O)},projectTilePoint:(r,e)=>({x:r,y:e,z:0}),locationPoint:(r,e)=>r._coordinatePoint(r.locationCoordinate(e),!1),pixelsPerMeter:(r,e)=>yl(1,r)*e,farthestPixelDistance(r){return su(r,this.pixelsPerMeter(r.center.lat,r.worldSize))},createTileTransform:(r,e)=>new au(r,e)};const ku=1.340264,Cd=-.081106,$s=893e-6,Ed=.003796,Yp=Math.sqrt(3)/2;var kv={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(r,e){e=e/180*Math.PI,r=r/180*Math.PI;const o=Math.asin(Yp*Math.sin(e)),a=o*o,u=a*a*a;return{x:.5*(r*Math.cos(o)/(Yp*(ku+3*Cd*a+u*(7*$s+9*Ed*a)))/Math.PI+.5),y:1-.5*(o*(ku+Cd*a+u*($s+Ed*a))/Math.PI+1),z:0}},unproject(r,e){r=(2*r-.5)*Math.PI;let o=e=(2*(1-e)-1)*Math.PI,a=o*o,u=a*a*a;for(let D,O,N,B=0;B<12&&(O=o*(ku+Cd*a+u*($s+Ed*a))-e,N=ku+3*Cd*a+u*(7*$s+9*Ed*a),D=O/N,o=pn(o-D,-Math.PI/3,Math.PI/3),a=o*o,u=a*a*a,!(Math.abs(D)<1e-12));++B);const p=Yp*r*(ku+3*Cd*a+u*(7*$s+9*Ed*a))/Math.cos(o),_=Math.asin(Math.sin(o)/Yp),x=pn(180*p/Math.PI,-180,180),C=pn(180*_/Math.PI,-85.051129,Aa);return new ni(x,C)},projectTilePoint:(r,e)=>({x:r,y:e,z:0}),locationPoint:(r,e)=>r._coordinatePoint(r.locationCoordinate(e),!1),pixelsPerMeter:(r,e)=>yl(1,r)*e,farthestPixelDistance(r){return su(r,this.pixelsPerMeter(r.center.lat,r.worldSize))},createTileTransform:(r,e)=>new au(r,e)},hg={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(r,e)=>({x:.5+r/360,y:.5-e/360,z:0}),unproject(r,e){const o=360*(r-.5),a=pn(360*(.5-e),-85.051129,Aa);return new ni(o,a)},projectTilePoint:(r,e)=>({x:r,y:e,z:0}),locationPoint:(r,e)=>r._coordinatePoint(r.locationCoordinate(e),!1),pixelsPerMeter:(r,e)=>yl(1,r)*e,farthestPixelDistance(r){return su(r,this.pixelsPerMeter(r.center.lat,r.worldSize))},createTileTransform:(r,e)=>new au(r,e)};const lu=Math.PI/2;function wh(r){return Math.tan((lu+r)/2)}var N_={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Jr(this.parallels,this.constants.parallels))return;const r=An(this.parallels[0]),e=An(this.parallels[1]),o=Math.cos(r),a=r===e?Math.sin(r):Math.log(o/Math.cos(e))/Math.log(wh(e)/wh(r)),u=o*Math.pow(wh(r),a)/a;this.constants={n:a,f:u,parallels:this.parallels}},project(r,e){this.initializeConstants(),e=An(e),r=An(r-this.center[0]);const o=1e-6,{n:a,f:u}=this.constants;u>0?e<-lu+o&&(e=-lu+o):e>lu-o&&(e=lu-o);const p=u/Math.pow(wh(e),a),_=p*Math.sin(a*r),x=u-p*Math.cos(a*r);return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+.5),z:0}},unproject(r,e){this.initializeConstants(),r=(2*r-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:o,f:a}=this.constants,u=a-e,p=Math.sign(u),_=Math.sign(o)*Math.sqrt(r*r+u*u);let x=Math.atan2(r,Math.abs(u))*p;u*o<0&&(x-=Math.PI*Math.sign(r)*p);const C=pn(Lr(x/o)+this.center[0],-180,180),D=pn(Lr(2*Math.atan(Math.pow(a/_,1/o))-lu),-85.051129,Aa);return new ni(C,D)},projectTilePoint:(r,e)=>({x:r,y:e,z:0}),locationPoint:(r,e)=>r._coordinatePoint(r.locationCoordinate(e),!1),pixelsPerMeter:(r,e)=>yl(1,r)*e,farthestPixelDistance(r){return su(r,this.pixelsPerMeter(r.center.lat,r.worldSize))},createTileTransform:(r,e)=>new au(r,e)},Ov={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(r,e)=>({x:vu(r),y:xu(e),z:0}),unproject(r,e){const o=pc(r),a=As(e);return new ni(o,a)},projectTilePoint:(r,e)=>({x:r,y:e,z:0}),locationPoint:(r,e)=>r._coordinatePoint(r.locationCoordinate(e),!1),pixelsPerMeter:(r,e)=>yl(1,r)*e,farthestPixelDistance(r){return su(r,this.pixelsPerMeter(r.center.lat,r.worldSize))},createTileTransform:(r,e)=>new au(r,e)};const Xp=An(Aa);var Kp={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(r,e){const o=(e=An(e))*e,a=o*o;return{x:.5*((r=An(r))*(.8707-.131979*o+a*(a*(.003971*o-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+o*(.015085+a*(.028874*o-.044475-.005916*a)))/Math.PI+1),z:0}},unproject(r,e){r=(2*r-.5)*Math.PI;let o=e=(2*(1-e)-1)*Math.PI,a=25,u=0,p=o*o;do{p=o*o;const C=p*p;u=(o*(1.007226+p*(.015085+C*(.028874*p-.044475-.005916*C)))-e)/(1.007226+p*(.045255+C*(.259866*p-.311325-.005916*11*C))),o=pn(o-u,-Xp,Xp)}while(Math.abs(u)>1e-6&&--a>0);p=o*o;const _=pn(Lr(r/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),x=Lr(o);return new ni(_,x)},projectTilePoint:(r,e)=>({x:r,y:e,z:0}),locationPoint:(r,e)=>r._coordinatePoint(r.locationCoordinate(e),!1),pixelsPerMeter:(r,e)=>yl(1,r)*e,farthestPixelDistance(r){return su(r,this.pixelsPerMeter(r.center.lat,r.worldSize))},createTileTransform:(r,e)=>new au(r,e)};const dg=An(Aa),Td={albers:ug,equalEarth:kv,equirectangular:hg,lambertConformalConic:N_,mercator:Ov,naturalEarth:Kp,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(r,e){e=An(e),r=An(r);const o=Math.cos(e),a=2/Math.PI,u=Math.acos(o*Math.cos(r/2)),p=Math.sin(u)/u,_=.5*(r*a+2*o*Math.sin(r/2)/p)||0,x=.5*(e+Math.sin(e)/p)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}},unproject(r,e){let o=r=(2*r-.5)*Math.PI,a=e=(2*(1-e)-1)*Math.PI,u=25;const p=1e-6;let _=0,x=0;do{const C=Math.cos(a),D=Math.sin(a),O=2*D*C,N=D*D,B=C*C,X=Math.cos(o/2),ne=Math.sin(o/2),ae=2*X*ne,le=ne*ne,ye=1-B*X*X,De=ye?1/ye:0,Re=ye?Math.acos(C*X)*Math.sqrt(1/ye):0,Ve=.5*(2*Re*C*ne+2*o/Math.PI)-r,$e=.5*(Re*D+a)-e,Ge=.5*De*(B*le+Re*C*X*N)+1/Math.PI,dt=De*(ae*O/4-Re*D*ne),ct=.125*De*(O*ne-Re*D*B*ae),Lt=.5*De*(N*X+Re*le*C)+.5,St=dt*ct-Lt*Ge;_=($e*dt-Ve*Lt)/St,x=(Ve*ct-$e*Ge)/St,o=pn(o-_,-Math.PI,Math.PI),a=pn(a-x,-dg,dg)}while((Math.abs(_)>p||Math.abs(x)>p)&&--u>0);return new ni(Lr(o),Lr(a))},projectTilePoint:(r,e)=>({x:r,y:e,z:0}),locationPoint:(r,e)=>r._coordinatePoint(r.locationCoordinate(e),!1),pixelsPerMeter:(r,e)=>yl(1,r)*e,farthestPixelDistance(r){return su(r,this.pixelsPerMeter(r.center.lat,r.worldSize))},createTileTransform:(r,e)=>new au(r,e)}};h.ARRAY_TYPE=Xe,h.AUTH_ERR_MSG=Ze,h.Aabb=Ya,h.Actor=class{constructor(r,e,o){this.target=r,this.parent=e,this.mapId=o,this.callbacks={},this.cancelCallbacks={},Wt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ci()?r:ge,this.scheduler=new Gm}send(r,e,o,a,u=!1,p){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=p,this.callbacks[_]=o);const x=jo(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:r,hasCallback:!!o,targetMapId:a,mustQueue:u,sourceMapId:this.mapId,data:zs(e,x)},x),{cancel:()=>{o&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(r){const e=r.data,o=e.id;if(o&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const a=this.cancelCallbacks[o];delete this.cancelCallbacks[o],a&&a.cancel()}else if(e.mustQueue||ci()){const a=this.callbacks[o];this.cancelCallbacks[o]=this.scheduler.add(()=>this.processTask(o,e),a&&a.metadata||{type:"message"})}else this.processTask(o,e)}processTask(r,e){if("<response>"===e.type){const o=this.callbacks[r];delete this.callbacks[r],o&&(e.error?o(fa(e.error)):o(null,fa(e.data)))}else{const o=jo(this.globalScope)?void 0:[],a=e.hasCallback?(p,_)=>{delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:p?zs(p):null,data:zs(_,o)},o)}:p=>{},u=fa(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,a);else if(this.parent.getWorkerSource){const p=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,p[0],u.source)[p[1]](u,a)}else a(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},h.CanonicalTileID=vh,h.Color=Jn,h.ColorMode=Us,h.CullFaceMode=js,h.DEMData=_d,h.DataConstantProperty=tn,h.DedupedRequest=F_,h.DepthMode=Pu,h.EXTENT=mr,h.Elevation=class{getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,o=!0){null==e&&(e=null);const a=this._source();if(!a||r.y<0||r.y>1)return e;const u=a.getSource().maxzoom,p=1<<u,_=Math.floor(r.x),x=r.x-_,C=new oo(u,_,u,Math.floor(x*p),Math.floor(r.y*p)),D=this.findDEMTileFor(C);if(!D||!D.dem)return e;const O=D.dem,N=1<<D.tileID.canonical.z,B=(x*N-D.tileID.canonical.x)*O.dim,X=(r.y*N-D.tileID.canonical.y)*O.dim,ne=Math.floor(B),ae=Math.floor(X);return(o?this.exaggeration():1)*fr(fr(O.get(ne,ae),O.get(ne,ae+1),X-ae),fr(O.get(ne+1,ae),O.get(ne+1,ae+1),X-ae),B-ne)}getAtTileOffset(r,e,o){const a=1<<r.canonical.z;return this.getAtPointOrZero(new Wu(r.wrap+(r.canonical.x+e/mr)/a,(r.canonical.y+o/mr)/a))}getAtTileOffsetFunc(r,e){return o=>{const a=this.getAtTileOffset(r,o.x,o.y),u=e.upVector(r.canonical,o.x,o.y);return In(u,u,a*e.upVectorScale(r.canonical)),u}}getForTilePoints(r,e,o,a){const u=yd.create(this,r,a);return!!u&&(e.forEach(p=>{p[2]=this.exaggeration()*u.getElevationAt(p[0],p[1],o)}),!0)}getMinMaxForTile(r){const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const o=e.dem.tree,a=e.tileID,u=1<<r.canonical.z-a.canonical.z;let p=r.canonical.x/u-a.canonical.x,_=r.canonical.y/u-a.canonical.y,x=0;for(let C=0;C<r.canonical.z-a.canonical.z&&!o.leaves[x];C++){p*=2,_*=2;const D=2*Math.floor(_)+Math.floor(p);x=o.childOffsets[x]+D,p%=1,_%=1}return{min:this.exaggeration()*o.minimums[x],max:this.exaggeration()*o.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,o){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},h.ErrorEvent=$o,h.EvaluationParameters=En,h.Event=uo,h.Evented=qr,h.Frustum=ip,h.GLOBE_ZOOM_THRESHOLD_MAX=6,h.GlobeSharedBuffers=wd,h.GlyphManager=dh,h.ImagePosition=lh,h.LineAtlas=yh,h.LngLat=ni,h.LngLatBounds=Ul,h.LocalGlyphMode=td,h.MAX_MERCATOR_LATITUDE=Aa,h.MercatorCoordinate=Wu,h.ONE_EM=24,h.OverscaledTileID=oo,h.Properties=ki,h.RGBAImage=ya,h.Ray=class{constructor(r,e){this.pos=r,this.dir=e}intersectsPlane(r,e,o){const a=$t(e,this.dir);if(Math.abs(a)<1e-6)return!1;const u=((r[0]-this.pos[0])*e[0]+(r[1]-this.pos[1])*e[1]+(r[2]-this.pos[2])*e[2])/a;return o[0]=this.pos[0]+this.dir[0]*u,o[1]=this.pos[1]+this.dir[1]*u,o[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(r,e,o){if(ne=(B=this.pos)[0],ae=B[1],le=B[2],ye=(X=r)[0],De=X[1],Re=X[2],Math.abs(ne-ye)<=Ye*Math.max(1,Math.abs(ne),Math.abs(ye))&&Math.abs(ae-De)<=Ye*Math.max(1,Math.abs(ae),Math.abs(De))&&Math.abs(le-Re)<=Ye*Math.max(1,Math.abs(le),Math.abs(Re))||0===e)return o[0]=o[1]=o[2]=0,!1;var B,X,ne,ae,le,ye,De,Re;const[a,u,p]=this.dir,_=this.pos[0]-r[0],x=this.pos[1]-r[1],C=this.pos[2]-r[2],D=a*a+u*u+p*p,O=2*(_*a+x*u+C*p),N=O*O-4*D*(_*_+x*x+C*C-e*e);if(N<0){const B=Math.max(-O/2,0),X=_+a*B,ne=x+u*B,ae=C+p*B,le=Math.hypot(X,ne,ae);return o[0]=X*e/le,o[1]=ne*e/le,o[2]=ae*e/le,!1}{const B=(-O-Math.sqrt(N))/(2*D);if(B<0){const X=Math.hypot(_,x,C);return o[0]=_*e/X,o[1]=x*e/X,o[2]=C*e/X,!1}return o[0]=_+a*B,o[1]=x+u*B,o[2]=C+p*B,!0}}},h.RequestManager=class{constructor(r,e,o){this._transformRequestFn=r,this._customAccessToken=e,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){const r=function(){let e="";for(let o=0;o<10;o++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Oe,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,e){return this._transformRequestFn&&this._transformRequestFn(r,e)||{url:r}}normalizeStyleURL(r,e){if(!lt(r))return r;const o=Qt(r);return o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||e)}normalizeGlyphsURL(r,e){if(!lt(r))return r;const o=Qt(r);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||e)}normalizeSourceURL(r,e){if(!lt(r))return r;const o=Qt(r);return o.path=`/v4/${o.authority}.json`,o.params.push("secure"),this._makeAPIURL(o,this._customAccessToken||e)}normalizeSpriteURL(r,e,o,a){const u=Qt(r);return lt(r)?(u.path=`/styles/v1${u.path}/sprite${e}${o}`,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=`${e}${o}`,Gt(u))}normalizeTileURL(r,e,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!lt(r))return r;const a=Qt(r);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||o&&"raster"!==a.authority&&512===o?"@2x":""}${re.supported?".webp":"$1"}`),"raster"===a.authority?a.path=`/${Z.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${Z.TILE_URL_VERSION}${a.path}`);const u=this._customAccessToken||function(p){for(const _ of p){const x=_.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(a.params)||Z.ACCESS_TOKEN;return Z.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,u)}canonicalizeTileURL(r,e){const o=Qt(r);if(!o.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!o.path.match(/\.[\w]+$/))return r;let a="mapbox://";o.path.match(/^\/raster\/v1\//)?a+=`raster/${o.path.replace(`/${Z.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${o.path.replace(`/${Z.TILE_URL_VERSION}/`,"")}`;let u=o.params;return e&&(u=u.filter(p=>!p.match(/^access_token=/))),u.length&&(a+=`?${u.join("&")}`),a}canonicalizeTileset(r,e){const o=!!e&&lt(e),a=[];for(const u of r.tiles||[])ot(u)?a.push(this.canonicalizeTileURL(u,o)):a.push(u);return a}_makeAPIURL(r,e){const o="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",a=Qt(Z.API_URL);if(r.protocol=a.protocol,r.authority=a.authority,"http"===r.protocol){const u=r.params.indexOf("secure");u>=0&&r.params.splice(u,1)}if("/"!==a.path&&(r.path=`${a.path}${r.path}`),!Z.REQUIRE_ACCESS_TOKEN)return Gt(r);if(e=e||Z.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return r.params=r.params.filter(u=>-1===u.indexOf("access_token")),r.params.push(`access_token=${e||""}`),Gt(r)}},h.ResourceType=Eo,h.SegmentVector=io,h.SourceCache=Pa,h.StencilMode=Hm,h.StructArrayLayout1ui2=ju,h.StructArrayLayout2f1f2i16=qd,h.StructArrayLayout2i4=gu,h.StructArrayLayout2ui4=Bl,h.StructArrayLayout3f12=_u,h.StructArrayLayout3ui6=Vs,h.StructArrayLayout4i8=qa,h.Texture=dd,h.Tile=vd,h.Transitionable=Ts,h.Uniform1f=hc,h.Uniform1i=class extends is{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},h.Uniform2f=class extends is{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},h.Uniform3f=class extends is{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},h.Uniform4f=Jd,h.UniformColor=Qd,h.UniformMatrix2f=class extends is{constructor(r,e){super(r,e),this.current=fv}set(r){for(let e=0;e<4;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}},h.UniformMatrix3f=class extends is{constructor(r,e){super(r,e),this.current=pv}set(r){for(let e=0;e<9;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}},h.UniformMatrix4f=class extends is{constructor(r,e){super(r,e),this.current=Hf}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},h.UnwrappedTileID=pd,h.ValidationError=zt,h.VectorTileWorkerSource=class extends qr{constructor(r,e,o,a,u){super(),this.actor=r,this.layerIndex=e,this.availableImages=o,this.loadVectorData=u||L_,this.loading={},this.loaded={},this.deduped=new F_(r.scheduler),this.isSpriteLoaded=a,this.scheduler=r.scheduler}loadTile(r,e){const o=r.uid,a=r&&r.request,u=a&&a.collectResourceTiming,p=this.loading[o]=new O_(r);p.abort=this.loadVectorData(r,(_,x)=>{const C=!this.loading[o];if(delete this.loading[o],C||_||!x)return p.status="done",C||(this.loaded[o]=p),e(_);const D=x.rawData,O={};x.expires&&(O.expires=x.expires),x.cacheControl&&(O.cacheControl=x.cacheControl),p.vectorTile=x.vectorTile||new Jc.VectorTile(new vc(D));const N=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(B,X)=>{if(B||!X)return e(B);const ne={};if(u){const ae=Lp(a);ae.length>0&&(ne.resourceTiming=JSON.parse(JSON.stringify(ae)))}e(null,st({rawTileData:D.slice(0)},X,O,ne))})};this.isSpriteLoaded?N():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(N,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):N()}),this.loaded=this.loaded||{},this.loaded[o]=p})}reloadTile(r,e){const o=this.loaded,a=r.uid,u=this;if(o&&o[a]){const p=o[a];p.showCollisionBoxes=r.showCollisionBoxes,p.enableTerrain=!!r.enableTerrain,p.projection=r.projection;const _=(x,C)=>{const D=p.reloadCallback;D&&(delete p.reloadCallback,p.parse(p.vectorTile,u.layerIndex,this.availableImages,u.actor,D)),e(x,C)};"parsing"===p.status?p.reloadCallback=_:"done"===p.status&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(r,e){const o=r.uid,a=this.loading[o];a&&(a.abort&&a.abort(),delete this.loading[o]),e()}removeTile(r,e){const o=this.loaded,a=r.uid;o&&o[a]&&delete o[a],e()}},h.WritingMode=na,h.ZoomHistory=f,h.add=li,h.addDynamicAttributes=Pp,h.adjoint=function(r,e){var o=e[0],a=e[1],u=e[2],p=e[3],_=e[4],x=e[5],C=e[6],D=e[7],O=e[8];return r[0]=_*O-x*D,r[1]=u*D-a*O,r[2]=a*x-u*_,r[3]=x*C-p*O,r[4]=o*O-u*C,r[5]=u*p-o*x,r[6]=p*D-_*C,r[7]=a*C-o*D,r[8]=o*_-a*p,r},h.asyncAll=$i,h.bezier=Ji,h.bindAll=Wt,h.boundsAttributes=jp,h.bufferConvexPolygon=function(r,e){const o=[];for(let a=0;a<r.length;a++){const u=Br(a-1,-1,r.length-1),p=Br(a+1,-1,r.length-1),_=r[a],x=r[p],C=r[u].sub(_).unit(),D=x.sub(_).unit(),O=D.angleWithSep(C.x,C.y),N=C.add(D).unit().mult(-1*e/Math.sin(O/2));o.push(_.add(N))}return o},h.cacheEntryPossiblyAdded=function(r){Gr++,Gr>oi&&(r.getActor().send("enforceCacheSizeLimit",un),Gr=0)},h.calculateGlobeMatrix=cg,h.calculateGlobeMercatorMatrix=function(r){const e=r.worldSize,o=pn(r.center.lat,-85.051129,Aa),a=new Me(vu(r.center.lng)*e,xu(o)*e),u=yl(1,r.center.lat)*e,p=r.pixelsPerMeter,_=e/(u/r.pixelsPerMeter),x=_t(new Float64Array(16));return ut(x,x,[a.x,a.y,0]),qt(x,x,[_,_,p]),x},h.clamp=pn,h.clearTileCache=function(r){const e=ge.caches.delete(Nt);r&&e.catch(r).then(()=>r())},h.clipLine=ed,h.clone=function(r){var e=new Xe(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},h.clone$1=Nn,h.collisionCircleLayout=Ka,h.config=Z,h.conjugate=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},h.create=function(){var r=new Xe(16);return Xe!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},h.create$1=Ct,h.createExpression=ha,h.createLayout=Di,h.createStyleLayer=function(r){return"custom"===r.type?new A_(r):new Op[r.type](r)},h.cross=lo,h.degToRad=An,h.div=function(r,e,o){return r[0]=e[0]/o[0],r[1]=e[1]/o[1],r[2]=e[2]/o[2],r},h.dot=$t,h.ease=Uo,h.easeCubicInOut=hr,h.emitValidationErrors=Rr,h.endsWith=Xt,h.enforceCacheSizeLimit=function(r){Zr(),yn&&yn.then(e=>{e.keys().then(o=>{for(let a=0;a<o.length-r;a++)e.delete(o[a])})})},h.evaluateSizeForFeature=Ia,h.evaluateSizeForZoom=yc,h.evaluateVariableOffset=Vm,h.evented=rs,h.exactEquals=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},h.exactEquals$1=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]},h.exported=zn,h.exported$1=re,h.extend=st,h.extend$1=Qo,h.filterObject=Sr,h.fromMat4=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},h.fromQuat=function(r,e){var o=e[0],a=e[1],u=e[2],p=e[3],_=o+o,x=a+a,C=u+u,D=o*_,O=a*_,N=a*x,B=u*_,X=u*x,ne=u*C,ae=p*_,le=p*x,ye=p*C;return r[0]=1-N-ne,r[1]=O+ye,r[2]=B-le,r[3]=0,r[4]=O-ye,r[5]=1-D-ne,r[6]=X+ae,r[7]=0,r[8]=B+le,r[9]=X-ae,r[10]=1-D-N,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},h.fromRotation=function(r,e){var o=Math.sin(e),a=Math.cos(e);return r[0]=a,r[1]=o,r[2]=0,r[3]=-o,r[4]=a,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},h.fromScaling=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},h.furthestTileCorner=function(r){const e=Math.round((r+45+360)%360/90)%4;return Ci[e]},h.getAABBPointSquareDist=function(r,e,o){let a=0;for(let u=0;u<2;++u){const p=o?o[u]:0;r[u]>p&&(a+=(r[u]-p)*(r[u]-p)),e[u]<p&&(a+=(p-e[u])*(p-e[u]))}return a},h.getAnchorAlignment=Ap,h.getAnchorJustification=id,h.getBounds=function(r){let e=1/0,o=1/0,a=-1/0,u=-1/0;for(const p of r)e=Math.min(e,p.x),o=Math.min(o,p.y),a=Math.max(a,p.x),u=Math.max(u,p.y);return{min:new Me(e,o),max:new Me(a,u)}},h.getColumn=function(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]},h.getImage=Ir,h.getJSON=function(r,e){return pi(st(r,{type:"json"}),e)},h.getMapSessionAPI=eo,h.getPerformanceMeasurement=Lp,h.getProjection=function(r){const e=Td[r.name];if(!e)throw new Error(`Invalid projection name: ${r.name}`);return e.conic?function(o,a){if(a.parallels&&Math.abs(a.parallels[0]+a.parallels[1])<.01){let u=function(p){const _=Math.max(.01,Math.cos(An(p))),x=1/(2*Math.max(Math.PI*_,1/_));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(C,D){const O=An(C)*_,N=Math.sin(An(D))/_;return{x:O*x+.5,y:-N*x+.5,z:0}},unproject(C,D){const O=-(D-.5)/x,N=pn(Lr((C-.5)/x)/_,-180,180),B=Math.asin(pn(O*_,-1,1)),X=pn(Lr(B),-85.051129,Aa);return new ni(N,X)}}}(a.parallels[0]);if("lambertConformalConic"===a.name){const{project:p,unproject:_}=Td.mercator;u={wrap:!0,supportsWorldCopies:!0,project:p,unproject:_}}return st({},o,a,u)}return st({},o,a)}(e,r):e},h.getRTLTextPluginStatus=ma,h.getReferrer=bn,h.getTilePoint=function(r,{x:e,y:o},a=0){return new Me(((e-a)*r.scale-r.x)*mr,(o*r.scale-r.y)*mr)},h.getTileVec3=function(r,e,o=0){return ao(((e.x-o)*r.scale-r.x)*mr,(e.y*r.scale-r.y)*mr,Ms(e.z,e.y))},h.getVideo=function(r,e){const o=ge.document.createElement("video");o.muted=!0,o.onloadstart=function(){e(null,o)};for(let a=0;a<r.length;a++){const u=ge.document.createElement("source");Zi(r[a])||(o.crossOrigin="Anonymous"),u.src=r[a],o.appendChild(u)}return{cancel:()=>{}}},h.globeBuffersForTileMesh=function(r,e,o,a){const u=r.context,p=r.transform;let _=e.globeGridBuffer,x=e.globePoleBuffer;if(!_){const C=wd.createGridVertices(o.canonical);_=e.globeGridBuffer=u.createVertexBuffer(C,$p,!1)}if(!x){const C=wd.createPoleTriangleVertices(a,p.tileSize*a,0===o.canonical.y);x=e.globePoleBuffer=u.createVertexBuffer(C,$p,!1)}return[_,x]},h.globeDenormalizeECEF=lg,h.globeMatrixForTile=function(r,e){const o=lg(xh(r)),a=((u=new Float64Array(16))[0]=(p=e)[0],u[1]=p[1],u[2]=p[2],u[3]=p[3],u[4]=p[4],u[5]=p[5],u[6]=p[6],u[7]=p[7],u[8]=p[8],u[9]=p[9],u[10]=p[10],u[11]=p[11],u[12]=p[12],u[13]=p[13],u[14]=p[14],u[15]=p[15],u);var u,p;return jt(a,a,o),a},h.globePoleMatrixForTile=function(r,e,o){const a=_t(new Float64Array(16)),u=Math.pow(2,r.z),p=(r.x-u/2)/u*Math.PI*2,_=o.point,x=o.worldSize/(o.tileSize*u);return ut(a,a,[_.x,_.y,-o.worldSize/Math.PI/2]),qt(a,a,[x,x,x]),Dn(a,a,An(-o._center.lat)),cn(a,a,An(-o._center.lng)),cn(a,a,p),e&&qt(a,a,[1,-1,1]),a},h.globeTileBounds=xh,h.globeToMercatorTransition=function(r){return wo(5,6,r)},h.identity=_t,h.identity$1=Ko,h.invert=function(r,e){var o=e[0],a=e[1],u=e[2],p=e[3],_=e[4],x=e[5],C=e[6],D=e[7],O=e[8],N=e[9],B=e[10],X=e[11],ne=e[12],ae=e[13],le=e[14],ye=e[15],De=o*x-a*_,Re=o*C-u*_,Ve=o*D-p*_,$e=a*C-u*x,Ge=a*D-p*x,dt=u*D-p*C,ct=O*ae-N*ne,Lt=O*le-B*ne,St=O*ye-X*ne,ht=N*le-B*ae,Pt=N*ye-X*ae,Bt=B*ye-X*le,xt=De*Bt-Re*Pt+Ve*ht+$e*St-Ge*Lt+dt*ct;return xt?(r[0]=(x*Bt-C*Pt+D*ht)*(xt=1/xt),r[1]=(u*Pt-a*Bt-p*ht)*xt,r[2]=(ae*dt-le*Ge+ye*$e)*xt,r[3]=(B*Ge-N*dt-X*$e)*xt,r[4]=(C*St-_*Bt-D*Lt)*xt,r[5]=(o*Bt-u*St+p*Lt)*xt,r[6]=(le*Ve-ne*dt-ye*Re)*xt,r[7]=(O*dt-B*Ve+X*Re)*xt,r[8]=(_*Pt-x*St+D*ct)*xt,r[9]=(a*St-o*Pt-p*ct)*xt,r[10]=(ne*Ge-ae*Ve+ye*De)*xt,r[11]=(N*Ve-O*Ge-X*De)*xt,r[12]=(x*Lt-_*ht-C*ct)*xt,r[13]=(o*ht-a*Lt+u*ct)*xt,r[14]=(ae*Re-ne*$e-le*De)*xt,r[15]=(O*$e-N*Re+B*De)*xt,r):null},h.isMapAuthenticated=function(r){return ei.has(r)},h.isMapboxURL=lt,h.latFromMercatorY=As,h.len=hs,h.length=Kr,h.length$1=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},h.loadVectorTile=L_,h.makeRequest=pi,h.mercatorXfromLng=vu,h.mercatorYfromLat=xu,h.mercatorZfromAltitude=yl,h.mul=jt,h.mul$1=Os,h.multiply=function(r,e,o){var a=e[0],u=e[1],p=e[2],_=e[3],x=e[4],C=e[5],D=e[6],O=e[7],N=e[8],B=o[0],X=o[1],ne=o[2],ae=o[3],le=o[4],ye=o[5],De=o[6],Re=o[7],Ve=o[8];return r[0]=B*a+X*_+ne*D,r[1]=B*u+X*x+ne*O,r[2]=B*p+X*C+ne*N,r[3]=ae*a+le*_+ye*D,r[4]=ae*u+le*x+ye*O,r[5]=ae*p+le*C+ye*N,r[6]=De*a+Re*_+Ve*D,r[7]=De*u+Re*x+Ve*O,r[8]=De*p+Re*C+Ve*N,r},h.multiply$1=Vt,h.multiply$2=qn,h.nextPowerOfTwo=Je,h.normalize=Un,h.normalize$1=function(r,e){var o=e[0],a=e[1],u=e[2],p=e[3],_=o*o+a*a+u*u+p*p;return _>0&&(_=1/Math.sqrt(_)),r[0]=o*_,r[1]=a*_,r[2]=u*_,r[3]=p*_,r},h.number=fr,h.ortho=function(r,e,o,a,u,p,_){var x=1/(e-o),C=1/(a-u),D=1/(p-_);return r[0]=-2*x,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*C,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*D,r[11]=0,r[12]=(e+o)*x,r[13]=(u+a)*C,r[14]=(_+p)*D,r[15]=1,r},h.pbf=vc,h.perspective=function(r,e,o,a,u){var p,_=1/Math.tan(e/2);return r[0]=_/o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=_,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,null!=u&&u!==1/0?(r[10]=(u+a)*(p=1/(a-u)),r[14]=2*u*a*p):(r[10]=-1,r[14]=-2*a),r},h.pick=function(r,e){const o={};for(let a=0;a<e.length;a++){const u=e[a];u in r&&(o[u]=r[u])}return o},h.plugin=cr,h.pointGeometry=Me,h.polygonIntersectsBox=rp,h.polygonIntersectsPolygon=Kf,h.polygonizeBounds=function(r,e,o=0,a=!0){const u=new Me(o,o),p=r.sub(u),_=e.add(u),x=[p,new Me(_.x,p.y),_,new Me(p.x,_.y)];return a&&x.push(p),x},h.posAttributes=ng,h.postMapLoadEvent=tr,h.postTurnstileEvent=xn,h.potpack=wl,h.prevPowerOfTwo=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},h.radToDeg=Lr,h.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],h.registerForPluginStateChange=function(r){return r({pluginStatus:vn,pluginURL:lr}),rs.on("pluginStateChange",r),r},h.removeAuthState=function(r){ei.delete(r)},h.renderColorRamp=Sa,h.rotateX=Dn,h.rotateX$1=ji,h.rotateY=cn,h.rotateZ=function(r,e,o){var a=Math.sin(o),u=Math.cos(o),p=e[0],_=e[1],x=e[2],C=e[3],D=e[4],O=e[5],N=e[6],B=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=p*u+D*a,r[1]=_*u+O*a,r[2]=x*u+N*a,r[3]=C*u+B*a,r[4]=D*u-p*a,r[5]=O*u-_*a,r[6]=N*u-x*a,r[7]=B*u-C*a,r},h.rotateZ$1=function(r,e,o){o*=.5;var a=e[0],u=e[1],p=e[2],_=e[3],x=Math.sin(o),C=Math.cos(o);return r[0]=a*C+u*x,r[1]=u*C-a*x,r[2]=p*C+_*x,r[3]=_*C-p*x,r},h.scale=qt,h.scale$1=function(r,e,o){return r[0]=e[0]*o,r[1]=e[1]*o,r[2]=e[2]*o,r[3]=e[3]*o,r},h.scale$2=In,h.scaleAndAdd=dn,h.setCacheLimits=function(r,e){un=r,oi=e},h.setColumn=function(r,e,o){r[4*e+0]=o[0],r[4*e+1]=o[1],r[4*e+2]=o[2],r[4*e+3]=o[3]},h.setRTLTextPlugin=function(r,e,o=!1){if(vn===ln||vn===Vn||vn===Or)throw new Error("setRTLTextPlugin cannot be called multiple times.");lr=zn.resolveURL(r),vn=ln,Yr=e,vo(),o||Bs()},h.smoothstep=wo,h.spec=rt,h.storeAuthState=function(r,e){e?ei.add(r):ei.delete(r)},h.sub=co,h.subtract=Jt,h.symbolSize=Tm,h.tileAABB=function(r,e,o,a,u,p,_,x,C){if("globe"===C.name){const X=xh(new pd(p,new vh(o,a,u)).canonical).getCorners(),ne=Number.MAX_VALUE,ae=[-ne,-ne,-ne],le=[ne,ne,ne],ye=cg(r,e);for(let De=0;De<X.length;De++)Ln(X[De],X[De],ye),O=le,N=X[De],(D=le)[0]=Math.min(O[0],N[0]),D[1]=Math.min(O[1],N[1]),D[2]=Math.min(O[2],N[2]),Mr(ae,ae,X[De]);return new Ya(le,ae)}var D,O,N;const B=bh({z:o,x:a,y:u},C);return new Ya([(p+B.x/B.scale)*e,e*(B.y/B.scale),_],[(p+B.x2/B.scale)*e,e*(B.y2/B.scale),x])},h.tileTransform=bh,h.transformMat3=function(r,e,o){var a=e[0],u=e[1],p=e[2];return r[0]=a*o[0]+u*o[3]+p*o[6],r[1]=a*o[1]+u*o[4]+p*o[7],r[2]=a*o[2]+u*o[5]+p*o[8],r},h.transformMat4=Ln,h.transformMat4$1=bo,h.transformQuat=Ki,h.translate=ut,h.transpose=function(r,e){if(r===e){var o=e[1],a=e[2],u=e[5];r[1]=e[3],r[2]=e[6],r[3]=o,r[5]=e[7],r[6]=a,r[7]=u}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r},h.triggerPluginCompletionEvent=vi,h.uniqueId=Fe,h.validateCustomStyleLayer=function(r){const e=[],o=r.id;return void 0===o&&e.push({message:`layers.${o}: missing required property "id"`}),void 0===r.render&&e.push({message:`layers.${o}: missing required method "render"`}),r.renderingMode&&"2d"!==r.renderingMode&&"3d"!==r.renderingMode&&e.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),e},h.validateFog=Le,h.validateLight=we,h.validateStyle=oe,h.values=Jo,h.vectorTile=Jc,h.version="2.7.0",h.warnOnce=kn,h.window=ge,h.wrap=Br}),y(0,function(h){function Qe(me){const Z=typeof me;if("number"===Z||"boolean"===Z||"string"===Z||null==me)return JSON.stringify(me);if(Array.isArray(me)){let ve="[";for(const Ie of me)ve+=`${Qe(Ie)},`;return`${ve}]`}const re=Object.keys(me).sort();let pe="{";for(let ve=0;ve<re.length;ve++)pe+=`${JSON.stringify(re[ve])}:${Qe(me[re[ve]])},`;return`${pe}}`}function nt(me){let Z="";for(const re of h.refProperties)Z+=`/${Qe(me[re])}`;return Z}class ze{constructor(Z){this.keyCache={},Z&&this.replace(Z)}replace(Z){this._layerConfigs={},this._layers={},this.update(Z,[])}update(Z,re){for(const ve of Z)this._layerConfigs[ve.id]=ve,(this._layers[ve.id]=h.createStyleLayer(ve)).compileFilter(),this.keyCache[ve.id]&&delete this.keyCache[ve.id];for(const ve of re)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};const pe=function(ve,Ie){const Be={};for(let Oe=0;Oe<ve.length;Oe++){const Ze=Ie&&Ie[ve[Oe].id]||nt(ve[Oe]);Ie&&(Ie[ve[Oe].id]=Ze);let lt=Be[Ze];lt||(lt=Be[Ze]=[]),lt.push(ve[Oe])}const je=[];for(const Oe in Be)je.push(Be[Oe]);return je}(h.values(this._layerConfigs),this.keyCache);for(const ve of pe){const Ie=ve.map(ot=>this._layers[ot.id]),Be=Ie[0];if("none"===Be.visibility)continue;const je=Be.source||"";let Oe=this.familiesBySource[je];Oe||(Oe=this.familiesBySource[je]={});const Ze=Be.sourceLayer||"_geojsonTileLayer";let lt=Oe[Ze];lt||(lt=Oe[Ze]=[]),lt.push(Ie)}}}const{ImageBitmap:Me}=h.window;class qe{loadTile(Z,re){const{uid:pe,encoding:ve,rawImageData:Ie,padding:Be,buildQuadTree:je}=Z,Oe=Me&&Ie instanceof Me?this.getImageData(Ie,Be):Ie;re(null,new h.DEMData(pe,Oe,ve,Be<1,je))}getImageData(Z,re){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const pe=this.offscreenCanvasContext.getImageData(-re,-re,Z.width+2*re,Z.height+2*re);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new h.RGBAImage({width:pe.width,height:pe.height},pe.data)}}var ge=function me(Z,re){var pe,ve=Z&&Z.type;if("FeatureCollection"===ve)for(pe=0;pe<Z.features.length;pe++)me(Z.features[pe],re);else if("GeometryCollection"===ve)for(pe=0;pe<Z.geometries.length;pe++)me(Z.geometries[pe],re);else if("Feature"===ve)me(Z.geometry,re);else if("Polygon"===ve)Ye(Z.coordinates,re);else if("MultiPolygon"===ve)for(pe=0;pe<Z.coordinates.length;pe++)Ye(Z.coordinates[pe],re);return Z};function Ye(me,Z){if(0!==me.length){Xe(me[0],Z);for(var re=1;re<me.length;re++)Xe(me[re],!Z)}}function Xe(me,Z){for(var re=0,pe=0,ve=0,Ie=me.length,Be=Ie-1;ve<Ie;Be=ve++){var je=(me[ve][0]-me[Be][0])*(me[Be][1]+me[ve][1]),Oe=re+je;pe+=Math.abs(re)>=Math.abs(je)?re-Oe+je:je-Oe+re,re=Oe}re+pe>=0!=!!Z&&me.reverse()}const Ct=h.vectorTile.VectorTileFeature.prototype.toGeoJSON;class _t{constructor(Z){this._feature=Z,this.extent=h.EXTENT,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))}loadGeometry(){if(1===this._feature.type){const Z=[];for(const re of this._feature.geometry)Z.push([new h.pointGeometry(re[0],re[1])]);return Z}{const Z=[];for(const re of this._feature.geometry){const pe=[];for(const ve of re)pe.push(new h.pointGeometry(ve[0],ve[1]));Z.push(pe)}return Z}}toGeoJSON(Z,re,pe){return Ct.call(this,Z,re,pe)}}class Vt{constructor(Z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.EXTENT,this.length=Z.length,this._features=Z}feature(Z){return new _t(this._features[Z])}}var ut=h.vectorTile.VectorTileFeature,qt=Dn;function Dn(me,Z){this.options=Z||{},this.features=me,this.length=me.length}function cn(me,Z){this.id="number"==typeof me.id?me.id:void 0,this.type=me.type,this.rawGeometry=1===me.type?[me.geometry]:me.geometry,this.properties=me.tags,this.extent=Z||4096}Dn.prototype.feature=function(me){return new cn(this.features[me],this.options.extent)},cn.prototype.loadGeometry=function(){var me=this.rawGeometry;this.geometry=[];for(var Z=0;Z<me.length;Z++){for(var re=me[Z],pe=[],ve=0;ve<re.length;ve++)pe.push(new h.pointGeometry(re[ve][0],re[ve][1]));this.geometry.push(pe)}return this.geometry},cn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var me=this.geometry,Z=1/0,re=-1/0,pe=1/0,ve=-1/0,Ie=0;Ie<me.length;Ie++)for(var Be=me[Ie],je=0;je<Be.length;je++){var Oe=Be[je];Z=Math.min(Z,Oe.x),re=Math.max(re,Oe.x),pe=Math.min(pe,Oe.y),ve=Math.max(ve,Oe.y)}return[Z,pe,re,ve]},cn.prototype.toGeoJSON=ut.prototype.toGeoJSON;var jt=hn,vr=qt;function hn(me){var Z=new h.pbf;return function(re,pe){for(var ve in re.layers)pe.writeMessage(3,Kr,re.layers[ve])}(me,Z),Z.finish()}function Kr(me,Z){var re;Z.writeVarintField(15,me.version||1),Z.writeStringField(1,me.name||""),Z.writeVarintField(5,me.extent||4096);var pe={keys:[],values:[],keycache:{},valuecache:{}};for(re=0;re<me.length;re++)pe.feature=me.feature(re),Z.writeMessage(2,ao,pe);var ve=pe.keys;for(re=0;re<ve.length;re++)Z.writeStringField(3,ve[re]);var Ie=pe.values;for(re=0;re<Ie.length;re++)Z.writeMessage(4,In,Ie[re])}function ao(me,Z){var re=me.feature;void 0!==re.id&&Z.writeVarintField(1,re.id),Z.writeMessage(2,li,me),Z.writeVarintField(3,re.type),Z.writeMessage(4,Mr,re)}function li(me,Z){var re=me.feature,pe=me.keys,ve=me.values,Ie=me.keycache,Be=me.valuecache;for(var je in re.properties){var Oe=re.properties[je],Ze=Ie[je];if(null!==Oe){void 0===Ze&&(pe.push(je),Ie[je]=Ze=pe.length-1),Z.writeVarint(Ze);var lt=typeof Oe;"string"!==lt&&"boolean"!==lt&&"number"!==lt&&(Oe=JSON.stringify(Oe));var ot=lt+":"+Oe,mt=Be[ot];void 0===mt&&(ve.push(Oe),Be[ot]=mt=ve.length-1),Z.writeVarint(mt)}}}function Jt(me,Z){return(Z<<3)+(7&me)}function qn(me){return me<<1^me>>31}function Mr(me,Z){for(var re=me.loadGeometry(),pe=me.type,ve=0,Ie=0,Be=re.length,je=0;je<Be;je++){var Oe=re[je],Ze=1;1===pe&&(Ze=Oe.length),Z.writeVarint(Jt(1,Ze));for(var lt=3===pe?Oe.length-1:Oe.length,ot=0;ot<lt;ot++){1===ot&&1!==pe&&Z.writeVarint(Jt(2,lt-1));var mt=Oe[ot].x-ve,Qt=Oe[ot].y-Ie;Z.writeVarint(qn(mt)),Z.writeVarint(qn(Qt)),ve+=mt,Ie+=Qt}3===pe&&Z.writeVarint(Jt(7,1))}}function In(me,Z){var re=typeof me;"string"===re?Z.writeStringField(1,me):"boolean"===re?Z.writeBooleanField(7,me):"number"===re&&(me%1!=0?Z.writeDoubleField(3,me):me<0?Z.writeSVarintField(6,me):Z.writeVarintField(5,me))}function dn(me,Z,re,pe,ve,Ie){if(ve-pe<=re)return;const Be=pe+ve>>1;Un(me,Z,Be,pe,ve,Ie%2),dn(me,Z,re,pe,Be-1,Ie+1),dn(me,Z,re,Be+1,ve,Ie+1)}function Un(me,Z,re,pe,ve,Ie){for(;ve>pe;){if(ve-pe>600){const Ze=ve-pe+1,lt=re-pe+1,ot=Math.log(Ze),mt=.5*Math.exp(2*ot/3),Qt=.5*Math.sqrt(ot*mt*(Ze-mt)/Ze)*(lt-Ze/2<0?-1:1);Un(me,Z,re,Math.max(pe,Math.floor(re-lt*mt/Ze+Qt)),Math.min(ve,Math.floor(re+(Ze-lt)*mt/Ze+Qt)),Ie)}const Be=Z[2*re+Ie];let je=pe,Oe=ve;for($t(me,Z,pe,re),Z[2*ve+Ie]>Be&&$t(me,Z,pe,ve);je<Oe;){for($t(me,Z,je,Oe),je++,Oe--;Z[2*je+Ie]<Be;)je++;for(;Z[2*Oe+Ie]>Be;)Oe--}Z[2*pe+Ie]===Be?$t(me,Z,pe,Oe):(Oe++,$t(me,Z,Oe,ve)),Oe<=re&&(pe=Oe+1),re<=Oe&&(ve=Oe-1)}}function $t(me,Z,re,pe){lo(me,re,pe),lo(Z,2*re,2*pe),lo(Z,2*re+1,2*pe+1)}function lo(me,Z,re){const pe=me[Z];me[Z]=me[re],me[re]=pe}function Ln(me,Z,re,pe){const ve=me-re,Ie=Z-pe;return ve*ve+Ie*Ie}jt.fromVectorTileJs=hn,jt.fromGeojsonVt=function(me,Z){Z=Z||{};var re={};for(var pe in me)re[pe]=new qt(me[pe].features,Z),re[pe].name=pe,re[pe].version=Z.version,re[pe].extent=Z.extent;return hn({layers:re})},jt.GeoJSONWrapper=vr;const Ki=me=>me[0],hi=me=>me[1];class co{constructor(Z,re=Ki,pe=hi,ve=64,Ie=Float64Array){this.nodeSize=ve,this.points=Z;const Be=Z.length<65536?Uint16Array:Uint32Array,je=this.ids=new Be(Z.length),Oe=this.coords=new Ie(2*Z.length);for(let Ze=0;Ze<Z.length;Ze++)je[Ze]=Ze,Oe[2*Ze]=re(Z[Ze]),Oe[2*Ze+1]=pe(Z[Ze]);dn(je,Oe,ve,0,je.length-1,0)}range(Z,re,pe,ve){return function(Ie,Be,je,Oe,Ze,lt,ot){const mt=[0,Ie.length-1,0],Qt=[];let Gt,Yt;for(;mt.length;){const sn=mt.pop(),Mn=mt.pop(),xn=mt.pop();if(Mn-xn<=ot){for(let Wn=xn;Wn<=Mn;Wn++)Gt=Be[2*Wn],Yt=Be[2*Wn+1],Gt>=je&&Gt<=Ze&&Yt>=Oe&&Yt<=lt&&Qt.push(Ie[Wn]);continue}const Kn=Math.floor((xn+Mn)/2);Gt=Be[2*Kn],Yt=Be[2*Kn+1],Gt>=je&&Gt<=Ze&&Yt>=Oe&&Yt<=lt&&Qt.push(Ie[Kn]);const tr=(sn+1)%2;(0===sn?je<=Gt:Oe<=Yt)&&(mt.push(xn),mt.push(Kn-1),mt.push(tr)),(0===sn?Ze>=Gt:lt>=Yt)&&(mt.push(Kn+1),mt.push(Mn),mt.push(tr))}return Qt}(this.ids,this.coords,Z,re,pe,ve,this.nodeSize)}within(Z,re,pe){return function(ve,Ie,Be,je,Oe,Ze){const lt=[0,ve.length-1,0],ot=[],mt=Oe*Oe;for(;lt.length;){const Qt=lt.pop(),Gt=lt.pop(),Yt=lt.pop();if(Gt-Yt<=Ze){for(let tr=Yt;tr<=Gt;tr++)Ln(Ie[2*tr],Ie[2*tr+1],Be,je)<=mt&&ot.push(ve[tr]);continue}const sn=Math.floor((Yt+Gt)/2),Mn=Ie[2*sn],xn=Ie[2*sn+1];Ln(Mn,xn,Be,je)<=mt&&ot.push(ve[sn]);const Kn=(Qt+1)%2;(0===Qt?Be-Oe<=Mn:je-Oe<=xn)&&(lt.push(Yt),lt.push(sn-1),lt.push(Kn)),(0===Qt?Be+Oe>=Mn:je+Oe>=xn)&&(lt.push(sn+1),lt.push(Gt),lt.push(Kn))}return ot}(this.ids,this.coords,Z,re,pe,this.nodeSize)}}const Os={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:me=>me},hs=Math.fround||(bo=new Float32Array(1),me=>(bo[0]=+me,bo[0]));var bo;class Fo{constructor(Z){this.options=Ci(Object.create(Os),Z),this.trees=new Array(this.options.maxZoom+1)}load(Z){const{log:re,minZoom:pe,maxZoom:ve,nodeSize:Ie}=this.options;re&&console.time("total time");const Be=`prepare ${Z.length} points`;re&&console.time(Be),this.points=Z;let je=[];for(let Oe=0;Oe<Z.length;Oe++)Z[Oe].geometry&&je.push(ji(Z[Oe],Oe));this.trees[ve+1]=new co(je,hr,Ji,Ie,Float32Array),re&&console.timeEnd(Be);for(let Oe=ve;Oe>=pe;Oe--){const Ze=+Date.now();je=this._cluster(je,Oe),this.trees[Oe]=new co(je,hr,Ji,Ie,Float32Array),re&&console.log("z%d: %d clusters in %dms",Oe,je.length,+Date.now()-Ze)}return re&&console.timeEnd("total time"),this}getClusters(Z,re){let pe=((Z[0]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,Z[1]));let Ie=180===Z[2]?180:((Z[2]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)pe=-180,Ie=180;else if(pe>Ie){const lt=this.getClusters([pe,ve,180,Be],re),ot=this.getClusters([-180,ve,Ie,Be],re);return lt.concat(ot)}const je=this.trees[this._limitZoom(re)],Oe=je.range(Xn(pe),An(Be),Xn(Ie),An(ve)),Ze=[];for(const lt of Oe){const ot=je.points[lt];Ze.push(ot.numPoints?Jr(ot):this.points[ot.index])}return Ze}getChildren(Z){const re=this._getOriginId(Z),pe=this._getOriginZoom(Z),ve="No cluster with the specified id.",Ie=this.trees[pe];if(!Ie)throw new Error(ve);const Be=Ie.points[re];if(!Be)throw new Error(ve);const je=this.options.radius/(this.options.extent*Math.pow(2,pe-1)),Oe=Ie.within(Be.x,Be.y,je),Ze=[];for(const lt of Oe){const ot=Ie.points[lt];ot.parentId===Z&&Ze.push(ot.numPoints?Jr(ot):this.points[ot.index])}if(0===Ze.length)throw new Error(ve);return Ze}getLeaves(Z,re,pe){const ve=[];return this._appendLeaves(ve,Z,re=re||10,pe=pe||0,0),ve}getTile(Z,re,pe){const ve=this.trees[this._limitZoom(Z)],Ie=Math.pow(2,Z),{extent:Be,radius:je}=this.options,Oe=je/Be,Ze=(pe-Oe)/Ie,lt=(pe+1+Oe)/Ie,ot={features:[]};return this._addTileFeatures(ve.range((re-Oe)/Ie,Ze,(re+1+Oe)/Ie,lt),ve.points,re,pe,Ie,ot),0===re&&this._addTileFeatures(ve.range(1-Oe/Ie,Ze,1,lt),ve.points,Ie,pe,Ie,ot),re===Ie-1&&this._addTileFeatures(ve.range(0,Ze,Oe/Ie,lt),ve.points,-1,pe,Ie,ot),ot.features.length?ot:null}getClusterExpansionZoom(Z){let re=this._getOriginZoom(Z)-1;for(;re<=this.options.maxZoom;){const pe=this.getChildren(Z);if(re++,1!==pe.length)break;Z=pe[0].properties.cluster_id}return re}_appendLeaves(Z,re,pe,ve,Ie){const Be=this.getChildren(re);for(const je of Be){const Oe=je.properties;if(Oe&&Oe.cluster?Ie+Oe.point_count<=ve?Ie+=Oe.point_count:Ie=this._appendLeaves(Z,Oe.cluster_id,pe,ve,Ie):Ie<ve?Ie++:Z.push(je),Z.length===pe)break}return Ie}_addTileFeatures(Z,re,pe,ve,Ie,Be){for(const je of Z){const Oe=re[je],Ze=Oe.numPoints;let lt,ot,mt;if(Ze)lt=ii(Oe),ot=Oe.x,mt=Oe.y;else{const Yt=this.points[Oe.index];lt=Yt.properties,ot=Xn(Yt.geometry.coordinates[0]),mt=An(Yt.geometry.coordinates[1])}const Qt={type:1,geometry:[[Math.round(this.options.extent*(ot*Ie-pe)),Math.round(this.options.extent*(mt*Ie-ve))]],tags:lt};let Gt;Ze?Gt=Oe.id:this.options.generateId?Gt=Oe.index:this.points[Oe.index].id&&(Gt=this.points[Oe.index].id),void 0!==Gt&&(Qt.id=Gt),Be.features.push(Qt)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(+Z,this.options.maxZoom+1))}_cluster(Z,re){const pe=[],{radius:ve,extent:Ie,reduce:Be,minPoints:je}=this.options,Oe=ve/(Ie*Math.pow(2,re));for(let Ze=0;Ze<Z.length;Ze++){const lt=Z[Ze];if(lt.zoom<=re)continue;lt.zoom=re;const ot=this.trees[re+1],mt=ot.within(lt.x,lt.y,Oe),Qt=lt.numPoints||1;let Gt=Qt;for(const Yt of mt){const sn=ot.points[Yt];sn.zoom>re&&(Gt+=sn.numPoints||1)}if(Gt>Qt&&Gt>=je){let Yt=lt.x*Qt,sn=lt.y*Qt,Mn=Be&&Qt>1?this._map(lt,!0):null;const xn=(Ze<<5)+(re+1)+this.points.length;for(const Kn of mt){const tr=ot.points[Kn];if(tr.zoom<=re)continue;tr.zoom=re;const Wn=tr.numPoints||1;Yt+=tr.x*Wn,sn+=tr.y*Wn,tr.parentId=xn,Be&&(Mn||(Mn=this._map(lt,!0)),Be(Mn,this._map(tr)))}lt.parentId=xn,pe.push(Ko(Yt/Gt,sn/Gt,xn,Gt,Mn))}else if(pe.push(lt),Gt>1)for(const Yt of mt){const sn=ot.points[Yt];sn.zoom<=re||(sn.zoom=re,pe.push(sn))}}return pe}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,re){if(Z.numPoints)return re?Ci({},Z.properties):Z.properties;const pe=this.points[Z.index].properties,ve=this.options.map(pe);return re&&ve===pe?Ci({},ve):ve}}function Ko(me,Z,re,pe,ve){return{x:hs(me),y:hs(Z),zoom:1/0,id:re,parentId:-1,numPoints:pe,properties:ve}}function ji(me,Z){const[re,pe]=me.geometry.coordinates;return{x:hs(Xn(re)),y:hs(An(pe)),zoom:1/0,index:Z,parentId:-1}}function Jr(me){return{type:"Feature",id:me.id,properties:ii(me),geometry:{type:"Point",coordinates:[(Z=me.x,360*(Z-.5)),Lr(me.y)]}};var Z}function ii(me){const Z=me.numPoints,re=Z>=1e4?`${Math.round(Z/1e3)}k`:Z>=1e3?Math.round(Z/100)/10+"k":Z;return Ci(Ci({},me.properties),{cluster:!0,cluster_id:me.id,point_count:Z,point_count_abbreviated:re})}function Xn(me){return me/360+.5}function An(me){const Z=Math.sin(me*Math.PI/180),re=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return re<0?0:re>1?1:re}function Lr(me){const Z=(180-360*me)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function Ci(me,Z){for(const re in Z)me[re]=Z[re];return me}function hr(me){return me.x}function Ji(me){return me.y}function Uo(me,Z,re,pe){for(var ve,Ie=pe,Be=re-Z>>1,je=re-Z,Oe=me[Z],Ze=me[Z+1],lt=me[re],ot=me[re+1],mt=Z+3;mt<re;mt+=3){var Qt=pn(me[mt],me[mt+1],Oe,Ze,lt,ot);if(Qt>Ie)ve=mt,Ie=Qt;else if(Qt===Ie){var Gt=Math.abs(mt-Be);Gt<je&&(ve=mt,je=Gt)}}Ie>pe&&(ve-Z>3&&Uo(me,Z,ve,pe),me[ve+2]=Ie,re-ve>3&&Uo(me,ve,re,pe))}function pn(me,Z,re,pe,ve,Ie){var Be=ve-re,je=Ie-pe;if(0!==Be||0!==je){var Oe=((me-re)*Be+(Z-pe)*je)/(Be*Be+je*je);Oe>1?(re=ve,pe=Ie):Oe>0&&(re+=Be*Oe,pe+=je*Oe)}return(Be=me-re)*Be+(je=Z-pe)*je}function wo(me,Z,re,pe){var ve={id:void 0===me?null:me,type:Z,geometry:re,tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ie){var Be=Ie.geometry,je=Ie.type;if("Point"===je||"MultiPoint"===je||"LineString"===je)Br(Ie,Be);else if("Polygon"===je||"MultiLineString"===je)for(var Oe=0;Oe<Be.length;Oe++)Br(Ie,Be[Oe]);else if("MultiPolygon"===je)for(Oe=0;Oe<Be.length;Oe++)for(var Ze=0;Ze<Be[Oe].length;Ze++)Br(Ie,Be[Oe][Ze])}(ve),ve}function Br(me,Z){for(var re=0;re<Z.length;re+=3)me.minX=Math.min(me.minX,Z[re]),me.minY=Math.min(me.minY,Z[re+1]),me.maxX=Math.max(me.maxX,Z[re]),me.maxY=Math.max(me.maxY,Z[re+1])}function $i(me,Z,re,pe){if(Z.geometry){var ve=Z.geometry.coordinates,Ie=Z.geometry.type,Be=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2),je=[],Oe=Z.id;if(re.promoteId?Oe=Z.properties[re.promoteId]:re.generateId&&(Oe=pe||0),"Point"===Ie)Jo(ve,je);else if("MultiPoint"===Ie)for(var Ze=0;Ze<ve.length;Ze++)Jo(ve[Ze],je);else if("LineString"===Ie)st(ve,je,Be,!1);else if("MultiLineString"===Ie){if(re.lineMetrics){for(Ze=0;Ze<ve.length;Ze++)st(ve[Ze],je=[],Be,!1),me.push(wo(Oe,"LineString",je,Z.properties));return}Ne(ve,je,Be,!1)}else if("Polygon"===Ie)Ne(ve,je,Be,!0);else{if("MultiPolygon"!==Ie){if("GeometryCollection"===Ie){for(Ze=0;Ze<Z.geometry.geometries.length;Ze++)$i(me,{id:Oe,geometry:Z.geometry.geometries[Ze],properties:Z.properties},re,pe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ze=0;Ze<ve.length;Ze++){var lt=[];Ne(ve[Ze],lt,Be,!0),je.push(lt)}}me.push(wo(Oe,Ie,je,Z.properties))}}function Jo(me,Z){Z.push(Fe(me[0])),Z.push(At(me[1])),Z.push(0)}function st(me,Z,re,pe){for(var ve,Ie,Be=0,je=0;je<me.length;je++){var Oe=Fe(me[je][0]),Ze=At(me[je][1]);Z.push(Oe),Z.push(Ze),Z.push(0),je>0&&(Be+=pe?(ve*Ze-Oe*Ie)/2:Math.sqrt(Math.pow(Oe-ve,2)+Math.pow(Ze-Ie,2))),ve=Oe,Ie=Ze}var lt=Z.length-3;Z[2]=1,Uo(Z,0,lt,re),Z[lt+2]=1,Z.size=Math.abs(Be),Z.start=0,Z.end=Z.size}function Ne(me,Z,re,pe){for(var ve=0;ve<me.length;ve++){var Ie=[];st(me[ve],Ie,re,pe),Z.push(Ie)}}function Fe(me){return me/360+.5}function At(me){var Z=Math.sin(me*Math.PI/180),re=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return re<0?0:re>1?1:re}function Je(me,Z,re,pe,ve,Ie,Be,je){if(pe/=Z,Ie>=(re/=Z)&&Be<pe)return me;if(Be<re||Ie>=pe)return null;for(var Oe=[],Ze=0;Ze<me.length;Ze++){var lt=me[Ze],ot=lt.geometry,mt=lt.type,Qt=0===ve?lt.minX:lt.minY,Gt=0===ve?lt.maxX:lt.maxY;if(Qt>=re&&Gt<pe)Oe.push(lt);else if(!(Gt<re||Qt>=pe)){var Yt=[];if("Point"===mt||"MultiPoint"===mt)Zt(ot,Yt,re,pe,ve);else if("LineString"===mt)Wt(ot,Yt,re,pe,ve,!1,je.lineMetrics);else if("MultiLineString"===mt)_n(ot,Yt,re,pe,ve,!1);else if("Polygon"===mt)_n(ot,Yt,re,pe,ve,!0);else if("MultiPolygon"===mt)for(var sn=0;sn<ot.length;sn++){var Mn=[];_n(ot[sn],Mn,re,pe,ve,!0),Mn.length&&Yt.push(Mn)}if(Yt.length){if(je.lineMetrics&&"LineString"===mt){for(sn=0;sn<Yt.length;sn++)Oe.push(wo(lt.id,mt,Yt[sn],lt.tags));continue}"LineString"!==mt&&"MultiLineString"!==mt||(1===Yt.length?(mt="LineString",Yt=Yt[0]):mt="MultiLineString"),"Point"!==mt&&"MultiPoint"!==mt||(mt=3===Yt.length?"Point":"MultiPoint"),Oe.push(wo(lt.id,mt,Yt,lt.tags))}}}return Oe.length?Oe:null}function Zt(me,Z,re,pe,ve){for(var Ie=0;Ie<me.length;Ie+=3){var Be=me[Ie+ve];Be>=re&&Be<=pe&&(Z.push(me[Ie]),Z.push(me[Ie+1]),Z.push(me[Ie+2]))}}function Wt(me,Z,re,pe,ve,Ie,Be){for(var je,Oe,Ze=Xt(me),lt=0===ve?Nn:Nr,ot=me.start,mt=0;mt<me.length-3;mt+=3){var Qt=me[mt],Gt=me[mt+1],Yt=me[mt+2],sn=me[mt+3],Mn=me[mt+4],xn=0===ve?Qt:Gt,Kn=0===ve?sn:Mn,tr=!1;Be&&(je=Math.sqrt(Math.pow(Qt-sn,2)+Math.pow(Gt-Mn,2))),xn<re?Kn>re&&(Oe=lt(Ze,Qt,Gt,sn,Mn,re),Be&&(Ze.start=ot+je*Oe)):xn>pe?Kn<pe&&(Oe=lt(Ze,Qt,Gt,sn,Mn,pe),Be&&(Ze.start=ot+je*Oe)):Sr(Ze,Qt,Gt,Yt),Kn<re&&xn>=re&&(Oe=lt(Ze,Qt,Gt,sn,Mn,re),tr=!0),Kn>pe&&xn<=pe&&(Oe=lt(Ze,Qt,Gt,sn,Mn,pe),tr=!0),!Ie&&tr&&(Be&&(Ze.end=ot+je*Oe),Z.push(Ze),Ze=Xt(me)),Be&&(ot+=je)}var Wn=me.length-3;Qt=me[Wn],Gt=me[Wn+1],Yt=me[Wn+2],(xn=0===ve?Qt:Gt)>=re&&xn<=pe&&Sr(Ze,Qt,Gt,Yt),Wn=Ze.length-3,Ie&&Wn>=3&&(Ze[Wn]!==Ze[0]||Ze[Wn+1]!==Ze[1])&&Sr(Ze,Ze[0],Ze[1],Ze[2]),Ze.length&&Z.push(Ze)}function Xt(me){var Z=[];return Z.size=me.size,Z.start=me.start,Z.end=me.end,Z}function _n(me,Z,re,pe,ve,Ie){for(var Be=0;Be<me.length;Be++)Wt(me[Be],Z,re,pe,ve,Ie,!1)}function Sr(me,Z,re,pe){me.push(Z),me.push(re),me.push(pe)}function Nn(me,Z,re,pe,ve,Ie){var Be=(Ie-Z)/(pe-Z);return me.push(Ie),me.push(re+(ve-re)*Be),me.push(1),Be}function Nr(me,Z,re,pe,ve,Ie){var Be=(Ie-re)/(ve-re);return me.push(Z+(pe-Z)*Be),me.push(Ie),me.push(1),Be}function kn(me,Z){for(var re=[],pe=0;pe<me.length;pe++){var ve,Ie=me[pe],Be=Ie.type;if("Point"===Be||"MultiPoint"===Be||"LineString"===Be)ve=On(Ie.geometry,Z);else if("MultiLineString"===Be||"Polygon"===Be){ve=[];for(var je=0;je<Ie.geometry.length;je++)ve.push(On(Ie.geometry[je],Z))}else if("MultiPolygon"===Be)for(ve=[],je=0;je<Ie.geometry.length;je++){for(var Oe=[],Ze=0;Ze<Ie.geometry[je].length;Ze++)Oe.push(On(Ie.geometry[je][Ze],Z));ve.push(Oe)}re.push(wo(Ie.id,Be,ve,Ie.tags))}return re}function On(me,Z){var re=[];re.size=me.size,void 0!==me.start&&(re.start=me.start,re.end=me.end);for(var pe=0;pe<me.length;pe+=3)re.push(me[pe]+Z,me[pe+1],me[pe+2]);return re}function rn(me,Z){if(me.transformed)return me;var re,pe,ve,Ie=1<<me.z,Be=me.x,je=me.y;for(re=0;re<me.features.length;re++){var Oe=me.features[re],Ze=Oe.geometry,lt=Oe.type;if(Oe.geometry=[],1===lt)for(pe=0;pe<Ze.length;pe+=2)Oe.geometry.push(ci(Ze[pe],Ze[pe+1],Z,Ie,Be,je));else for(pe=0;pe<Ze.length;pe++){var ot=[];for(ve=0;ve<Ze[pe].length;ve+=2)ot.push(ci(Ze[pe][ve],Ze[pe][ve+1],Z,Ie,Be,je));Oe.geometry.push(ot)}}return me.transformed=!0,me}function ci(me,Z,re,pe,ve,Ie){return[Math.round(re*(me*pe-ve)),Math.round(re*(Z*pe-Ie))]}function Gn(me,Z,re,pe,ve){for(var Ie=Z===ve.maxZoom?0:ve.tolerance/((1<<Z)*ve.extent),Be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:re,y:pe,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},je=0;je<me.length;je++){Be.numFeatures++,Qr(Be,me[je],Ie,ve);var Oe=me[je].minX,Ze=me[je].minY,lt=me[je].maxX,ot=me[je].maxY;Oe<Be.minX&&(Be.minX=Oe),Ze<Be.minY&&(Be.minY=Ze),lt>Be.maxX&&(Be.maxX=lt),ot>Be.maxY&&(Be.maxY=ot)}return Be}function Qr(me,Z,re,pe){var ve=Z.geometry,Ie=Z.type,Be=[];if("Point"===Ie||"MultiPoint"===Ie)for(var je=0;je<ve.length;je+=3)Be.push(ve[je]),Be.push(ve[je+1]),me.numPoints++,me.numSimplified++;else if("LineString"===Ie)di(Be,ve,me,re,!1,!1);else if("MultiLineString"===Ie||"Polygon"===Ie)for(je=0;je<ve.length;je++)di(Be,ve[je],me,re,"Polygon"===Ie,0===je);else if("MultiPolygon"===Ie)for(var Oe=0;Oe<ve.length;Oe++){var Ze=ve[Oe];for(je=0;je<Ze.length;je++)di(Be,Ze[je],me,re,!0,0===je)}if(Be.length){var lt=Z.tags||null;if("LineString"===Ie&&pe.lineMetrics){for(var ot in lt={},Z.tags)lt[ot]=Z.tags[ot];lt.mapbox_clip_start=ve.start/ve.size,lt.mapbox_clip_end=ve.end/ve.size}var mt={geometry:Be,type:"Polygon"===Ie||"MultiPolygon"===Ie?3:"LineString"===Ie||"MultiLineString"===Ie?2:1,tags:lt};null!==Z.id&&(mt.id=Z.id),me.features.push(mt)}}function di(me,Z,re,pe,ve,Ie){var Be=pe*pe;if(pe>0&&Z.size<(ve?Be:pe))re.numPoints+=Z.length/3;else{for(var je=[],Oe=0;Oe<Z.length;Oe+=3)(0===pe||Z[Oe+2]>Be)&&(re.numSimplified++,je.push(Z[Oe]),je.push(Z[Oe+1])),re.numPoints++;ve&&function(Ze,lt){for(var ot=0,mt=0,Qt=Ze.length,Gt=Qt-2;mt<Qt;Gt=mt,mt+=2)ot+=(Ze[mt]-Ze[Gt])*(Ze[mt+1]+Ze[Gt+1]);if(ot>0===lt)for(mt=0,Qt=Ze.length;mt<Qt/2;mt+=2){var Yt=Ze[mt],sn=Ze[mt+1];Ze[mt]=Ze[Qt-2-mt],Ze[mt+1]=Ze[Qt-1-mt],Ze[Qt-2-mt]=Yt,Ze[Qt-1-mt]=sn}}(je,Ie),me.push(je)}}function Qn(me,Z){var re=(Z=this.options=function(ve,Ie){for(var Be in Ie)ve[Be]=Ie[Be];return ve}(Object.create(this.options),Z)).debug;if(re&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");var ve,Ie,Be,je,Oe,Ze,pe=function(ve,Ie){var Be=[];if("FeatureCollection"===ve.type)for(var je=0;je<ve.features.length;je++)$i(Be,ve.features[je],Ie,je);else $i(Be,"Feature"===ve.type?ve:{geometry:ve},Ie);return Be}(me,Z);this.tiles={},this.tileCoords=[],re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ve=pe,Ie=Z,Be=Ie.buffer/Ie.extent,je=ve,Oe=Je(ve,1,-1-Be,Be,0,-1,2,Ie),Ze=Je(ve,1,1-Be,2+Be,0,-1,2,Ie),(Oe||Ze)&&(je=Je(ve,1,-Be,1+Be,0,-1,2,Ie)||[],Oe&&(je=kn(Oe,1).concat(je)),Ze&&(je=je.concat(kn(Ze,-1)))),pe=je).length&&this.splitTile(pe,0,0,0),re&&(pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Qi(me,Z,re){return 32*((1<<me)*re+Z)+me}function jo(me,Z){const re=me.tileID.canonical;if(!this._geoJSONIndex)return Z(null,null);const pe=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!pe)return Z(null,null);const ve=new Vt(pe.features);let Ie=jt(ve);0===Ie.byteOffset&&Ie.byteLength===Ie.buffer.byteLength||(Ie=new Uint8Array(Ie)),Z(null,{vectorTile:ve,rawData:Ie.buffer})}Qn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Qn.prototype.splitTile=function(me,Z,re,pe,ve,Ie,Be){for(var je=[me,Z,re,pe],Oe=this.options,Ze=Oe.debug;je.length;){pe=je.pop(),re=je.pop(),Z=je.pop(),me=je.pop();var lt=1<<Z,ot=Qi(Z,re,pe),mt=this.tiles[ot];if(!mt&&(Ze>1&&console.time("creation"),mt=this.tiles[ot]=Gn(me,Z,re,pe,Oe),this.tileCoords.push({z:Z,x:re,y:pe}),Ze)){Ze>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,re,pe,mt.numFeatures,mt.numPoints,mt.numSimplified),console.timeEnd("creation"));var Qt="z"+Z;this.stats[Qt]=(this.stats[Qt]||0)+1,this.total++}if(mt.source=me,ve){if(Z===Oe.maxZoom||Z===ve)continue;var Gt=1<<ve-Z;if(re!==Math.floor(Ie/Gt)||pe!==Math.floor(Be/Gt))continue}else if(Z===Oe.indexMaxZoom||mt.numPoints<=Oe.indexMaxPoints)continue;if(mt.source=null,0!==me.length){Ze>1&&console.time("clipping");var Yt,sn,Mn,xn,Kn,tr,Wn=.5*Oe.buffer/Oe.extent,eo=.5-Wn,ei=.5+Wn,Nt=1+Wn;Yt=sn=Mn=xn=null,Kn=Je(me,lt,re-Wn,re+ei,0,mt.minX,mt.maxX,Oe),tr=Je(me,lt,re+eo,re+Nt,0,mt.minX,mt.maxX,Oe),me=null,Kn&&(Yt=Je(Kn,lt,pe-Wn,pe+ei,1,mt.minY,mt.maxY,Oe),sn=Je(Kn,lt,pe+eo,pe+Nt,1,mt.minY,mt.maxY,Oe),Kn=null),tr&&(Mn=Je(tr,lt,pe-Wn,pe+ei,1,mt.minY,mt.maxY,Oe),xn=Je(tr,lt,pe+eo,pe+Nt,1,mt.minY,mt.maxY,Oe),tr=null),Ze>1&&console.timeEnd("clipping"),je.push(Yt||[],Z+1,2*re,2*pe),je.push(sn||[],Z+1,2*re,2*pe+1),je.push(Mn||[],Z+1,2*re+1,2*pe),je.push(xn||[],Z+1,2*re+1,2*pe+1)}}},Qn.prototype.getTile=function(me,Z,re){var pe=this.options,ve=pe.extent,Ie=pe.debug;if(me<0||me>24)return null;var Be=1<<me,je=Qi(me,Z=(Z%Be+Be)%Be,re);if(this.tiles[je])return rn(this.tiles[je],ve);Ie>1&&console.log("drilling down to z%d-%d-%d",me,Z,re);for(var Oe,Ze=me,lt=Z,ot=re;!Oe&&Ze>0;)Ze--,lt=Math.floor(lt/2),ot=Math.floor(ot/2),Oe=this.tiles[Qi(Ze,lt,ot)];return Oe&&Oe.source?(Ie>1&&console.log("found parent tile z%d-%d-%d",Ze,lt,ot),Ie>1&&console.time("drilling down"),this.splitTile(Oe.source,Ze,lt,ot,me,Z,re),Ie>1&&console.timeEnd("drilling down"),this.tiles[je]?rn(this.tiles[je],ve):null):null};class Co extends h.VectorTileWorkerSource{constructor(Z,re,pe,ve,Ie){super(Z,re,pe,ve,jo),Ie&&(this.loadGeoJSON=Ie)}loadData(Z,re){const pe=Z&&Z.request,ve=pe&&pe.collectResourceTiming;this.loadGeoJSON(Z,(Ie,Be)=>{if(Ie||!Be)return re(Ie);if("object"!=typeof Be)return re(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{ge(Be,!0);try{if(Z.filter){const Oe=h.createExpression(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Oe.result)throw new Error(Oe.value.map(lt=>`${lt.key}: ${lt.message}`).join(", "));const Ze=Be.features.filter(lt=>Oe.value.evaluate({zoom:0},lt));Be={type:"FeatureCollection",features:Ze}}this._geoJSONIndex=Z.cluster?new Fo(function({superclusterOptions:Oe,clusterProperties:Ze}){if(!Ze||!Oe)return Oe;const lt={},ot={},mt={accumulated:null,zoom:0},Qt={properties:null},Gt=Object.keys(Ze);for(const Yt of Gt){const[sn,Mn]=Ze[Yt],xn=h.createExpression(Mn),Kn=h.createExpression("string"==typeof sn?[sn,["accumulated"],["get",Yt]]:sn);lt[Yt]=xn.value,ot[Yt]=Kn.value}return Oe.map=Yt=>{Qt.properties=Yt;const sn={};for(const Mn of Gt)sn[Mn]=lt[Mn].evaluate(mt,Qt);return sn},Oe.reduce=(Yt,sn)=>{Qt.properties=sn;for(const Mn of Gt)mt.accumulated=Yt[Mn],Yt[Mn]=ot[Mn].evaluate(mt,Qt)},Oe}(Z)).load(Be.features):new Qn(Oe=Be,Z.geojsonVtOptions)}catch(Oe){return re(Oe)}this.loaded={};const je={};if(ve){const Oe=h.getPerformanceMeasurement(pe);Oe&&(je.resourceTiming={},je.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Oe)))}re(null,je)}var Oe})}reloadTile(Z,re){const pe=this.loaded;return pe&&pe[Z.uid]?super.reloadTile(Z,re):this.loadTile(Z,re)}loadGeoJSON(Z,re){if(Z.request)h.getJSON(Z.request,re);else{if("string"!=typeof Z.data)return re(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));try{return re(null,JSON.parse(Z.data))}catch(pe){return re(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Z,re){try{re(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(pe){re(pe)}}getClusterChildren(Z,re){try{re(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(pe){re(pe)}}getClusterLeaves(Z,re){try{re(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(pe){re(pe)}}}class zn{constructor(Z){this.self=Z,this.actor=new h.Actor(Z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=h.getProjection({name:"mercator"}),this.workerSourceTypes={vector:h.VectorTileWorkerSource,geojson:Co},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(re,pe)=>{if(this.workerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.workerSourceTypes[re]=pe},this.self.registerRTLTextPlugin=re=>{if(h.plugin.isParsed())throw new Error("RTL text plugin already registered.");h.plugin.applyArabicShaping=re.applyArabicShaping,h.plugin.processBidirectionalText=re.processBidirectionalText,h.plugin.processStyledBidirectionalText=re.processStyledBidirectionalText}}clearCaches(Z,re,pe){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.workerSources[Z],delete this.demWorkerSources[Z],pe()}checkIfReady(Z,re,pe){pe()}setReferrer(Z,re){this.referrer=re}spriteLoaded(Z,re){this.isSpriteLoaded[Z]=re;for(const pe in this.workerSources[Z]){const ve=this.workerSources[Z][pe];for(const Ie in ve)ve[Ie]instanceof h.VectorTileWorkerSource&&(ve[Ie].isSpriteLoaded=re,ve[Ie].fire(new h.Event("isSpriteLoaded")))}}setImages(Z,re,pe){this.availableImages[Z]=re;for(const ve in this.workerSources[Z]){const Ie=this.workerSources[Z][ve];for(const Be in Ie)Ie[Be].availableImages=re}pe()}enableTerrain(Z,re,pe){this.terrain=re,pe()}setProjection(Z,re){this.projections[Z]=h.getProjection(re)}setLayers(Z,re,pe){this.getLayerIndex(Z).replace(re),pe()}updateLayers(Z,re,pe){this.getLayerIndex(Z).update(re.layers,re.removedIds),pe()}loadTile(Z,re,pe){const ve=this.enableTerrain?h.extend({enableTerrain:this.terrain},re):re;ve.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,re.type,re.source).loadTile(ve,pe)}loadDEMTile(Z,re,pe){const ve=this.enableTerrain?h.extend({buildQuadTree:this.terrain},re):re;this.getDEMWorkerSource(Z,re.source).loadTile(ve,pe)}reloadTile(Z,re,pe){const ve=this.enableTerrain?h.extend({enableTerrain:this.terrain},re):re;ve.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,re.type,re.source).reloadTile(ve,pe)}abortTile(Z,re,pe){this.getWorkerSource(Z,re.type,re.source).abortTile(re,pe)}removeTile(Z,re,pe){this.getWorkerSource(Z,re.type,re.source).removeTile(re,pe)}removeSource(Z,re,pe){if(!this.workerSources[Z]||!this.workerSources[Z][re.type]||!this.workerSources[Z][re.type][re.source])return;const ve=this.workerSources[Z][re.type][re.source];delete this.workerSources[Z][re.type][re.source],void 0!==ve.removeSource?ve.removeSource(re,pe):pe()}loadWorkerSource(Z,re,pe){try{this.self.importScripts(re.url),pe()}catch(ve){pe(ve.toString())}}syncRTLPluginState(Z,re,pe){try{h.plugin.setState(re);const ve=h.plugin.getPluginURL();if(h.plugin.isLoaded()&&!h.plugin.isParsed()&&null!=ve){this.self.importScripts(ve);const Ie=h.plugin.isParsed();pe(Ie?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ve}`),Ie)}}catch(ve){pe(ve.toString())}}getAvailableImages(Z){let re=this.availableImages[Z];return re||(re=[]),re}getLayerIndex(Z){let re=this.layerIndexes[Z];return re||(re=this.layerIndexes[Z]=new ze),re}getWorkerSource(Z,re,pe){return this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][re]||(this.workerSources[Z][re]={}),this.workerSources[Z][re][pe]||(this.workerSources[Z][re][pe]=new this.workerSourceTypes[re]({send:(ve,Ie,Be,je,Oe,Ze)=>{this.actor.send(ve,Ie,Be,Z,Oe,Ze)},scheduler:this.actor.scheduler},this.getLayerIndex(Z),this.getAvailableImages(Z),this.isSpriteLoaded[Z])),this.workerSources[Z][re][pe]}getDEMWorkerSource(Z,re){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][re]||(this.demWorkerSources[Z][re]=new qe),this.demWorkerSources[Z][re]}enforceCacheSizeLimit(Z,re){h.enforceCacheSizeLimit(re)}getWorkerPerformanceMetrics(Z,re,pe){pe(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new zn(self)),zn}),y(0,function(h){var Qe=nt;function nt(f){return i=f,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,v,b=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(b);try{v=new Worker(T),m=!0}catch(R){m=!1}return v&&v.terminate(),URL.revokeObjectURL(T),m}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var m=document.createElement("canvas");m.width=m.height=1;var v=m.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===m.width}()||(void 0===ze[c=i&&i.failIfMajorPerformanceCaveat]&&(ze[c]=function(m){var v,T,R,z,b=(T=m,R=document.createElement("canvas"),(z=Object.create(nt.webGLContextAttributes)).failIfMajorPerformanceCaveat=T,R.getContext("webgl",z)||R.getContext("experimental-webgl",z));if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch(T){return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),!0===b.getShaderParameter(v,b.COMPILE_STATUS))}(c)),!ze[c]||document.documentMode));var i,c}var ze={};function Me(f,i){var c=i[0],m=i[1],v=i[2],b=i[3],T=c*b-v*m;return T?(f[0]=b*(T=1/T),f[1]=-m*T,f[2]=-v*T,f[3]=c*T,f):null}function qe(f,i){if(Array.isArray(f)){if(!Array.isArray(i)||f.length!==i.length)return!1;for(let c=0;c<f.length;c++)if(!qe(f[c],i[c]))return!1;return!0}if("object"==typeof f&&null!==f&&null!==i){if("object"!=typeof i||Object.keys(f).length!==Object.keys(i).length)return!1;for(const c in f)if(!qe(f[c],i[c]))return!1;return!0}return f===i}nt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ge={create:function(f,i,c){const m=h.window.document.createElement(f);return void 0!==i&&(m.className=i),c&&c.appendChild(m),m},createSVG:function(f,i,c){const m=h.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const v of Object.keys(i))m.setAttributeNS(null,v,i[v]);return c&&c.appendChild(m),m}},Ye=h.window.document&&h.window.document.documentElement.style,Xe=Ye&&void 0!==Ye.userSelect?"userSelect":"WebkitUserSelect";let Ct;ge.disableDrag=function(){Ye&&Xe&&(Ct=Ye[Xe],Ye[Xe]="none")},ge.enableDrag=function(){Ye&&Xe&&(Ye[Xe]=Ct)};const _t=function(f){f.preventDefault(),f.stopPropagation(),h.window.removeEventListener("click",_t,!0)};function Vt(f,i,c){const m=f.offsetWidth===i.width?1:f.offsetWidth/i.width;return new h.pointGeometry((c.clientX-i.left)*m,(c.clientY-i.top)*m)}function ut(f){const{userImage:i}=f;return!!(i&&i.render&&i.render())&&(f.data.replace(new Uint8Array(i.data.buffer)),!0)}ge.suppressClick=function(){h.window.addEventListener("click",_t,!0),h.window.setTimeout(()=>{h.window.removeEventListener("click",_t,!0)},0)},ge.mousePos=function(f,i){const c=f.getBoundingClientRect();return Vt(f,c,i)},ge.touchPos=function(f,i){const c=f.getBoundingClientRect(),m=[];for(let v=0;v<i.length;v++)m.push(Vt(f,c,i[v]));return m},ge.mouseButton=function(f){return void 0!==h.window.InstallTrigger&&2===f.button&&f.ctrlKey&&h.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button};class qt extends h.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:c,callback:m}of this.requestors)this._notify(c,m);this.requestors=[]}}getImage(i){return this.images[i]}addImage(i,c){this._validate(i,c)&&(this.images[i]=c)}_validate(i,c){let m=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new h.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),m=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new h.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),m=!1),this._validateContent(c.content,c)||(this.fire(new h.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),m=!1),m}_validateStretch(i,c){if(!i)return!0;let m=0;for(const v of i){if(v[0]<m||v[1]<v[0]||c<v[1])return!1;m=v[1]}return!0}_validateContent(i,c){return!(i&&(4!==i.length||i[0]<0||c.data.width<i[0]||i[1]<0||c.data.height<i[1]||i[2]<0||c.data.width<i[2]||i[3]<0||c.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,c){c.version=this.images[i].version+1,this.images[i]=c,this.updatedImages[i]=!0}removeImage(i){const c=this.images[i];delete this.images[i],delete this.patterns[i],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,c){let m=!0;if(!this.isLoaded())for(const v of i)this.images[v]||(m=!1);this.isLoaded()||m?this._notify(i,c):this.requestors.push({ids:i,callback:c})}_notify(i,c){const m={};for(const v of i){this.images[v]||this.fire(new h.Event("styleimagemissing",{id:v}));const b=this.images[v];b?m[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:h.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,m)}getPixelSize(){const{width:i,height:c}=this.atlasImage;return{width:i,height:c}}getPattern(i){const c=this.patterns[i],m=this.getImage(i);if(!m)return null;if(c&&c.position.version===m.version)return c.position;if(c)c.position.version=m.version;else{const v={w:m.data.width+2,h:m.data.height+2,x:0,y:0},b=new h.ImagePosition(v,m);this.patterns[i]={bin:v,position:b}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const c=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new h.Texture(i,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const b in this.patterns)i.push(this.patterns[b].bin);const{w:c,h:m}=h.potpack(i),v=this.atlasImage;v.resize({width:c||1,height:m||1});for(const b in this.patterns){const{bin:T}=this.patterns[b],R=T.x+1,z=T.y+1,j=this.images[b].data,q=j.width,Q=j.height;h.RGBAImage.copy(j,v,{x:0,y:0},{x:R,y:z},{width:q,height:Q}),h.RGBAImage.copy(j,v,{x:0,y:Q-1},{x:R,y:z-1},{width:q,height:1}),h.RGBAImage.copy(j,v,{x:0,y:0},{x:R,y:z+Q},{width:q,height:1}),h.RGBAImage.copy(j,v,{x:q-1,y:0},{x:R-1,y:z},{width:1,height:Q}),h.RGBAImage.copy(j,v,{x:0,y:0},{x:R+q,y:z},{width:1,height:Q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const c of i){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const m=this.images[c];ut(m)&&this.updateImage(c,m)}}}const Dn=new h.Properties({anchor:new h.DataConstantProperty(h.spec.light.anchor),position:new class{constructor(){this.specification=h.spec.light.position}possiblyEvaluate(f,i){return function([c,m,v]){const b=h.degToRad(m+90),T=h.degToRad(v);return{x:c*Math.cos(b)*Math.sin(T),y:c*Math.sin(b)*Math.sin(T),z:c*Math.cos(T),azimuthal:m,polar:v}}(f.expression.evaluate(i))}interpolate(f,i,c){return{x:h.number(f.x,i.x,c),y:h.number(f.y,i.y,c),z:h.number(f.z,i.z,c),azimuthal:h.number(f.azimuthal,i.azimuthal,c),polar:h.number(f.polar,i.polar,c)}}},color:new h.DataConstantProperty(h.spec.light.color),intensity:new h.DataConstantProperty(h.spec.light.intensity)}),cn="-transition";class jt extends h.Evented{constructor(i){super(),this._transitionable=new h.Transitionable(Dn),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,c={}){if(!this._validate(h.validateLight,i,c))for(const m in i){const v=i[m];h.endsWith(m,cn)?this._transitionable.setTransition(m.slice(0,-cn.length),v):this._transitionable.setValue(m,v)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,c,m){return(!m||!1!==m.validate)&&h.emitValidationErrors(this,i.call(h.validateStyle,h.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}const vr=new h.Properties({source:new h.DataConstantProperty(h.spec.terrain.source),exaggeration:new h.DataConstantProperty(h.spec.terrain.exaggeration)}),hn="-transition";class Kr extends h.Evented{constructor(i,c){super(),this._transitionable=new h.Transitionable(vr),this.set(i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(i){for(const c in i){const m=i[c];h.endsWith(c,hn)?this._transitionable.setTransition(c.slice(0,-hn.length),m):this._transitionable.setValue(c,m)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}}function ao(f,i,c,m){const v=h.smoothstep(45,65,c),[b,T]=li(f,m),R=h.length(i);let z=1-Math.min(1,Math.exp((R-b)/(T-b)*-6));return z*=z*z,z=Math.min(1,1.00747*z),z*v*f.alpha}function li(f,i){const c=.5/Math.tan(.5*i);return[f.range[0]+c,f.range[1]+c]}const Jt=new h.Properties({range:new h.DataConstantProperty(h.spec.fog.range),color:new h.DataConstantProperty(h.spec.fog.color),"horizon-blend":new h.DataConstantProperty(h.spec.fog["horizon-blend"])}),qn="-transition";class Mr extends h.Evented{constructor(i,c){super(),this._transitionable=new h.Transitionable(Jt),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,c={}){if(!this._validate(h.validateFog,i,c))for(const m in i){const v=i[m];h.endsWith(m,qn)?this._transitionable.setTransition(m.slice(0,-qn.length),v):this._transitionable.setValue(m,v)}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return h.smoothstep(45,65,i)*c.a}getOpacityAtLatLng(i,c){return this._transform.projection.supportsFog?function(m,v,b){const T=h.MercatorCoordinate.fromLngLat(v),R=b.elevation?b.elevation.getAtPointOrZero(T):0,z=[T.x,T.y,R];return h.transformMat4(z,z,b.mercatorFogMatrix),ao(m,z,b.pitch,b._fov)}(this.state,i,c):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?li(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,c,m){return(!m||!1!==m.validate)&&h.emitValidationErrors(this,i.call(h.validateStyle,h.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}class In{constructor(i,c){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=h.uniqueId();const m=this.workerPool.acquire(this.id);for(let v=0;v<m.length;v++){const b=new In.Actor(m[v],c,this.id);b.name=`Worker ${v}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,c,m){h.asyncAll(this.actors,(v,b)=>{v.send(i,c,b)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function dn(f,i,c){return i*(h.EXTENT/(f.tileSize*Math.pow(2,c-f.tileID.overscaledZ)))}In.Actor=h.Actor;class Un{constructor(i,c,m){this.context=i;const v=i.gl;this.buffer=v.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const $t={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class lo{constructor(i,c,m,v){this.length=c.length,this.attributes=m,this.itemSize=c.bytesPerElement,this.dynamicDraw=v,this.context=i;const b=i.gl;this.buffer=b.createBuffer(),i.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,c){for(let m=0;m<this.attributes.length;m++){const v=c.attributes[this.attributes[m].name];void 0!==v&&i.enableVertexAttribArray(v)}}setVertexAttribPointers(i,c,m){for(let v=0;v<this.attributes.length;v++){const b=this.attributes[v],T=c.attributes[b.name];void 0!==T&&i.vertexAttribPointer(T,b.components,i[$t[b.type]],!1,this.itemSize,b.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ln{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ki extends Ln{getDefault(){return h.Color.transparent}set(i){const c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class hi extends Ln{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class co extends Ln{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Os extends Ln{getDefault(){return[!0,!0,!0,!0]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class hs extends Ln{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class bo extends Ln{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Fo extends Ln{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const c=this.current;(i.func!==c.func||i.ref!==c.ref||i.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Ko extends Ln{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class ji extends Ln{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=i,this.dirty=!1}}class Jr extends Ln{getDefault(){return[0,1]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class ii extends Ln{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=i,this.dirty=!1}}class Xn extends Ln{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class An extends Ln{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.BLEND):c.disable(c.BLEND),this.current=i,this.dirty=!1}}class Lr extends Ln{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Ci extends Ln{getDefault(){return h.Color.transparent}set(i){const c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class hr extends Ln{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Ji extends Ln{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=i,this.dirty=!1}}class Uo extends Ln{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class pn extends Ln{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class wo extends Ln{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class Br extends Ln{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class $i extends Ln{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Jo extends Ln{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class st extends Ln{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ne extends Ln{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Fe extends Ln{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class At extends Ln{getDefault(){return null}set(i){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Je extends Ln{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class Zt extends Ln{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Wt extends Ln{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Xt extends Ln{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class _n extends Ln{constructor(i,c){super(i),this.context=i,this.parent=c}getDefault(){return null}}class Sr extends _n{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Nn extends _n{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Nr extends Nn{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class kn{constructor(i,c,m,v){this.context=i,this.width=c,this.height=m;const b=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new Sr(i,b),v&&(this.depthAttachment=new Nn(i,b))}destroy(){const i=this.context.gl,c=this.colorAttachment.get();if(c&&i.deleteTexture(c),this.depthAttachment){const m=this.depthAttachment.get();m&&i.deleteRenderbuffer(m)}i.deleteFramebuffer(this.framebuffer)}}class On{constructor(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ki(this),this.clearDepth=new hi(this),this.clearStencil=new co(this),this.colorMask=new Os(this),this.depthMask=new hs(this),this.stencilMask=new bo(this),this.stencilFunc=new Fo(this),this.stencilOp=new Ko(this),this.stencilTest=new ji(this),this.depthRange=new Jr(this),this.depthTest=new ii(this),this.depthFunc=new Xn(this),this.blend=new An(this),this.blendFunc=new Lr(this),this.blendColor=new Ci(this),this.blendEquation=new hr(this),this.cullFace=new Ji(this),this.cullFaceSide=new Uo(this),this.frontFace=new pn(this),this.program=new wo(this),this.activeTexture=new Br(this),this.viewport=new $i(this),this.bindFramebuffer=new Jo(this),this.bindRenderbuffer=new st(this),this.bindTexture=new Ne(this),this.bindVertexBuffer=new Fe(this),this.bindElementBuffer=new At(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Je(this),this.pixelStoreUnpack=new Zt(this),this.pixelStoreUnpackPremultiplyAlpha=new Wt(this),this.pixelStoreUnpackFlipY=new Xt(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,c){return new Un(this,i,c)}createVertexBuffer(i,c,m){return new lo(this,i,c,m)}createRenderbuffer(i,c,m){const v=this.gl,b=v.createRenderbuffer();return this.bindRenderbuffer.set(b),v.renderbufferStorage(v.RENDERBUFFER,i,c,m),this.bindRenderbuffer.set(null),b}createFramebuffer(i,c,m){return new kn(this,i,c,m)}clear({color:i,depth:c,stencil:m}){const v=this.gl;let b=0;i&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==m&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),v.clear(b)}setCullFace(i){!1===i.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){qe(i.blendFunction,h.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class rn{constructor(i,c,m,v){this.screenBounds=i,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(b=>v.pointCoordinate3D(b)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(i,c){let m,v;if(i instanceof h.pointGeometry||"number"==typeof i[0]){const b=h.pointGeometry.convert(i);m=[h.pointGeometry.convert(i)],v=c.isPointAboveHorizon(b)}else{const b=h.pointGeometry.convert(i[0]),T=h.pointGeometry.convert(i[1]);m=[b,T],v=h.polygonizeBounds(b,T).every(R=>c.isPointAboveHorizon(R))}return new rn(m,c.getCameraPoint(),v,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(i){return h.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const c=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new h.pointGeometry(1,1)):this.screenBounds[1],v=h.polygonizeBounds(c,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<m.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?v[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(v[3]=this.cameraPoint)),h.bufferConvexPolygon(v,i)}containsTile(i,c,m){const v=i.queryPadding+1,b=i.tileID.wrap,T=m?this._bufferedCameraMercator(v,c).map(ue=>h.getTilePoint(i.tileTransform,ue,b)):this._bufferedScreenMercator(v,c).map(ue=>h.getTilePoint(i.tileTransform,ue,b)),R=this.screenGeometryMercator.map(ue=>h.getTileVec3(i.tileTransform,ue,b)),z=R.map(ue=>new h.pointGeometry(ue[0],ue[1])),j=c.getFreeCameraOptions().position||new h.MercatorCoordinate(0,0,0),q=h.getTileVec3(i.tileTransform,j,b),Q=R.map(ue=>{const fe=h.sub(ue,ue,q);return h.normalize(fe,fe),new h.Ray(q,fe)}),se=dn(i,1,c.zoom);if(h.polygonIntersectsBox(T,0,0,h.EXTENT,h.EXTENT))return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:Q,bufferedTilespaceGeometry:T,bufferedTilespaceBounds:(he=h.getBounds(T),he.min.x=h.clamp(he.min.x,0,h.EXTENT),he.min.y=h.clamp(he.min.y,0,h.EXTENT),he.max.x=h.clamp(he.max.x,0,h.EXTENT),he.max.y=h.clamp(he.max.y,0,h.EXTENT),he),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:se};var he}_bufferedScreenMercator(i,c){const m=ci(i);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{const v=this.bufferedScreenGeometry(i).map(b=>c.pointCoordinate3D(b));return this._screenRaycastCache[m]=v,v}}_bufferedCameraMercator(i,c){const m=ci(i);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{const v=this.bufferedCameraGeometry(i).map(b=>c.pointCoordinate3D(b));return this._cameraRaycastCache[m]=v,v}}}function ci(f){return 100*f|0}function Gn(f,i,c){const m=function(v,b){if(v)return c(v);if(b){const T=h.pick(h.extend(b,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(T.vectorLayers=b.vector_layers,T.vectorLayerIds=T.vectorLayers.map(R=>R.id)),T.tiles=i.canonicalizeTileset(T,f.url),c(null,T)}};return f.url?h.getJSON(i.transformRequest(i.normalizeSourceURL(f.url),h.ResourceType.Source),m):h.exported.frame(()=>m(null,f))}class Qr{constructor(i,c,m){this.bounds=h.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=c||0,this.maxzoom=m||24}validateBounds(i){return Array.isArray(i)&&4===i.length?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const c=Math.pow(2,i.z),m=Math.floor(h.mercatorXfromLng(this.bounds.getWest())*c),v=Math.floor(h.mercatorYfromLat(this.bounds.getNorth())*c),b=Math.ceil(h.mercatorXfromLng(this.bounds.getEast())*c),T=Math.ceil(h.mercatorYfromLat(this.bounds.getSouth())*c);return i.x>=m&&i.x<b&&i.y>=v&&i.y<T}}class di extends h.Evented{constructor(i,c,m,v){super(),this.id=i,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.extend({type:"raster"},c),h.extend(this,h.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Gn(this._options,this.map._requestManager,(i,c)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new h.ErrorEvent(i)):c&&(h.extend(this,c),c.bounds&&(this.tileBounds=new Qr(c.bounds,this.minzoom,this.maxzoom)),h.postTurnstileEvent(c.tiles),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,c){const m=h.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);i.request=h.getImage(this.map._requestManager.transformRequest(v,h.ResourceType.Tile),(b,T,R,z)=>{if(delete i.request,i.aborted)i.state="unloaded",c(null);else if(b)i.state="errored",c(b);else if(T){this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:R,expires:z});const j=this.map.painter.context,q=j.gl;i.texture=this.map.painter.getTileTexture(T.width),i.texture?i.texture.update(T,{useMipmap:!0}):(i.texture=new h.Texture(j,T,q.RGBA,{useMipmap:!0}),i.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE),j.extTextureFilterAnisotropic&&q.texParameterf(q.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax)),i.state="loaded",h.cacheEntryPossiblyAdded(this.dispatcher),c(null)}})}abortTile(i,c){i.request&&(i.request.cancel(),delete i.request),c()}unloadTile(i,c){i.texture&&this.map.painter.saveTileTexture(i.texture),c()}hasTransition(){return!1}}let Qn;function Qi(f,i,c,m,v,b,T,R){const z=[f,c,v,i,m,b,1,1,1],j=[T,R,1],q=h.adjoint([],z),[Q,se,he]=h.transformMat3(j,j,h.transpose(q,q));return h.multiply(z,[Q,0,0,0,se,0,0,0,he],z)}class jo extends h.Evented{constructor(i,c,m,v){super(),this.id=i,this.dispatcher=m,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=c}load(i,c){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this.url=this.options.url,h.getImage(this.map._requestManager.transformRequest(this.url,h.ResourceType.Image),(m,v)=>{this._loaded=!0,m?this.fire(new h.ErrorEvent(m)):v&&(this.image=h.exported.getImageData(v),this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),c&&c(),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this.options.url=i.url,this.load(i.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}setCoordinates(i){this.coordinates=i,delete this._boundsArray;const c=i.map(h.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let v=1/0,b=1/0,T=-1/0,R=-1/0;for(const Q of m)v=Math.min(v,Q.x),b=Math.min(b,Q.y),T=Math.max(T,Q.x),R=Math.max(R,Q.y);const z=Math.max(T-v,R-b),j=Math.max(0,Math.floor(-Math.log(z)/Math.LN2)),q=Math.pow(2,j);return new h.CanonicalTileID(j,Math.floor((v+T)/2*q),Math.floor((b+R)/2*q))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const i=h.tileTransform(this.tileID,this.map.transform.projection),[c,m,v,b]=this.coordinates.map(T=>{const R=i.projection.project(T[0],T[1]);return h.getTilePoint(i,R)._round()});return this.perspectiveTransform=function(T,R,z,j,q,Q,se,he,ue,fe){const Se=Qi(0,0,T,0,0,R,T,R),de=Qi(z,j,q,Q,se,he,ue,fe);return h.multiply(de,h.adjoint(Se,Se),de),[de[6]/de[8]*T/h.EXTENT,de[7]/de[8]*R/h.EXTENT]}(this.width,this.height,c.x,c.y,m.x,m.y,b.x,b.y,v.x,v.y),this._boundsArray=new h.StructArrayLayout4i8,this._boundsArray.emplaceBack(c.x,c.y,0,0),this._boundsArray.emplaceBack(m.x,m.y,h.EXTENT,0),this._boundsArray.emplaceBack(b.x,b.y,0,h.EXTENT),this._boundsArray.emplaceBack(v.x,v.y,h.EXTENT,h.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const i=this.map.painter.context,c=i.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,h.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new h.Texture(i,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));for(const m in this.tiles){const v=this.tiles[m];"loaded"!==v.state&&(v.state="loaded",v.texture=this.texture)}}loadTile(i,c){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},c(null)):(i.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Co={vector:class extends h.Evented{constructor(f,i,c,m){if(super(),this.id=f,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.extend(this,h.pick(i,["url","scheme","tileSize","promoteId"])),this._options=h.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new h.DedupedRequest}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Gn(this._options,this.map._requestManager,(f,i)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new h.ErrorEvent(f)):i&&(h.extend(this,i),i.bounds&&(this.tileBounds=new Qr(i.bounds,this.minzoom,this.maxzoom)),h.postTurnstileEvent(i.tiles,this.map._requestManager._customAccessToken),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}onAdd(f){this.map=f,this.load()}setSourceProperty(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f();const i=this.map.style._getSourceCaches(this.id);for(const c of i)c.clearTiles();this.load()}setTiles(f){return this.setSourceProperty(()=>{this._options.tiles=f}),this}setUrl(f){return this.setSourceProperty(()=>{this.url=f,this._options.url=f}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}loadTile(f,i){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(c,h.ResourceType.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:h.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:f.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,f.actor&&"expired"!==f.state)"loading"===f.state?f.reloadCallback=i:f.request=f.actor.send("reloadTile",m,v.bind(this));else if(f.actor=this._tileWorkers[c]=this._tileWorkers[c]||this.dispatcher.getActor(),this.dispatcher.ready)f.request=f.actor.send("loadTile",m,v.bind(this),void 0,!0);else{const b=h.loadVectorTile.call({deduped:this._deduped},m,(T,R)=>{T||!R?v.call(this,T):(m.data={cacheControl:R.cacheControl,expires:R.expires,rawData:R.rawData.slice(0)},f.actor&&f.actor.send("loadTile",m,v.bind(this),void 0,!0))},!0);f.request={cancel:b}}function v(b,T){return delete f.request,f.aborted?i(null):b&&404!==b.status?i(b):(T&&T.resourceTiming&&(f.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&f.setExpiryData(T),f.loadVectorData(T,this.map.painter),h.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id})}unloadTile(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:di,"raster-dem":class extends di{constructor(f,i,c,m){super(f,i,c,m),this.type="raster-dem",this.maxzoom=22,this._options=h.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(f,i){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(v,b){v&&(f.state="errored",i(v)),b&&(f.dem=b,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",i(null))}f.request=h.getImage(this.map._requestManager.transformRequest(c,h.ResourceType.Tile),function(v,b,T,R){if(delete f.request,f.aborted)f.state="unloaded",i(null);else if(v)f.state="errored",i(v);else if(b){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:T,expires:R});const z=h.window.ImageBitmap&&b instanceof h.window.ImageBitmap&&(null==Qn&&(Qn=h.window.OffscreenCanvas&&new h.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof h.window.createImageBitmap),Qn),j=1-(b.width-h.prevPowerOfTwo(b.width))/2;j<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const q=z?b:h.exported.getImageData(b,j),Q={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:q,encoding:this.encoding,padding:j};f.actor&&"expired"!==f.state||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",Q,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const i=f.canonical,c=Math.pow(2,i.z),m=(i.x-1+c)%c,v=0===i.x?f.wrap-1:f.wrap,b=(i.x+1+c)%c,T=i.x+1===c?f.wrap+1:f.wrap,R={};return R[new h.OverscaledTileID(f.overscaledZ,v,i.z,m,i.y).key]={backfilled:!1},R[new h.OverscaledTileID(f.overscaledZ,T,i.z,b,i.y).key]={backfilled:!1},i.y>0&&(R[new h.OverscaledTileID(f.overscaledZ,v,i.z,m,i.y-1).key]={backfilled:!1},R[new h.OverscaledTileID(f.overscaledZ,f.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},R[new h.OverscaledTileID(f.overscaledZ,T,i.z,b,i.y-1).key]={backfilled:!1}),i.y+1<c&&(R[new h.OverscaledTileID(f.overscaledZ,v,i.z,m,i.y+1).key]={backfilled:!1},R[new h.OverscaledTileID(f.overscaledZ,f.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},R[new h.OverscaledTileID(f.overscaledZ,T,i.z,b,i.y+1).key]={backfilled:!1}),R}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends h.Evented{constructor(f,i,c,m){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(m),this._data=i.data,this._options=h.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const v=h.EXTENT/this.tileSize;this.workerOptions=h.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*v,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*v,extent:h.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:h.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*v,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},i),this}getClusterChildren(f,i){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},i),this}getClusterLeaves(f,i,c,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:i,offset:c},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new h.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=h.extend({},this.workerOptions),i=this._data;"string"==typeof i?(f.request=this.map._requestManager.transformRequest(h.exported.resolveURL(i),h.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(c,m)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new h.ErrorEvent(c));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(v.resourceTiming=m.resourceTiming[this.id]),this.fire(new h.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,i){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(c,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:h.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,v)=>(delete f.request,f.unloadVectorData(),f.aborted?i(null):m?i(m):(f.loadVectorData(v,this.map.painter,"reloadTile"===c),i(null))),void 0,"loadTile"===c)}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return h.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends jo{constructor(f,i,c,m){super(f,i,c,m),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const i of f.urls)this.urls.push(this.map._requestManager.transformRequest(i,h.ResourceType.Source).url);h.getVideo(this.urls,(i,c)=>{this._loaded=!0,i?this.fire(new h.ErrorEvent(i)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const i=this.video.seekable;f<i.start(0)||f>i.end(0)?this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const f=this.map.painter.context,i=f.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new h.Texture(f,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,h.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2));for(const c in this.tiles){const m=this.tiles[c];"loaded"!==m.state&&(m.state="loaded",m.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:jo,canvas:class extends jo{constructor(f,i,c,m){super(f,i,c,m),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some(v=>!Array.isArray(v)||2!==v.length||v.some(b=>"number"!=typeof b))||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof h.window.HTMLCanvasElement||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof h.window.HTMLCanvasElement?this.options.canvas:h.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const i=this.map.painter.context,c=i.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,h.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new h.Texture(i,this.canvas,c.RGBA,{premultiply:!0});for(const m in this.tiles){const v=this.tiles[m];"loaded"!==v.state&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}}},zn=function(f,i,c,m){const v=new Co[i.type](f,i,c,m);if(v.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${v.id}`);return h.bindAll(["load","abort","unload","serialize","prepare"],v),v};function me(f,i){const c=h.identity([]);return h.scale(c,c,[.5*f.width,.5*-f.height,1]),h.translate(c,c,[1,-1,0]),h.multiply$1(c,c,f.calculateProjMatrix(i.toUnwrapped()))}function Z(f,i,c,m,v,b,T,R=!1){const z=f.tilesIn(m,T,R);z.sort(pe);const j=[];for(const Q of z)j.push({wrappedTileID:Q.tile.tileID.wrapped().key,queryResults:Q.tile.queryRenderedFeatures(i,c,f._state,Q,v,b,me(f.transform,Q.tile.tileID),R)});const q=function(Q){const se={},he={};for(const ue of Q){const fe=ue.queryResults,Se=ue.wrappedTileID,de=he[Se]=he[Se]||{};for(const Ee in fe){const Ae=fe[Ee],be=de[Ee]=de[Ee]||{},Ce=se[Ee]=se[Ee]||[];for(const Pe of Ae)be[Pe.featureIndex]||(be[Pe.featureIndex]=!0,Ce.push(Pe))}}return se}(j);for(const Q in q)q[Q].forEach(se=>{const he=se.feature,ue=f.getFeatureState(he.layer["source-layer"],he.id);he.source=he.layer.source,he.layer["source-layer"]&&(he.sourceLayer=he.layer["source-layer"]),he.state=ue});return q}function re(f,i){const c=f.getRenderableIds().map(b=>f.getTileByID(b)),m=[],v={};for(let b=0;b<c.length;b++){const T=c[b],R=T.tileID.canonical.key;v[R]||(v[R]=!0,T.querySourceFeatures(m,i))}return m}function pe(f,i){const c=f.tileID,m=i.tileID;return c.overscaledZ-m.overscaledZ||c.canonical.y-m.canonical.y||c.wrap-m.wrap||c.canonical.x-m.canonical.x}function ve(){return null!=fa.workerClass?new fa.workerClass:new h.window.Worker(fa.workerUrl)}const Ie="mapboxgl_preloaded_worker_pool";class Be{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Be.workerCount;)this.workers.push(new ve);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ie]}numActive(){return Object.keys(this.active).length}}let je;function Oe(){return je||(je=new Be),je}function Ze(f,i){const c={};for(const m in f)"ref"!==m&&(c[m]=f[m]);return h.refProperties.forEach(m=>{m in i&&(c[m]=i[m])}),c}function lt(f){f=f.slice();const i=Object.create(null);for(let c=0;c<f.length;c++)i[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=Ze(f[c],i[f[c].ref]));return f}Be.workerCount=2;const ot={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function mt(f,i,c){c.push({command:ot.addSource,args:[f,i[f]]})}function Qt(f,i,c){i.push({command:ot.removeSource,args:[f]}),c[f]=!0}function Gt(f,i,c,m){Qt(f,c,m),mt(f,i,c)}function Yt(f,i,c){let m;for(m in f[c])if(f[c].hasOwnProperty(m)&&"data"!==m&&!qe(f[c][m],i[c][m]))return!1;for(m in i[c])if(i[c].hasOwnProperty(m)&&"data"!==m&&!qe(f[c][m],i[c][m]))return!1;return!0}function sn(f,i,c,m,v,b){let T;for(T in i=i||{},f=f||{})f.hasOwnProperty(T)&&(qe(f[T],i[T])||c.push({command:b,args:[m,T,i[T],v]}));for(T in i)i.hasOwnProperty(T)&&!f.hasOwnProperty(T)&&(qe(f[T],i[T])||c.push({command:b,args:[m,T,i[T],v]}))}function Mn(f){return f.id}function xn(f,i){return f[i.id]=i,f}class Kn{constructor(i,c){this.reset(i,c)}reset(i,c){this.points=i||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(1===this.points.length)return this.points[0];i=h.clamp(i,0,1);let c=1,m=this._distances[c];const v=i*this.paddedLength+this.padding;for(;m<v&&c<this._distances.length;)m=this._distances[++c];const b=c-1,T=this._distances[b],R=m-T,z=R>0?(v-T)/R:0;return this.points[b].mult(1-z).add(this.points[c].mult(z))}}class tr{constructor(i,c,m){const v=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(i/m),this.yCellCount=Math.ceil(c/m);for(let T=0;T<this.xCellCount*this.yCellCount;T++)v.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=c,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,c,m,v,b){this._forEachCell(c,m,v,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(b)}insertCircle(i,c,m,v){this._forEachCell(c-v,m-v,c+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(c),this.circles.push(m),this.circles.push(v)}_insertBoxCell(i,c,m,v,b,T){this.boxCells[b].push(T)}_insertCircleCell(i,c,m,v,b,T){this.circleCells[b].push(T)}_query(i,c,m,v,b,T){if(m<0||i>this.width||v<0||c>this.height)return!b&&[];const R=[];if(i<=0&&c<=0&&this.width<=m&&this.height<=v){if(b)return!0;for(let z=0;z<this.boxKeys.length;z++)R.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const j=this.circles[3*z],q=this.circles[3*z+1],Q=this.circles[3*z+2];R.push({key:this.circleKeys[z],x1:j-Q,y1:q-Q,x2:j+Q,y2:q+Q})}return T?R.filter(T):R}return this._forEachCell(i,c,m,v,this._queryCell,R,{hitTest:b,seenUids:{box:{},circle:{}}},T),b?R.length>0:R}_queryCircle(i,c,m,v,b){const T=i-m,R=i+m,z=c-m,j=c+m;if(R<0||T>this.width||j<0||z>this.height)return!v&&[];const q=[];return this._forEachCell(T,z,R,j,this._queryCellCircle,q,{hitTest:v,circle:{x:i,y:c,radius:m},seenUids:{box:{},circle:{}}},b),v?q.length>0:q}query(i,c,m,v,b){return this._query(i,c,m,v,!1,b)}hitTest(i,c,m,v,b){return this._query(i,c,m,v,!0,b)}hitTestCircle(i,c,m,v){return this._queryCircle(i,c,m,!0,v)}_queryCell(i,c,m,v,b,T,R,z){const j=R.seenUids,q=this.boxCells[b];if(null!==q){const se=this.bboxes;for(const he of q)if(!j.box[he]){j.box[he]=!0;const ue=4*he;if(i<=se[ue+2]&&c<=se[ue+3]&&m>=se[ue+0]&&v>=se[ue+1]&&(!z||z(this.boxKeys[he]))){if(R.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[he],x1:se[ue],y1:se[ue+1],x2:se[ue+2],y2:se[ue+3]})}}}const Q=this.circleCells[b];if(null!==Q){const se=this.circles;for(const he of Q)if(!j.circle[he]){j.circle[he]=!0;const ue=3*he;if(this._circleAndRectCollide(se[ue],se[ue+1],se[ue+2],i,c,m,v)&&(!z||z(this.circleKeys[he]))){if(R.hitTest)return T.push(!0),!0;{const fe=se[ue],Se=se[ue+1],de=se[ue+2];T.push({key:this.circleKeys[he],x1:fe-de,y1:Se-de,x2:fe+de,y2:Se+de})}}}}}_queryCellCircle(i,c,m,v,b,T,R,z){const j=R.circle,q=R.seenUids,Q=this.boxCells[b];if(null!==Q){const he=this.bboxes;for(const ue of Q)if(!q.box[ue]){q.box[ue]=!0;const fe=4*ue;if(this._circleAndRectCollide(j.x,j.y,j.radius,he[fe+0],he[fe+1],he[fe+2],he[fe+3])&&(!z||z(this.boxKeys[ue])))return T.push(!0),!0}}const se=this.circleCells[b];if(null!==se){const he=this.circles;for(const ue of se)if(!q.circle[ue]){q.circle[ue]=!0;const fe=3*ue;if(this._circlesCollide(he[fe],he[fe+1],he[fe+2],j.x,j.y,j.radius)&&(!z||z(this.circleKeys[ue])))return T.push(!0),!0}}}_forEachCell(i,c,m,v,b,T,R,z){const j=this._convertToXCellCoord(i),q=this._convertToYCellCoord(c),Q=this._convertToXCellCoord(m),se=this._convertToYCellCoord(v);for(let he=j;he<=Q;he++)for(let ue=q;ue<=se;ue++)if(b.call(this,i,c,m,v,this.xCellCount*ue+he,T,R,z))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,c,m,v,b,T){const R=v-i,z=b-c,j=m+T;return j*j>R*R+z*z}_circleAndRectCollide(i,c,m,v,b,T,R){const z=(T-v)/2,j=Math.abs(i-(v+z));if(j>z+m)return!1;const q=(R-b)/2,Q=Math.abs(c-(b+q));if(Q>q+m)return!1;if(j<=z||Q<=q)return!0;const se=j-z,he=Q-q;return se*se+he*he<=m*m}}const Wn=Math.tan(85*Math.PI/180);function eo(f,i,c,m,v,b){let T=h.create();if(c){if("globe"===v.projection.name)T=h.calculateGlobeMatrix(v,v.worldSize/v._projectionScaler,[0,0]),h.multiply$1(T,T,h.globeDenormalizeECEF(h.globeTileBounds(i)));else{const R=Me([],b);T[0]=R[0],T[1]=R[1],T[4]=R[2],T[5]=R[3]}m||h.rotateZ(T,T,v.angle)}else h.multiply$1(T,v.labelPlaneMatrix,f);return T}function ei(f,i,c,m,v,b){if(c){if("globe"===v.projection.name){const T=eo(f,i,c,m,v,b);return h.invert(T,T),h.multiply$1(T,f,T),T}{const T=h.clone(f),R=h.identity([]);return R[0]=b[0],R[1]=b[1],R[4]=b[2],R[5]=b[3],h.multiply$1(T,T,R),m||h.rotateZ(T,T,-v.angle),T}}return v.glCoordMatrix}function Nt(f,i,c=0){const m=[f.x,f.y,c,1];c?h.transformMat4$1(m,m,i):Li(m,m,i);const v=m[3];return{point:new h.pointGeometry(m[0]/v,m[1]/v),signedDistanceFromCamera:v}}function yn(f,i){return Math.min(.5+f/i*.5,1.5)}function sr(f,i){const c=f[0]/f[3],m=f[1]/f[3];return c>=-i[0]&&c<=i[0]&&m>=-i[1]&&m<=i[1]}function un(f,i,c,m,v,b,T,R,z,j){const q=c.transform,Q=m?f.textSizeData:f.iconSizeData,se=h.evaluateSizeForZoom(Q,c.transform.zoom),he=[256/c.width*2+1,256/c.height*2+1],ue=m?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;ue.clear();const fe=f.lineVertexArray,Se=m?f.text.placedSymbolArray:f.icon.placedSymbolArray,de=c.transform.width/c.transform.height;let Ee=!1;for(let Ae=0;Ae<Se.length;Ae++){const be=Se.get(Ae);if(be.writingMode!==h.WritingMode.vertical||Ee||0!==Ae&&Se.get(Ae-1).writingMode===h.WritingMode.horizontal||(Ee=!0),be.hidden||be.writingMode===h.WritingMode.vertical&&!Ee){pi(be.numGlyphs,ue);continue}Ee=!1;const Ce=new h.pointGeometry(be.tileAnchorX,be.tileAnchorY),Pe=z?z(Ce):[0,0,0],We=q.projection.projectTilePoint(Ce.x,Ce.y,j.canonical),et=[We.x+Pe[0],We.y+Pe[1],We.z+Pe[2]],Ft=[...et,1];if(h.transformMat4$1(Ft,Ft,i),!sr(Ft,he)){pi(be.numGlyphs,ue);continue}const bt=yn(c.transform.cameraToCenterDistance,Ft[3]),Tt=h.evaluateSizeForFeature(Q,se,be),pt=T?Tt/bt:Tt*bt,tt=Nt(new h.pointGeometry(et[0],et[1]),v,et[2]);if(tt.signedDistanceFromCamera<=0){pi(be.numGlyphs,ue);continue}let vt={};const gt=T?null:z,on=si(be,pt,!1,R,i,v,b,f.glyphOffsetArray,fe,ue,tt.point,Ce,vt,de,gt,q.projection,j);Ee=on.useVertical,gt&&on.needsFlipping&&(vt={}),(on.notEnoughRoom||Ee||on.needsFlipping&&si(be,pt,!0,R,i,v,b,f.glyphOffsetArray,fe,ue,tt.point,Ce,vt,de,gt,q.projection,j).notEnoughRoom)&&pi(be.numGlyphs,ue)}m?f.text.dynamicLayoutVertexBuffer.updateData(ue):f.icon.dynamicLayoutVertexBuffer.updateData(ue)}function oi(f,i,c,m,v,b,T,R,z,j,q,Q,se,he,ue){const fe=R.glyphStartIndex+R.numGlyphs,Se=R.lineStartIndex,de=R.lineStartIndex+R.lineLength,Ee=i.getoffsetX(R.glyphStartIndex),Ae=i.getoffsetX(fe-1),be=to(f*Ee,c,m,v,b,T,R.segment,Se,de,z,j,q,Q,se,!0,he,ue);if(!be)return null;const Ce=to(f*Ae,c,m,v,b,T,R.segment,Se,de,z,j,q,Q,se,!0,he,ue);return Ce?{first:be,last:Ce}:null}function Zr(f,i,c,m){return f.writingMode===h.WritingMode.horizontal&&Math.abs(c.y-i.y)>Math.abs(c.x-i.x)*m?{useVertical:!0}:f.writingMode===h.WritingMode.vertical?i.y<c.y?{needsFlipping:!0}:null:0!==f.flipState&&function(v,b,T){const R=(b.x-v.x)*T;return 0===R||Math.abs((b.y-v.y)/R)>Wn}(i,c,m)?1===f.flipState?{needsFlipping:!0}:null:i.x>c.x?{needsFlipping:!0}:null}function si(f,i,c,m,v,b,T,R,z,j,q,Q,se,he,ue,fe,Se){const de=i/24,Ee=f.lineOffsetX*de,Ae=f.lineOffsetY*de;let be;if(f.numGlyphs>1){const Ce=f.glyphStartIndex+f.numGlyphs,Pe=f.lineStartIndex,We=f.lineStartIndex+f.lineLength,et=oi(de,R,Ee,Ae,c,q,Q,f,z,b,se,ue,!1,fe,Se);if(!et)return{notEnoughRoom:!0};const Ft=Nt(et.first.point,T).point,bt=Nt(et.last.point,T).point;if(m&&!c){const Tt=Zr(f,Ft,bt,he);if(f.flipState=Tt&&Tt.needsFlipping?1:2,Tt)return Tt}be=[et.first];for(let Tt=f.glyphStartIndex+1;Tt<Ce-1;Tt++)be.push(to(de*R.getoffsetX(Tt),Ee,Ae,c,q,Q,f.segment,Pe,We,z,b,se,ue,!1,!1,fe,Se));be.push(et.last)}else{if(m&&!c){const Pe=Nt(Q,v).point,We=f.lineStartIndex+f.segment+1,et=new h.pointGeometry(z.getx(We),z.gety(We)),Ft=Nt(et,v),bt=Zr(f,Pe,Ft.signedDistanceFromCamera>0?Ft.point:Eo(Q,et,Pe,1,v,void 0,fe,Se.canonical),he);if(f.flipState=bt&&bt.needsFlipping?1:2,bt)return bt}const Ce=to(de*R.getoffsetX(f.glyphStartIndex),Ee,Ae,c,q,Q,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,z,b,se,ue,!1,!1,fe,Se);if(!Ce)return{notEnoughRoom:!0};be=[Ce]}for(const Ce of be)h.addDynamicAttributes(j,Ce.point,Ce.angle);return{}}function Gr(f,i,c,m,v){const b=m.projectTilePoint(f.x,f.y,i);if(!v)return Nt(b,c,b.z);const T=v(f);return Nt(new h.pointGeometry(b.x+T[0],b.y+T[1]),c,b.z+T[2])}function Eo(f,i,c,m,v,b,T,R){const z=Gr(f.add(f.sub(i)._unit()),R,v,T,b).point,j=c.sub(z);return c.add(j._mult(m/j.mag()))}function to(f,i,c,m,v,b,T,R,z,j,q,Q,se,he,ue,fe,Se){const de=m?f-i:f+i;let Ee=de>0?1:-1,Ae=0;m&&(Ee*=-1,Ae=Math.PI),Ee<0&&(Ae+=Math.PI);let be=Ee>0?R+T:R+T+1,Ce=v,Pe=v,We=0,et=0;const Ft=Math.abs(de),bt=[],Tt=[];let pt=b;const tt=()=>{const Ot=be-Ee;return 0===We?b:new h.pointGeometry(j.getx(Ot),j.gety(Ot))},vt=()=>Eo(tt(),pt,Pe,Ft-We+1,q,se,fe,Se.canonical);for(;We+et<=Ft;){if(be+=Ee,be<R||be>=z)return null;if(Pe=Ce,bt.push(Ce),he&&Tt.push(pt||tt()),Ce=Q[be],void 0===Ce){pt=new h.pointGeometry(j.getx(be),j.gety(be));const Ot=Gr(pt,Se.canonical,q,fe,se);Ce=Ot.signedDistanceFromCamera>0?Q[be]=Ot.point:vt()}else pt=null;We+=et,et=Pe.dist(Ce)}ue&&se&&(pt=pt||new h.pointGeometry(j.getx(be),j.gety(be)),Q[be]=Ce=void 0===Q[be]?Ce:vt(),et=Pe.dist(Ce));const gt=(Ft-We)/et,on=Ce.sub(Pe),gn=on.mult(gt)._add(Pe);c&&gn._add(on._unit()._perp()._mult(c*Ee));const Zn=Ae+Math.atan2(Ce.y-Pe.y,Ce.x-Pe.x);return bt.push(gn),he&&(pt=pt||new h.pointGeometry(j.getx(be),j.gety(be)),Tt.push(function(Ot,ln,Vn){const Or=1-Vn;return new h.pointGeometry(Ot.x*Or+ln.x*Vn,Ot.y*Or+ln.y*Vn)}(Tt.length>0?Tt[Tt.length-1]:pt,pt,gt))),{point:gn,angle:Zn,path:bt,tilePath:Tt}}const bn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function pi(f,i){for(let c=0;c<f;c++){const m=i.length;i.resize(m+4),i.float32.set(bn,3*m)}}function Li(f,i,c){const m=i[0],v=i[1];return f[0]=c[0]*m+c[4]*v+c[12],f[1]=c[1]*m+c[5]*v+c[13],f[3]=c[3]*m+c[7]*v+c[15],f}const Ni=100;class Lo{constructor(i,c,m=new tr(i.width+200,i.height+200,25),v=new tr(i.width+200,i.height+200,25)){this.transform=i,this.grid=m,this.ignoredGrid=v,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Ni,this.screenBottomBoundary=i.height+Ni,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=c}placeCollisionBox(i,c,m,v,b,T,R){let z=c.projectedAnchorX,j=c.projectedAnchorY,q=c.projectedAnchorZ;const Q=c.elevation,se=c.tileID;if(Q&&se){const be=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),Ce=be.upVector(se.canonical,c.tileAnchorX,c.tileAnchorY),Pe=be.upVectorScale(se.canonical);z+=Ce[0]*Q*Pe,j+=Ce[1]*Q*Pe,q+=Ce[2]*Q*Pe}const he=this.projectAndGetPerspectiveRatio(T,z,j,q,c.tileID),ue=b*he.perspectiveRatio,fe=(c.x1*i+m.x-c.padding)*ue+he.point.x,Se=(c.y1*i+m.y-c.padding)*ue+he.point.y,de=(c.x2*i+m.x+c.padding)*ue+he.point.x,Ee=(c.y2*i+m.y+c.padding)*ue+he.point.y,Ae=he.perspectiveRatio<=.55||he.aboveHorizon;return!this.isInsideGrid(fe,Se,de,Ee)||!v&&this.grid.hitTest(fe,Se,de,Ee,R)||Ae?{box:[],offscreen:!1}:{box:[fe,Se,de,Ee],offscreen:this.isOffscreen(fe,Se,de,Ee)}}placeCollisionCircles(i,c,m,v,b,T,R,z,j,q,Q,se,he,ue){const fe=[],Se=this.transform.elevation,de=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),Ee=Se?Se.getAtTileOffsetFunc(ue,de):gt=>[0,0,0],Ae=new h.pointGeometry(c.tileAnchorX,c.tileAnchorY),be=this.transform.projection.projectTilePoint(c.tileAnchorX,c.tileAnchorY,ue.canonical),Ce=Ee(Ae),Pe=[be.x+Ce[0],be.y+Ce[1],be.z+Ce[2]],We=this.projectAndGetPerspectiveRatio(T,Pe[0],Pe[1],Pe[2],ue),{perspectiveRatio:et}=We,Ft=(q?b/et:b*et)/h.ONE_EM,bt=Nt(new h.pointGeometry(Pe[0],Pe[1]),R,Pe[2]).point,Tt=We.signedDistanceFromCamera>0?oi(Ft,v,c.lineOffsetX*Ft,c.lineOffsetY*Ft,!1,bt,Ae,c,m,R,{},Se&&!q?Ee:null,q&&!!Se,this.transform.projection,ue):null;let pt=!1,tt=!1,vt=!0;if(Tt&&!We.aboveHorizon){const gt=.5*se*et+he,on=new h.pointGeometry(-100,-100),gn=new h.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Zn=new Kn,Ot=Tt.first,ln=Tt.last;let Vn=[];for(let vn=Ot.path.length-1;vn>=1;vn--)Vn.push(Ot.path[vn]);for(let vn=1;vn<ln.path.length;vn++)Vn.push(ln.path[vn]);const Or=2.5*gt;if(z){const vn=Vn.map(Se?(lr,vi)=>{const vo=Ee(vi<Ot.path.length-1?Ot.tilePath[Ot.path.length-1-vi]:ln.tilePath[vi-Ot.path.length+2]);return Nt(lr,z,vo[2])}:lr=>Nt(lr,z));Vn=vn.some(lr=>lr.signedDistanceFromCamera<=0)?[]:vn.map(lr=>lr.point)}let Yr=[];if(Vn.length>0){const vn=Vn[0].clone(),lr=Vn[0].clone();for(let vi=1;vi<Vn.length;vi++)vn.x=Math.min(vn.x,Vn[vi].x),vn.y=Math.min(vn.y,Vn[vi].y),lr.x=Math.max(lr.x,Vn[vi].x),lr.y=Math.max(lr.y,Vn[vi].y);Yr=vn.x>=on.x&&lr.x<=gn.x&&vn.y>=on.y&&lr.y<=gn.y?[Vn]:lr.x<on.x||vn.x>gn.x||lr.y<on.y||vn.y>gn.y?[]:h.clipLine([Vn],on.x,on.y,gn.x,gn.y)}for(const vn of Yr){Zn.reset(vn,.25*gt);let lr=0;lr=Zn.length<=.5*gt?1:Math.ceil(Zn.paddedLength/Or)+1;for(let vi=0;vi<lr;vi++){const vo=vi/Math.max(lr-1,1),rs=Zn.lerp(vo),ma=rs.x+Ni,Bs=rs.y+Ni;fe.push(ma,Bs,gt,0);const cr=ma-gt,En=Bs-gt,_r=ma+gt,ir=Bs+gt;if(vt=vt&&this.isOffscreen(cr,En,_r,ir),tt=tt||this.isInsideGrid(cr,En,_r,ir),!i&&this.grid.hitTestCircle(ma,Bs,gt,Q)&&(pt=!0,!j))return{circles:[],offscreen:!1,collisionDetected:pt}}}}return{circles:!j&&pt||!tt?[]:fe,offscreen:vt,collisionDetected:pt}}queryRenderedSymbols(i){if(0===i.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let m=1/0,v=1/0,b=-1/0,T=-1/0;for(const q of i){const Q=new h.pointGeometry(q.x+Ni,q.y+Ni);m=Math.min(m,Q.x),v=Math.min(v,Q.y),b=Math.max(b,Q.x),T=Math.max(T,Q.y),c.push(Q)}const R=this.grid.query(m,v,b,T).concat(this.ignoredGrid.query(m,v,b,T)),z={},j={};for(const q of R){const Q=q.key;if(void 0===z[Q.bucketInstanceId]&&(z[Q.bucketInstanceId]={}),z[Q.bucketInstanceId][Q.featureIndex])continue;const se=[new h.pointGeometry(q.x1,q.y1),new h.pointGeometry(q.x2,q.y1),new h.pointGeometry(q.x2,q.y2),new h.pointGeometry(q.x1,q.y2)];h.polygonIntersectsPolygon(c,se)&&(z[Q.bucketInstanceId][Q.featureIndex]=!0,void 0===j[Q.bucketInstanceId]&&(j[Q.bucketInstanceId]=[]),j[Q.bucketInstanceId].push(Q.featureIndex))}return j}insertCollisionBox(i,c,m,v,b){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:b},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,c,m,v,b){const T=c?this.ignoredGrid:this.grid,R={bucketInstanceId:m,featureIndex:v,collisionGroupID:b};for(let z=0;z<i.length;z+=4)T.insertCircle(R,i[z],i[z+1],i[z+2])}projectAndGetPerspectiveRatio(i,c,m,v,b){const T=[c,m,v||0,1];let R=!1;if(v||this.transform.pitch>0){h.transformMat4$1(T,T,i);let z=!1;this.fogState&&b&&(z=function(j,q,Q,se,he,ue){const fe=ue.calculateFogTileMatrix(he),Se=[q,Q,se];return h.transformMat4(Se,Se,fe),ao(j,Se,ue.pitch,ue._fov)}(this.fogState,c,m,v||0,b.toUnwrapped(),this.transform)>.9),R=T[2]>T[3]||z}else Li(T,T,i);return{point:new h.pointGeometry((T[0]/T[3]+1)/2*this.transform.width+Ni,(-T[1]/T[3]+1)/2*this.transform.height+Ni),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/T[3]*.5,1.5),signedDistanceFromCamera:T[3],aboveHorizon:R}}isOffscreen(i,c,m,v){return m<Ni||i>=this.screenRightBoundary||v<Ni||c>this.screenBottomBoundary}isInsideGrid(i,c,m,v){return m>=0&&i<this.gridRightBoundary&&v>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const i=h.identity([]);return h.translate(i,i,[-100,-100,0]),i}}class Zi{constructor(i,c,m,v){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?c:-c))):v&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class no{constructor(i,c,m,v,b,T=!1){this.text=new Zi(i?i.text:null,c,m,b),this.icon=new Zi(i?i.icon:null,c,v,b),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Mi{constructor(i,c,m,v=!1){this.text=i,this.icon=c,this.skipFade=m,this.clipped=v}}class fi{constructor(){this.invProjMatrix=h.create(),this.viewportMatrix=h.create(),this.circles=[]}}class Ir{constructor(i,c,m,v,b){this.bucketInstanceId=i,this.featureIndex=c,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=b}}class la{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const c=++this.maxGroupID;this.collisionGroups[i]={ID:c,predicate:m=>m.collisionGroupID===c}}return this.collisionGroups[i]}}function Fs(f,i,c,m,v){const{horizontalAlign:b,verticalAlign:T}=h.getAnchorAlignment(f),R=-(b-.5)*i,z=-(T-.5)*c,j=h.evaluateVariableOffset(f,m);return new h.pointGeometry(R+j[0]*v,z+j[1]*v)}function uo(f,i,c,m,v){const b=new h.pointGeometry(f,i);return c&&b._rotate(m?v:-v),b}class $o{constructor(i,c,m,v,b){this.transform=i.clone(),this.collisionIndex=new Lo(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new la(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,c,m,v){const b=m.getBucket(c),T=m.latestFeatureIndex;if(!b||!T||c.id!==b.layerIds[0])return;const R=b.layers[0].layout,z=m.collisionBoxArray,j=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),q=m.tileSize/h.EXTENT,Q=m.tileID.toUnwrapped(),se=this.transform.calculateProjMatrix(Q),he="map"===R.get("text-pitch-alignment"),ue="map"===R.get("text-rotation-alignment");c.compileFilter();const fe=c.dynamicFilter(),Se=c.dynamicFilterNeedsFeature(),de=this.transform.calculatePixelsToTileUnitsMatrix(m),Ee=eo(se,m.tileID.canonical,he,ue,this.transform,de);let Ae=null;if(he){const Pe=ei(se,m.tileID.canonical,he,ue,this.transform,de);Ae=h.multiply$1([],this.transform.labelPlaneMatrix,Pe)}let be=null;fe&&m.latestFeatureIndex&&(be={unwrappedTileID:Q,dynamicFilter:fe,dynamicFilterNeedsFeature:Se,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new Ir(b.bucketInstanceId,T,b.sourceLayerIndex,b.index,m.tileID);const Ce={bucket:b,layout:R,posMatrix:se,textLabelPlaneMatrix:Ee,labelToScreenMatrix:Ae,clippingData:be,scale:j,textPixelRatio:q,holdingForFade:m.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:h.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:h.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(v)for(const Pe of b.sortKeyRanges){const{sortKey:We,symbolInstanceStart:et,symbolInstanceEnd:Ft}=Pe;i.push({sortKey:We,symbolInstanceStart:et,symbolInstanceEnd:Ft,parameters:Ce})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ce})}attemptAnchorPlacement(i,c,m,v,b,T,R,z,j,q,Q,se,he,ue,fe,Se,de,Ee){const Ae=[se.textOffset0,se.textOffset1],be=Fs(i,m,v,Ae,b),Ce=this.collisionIndex.placeCollisionBox(b,c,uo(be.x,be.y,T,R,this.transform.angle),Q,z,j,q.predicate);if((!Se||0!==this.collisionIndex.placeCollisionBox(ue.getSymbolInstanceIconSize(Ee,this.transform.zoom,he),Se,uo(be.x,be.y,T,R,this.transform.angle),Q,z,j,q.predicate).box.length)&&Ce.box.length>0){let Pe;return this.prevPlacement&&this.prevPlacement.variableOffsets[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID].text&&(Pe=this.prevPlacement.variableOffsets[se.crossTileID].anchor),this.variableOffsets[se.crossTileID]={textOffset:Ae,width:m,height:v,anchor:i,textScale:b,prevAnchor:Pe},this.markUsedJustification(ue,i,se,fe),ue.allowVerticalPlacement&&(this.markUsedOrientation(ue,fe,se),this.placedOrientations[se.crossTileID]=fe),{shift:be,placedGlyphBoxes:Ce}}}placeLayerBucketPart(i,c,m,v){const{bucket:b,layout:T,posMatrix:R,textLabelPlaneMatrix:z,labelToScreenMatrix:j,clippingData:q,textPixelRatio:Q,holdingForFade:se,collisionBoxArray:he,partiallyEvaluatedTextSize:ue,partiallyEvaluatedIconSize:fe,collisionGroup:Se}=i.parameters,de=T.get("text-optional"),Ee=T.get("icon-optional"),Ae=T.get("text-allow-overlap"),be=T.get("icon-allow-overlap"),Ce="map"===T.get("text-rotation-alignment"),Pe="map"===T.get("text-pitch-alignment"),We="none"!==T.get("icon-text-fit"),et="viewport-y"===T.get("symbol-z-order"),Ft=Ae&&(be||!b.hasIconData()||Ee),bt=be&&(Ae||!b.hasTextData()||de);!b.collisionArrays&&he&&b.deserializeCollisionBoxes(he),m&&v&&b.updateCollisionDebugBuffers(this.transform.zoom,he);const Tt=(pt,tt,vt)=>{if(q){const cr={zoom:this.transform.zoom,pitch:this.transform.pitch};let En=null;if(q.dynamicFilterNeedsFeature){const _r=this.retainedQueryData[b.bucketInstanceId];En=q.featureIndex.loadFeature({featureIndex:pt.featureIndex,bucketIndex:_r.bucketIndex,sourceLayerIndex:_r.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,q.dynamicFilter)(cr,En,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new h.pointGeometry(pt.tileAnchorX,pt.tileAnchorY),this.transform.calculateDistanceTileData(q.unwrappedTileID)))return this.placements[pt.crossTileID]=new Mi(!1,!1,!1,!0),void(c[pt.crossTileID]=!0)}if(c[pt.crossTileID])return;if(se)return void(this.placements[pt.crossTileID]=new Mi(!1,!1,!1));let gt=!1,on=!1,gn=!0,Zn=null,Ot={box:null,offscreen:null},ln={box:null,offscreen:null},Vn=null,Or=null,Yr=null,vn=0,lr=0,vi=0;vt.textFeatureIndex?vn=vt.textFeatureIndex:pt.useRuntimeCollisionCircles&&(vn=pt.featureIndex),vt.verticalTextFeatureIndex&&(lr=vt.verticalTextFeatureIndex);const vo=cr=>{cr.tileID=this.retainedQueryData[b.bucketInstanceId].tileID,(this.transform.elevation||cr.elevation)&&(cr.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[b.bucketInstanceId].tileID,cr.tileAnchorX,cr.tileAnchorY):0)},rs=vt.textBox;if(rs){vo(rs);const cr=_r=>{let ir=h.WritingMode.horizontal;if(b.allowVerticalPlacement&&!_r&&this.prevPlacement){const Ts=this.prevPlacement.placedOrientations[pt.crossTileID];Ts&&(this.placedOrientations[pt.crossTileID]=Ts,ir=Ts,this.markUsedOrientation(b,ir,pt))}return ir},En=(_r,ir)=>{if(b.allowVerticalPlacement&&pt.numVerticalGlyphVertices>0&&vt.verticalTextBox){for(const Ts of b.writingModes)if(Ts===h.WritingMode.vertical?(Ot=ir(),ln=Ot):Ot=_r(),Ot&&Ot.box&&Ot.box.length)break}else Ot=_r()};if(T.get("text-variable-anchor")){let _r=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[pt.crossTileID]){const xi=this.prevPlacement.variableOffsets[pt.crossTileID];_r.indexOf(xi.anchor)>0&&(_r=_r.filter(Io=>Io!==xi.anchor),_r.unshift(xi.anchor))}const ir=(xi,Io,Ha)=>{const Ds=b.getSymbolInstanceTextSize(ue,pt,this.transform.zoom,tt),fl=(xi.x2-xi.x1)*Ds+2*xi.padding,tn=(xi.y2-xi.y1)*Ds+2*xi.padding,fn=We&&!be?Io:null;fn&&vo(fn);let Bi={box:[],offscreen:!1};const _s=Ae?2*_r.length:_r.length;for(let ga=0;ga<_s;++ga){const ki=this.attemptAnchorPlacement(_r[ga%_r.length],xi,fl,tn,Ds,Ce,Pe,Q,R,Se,ga>=_r.length,pt,tt,b,Ha,fn,ue,fe);if(ki&&(Bi=ki.placedGlyphBoxes,Bi&&Bi.box&&Bi.box.length)){gt=!0,Zn=ki.shift;break}}return Bi};En(()=>ir(rs,vt.iconBox,h.WritingMode.horizontal),()=>{const xi=vt.verticalTextBox;return xi&&vo(xi),b.allowVerticalPlacement&&!(Ot&&Ot.box&&Ot.box.length)&&pt.numVerticalGlyphVertices>0&&xi?ir(xi,vt.verticalIconBox,h.WritingMode.vertical):{box:null,offscreen:null}}),Ot&&(gt=Ot.box,gn=Ot.offscreen);const Ts=cr(Ot&&Ot.box);if(!gt&&this.prevPlacement){const xi=this.prevPlacement.variableOffsets[pt.crossTileID];xi&&(this.variableOffsets[pt.crossTileID]=xi,this.markUsedJustification(b,xi.anchor,pt,Ts))}}else{const _r=(ir,Ts)=>{const xi=b.getSymbolInstanceTextSize(ue,pt,this.transform.zoom,tt),Io=this.collisionIndex.placeCollisionBox(xi,ir,new h.pointGeometry(0,0),Ae,Q,R,Se.predicate);return Io&&Io.box&&Io.box.length&&(this.markUsedOrientation(b,Ts,pt),this.placedOrientations[pt.crossTileID]=Ts),Io};En(()=>_r(rs,h.WritingMode.horizontal),()=>{const ir=vt.verticalTextBox;return b.allowVerticalPlacement&&pt.numVerticalGlyphVertices>0&&ir?(vo(ir),_r(ir,h.WritingMode.vertical)):{box:null,offscreen:null}}),cr(Ot&&Ot.box&&Ot.box.length)}}if(Vn=Ot,gt=Vn&&Vn.box&&Vn.box.length>0,gn=Vn&&Vn.offscreen,pt.useRuntimeCollisionCircles){const cr=b.text.placedSymbolArray.get(pt.centerJustifiedTextSymbolIndex>=0?pt.centerJustifiedTextSymbolIndex:pt.verticalPlacedTextSymbolIndex),En=h.evaluateSizeForFeature(b.textSizeData,ue,cr),_r=T.get("text-padding");Or=this.collisionIndex.placeCollisionCircles(Ae,cr,b.lineVertexArray,b.glyphOffsetArray,En,R,z,j,m,Pe,Se.predicate,pt.collisionCircleDiameter*En/h.ONE_EM,_r,this.retainedQueryData[b.bucketInstanceId].tileID),gt=Ae||Or.circles.length>0&&!Or.collisionDetected,gn=gn&&Or.offscreen}if(vt.iconFeatureIndex&&(vi=vt.iconFeatureIndex),vt.iconBox){const cr=En=>{vo(En);const _r=We&&Zn?uo(Zn.x,Zn.y,Ce,Pe,this.transform.angle):new h.pointGeometry(0,0),ir=b.getSymbolInstanceIconSize(fe,this.transform.zoom,tt);return this.collisionIndex.placeCollisionBox(ir,En,_r,be,Q,R,Se.predicate)};ln&&ln.box&&ln.box.length&&vt.verticalIconBox?(Yr=cr(vt.verticalIconBox),on=Yr.box.length>0):(Yr=cr(vt.iconBox),on=Yr.box.length>0),gn=gn&&Yr.offscreen}const ma=de||0===pt.numHorizontalGlyphVertices&&0===pt.numVerticalGlyphVertices,Bs=Ee||0===pt.numIconVertices;if(ma||Bs?Bs?ma||(on=on&&gt):gt=on&&gt:on=gt=on&&gt,gt&&Vn&&Vn.box&&this.collisionIndex.insertCollisionBox(Vn.box,T.get("text-ignore-placement"),b.bucketInstanceId,ln&&ln.box&&lr?lr:vn,Se.ID),on&&Yr&&this.collisionIndex.insertCollisionBox(Yr.box,T.get("icon-ignore-placement"),b.bucketInstanceId,vi,Se.ID),Or&&(gt&&this.collisionIndex.insertCollisionCircles(Or.circles,T.get("text-ignore-placement"),b.bucketInstanceId,vn,Se.ID),m)){const cr=b.bucketInstanceId;let En=this.collisionCircleArrays[cr];void 0===En&&(En=this.collisionCircleArrays[cr]=new fi);for(let _r=0;_r<Or.circles.length;_r+=4)En.circles.push(Or.circles[_r+0]),En.circles.push(Or.circles[_r+1]),En.circles.push(Or.circles[_r+2]),En.circles.push(Or.collisionDetected?1:0)}this.placements[pt.crossTileID]=new Mi(gt||Ft,on||bt,gn||b.justReloaded),c[pt.crossTileID]=!0};if(et){const pt=b.getSortedSymbolIndexes(this.transform.angle);for(let tt=pt.length-1;tt>=0;--tt){const vt=pt[tt];Tt(b.symbolInstances.get(vt),vt,b.collisionArrays[vt])}}else for(let pt=i.symbolInstanceStart;pt<i.symbolInstanceEnd;pt++)Tt(b.symbolInstances.get(pt),pt,b.collisionArrays[pt]);if(m&&b.bucketInstanceId in this.collisionCircleArrays){const pt=this.collisionCircleArrays[b.bucketInstanceId];h.invert(pt.invProjMatrix,R),pt.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(i,c,m,v){let b;b=v===h.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[h.getAnchorJustification(c)];const T=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const R of T)R>=0&&(i.text.placedSymbolArray.get(R).crossTileID=b>=0&&R!==b?0:m.crossTileID)}markUsedOrientation(i,c,m){const v=c===h.WritingMode.horizontal||c===h.WritingMode.horizontalOnly?c:0,b=c===h.WritingMode.vertical?c:0,T=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const R of T)i.text.placedSymbolArray.get(R).placedOrientation=v;m.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let m=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const v=c?c.symbolFadeChange(i):1,b=c?c.opacities:{},T=c?c.variableOffsets:{},R=c?c.placedOrientations:{};for(const z in this.placements){const j=this.placements[z],q=b[z];q?(this.opacities[z]=new no(q,v,j.text,j.icon,null,j.clipped),m=m||j.text!==q.text.placed||j.icon!==q.icon.placed):(this.opacities[z]=new no(null,v,j.text,j.icon,j.skipFade,j.clipped),m=m||j.text||j.icon)}for(const z in b){const j=b[z];if(!this.opacities[z]){const q=new no(j,v,!1,!1);q.isHidden()||(this.opacities[z]=q,m=m||j.text.placed||j.icon.placed)}}for(const z in T)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=T[z]);for(const z in R)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=R[z]);m?this.lastPlacementChangeTime=i:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:i)}updateLayerOpacities(i,c){const m={};for(const v of c){const b=v.getBucket(i);b&&v.latestFeatureIndex&&i.id===b.layerIds[0]&&this.updateBucketOpacities(b,m,v.collisionBoxArray)}}updateBucketOpacities(i,c,m){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const v=i.layers[0].layout,b=!!i.layers[0].dynamicFilter(),T=new no(null,0,!1,!1,!0),R=v.get("text-allow-overlap"),z=v.get("icon-allow-overlap"),j=v.get("text-variable-anchor"),q="map"===v.get("text-rotation-alignment"),Q="map"===v.get("text-pitch-alignment"),se="none"!==v.get("icon-text-fit"),he=new no(null,0,R&&(z||!i.hasIconData()||v.get("icon-optional")),z&&(R||!i.hasTextData()||v.get("text-optional")),!0);!i.collisionArrays&&m&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(m);const ue=(Se,de,Ee)=>{for(let Ae=0;Ae<de/4;Ae++)Se.opacityVertexArray.emplaceBack(Ee)};let fe=0;for(let Se=0;Se<i.symbolInstances.length;Se++){const de=i.symbolInstances.get(Se),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:Ae,crossTileID:be}=de;let Ce=this.opacities[be];c[be]?Ce=T:Ce||(Ce=he,this.opacities[be]=Ce),c[be]=!0;const Pe=Ee>0||Ae>0,We=de.numIconVertices>0,et=this.placedOrientations[de.crossTileID],Ft=et===h.WritingMode.vertical,bt=et===h.WritingMode.horizontal||et===h.WritingMode.horizontalOnly;if(!Pe&&!We||Ce.isHidden()||fe++,Pe){const Tt=Ei(Ce.text);ue(i.text,Ee,Ft?Si:Tt),ue(i.text,Ae,bt?Si:Tt);const pt=Ce.text.isHidden();[de.rightJustifiedTextSymbolIndex,de.centerJustifiedTextSymbolIndex,de.leftJustifiedTextSymbolIndex].forEach(gt=>{gt>=0&&(i.text.placedSymbolArray.get(gt).hidden=pt||Ft?1:0)}),de.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(de.verticalPlacedTextSymbolIndex).hidden=pt||bt?1:0);const tt=this.variableOffsets[de.crossTileID];tt&&this.markUsedJustification(i,tt.anchor,de,et);const vt=this.placedOrientations[de.crossTileID];vt&&(this.markUsedJustification(i,"left",de,vt),this.markUsedOrientation(i,vt,de))}if(We){const Tt=Ei(Ce.icon);de.placedIconSymbolIndex>=0&&(ue(i.icon,de.numIconVertices,Ft?Si:Tt),i.icon.placedSymbolArray.get(de.placedIconSymbolIndex).hidden=Ce.icon.isHidden()),de.verticalPlacedIconSymbolIndex>=0&&(ue(i.icon,de.numVerticalIconVertices,bt?Si:Tt),i.icon.placedSymbolArray.get(de.verticalPlacedIconSymbolIndex).hidden=Ce.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Tt=i.collisionArrays[Se];if(Tt){let pt=new h.pointGeometry(0,0),tt=!0;if(Tt.textBox||Tt.verticalTextBox){if(j){const gt=this.variableOffsets[be];gt?(pt=Fs(gt.anchor,gt.width,gt.height,gt.textOffset,gt.textScale),q&&pt._rotate(Q?this.transform.angle:-this.transform.angle)):tt=!1}b&&(tt=!Ce.clipped),Tt.textBox&&qr(i.textCollisionBox.collisionVertexArray,Ce.text.placed,!tt||Ft,pt.x,pt.y),Tt.verticalTextBox&&qr(i.textCollisionBox.collisionVertexArray,Ce.text.placed,!tt||bt,pt.x,pt.y)}const vt=tt&&Boolean(!bt&&Tt.verticalIconBox);Tt.iconBox&&qr(i.iconCollisionBox.collisionVertexArray,Ce.icon.placed,vt,se?pt.x:0,se?pt.y:0),Tt.verticalIconBox&&qr(i.iconCollisionBox.collisionVertexArray,Ce.icon.placed,!vt,se?pt.x:0,se?pt.y:0)}}}if(i.fullyClipped=0===fe,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const Se=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=Se.invProjMatrix,i.placementViewportMatrix=Se.viewportMatrix,i.collisionCircleArray=Se.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return 0===this.fadeDuration?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,c){const m=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*m>i}setStale(){this.stale=!0}}function qr(f,i,c,m,v){f.emplaceBack(i?1:0,c?1:0,m||0,v||0),f.emplaceBack(i?1:0,c?1:0,m||0,v||0),f.emplaceBack(i?1:0,c?1:0,m||0,v||0),f.emplaceBack(i?1:0,c?1:0,m||0,v||0)}const rt=Math.pow(2,25),zt=Math.pow(2,24),dr=Math.pow(2,17),Qo=Math.pow(2,16),nr=Math.pow(2,9),ti=Math.pow(2,8),Gi=Math.pow(2,1);function Ei(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const i=f.placed?1:0,c=Math.floor(127*f.opacity);return c*rt+i*zt+c*dr+i*Qo+c*nr+i*ti+c*Gi+i}const Si=0;class kt{constructor(i){this._sortAcrossTiles="viewport-y"!==i.layout.get("symbol-z-order")&&void 0!==i.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,c,m,v,b){const T=this._bucketParts;for(;this._currentTileIndex<i.length;)if(c.getBucketParts(T,v,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((R,z)=>R.sortKey-z.sortKey));this._currentPartIndex<T.length;){const R=T[this._currentPartIndex];if(c.placeLayerBucketPart(R,this._seenCrossTileIDs,m,0===R.symbolInstanceStart),this._currentPartIndex++,b())return!0}return!1}}class Bn{constructor(i,c,m,v,b,T,R,z){this.placement=new $o(i,b,T,R,z),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(i,c,m){const v=h.exported.now(),b=()=>{const T=h.exported.now()-v;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=c[i[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if("symbol"===T.type&&(!T.minzoom||T.minzoom<=R)&&(!T.maxzoom||T.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new kt(T)),this._inProgressLayer.continuePlacement(m[T.source],this.placement,this._showCollisionBoxes,T,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Rn=512/h.EXTENT/2;class mi{constructor(i,c,m){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let v=0;v<c.length;v++){const b=c.get(v),T=b.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,i)})}}getScaledCoordinates(i,c){const m=Rn/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*h.EXTENT+i.tileAnchorX)*m),y:Math.floor((c.canonical.y*h.EXTENT+i.tileAnchorY)*m)}}findMatches(i,c,m){const v=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let b=0;b<i.length;b++){const T=i.get(b);if(T.crossTileID)continue;const R=this.indexedSymbolInstances[T.key];if(!R)continue;const z=this.getScaledCoordinates(T,c);for(const j of R)if(Math.abs(j.coord.x-z.x)<=v&&Math.abs(j.coord.y-z.y)<=v&&!m[j.crossTileID]){m[j.crossTileID]=!0,T.crossTileID=j.crossTileID;break}}}}class ho{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Fn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const c=Math.round((i-this.lng)/360);if(0!==c)for(const m in this.indexes){const v=this.indexes[m],b={};for(const T in v){const R=v[T];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+c),b[R.tileID.key]=R}this.indexes[m]=b}this.lng=i}addBucket(i,c,m){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let b=0;b<c.symbolInstances.length;b++)c.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const v=this.usedCrossTileIDs[i.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>i.overscaledZ)for(const R in T){const z=T[R];z.tileID.isChildOf(i)&&z.findMatches(c.symbolInstances,i,v)}else{const R=T[i.scaledTo(Number(b)).key];R&&R.findMatches(c.symbolInstances,i,v)}}for(let b=0;b<c.symbolInstances.length;b++){const T=c.symbolInstances.get(b);T.crossTileID||(T.crossTileID=m.generate(),v[T.crossTileID]=!0)}return void 0===this.indexes[i.overscaledZ]&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new mi(i,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(i,c){for(const m in c.indexedSymbolInstances)for(const v of c.indexedSymbolInstances[m])delete this.usedCrossTileIDs[i][v.crossTileID]}removeStaleBuckets(i){let c=!1;for(const m in this.indexes){const v=this.indexes[m];for(const b in v)i[v[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[b]),delete v[b],c=!0)}return c}}class Zo{constructor(){this.layerIndexes={},this.crossTileIDs=new ho,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,c,m,v){let b=this.layerIndexes[i.id];void 0===b&&(b=this.layerIndexes[i.id]=new Fn);let T=!1;const R={};"globe"!==v.name&&b.handleWrapJump(m);for(const z of c){const j=z.getBucket(i);j&&i.id===j.layerIds[0]&&(j.bucketInstanceId||(j.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(z.tileID,j,this.crossTileIDs)&&(T=!0),R[j.bucketInstanceId]=!0)}return b.removeStaleBuckets(R)&&(T=!0),T}pruneUnusedLayers(i){const c={};i.forEach(m=>{c[m]=!0});for(const m in this.layerIndexes)c[m]||delete this.layerIndexes[m]}}const es=(f,i)=>h.emitValidationErrors(f,i&&i.filter(c=>"source.canvas"!==c.identifier)),To=h.pick(ot,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ui=h.pick(ot,["setCenter","setZoom","setBearing","setPitch"]),Dr=function(){const f={},i=h.spec.$version;for(const c in h.spec.$root){const m=h.spec.$root[c];if(m.required){let v=null;v="version"===c?i:"array"===m.type?[]:{},null!=v&&(f[c]=v)}}return f}(),Gs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ii extends h.Evented{constructor(i,c={}){super(),this.map=i,this.dispatcher=new In(Oe(),this),this.imageManager=new qt,this.imageManager.setEventedParent(this),this.glyphManager=new h.GlyphManager(i._requestManager,c.localFontFamily?h.LocalGlyphMode.all:c.localIdeographFontFamily?h.LocalGlyphMode.ideographs:h.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.lineAtlas=new h.LineAtlas(256,512),this.crossTileSymbolIndex=new Zo,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new h.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",h.getReferrer());const m=this;this._rtlTextPluginCallback=Ii.registerForPluginStateChange(v=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(b,T)=>{if(h.triggerPluginCompletionEvent(b),T&&T.every(R=>R))for(const R in m._sourceCaches){const z=m._sourceCaches[R],j=z.getSource().type;"vector"!==j&&"geojson"!==j||z.reload()}})}),this.on("data",v=>{if("source"!==v.dataType||"metadata"!==v.sourceDataType)return;const b=this.getSource(v.sourceId);if(b&&b.vectorLayerIds)for(const T in this._layers){const R=this._layers[T];R.source===b.id&&this._validateLayer(R)}})}loadURL(i,c={}){this.fire(new h.Event("dataloading",{dataType:"style"}));const m="boolean"==typeof c.validate?c.validate:!h.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,c.accessToken);const v=this.map._requestManager.transformRequest(i,h.ResourceType.Style);this._request=h.getJSON(v,(b,T)=>{this._request=null,b?this.fire(new h.ErrorEvent(b)):T&&this._load(T,m)})}loadJSON(i,c={}){this.fire(new h.Event("dataloading",{dataType:"style"})),this._request=h.exported.frame(()=>{this._request=null,this._load(i,!1!==c.validate)})}loadEmpty(){this.fire(new h.Event("dataloading",{dataType:"style"})),this._load(Dr,!1)}_updateLayerCount(i,c){const m=c?1:-1;i.is3D()&&(this._num3DLayers+=m),"circle"===i.type&&(this._numCircleLayers+=m),"symbol"===i.type&&(this._numSymbolLayers+=m)}_load(i,c){if(c&&es(this,h.validateStyle(i)))return;this._loaded=!0,this.stylesheet=i,this.updateProjection();for(const v in i.sources)this.addSource(v,i.sources[v],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const m=lt(this.stylesheet.layers);this._order=m.map(v=>v.id),this._layers={},this._serializedLayers={};for(let v of m)v=h.createStyleLayer(v),v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new jt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new h.Event("data",{dataType:"style"})),this.fire(new h.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&0===this.terrain.drapeRenderMode}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const i=this.map.transform.projection,c=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),m=this.map.transform.projection;if(this._loaded&&(m.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),c){if(m.isReprojectedInTileSpace||i.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(i){this._spriteRequest=function(c,m,v){let b,T,R;const z=h.exported.devicePixelRatio>1?"@2x":"";let j=h.getJSON(m.transformRequest(m.normalizeSpriteURL(c,z,".json"),h.ResourceType.SpriteJSON),(se,he)=>{j=null,R||(R=se,b=he,Q())}),q=h.getImage(m.transformRequest(m.normalizeSpriteURL(c,z,".png"),h.ResourceType.SpriteImage),(se,he)=>{q=null,R||(R=se,T=he,Q())});function Q(){if(R)v(R);else if(b&&T){const se=h.exported.getImageData(T),he={};for(const ue in b){const{width:fe,height:Se,x:de,y:Ee,sdf:Ae,pixelRatio:be,stretchX:Ce,stretchY:Pe,content:We}=b[ue],et=new h.RGBAImage({width:fe,height:Se});h.RGBAImage.copy(se,et,{x:de,y:Ee},{x:0,y:0},{width:fe,height:Se}),he[ue]={data:et,pixelRatio:be,sdf:Ae,stretchX:Ce,stretchY:Pe,content:We}}v(null,he)}}return{cancel(){j&&(j.cancel(),j=null),q&&(q.cancel(),q=null)}}}(i,this.map._requestManager,(c,m)=>{if(this._spriteRequest=null,c)this.fire(new h.ErrorEvent(c));else if(m)for(const v in m)this.imageManager.addImage(v,m[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new h.Event("data",{dataType:"style"}))})}_validateLayer(i){const c=this.getSource(i.source);if(!c)return;const m=i.sourceLayer;m&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(m))&&this.fire(new h.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${c.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const c=[];for(const m of i){const v=this._layers[m];"custom"!==v.type&&c.push(v.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&Gs[i.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const c=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(v.length||b.length)&&this._updateWorkerLayers(v,b);for(const T in this._updatedSources){const R=this._updatedSources[T];"reload"===R?this._reloadSource(T):"clear"===R&&this._clearSource(T)}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const m={};for(const v in this._sourceCaches){const b=this._sourceCaches[v];m[v]=b.used,b.used=!1}for(const v of this._order){const b=this._layers[v];if(b.recalculate(i,this._availableImages),!b.isHidden(i.zoom)){const R=this._getLayerSourceCache(b);R&&(R.used=!0)}const T=this.map.painter;if(T){const R=b.getProgramIds();if(!R)continue;const z=b.getProgramConfiguration(i.zoom);for(const j of R)T.useProgram(j,z)}}for(const v in m){const b=this._sourceCaches[v];m[v]!==b.used&&b.getSource().fire(new h.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new h.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),es(this,h.validateStyle(i)))return!1;(i=h.clone$1(i)).layers=lt(i.layers);const c=function(v,b){if(!v)return[{command:ot.setStyle,args:[b]}];let T=[];try{if(!qe(v.version,b.version))return[{command:ot.setStyle,args:[b]}];qe(v.center,b.center)||T.push({command:ot.setCenter,args:[b.center]}),qe(v.zoom,b.zoom)||T.push({command:ot.setZoom,args:[b.zoom]}),qe(v.bearing,b.bearing)||T.push({command:ot.setBearing,args:[b.bearing]}),qe(v.pitch,b.pitch)||T.push({command:ot.setPitch,args:[b.pitch]}),qe(v.sprite,b.sprite)||T.push({command:ot.setSprite,args:[b.sprite]}),qe(v.glyphs,b.glyphs)||T.push({command:ot.setGlyphs,args:[b.glyphs]}),qe(v.transition,b.transition)||T.push({command:ot.setTransition,args:[b.transition]}),qe(v.light,b.light)||T.push({command:ot.setLight,args:[b.light]}),qe(v.fog,b.fog)||T.push({command:ot.setFog,args:[b.fog]}),qe(v.projection,b.projection)||T.push({command:ot.setProjection,args:[b.projection]});const R={},z=[];!function(Q,se,he,ue){let fe;for(fe in se=se||{},Q=Q||{})Q.hasOwnProperty(fe)&&(se.hasOwnProperty(fe)||Qt(fe,he,ue));for(fe in se)se.hasOwnProperty(fe)&&(Q.hasOwnProperty(fe)?qe(Q[fe],se[fe])||("geojson"===Q[fe].type&&"geojson"===se[fe].type&&Yt(Q,se,fe)?he.push({command:ot.setGeoJSONSourceData,args:[fe,se[fe].data]}):Gt(fe,se,he,ue)):mt(fe,se,he))}(v.sources,b.sources,z,R);const j=[];v.layers&&v.layers.forEach(Q=>{R[Q.source]?T.push({command:ot.removeLayer,args:[Q.id]}):j.push(Q)});let q=v.terrain;q&&R[q.source]&&(T.push({command:ot.setTerrain,args:[void 0]}),q=void 0),T=T.concat(z),qe(q,b.terrain)||T.push({command:ot.setTerrain,args:[b.terrain]}),function(Q,se,he){se=se||[];const ue=(Q=Q||[]).map(Mn),fe=se.map(Mn),Se=Q.reduce(xn,{}),de=se.reduce(xn,{}),Ee=ue.slice(),Ae=Object.create(null);let be,Ce,Pe,We,et,Ft,bt;for(be=0,Ce=0;be<ue.length;be++)Pe=ue[be],de.hasOwnProperty(Pe)?Ce++:(he.push({command:ot.removeLayer,args:[Pe]}),Ee.splice(Ee.indexOf(Pe,Ce),1));for(be=0,Ce=0;be<fe.length;be++)Pe=fe[fe.length-1-be],Ee[Ee.length-1-be]!==Pe&&(Se.hasOwnProperty(Pe)?(he.push({command:ot.removeLayer,args:[Pe]}),Ee.splice(Ee.lastIndexOf(Pe,Ee.length-Ce),1)):Ce++,Ft=Ee[Ee.length-be],he.push({command:ot.addLayer,args:[de[Pe],Ft]}),Ee.splice(Ee.length-be,0,Pe),Ae[Pe]=!0);for(be=0;be<fe.length;be++)if(Pe=fe[be],We=Se[Pe],et=de[Pe],!Ae[Pe]&&!qe(We,et))if(qe(We.source,et.source)&&qe(We["source-layer"],et["source-layer"])&&qe(We.type,et.type)){for(bt in sn(We.layout,et.layout,he,Pe,null,ot.setLayoutProperty),sn(We.paint,et.paint,he,Pe,null,ot.setPaintProperty),qe(We.filter,et.filter)||he.push({command:ot.setFilter,args:[Pe,et.filter]}),qe(We.minzoom,et.minzoom)&&qe(We.maxzoom,et.maxzoom)||he.push({command:ot.setLayerZoomRange,args:[Pe,et.minzoom,et.maxzoom]}),We)We.hasOwnProperty(bt)&&"layout"!==bt&&"paint"!==bt&&"filter"!==bt&&"metadata"!==bt&&"minzoom"!==bt&&"maxzoom"!==bt&&(0===bt.indexOf("paint.")?sn(We[bt],et[bt],he,Pe,bt.slice(6),ot.setPaintProperty):qe(We[bt],et[bt])||he.push({command:ot.setLayerProperty,args:[Pe,bt,et[bt]]}));for(bt in et)et.hasOwnProperty(bt)&&!We.hasOwnProperty(bt)&&"layout"!==bt&&"paint"!==bt&&"filter"!==bt&&"metadata"!==bt&&"minzoom"!==bt&&"maxzoom"!==bt&&(0===bt.indexOf("paint.")?sn(We[bt],et[bt],he,Pe,bt.slice(6),ot.setPaintProperty):qe(We[bt],et[bt])||he.push({command:ot.setLayerProperty,args:[Pe,bt,et[bt]]}))}else he.push({command:ot.removeLayer,args:[Pe]}),Ft=Ee[Ee.lastIndexOf(Pe)+1],he.push({command:ot.addLayer,args:[et,Ft]})}(j,b.layers,T)}catch(R){console.warn("Unable to compute style diff:",R),T=[{command:ot.setStyle,args:[b]}]}return T}(this.serialize(),i).filter(v=>!(v.command in ui));if(0===c.length)return!1;const m=c.filter(v=>!(v.command in To));if(m.length>0)throw new Error(`Unimplemented: ${m.map(v=>v.command).join(", ")}.`);return c.forEach(v=>{"setTransition"!==v.command&&this[v.command].apply(this,v.args)}),this.stylesheet=i,this.updateProjection(),!0}addImage(i,c){if(this.getImage(i))return this.fire(new h.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(i,c),this._afterImageUpdated(i)}updateImage(i,c){this.imageManager.updateImage(i,c)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new h.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,c,m={}){if(this._checkLoaded(),void 0!==this.getSource(i))throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(h.validateStyle.source,`sources.${i}`,c,null,m))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const v=zn(i,c,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:v.serialize(),sourceId:i}));const b=T=>{const R=(T?"symbol:":"other:")+i,z=this._sourceCaches[R]=new h.SourceCache(R,v,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[i]=z,z.style=this,z.onAdd(this.map)};b(!1),"vector"!==c.type&&"geojson"!==c.type||b(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const c=this.getSource(i);if(void 0===c)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===i)return this.fire(new h.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new h.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(i);for(const v of m)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new h.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,c){this._checkLoaded(),this.getSource(i).setData(c),this._changed=!0}getSource(i){const c=this._getSourceCache(i);return c&&c.getSource()}addLayer(i,c,m={}){this._checkLoaded();const v=i.id;if(this.getLayer(v))return void this.fire(new h.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let b;if("custom"===i.type){if(es(this,h.validateCustomStyleLayer(i)))return;b=h.createStyleLayer(i)}else{if("object"==typeof i.source&&(this.addSource(v,i.source),i=h.clone$1(i),i=h.extend(i,{source:v})),this._validate(h.validateStyle.layer,`layers.${v}`,i,{arrayIndex:-1},m))return;b=h.createStyleLayer(i),this._validateLayer(b),b.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const T=c?this._order.indexOf(c):this._order.length;if(c&&-1===T)return void this.fire(new h.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(T,0,v),this._layerOrderChanged=!0,this._layers[v]=b;const R=this._getLayerSourceCache(b);if(this._removedLayers[v]&&b.source&&R&&"custom"!==b.type){const z=this._removedLayers[v];delete this._removedLayers[v],z.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",R.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,c){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new h.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===c)return;const m=this._order.indexOf(i);this._order.splice(m,1);const v=c?this._order.indexOf(c):this._order.length;c&&-1===v?this.fire(new h.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(v,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const c=this._layers[i];if(!c)return void this.fire(new h.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const m=this._order.indexOf(i);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=c,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const c in this._layers)if(this._layers[c].type===i)return!0;return!1}setLayerZoomRange(i,c,m){this._checkLoaded();const v=this.getLayer(i);v?v.minzoom===c&&v.maxzoom===m||(null!=c&&(v.minzoom=c),null!=m&&(v.maxzoom=m),this._updateLayer(v)):this.fire(new h.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,c,m={}){this._checkLoaded();const v=this.getLayer(i);if(v){if(!qe(v.filter,c))return null==c?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(h.validateStyle.filter,`layers.${v.id}.filter`,c,{layerType:v.type},m)||(v.filter=h.clone$1(c),this._updateLayer(v)))}else this.fire(new h.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){return h.clone$1(this.getLayer(i).filter)}setLayoutProperty(i,c,m,v={}){this._checkLoaded();const b=this.getLayer(i);b?qe(b.getLayoutProperty(c),m)||(b.setLayoutProperty(c,m,v),this._updateLayer(b)):this.fire(new h.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,c){const m=this.getLayer(i);if(m)return m.getLayoutProperty(c);this.fire(new h.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,c,m,v={}){this._checkLoaded();const b=this.getLayer(i);b?qe(b.getPaintProperty(c),m)||(b.setPaintProperty(c,m,v)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new h.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,c){return this.getLayer(i).getPaintProperty(c)}setFeatureState(i,c){this._checkLoaded();const m=i.source,v=i.sourceLayer,b=this.getSource(m);if(void 0===b)return void this.fire(new h.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const T=b.type;if("geojson"===T&&v)return void this.fire(new h.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===T&&!v)return void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===i.id&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided.")));const R=this._getSourceCaches(m);for(const z of R)z.setFeatureState(v,i.id,c)}removeFeatureState(i,c){this._checkLoaded();const m=i.source,v=this.getSource(m);if(void 0===v)return void this.fire(new h.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const b=v.type,T="vector"===b?i.sourceLayer:void 0;if("vector"===b&&!T)return void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof i.id&&"number"!=typeof i.id)return void this.fire(new h.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const R=this._getSourceCaches(m);for(const z of R)z.removeFeatureState(T,i.id,c)}getFeatureState(i){this._checkLoaded();const c=i.source,m=i.sourceLayer,v=this.getSource(c);if(void 0!==v){if("vector"!==v.type||m)return void 0===i.id&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(m,i.id);this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new h.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return h.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const c in this._sourceCaches){const m=this._sourceCaches[c].getSource();i[m.id]||(i[m.id]=m.serialize())}return h.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},c=>void 0!==c)}_updateLayer(i){this._updatedLayers[i.id]=!0;const c=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&c&&"raster"!==c.getSource().type&&(this._updatedSources[i.source]="reload",c.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const c=T=>"fill-extrusion"===this._layers[T].type,m={},v=[];for(let T=this._order.length-1;T>=0;T--){const R=this._order[T];if(c(R)){m[R]=T;for(const z of i){const j=z[R];if(j)for(const q of j)v.push(q)}}}v.sort((T,R)=>R.intersectionZ-T.intersectionZ);const b=[];for(let T=this._order.length-1;T>=0;T--){const R=this._order[T];if(c(R))for(let z=v.length-1;z>=0;z--){const j=v[z].feature;if(m[j.layer.id]<T)break;b.push(j),v.pop()}else for(const z of i){const j=z[R];if(j)for(const q of j)b.push(q.feature)}}return b}queryRenderedFeatures(i,c,m){c&&c.filter&&this._validate(h.validateStyle.filter,"queryRenderedFeatures.filter",c.filter,null,c);const v={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new h.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const z of c.layers){const j=this._layers[z];if(!j)return this.fire(new h.ErrorEvent(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];v[j.source]=!0}}const b=[];c.availableImages=this._availableImages;const T=c&&c.layers?c.layers.some(z=>{const j=this.getLayer(z);return j&&j.is3D()}):this.has3DLayers(),R=rn.createFromScreenPoints(i,m);for(const z in this._sourceCaches){const j=this._sourceCaches[z].getSource().id;c.layers&&!v[j]||b.push(Z(this._sourceCaches[z],this._layers,this._serializedLayers,R,c,m,T,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(z,j,q,Q,se,he,ue){const fe={},Se=he.queryRenderedSymbols(Q),de=[];for(const Ee of Object.keys(Se).map(Number))de.push(ue[Ee]);de.sort(pe);for(const Ee of de){const Ae=Ee.featureIndex.lookupSymbolFeatures(Se[Ee.bucketInstanceId],j,Ee.bucketIndex,Ee.sourceLayerIndex,se.filter,se.layers,se.availableImages,z);for(const be in Ae){const Ce=fe[be]=fe[be]||[],Pe=Ae[be];Pe.sort((We,et)=>{const Ft=Ee.featureSortOrder;if(Ft){const bt=Ft.indexOf(We.featureIndex);return Ft.indexOf(et.featureIndex)-bt}return et.featureIndex-We.featureIndex});for(const We of Pe)Ce.push(We)}}for(const Ee in fe)fe[Ee].forEach(Ae=>{const be=Ae.feature,Ce=q(z[Ee]).getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=Ce});return fe}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),R.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(i,c){c&&c.filter&&this._validate(h.validateStyle.filter,"querySourceFeatures.filter",c.filter,null,c);const m=this._getSourceCaches(i);let v=[];for(const b of m)v=v.concat(re(b,c));return v}addSourceType(i,c,m){return Ii.getSourceType(i)?m(new Error(`A source type called "${i}" already exists.`)):(Ii.setSourceType(i,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:c.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(i,c={}){this._checkLoaded();const m=this.light.getLight();let v=!1;for(const T in i)if(!qe(i[T],m[T])){v=!0;break}if(!v)return;const b={now:h.exported.now(),transition:h.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,c),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,c=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===c){if("object"==typeof i.source){const m="terrain-dem-src";this.addSource(m,i.source),i=h.clone$1(i),i=h.extend(i,{source:m})}if(this._validate(h.validateStyle.terrain,"terrain",i))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode)this._createTerrain(i,c);else{const m=this.terrain,v=m.get();for(const b in i)if(!qe(i[b],v[b])){m.set(i),this.stylesheet.terrain=i;const T={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};m.updateTransitions(T);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const c=this.fog=new Mr(i,this.map.transform);this.stylesheet.fog=i;const m={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(m)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,m=c.get();for(const v in i)if(!qe(i[v],m[v])){c.set(i),this.stylesheet.fog=i;const b={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(b);break}}else this._createFog(i);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(m=>this.isLayerDraped(this._layers[m])),c=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...c)}_createTerrain(i,c){const m=this.terrain=new Kr(i,c);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const v={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};m.updateTransitions(v)}_force3DLayerUpdate(){for(const i in this._layers){const c=this._layers[i];"fill-extrusion"===c.type&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const c=this._layers[i];"symbol"===c.type&&this._updateLayer(c)}}_validate(i,c,m,v,b={}){return(!b||!1!==b.validate)&&es(this,i.call(h.validateStyle,h.extend({key:c,style:this.serialize(),value:m,styleSpec:h.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),h.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const c=this._getSourceCaches(i);for(const m of c)m.clearTiles()}_reloadSource(i){const c=this._getSourceCaches(i);for(const m of c)m.resume(),m.reload()}_updateSources(i){for(const c in this._sourceCaches)this._sourceCaches[c].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const c=this._sourceCaches[i];c.resume(),c.reload()}}_updatePlacement(i,c,m,v,b=!1){let T=!1,R=!1;const z={};for(const j of this._order){const q=this._layers[j];if("symbol"!==q.type)continue;if(!z[q.source]){const se=this._getLayerSourceCache(q);if(!se)continue;z[q.source]=se.getRenderableIds(!0).map(he=>se.getTileByID(he)).sort((he,ue)=>ue.tileID.overscaledZ-he.tileID.overscaledZ||(he.tileID.isLessThan(ue.tileID)?-1:1))}const Q=this.crossTileSymbolIndex.addLayer(q,z[q.source],i.center.lng,i.projection);T=T||Q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||0===m,this._layerOrderChanged&&this.fire(new h.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(h.exported.now(),i.zoom))&&(this.pauseablePlacement=new Bn(i,this._order,b,c,m,v,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(h.exported.now()),R=!0),T&&this.pauseablePlacement.placement.setStale()),R||T)for(const j of this._order){const q=this._layers[j];"symbol"===q.type&&this.placement.updateLayerOpacities(q,z[q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(h.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,c,m){this.imageManager.getImages(c.icons,m),this._updateTilesForChangedImages();const v=b=>{b&&b.setDependencies(c.tileID.key,c.type,c.icons)};v(this._otherSourceCaches[c.source]),v(this._symbolSourceCaches[c.source])}getGlyphs(i,c,m){this.glyphManager.getGlyphs(c.stacks,m)}getResource(i,c,m){return h.makeRequest(c,m)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return"symbol"===i.type?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const c=[];return this._otherSourceCaches[i]&&c.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&c.push(this._symbolSourceCaches[i]),c}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ii.getSourceType=function(f){return Co[f]},Ii.setSourceType=function(f,i){Co[f]=i},Ii.registerForPluginStateChange=h.registerForPluginStateChange;var Go="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Do="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Ho={},bs={};Ho=mn("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),bs=mn("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Jn=mn("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}\n#ifdef PROJECTION_GLOBE_VIEW\nmat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ao=Go;var po={background:mn("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:mn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:mn("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:mn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:mn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:mn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:mn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:mn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:mn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:mn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:mn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:mn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:mn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:mn("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:mn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:mn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:mn("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:mn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:mn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:mn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:mn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:mn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:mn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:mn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:mn("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Do),skyboxGradient:mn("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Do),skyboxCapture:mn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:mn("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:mn("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function mn(f,i,c){const m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,b=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),T=f.match(v),R=i.match(v),z=Go.match(v);let j=R?R.concat(T):T;c||(Ho.staticUniforms&&(j=Ho.staticUniforms.concat(j)),bs.staticUniforms&&(j=bs.staticUniforms.concat(j))),j&&(j=j.concat(z));const q={};return{fragmentSource:f=f.replace(m,(Q,se,he,ue,fe)=>(q[fe]=!0,"define"===se?`\n#ifndef HAS_UNIFORM_u_${fe}\nvarying ${he} ${ue} ${fe};\n#else\nuniform ${he} ${ue} u_${fe};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${fe}\n    ${he} ${ue} ${fe} = u_${fe};\n#endif\n`)),vertexSource:i=i.replace(m,(Q,se,he,ue,fe)=>{const Se="float"===ue?"vec2":"vec4",de=fe.match(/color/)?"color":Se;return q[fe]?"define"===se?`\n#ifndef HAS_UNIFORM_u_${fe}\nuniform lowp float u_${fe}_t;\nattribute ${he} ${Se} a_${fe};\nvarying ${he} ${ue} ${fe};\n#else\nuniform ${he} ${ue} u_${fe};\n#endif\n`:"vec4"===de?`\n#ifndef HAS_UNIFORM_u_${fe}\n    ${fe} = a_${fe};\n#else\n    ${he} ${ue} ${fe} = u_${fe};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${fe}\n    ${fe} = unpack_mix_${de}(a_${fe}, u_${fe}_t);\n#else\n    ${he} ${ue} ${fe} = u_${fe};\n#endif\n`:"define"===se?`\n#ifndef HAS_UNIFORM_u_${fe}\nuniform lowp float u_${fe}_t;\nattribute ${he} ${Se} a_${fe};\n#else\nuniform ${he} ${ue} u_${fe};\n#endif\n`:"vec4"===de?`\n#ifndef HAS_UNIFORM_u_${fe}\n    ${he} ${ue} ${fe} = a_${fe};\n#else\n    ${he} ${ue} ${fe} = u_${fe};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${fe}\n    ${he} ${ue} ${fe} = unpack_mix_${de}(a_${fe}, u_${fe}_t);\n#else\n    ${he} ${ue} ${fe} = u_${fe};\n#endif\n`}),staticAttributes:b,staticUniforms:j}}class Pi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,c,m,v,b,T,R,z){this.context=i;let j=this.boundPaintVertexBuffers.length!==v.length;for(let q=0;!j&&q<v.length;q++)this.boundPaintVertexBuffers[q]!==v[q]&&(j=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===m&&!j&&this.boundIndexBuffer===b&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===R&&this.boundDynamicVertexBuffer2===z?(i.bindVertexArrayOES.set(this.vao),R&&R.bind(),b&&b.dynamicDraw&&b.bind(),z&&z.bind()):this.freshBind(c,m,v,b,T,R,z)}freshBind(i,c,m,v,b,T,R){let z;const j=i.numAttributes,q=this.context,Q=q.gl;if(q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=q.extVertexArrayObject.createVertexArrayOES(),q.bindVertexArrayOES.set(this.vao),z=0,this.boundProgram=i,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=R;else{z=q.currentNumAttributes||0;for(let se=j;se<z;se++)Q.disableVertexAttribArray(se)}c.enableAttributes(Q,i);for(const se of m)se.enableAttributes(Q,i);T&&T.enableAttributes(Q,i),R&&R.enableAttributes(Q,i),c.bind(),c.setVertexAttribPointers(Q,i,b);for(const se of m)se.bind(),se.setVertexAttribPointers(Q,i,b);T&&(T.bind(),T.setVertexAttribPointers(Q,i,b)),v&&v.bind(),R&&(R.bind(),R.setVertexAttribPointers(Q,i,b)),q.currentNumAttributes=j}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ka(f,i){const c=Math.pow(2,i.canonical.z),m=i.canonical.y;return[new h.MercatorCoordinate(0,m/c).toLngLat().lat,new h.MercatorCoordinate(0,(m+1)/c).toLngLat().lat]}function fo(f,i,c,m,v,b,T){const R=f.context,z=R.gl,j=c.fbo;if(!j)return;f.prepareDrawTile(i);const q=f.useProgram("hillshade");R.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,j.colorAttachment.get());const Q=((fe,Se,de,Ee)=>{const Ae=de.paint.get("hillshade-shadow-color"),be=de.paint.get("hillshade-highlight-color"),Ce=de.paint.get("hillshade-accent-color");let Pe=de.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===de.paint.get("hillshade-illumination-anchor")&&(Pe-=fe.transform.angle);const We=!fe.options.moving;return{u_matrix:Ee||fe.transform.calculateProjMatrix(Se.tileID.toUnwrapped(),We),u_image:0,u_latrange:ka(0,Se.tileID),u_light:[de.paint.get("hillshade-exaggeration"),Pe],u_shadow:Ae,u_highlight:be,u_accent:Ce}})(f,c,m,f.terrain?i.projMatrix:null);f.prepareDrawProgram(R,q,i.toUnwrapped());const{tileBoundsBuffer:se,tileBoundsIndexBuffer:he,tileBoundsSegments:ue}=f.getTileBoundsBuffers(c);q.draw(R,z.TRIANGLES,v,b,T,h.CullFaceMode.disabled,Q,m.id,se,he,ue)}function Ar(f,i,c){if(!i.needsDEMTextureUpload)return;const m=f.context,v=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||f.getTileTexture(c.stride);const b=c.getPixels();i.demTexture?i.demTexture.update(b,{premultiply:!1}):i.demTexture=new h.Texture(m,b,v.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function Wr(f,i,c,m,v,b){const T=f.context,R=T.gl;if(!i.dem)return;const z=i.dem;if(T.activeTexture.set(R.TEXTURE1),Ar(f,i,z),!i.demTexture)return;i.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);const j=z.dim;T.activeTexture.set(R.TEXTURE0);let q=i.fbo;if(!q){const ue=new h.Texture(T,{width:j,height:j,data:null},R.RGBA);ue.bind(R.LINEAR,R.CLAMP_TO_EDGE),q=i.fbo=T.createFramebuffer(j,j,!0),q.colorAttachment.set(ue.texture)}T.bindFramebuffer.set(q.framebuffer),T.viewport.set([0,0,j,j]);const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:se,tileBoundsSegments:he}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(T,R.TRIANGLES,m,v,b,h.CullFaceMode.disabled,((ue,fe)=>{const Se=fe.stride,de=h.create();return h.ortho(de,0,h.EXTENT,-h.EXTENT,0,0,1),h.translate(de,de,[0,-h.EXTENT,0]),{u_matrix:de,u_image:1,u_dimension:[Se,Se],u_zoom:ue.overscaledZ,u_unpack:fe.unpackVector}})(i.tileID,z),c.id,Q,se,he),i.needsHillshadePrepare=!1}const qo=(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_image0:new h.Uniform1i(f,i.u_image0),u_skirt_height:new h.Uniform1f(f,i.u_skirt_height)}),gi=(f,i)=>({u_matrix:f,u_image0:0,u_skirt_height:i}),an=(f,i,c,m,v)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:i,u_merc_matrix:c,u_zoom_transition:m,u_merc_center:v,u_image0:0});function Hi(f,i){return null!=f&&null!=i&&!(!f.hasData()||!i.hasData())&&null!=f.demTexture&&null!=i.demTexture&&f.tileID.key!==i.tileID.key}const Mo=new class{constructor(){this.operations={}}newMorphing(f,i,c,m,v){if(f in this.operations){const b=this.operations[f];b.to.tileID.key!==c.tileID.key&&(b.queued=c)}else this.operations[f]={startTime:m,phase:0,duration:v,from:i,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const i=this.operations[f];return{from:i.from,to:i.to,phase:i.phase}}update(f){for(const i in this.operations){const c=this.operations[i];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[i];break}}}_nextOp(f,i){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=i,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},mo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Hs(f,i){const c=1<<f.z;return!i&&(0===f.x||f.x===c-1)||0===f.y||f.y===c-1}const Ti=f=>({u_matrix:f});function H(f,i,c,m,v){if(v>0){const b=h.exported.now(),T=(b-f.timeAdded)/v,R=i?(b-i.timeAdded)/v:-1,z=c.getSource(),j=m.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),q=!i||Math.abs(i.tileID.overscaledZ-j)>Math.abs(f.tileID.overscaledZ-j),Q=q&&f.refreshedUponExpiration?1:h.clamp(q?T:1-R,0,1);return f.refreshedUponExpiration&&T>=1&&(f.refreshedUponExpiration=!1),i?{opacity:1,mix:1-Q}:{opacity:Q,mix:0}}return{opacity:1,mix:0}}class ie extends h.SourceCache{constructor(i){const c={type:"raster-dem",maxzoom:i.transform.maxZoom},m=new In(Oe(),null),v=zn("mock-dem",c,m,i.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,c){i.state="loaded",c(null)}}class G extends h.SourceCache{constructor(i){const c=zn("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new In(Oe(),null),i.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,c,m){if(i.freezeTileCoverage)return;this.transform=i;const v=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,T)=>{if(b[T.key]="",!this._tiles[T.key]){const R=new h.Tile(T,this._source.tileSize*T.overscaleFactor(),i.tileZoom);R.state="loaded",this._tiles[T.key]=R}return b},{});for(const b in this._tiles)b in v||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(i){const c=this.proxyCachedFBO[i];if(void 0!==c){const m=Object.values(c);this.renderCachePool.push(...m),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class S extends h.OverscaledTileID{constructor(i,c,m){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=c,this.projMatrix=m}}class k extends h.Elevation{constructor(i,c){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,v,b]=function(z){const j=new h.StructArrayLayout4i8,q=new h.StructArrayLayout3ui6,Q=131;j.reserve(17161),q.reserve(33800);const se=h.EXTENT/128,he=h.EXTENT+se/2,ue=he+se;for(let Se=-se;Se<ue;Se+=se)for(let de=-se;de<ue;de+=se){const Ee=de<0||de>he||Se<0||Se>he?24575:0,Ae=h.clamp(Math.round(de),0,h.EXTENT),be=h.clamp(Math.round(Se),0,h.EXTENT);j.emplaceBack(Ae+Ee,be,Ae,be)}const fe=(Se,de)=>{const Ee=de*Q+Se;q.emplaceBack(Ee+1,Ee,Ee+Q),q.emplaceBack(Ee+Q,Ee+Q+1,Ee+1)};for(let Se=1;Se<129;Se++)for(let de=1;de<129;de++)fe(de,Se);return[0,129].forEach(Se=>{for(let de=0;de<130;de++)fe(de,Se),fe(Se,de)}),[j,q,32768]}(),T=i.context;this.gridBuffer=T.createVertexBuffer(m,h.boundsAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(v),this.gridSegments=h.SegmentVector.simpleSegment(0,0,m.length,v.length),this.gridNoSkirtSegments=h.SegmentVector.simpleSegment(0,0,m.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new G(c.map),this.orthoMatrix=h.create(),h.ortho(this.orthoMatrix,0,h.EXTENT,0,h.EXTENT,0,1);const R=T.gl;this._overlapStencilMode=new h.StencilMode({func:R.GEQUAL,mask:255},0,255,R.KEEP,R.KEEP,R.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ie(c.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency()}update(i,c,m){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const v=i.terrain.properties;this.sourceCache=0===i.terrain.drapeRenderMode?this._mockSourceCache:i._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const b=()=>{this.sourceCache.used&&h.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const T=this.getScaledDemTileSize();this.sourceCache.update(c,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),c.updateElevation(!m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==i.efficiency&&h.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&"source"===i.dataType?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):"style"===i.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=0===m._centerAltitude&&-1===this.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(m.center),-1),this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=c.getIds().map(z=>{const j=c.getTileByID(z).tileID;return j.projMatrix=m.calculateProjMatrix(j.toUnwrapped()),j});(function(z,j){const q=j.transform.pointCoordinate(j.transform.getCameraPoint()),Q=new h.pointGeometry(q.x,q.y);z.sort((se,he)=>{if(he.overscaledZ-se.overscaledZ)return he.overscaledZ-se.overscaledZ;const ue=new h.pointGeometry(se.canonical.x+(1<<se.canonical.z)*se.wrap,se.canonical.y),fe=new h.pointGeometry(he.canonical.x+(1<<he.canonical.z)*he.wrap,he.canonical.y),Se=Q.mult(1<<se.canonical.z);return Se.x-=.5,Se.y-=.5,Se.distSqr(ue)-Se.distSqr(fe)})})(v,this.painter),this._previousZoom=m.zoom;const b=this.proxyToSource||{};this.proxyToSource={},v.forEach(z=>{this.proxyToSource[z.key]={}}),this.terrainTileForTile={};const T=this._style._sourceCaches;for(const z in T){const j=T[z];if(!j.used||(j!==this.sourceCache&&this.resetTileLookupCache(j.id),this._setupProxiedCoordsForOrtho(j,i[z],b),j.usedForTerrain))continue;const q=i[z];j.getSource().reparseOverscaled&&this._assignTerrainTiles(q)}this.proxiedCoords[c.id]=v.map(z=>new S(z,z.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=h.exported.now();const R={};this._visibleDemTiles=[];for(const z of this.proxyCoords){const j=this.terrainTileForTile[z.key];if(!j)continue;const q=j.tileID.key;q in R||(this._visibleDemTiles.push(j),R[q]=q)}}_assignTerrainTiles(i){this._initializing||i.forEach(c=>{if(this.terrainTileForTile[c.key])return;const m=this._findTileCoveringTileID(c,this.sourceCache);m&&(this.terrainTileForTile[c.key]=m)})}_prepareDEMTextures(){const i=this.painter.context,c=i.gl;for(const m in this.terrainTileForTile){const v=this.terrainTileForTile[m],b=v.dem;!b||v.demTexture&&!v.needsDEMTextureUpload||(i.activeTexture.set(c.TEXTURE1),Ar(this.painter,v,b))}}_prepareDemTileUniforms(i,c,m,v){if(!c||null==c.demTexture)return!1;const b=i.tileID.canonical,T=Math.pow(2,c.tileID.canonical.z-b.z),R=v||"";return m[`u_dem_tl${R}`]=[b.x*T%1,b.y*T%1],m[`u_dem_scale${R}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,c=i.gl;if(!this._emptyDepthBufferTexture){const m={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new h.Texture(i,m,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const c=this._visibleDemTiles.reduce((m,v)=>{if(!v.dem)return m;const b=v.dem.tree.minimums[0];return b>0&&i++,m+b},0);return i?c/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,c=i.gl;i.activeTexture.set(c.TEXTURE2);const m=this._getLoadedAreaMinimum(),v={width:1,height:1,data:new Uint8Array(h.DEMData.pack(m,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new h.Texture(i,v,c.RGBA,{premultiply:!1}),b}setupElevationDraw(i,c,m){const v=this.painter.context,b=v.gl,T=(R=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:h.DEMData.getUnpackVector(R),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var R;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();const z=this.painter.transform,j=z.projection.createTileTransform(z,z.worldSize),q=i.tileID.canonical;T.u_tile_tl_up=j.upVector(q,0,0),T.u_tile_tr_up=j.upVector(q,h.EXTENT,0),T.u_tile_br_up=j.upVector(q,h.EXTENT,h.EXTENT),T.u_tile_bl_up=j.upVector(q,0,h.EXTENT),T.u_tile_up_scale=j.upVectorScale(q);let Q=null,se=null,he=1;if(m&&m.morphing&&this._useVertexMorphing){const ue=m.morphing.srcDemTile,fe=m.morphing.dstDemTile;he=m.morphing.phase,ue&&fe&&(this._prepareDemTileUniforms(i,ue,T,"_prev")&&(se=ue),this._prepareDemTileUniforms(i,fe,T)&&(Q=fe))}if(se&&Q?(v.activeTexture.set(b.TEXTURE2),Q.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),v.activeTexture.set(b.TEXTURE4),se.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),T.u_dem_lerp=he):(Q=this.terrainTileForTile[i.tileID.key],v.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(i,Q,T)?Q.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),v.activeTexture.set(b.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&Q){const ue=(1<<Q.tileID.canonical.z)*h.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=ue}m&&m.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),c.setTerrainUniformValues(v,T)}renderToBackBuffer(i){const c=this.painter,m=this.painter.context;0!==i.length&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),this.renderingToTexture=!1,function(v,b,T,R,z){if("globe"===v.transform.projection.name)!function(j,q,Q,se,he){const ue=j.context,fe=ue.gl;let Se,de;const Ee=j.options.showTerrainWireframe?2:0,Ae=(Tt,pt)=>{if(de===Tt)return;const tt=[];pt&&tt.push(mo[Ee]),tt.push(mo[Tt]),tt.push("PROJECTION_GLOBE_VIEW"),Se=j.useProgram("globeRaster",null,tt),de=Tt},be=j.colorModeForRenderPass(),Ce=new h.DepthMode(fe.LEQUAL,h.DepthMode.ReadWrite,j.depthRangeFor3D);Mo.update(he);const Pe=j.transform,We=h.calculateGlobeMatrix(Pe,Pe.worldSize),et=h.calculateGlobeMercatorMatrix(Pe),Ft=[h.mercatorXfromLng(Pe.center.lng),h.mercatorYfromLat(Pe.center.lat)],bt=j.globeSharedBuffers;(Ee?[!1,!0]:[!1]).forEach(Tt=>{de=-1;const pt=Tt?fe.LINES:fe.TRIANGLES;for(const tt of se){const vt=Q.getTile(tt),gt=Math.pow(2,tt.canonical.z),[on,gn]=h.globeBuffersForTileMesh(j,vt,tt,gt),Zn=h.StencilMode.disabled,Ot=q.prevTerrainTileForTile[tt.key],ln=q.terrainTileForTile[tt.key];Hi(Ot,ln)&&Mo.newMorphing(tt.key,Ot,ln,he,250),ue.activeTexture.set(fe.TEXTURE0),vt.texture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE);const Vn=Mo.getMorphValuesForProxy(tt.key),Or=Vn?1:0,Yr={};Vn&&h.extend$1(Yr,{morphing:{srcDemTile:Vn.from,dstDemTile:Vn.to,phase:h.easeCubicInOut(Vn.phase)}});const vn=h.globeMatrixForTile(tt.canonical,We),lr=an(Pe.projMatrix,vn,et,h.globeToMercatorTransition(Pe.zoom),Ft);if(Ae(Or,Tt),q.setupElevationDraw(vt,Se,Yr),j.prepareDrawProgram(ue,Se,tt.toUnwrapped()),bt){const[vi,vo]=Tt?bt.getWirefameBuffer(j.context):[bt.gridIndexBuffer,bt.gridSegments];Se.draw(ue,pt,Ce,Zn,be,h.CullFaceMode.backCCW,lr,"globe_raster",on,vi,vo)}if(!Tt){const vi=[0===tt.canonical.y?h.globePoleMatrixForTile(tt.canonical,!1,Pe):null,tt.canonical.y===gt-1?h.globePoleMatrixForTile(tt.canonical,!0,Pe):null];for(const vo of vi){if(!vo)continue;const rs=an(Pe.projMatrix,vo,vo,0,Ft);bt&&Se.draw(ue,pt,Ce,Zn,be,h.CullFaceMode.disabled,rs,"globe_pole_raster",gn,bt.poleIndexBuffer,bt.poleSegments)}}}})}(v,b,T,R,z);else{const j=v.context,q=j.gl;let Q,se;const he=v.options.showTerrainWireframe?2:0,ue=(Ae,be)=>{if(se===Ae)return;const Ce=[mo[Ae]];be&&Ce.push(mo[he]),Q=v.useProgram("terrainRaster",null,Ce),se=Ae},fe=v.colorModeForRenderPass(),Se=new h.DepthMode(q.LEQUAL,h.DepthMode.ReadWrite,v.depthRangeFor3D);Mo.update(z);const de=v.transform,Ee=6*Math.pow(1.5,22-de.zoom)*b.exaggeration();(he?[!1,!0]:[!1]).forEach(Ae=>{se=-1;const be=Ae?q.LINES:q.TRIANGLES,[Ce,Pe]=Ae?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const We of R){const et=T.getTile(We),Ft=h.StencilMode.disabled,bt=b.prevTerrainTileForTile[We.key],Tt=b.terrainTileForTile[We.key];Hi(bt,Tt)&&Mo.newMorphing(We.key,bt,Tt,z,250),j.activeTexture.set(q.TEXTURE0),et.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST);const pt=Mo.getMorphValuesForProxy(We.key),tt=pt?1:0;let vt;pt&&(vt={morphing:{srcDemTile:pt.from,dstDemTile:pt.to,phase:h.easeCubicInOut(pt.phase)}});const gt=gi(We.projMatrix,Hs(We.canonical,de.renderWorldCopies)?Ee/10:Ee);ue(tt,Ae),b.setupElevationDraw(et,Q,vt),v.prepareDrawProgram(j,Q,We.toUnwrapped()),Q.draw(j,be,Se,Ft,fe,h.CullFaceMode.backCCW,gt,"terrain_raster",b.gridBuffer,Ce,Pe)}})}}(c,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,i.splice(0,i.length))}renderBatch(i){if(0===this._drapedRenderBatches.length)return i+1;this.renderingToTexture=!0;const c=this.painter,m=this.painter.context,v=this.proxySourceCache,b=this.proxiedCoords[v.id],T=this._drapedRenderBatches.shift(),R=[],z=c.style.order;let j=0;for(const q of b){const Q=v.getTileByID(q.proxyTileKey),se=v.proxyCachedFBO[q.key]?v.proxyCachedFBO[q.key][i]:void 0,he=void 0!==se?v.renderCache[se]:this.pool[j++],ue=void 0!==se;if(Q.texture=he.tex,ue&&!he.dirty){R.push(Q.tileID);continue}let fe;m.bindFramebuffer.set(he.fb.framebuffer),this.renderedToTile=!1,he.dirty&&(m.clear({color:h.Color.transparent,stencil:0}),he.dirty=!1);for(let Se=T.start;Se<=T.end;++Se){const de=c.style._layers[z[Se]];if(de.isHidden(c.transform.zoom))continue;const Ee=c.style._getLayerSourceCache(de),Ae=Ee?this.proxyToSource[q.key][Ee.id]:[q];if(!Ae)continue;const be=Ae;m.viewport.set([0,0,he.fb.width,he.fb.height]),fe!==(Ee?Ee.id:null)&&(this._setupStencil(he,Ae,de,Ee),fe=Ee?Ee.id:null),c.renderLayer(c,Ee,de,be)}this.renderedToTile?(he.dirty=!0,R.push(Q.tileID)):ue||--j,5===j&&(j=0,this.renderToBackBuffer(R))}return this.renderToBackBuffer(R),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),T.end+1}postRender(){}renderCacheEfficiency(i){const c=i.order.length;if(0===c)return{efficiency:100};let m,v=0,b=0,T=!1;for(let R=0;R<c;++R){const z=i._layers[i.order[R]];this._style.isLayerDraped(z)?(T&&++v,++b):T||(T=!0,m=z.id)}return 0===b?{efficiency:100}:{efficiency:100*(1-v/b),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{i=Math.min(i,c.dem.tree.minimums[0])}),0===i?i:(i-30)*this._exaggeration}raycast(i,c,m){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const T=b.tileID,R=Math.pow(2,T.overscaledZ),{x:z,y:j}=T.canonical,q=z/R,Q=(z+1)/R,se=j/R,he=(j+1)/R;return{minx:q,miny:se,maxx:Q,maxy:he,t:b.dem.tree.raycastRoot(q,se,Q,he,i,c,m),tile:b}});v.sort((b,T)=>(null!==b.t?b.t:Number.MAX_VALUE)-(null!==T.t?T.t:Number.MAX_VALUE));for(const b of v){if(null==b.t)return null;const T=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,i,c,m);if(null!=T)return T}return null}_createFBO(){const i=this.painter.context,c=i.gl,m=this.drapeBufferSize;i.activeTexture.set(c.TEXTURE0);const v=new h.Texture(i,{width:m[0],height:m[1],data:null},c.RGBA);v.bind(c.LINEAR,c.CLAMP_TO_EDGE);const b=i.createFramebuffer(m[0],m[1],!1);return b.colorAttachment.set(v.texture),b.depthAttachment=new Nr(i,b.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:b,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const c=this._style._layers[i],m=c.isHidden(this.painter.transform.zoom),v=c.getCrossfadeParameters(),b=!!v&&1!==v.t,T=c.hasTransition();return"custom"!==c.type&&!m&&(b||T)})}_clearRasterFadeFromRenderCache(){let i=!1;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c]._source instanceof di){i=!0;break}if(i)for(let c=0;c<this._style.order.length;++c){const m=this._style._layers[this._style.order[c]],v=m.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(m);if("raster"!==m.type||v||!b)continue;const T=m.paint.get("raster-fade-duration");for(const R of this.proxyCoords){const z=this.proxyToSource[R.key][b.id];if(z)for(const j of z){const q=H(b.getTile(j),b.findLoadedParent(j,0),b,this.painter.transform,T);(1!==q.opacity||0!==q.mix)&&this._clearRenderCacheForTile(b.id,j)}}}}_setupDrapedRenderBatches(){const i=this._style.order,c=i.length;if(0===c)return;const m=[];let v,b=0,T=this._style._layers[i[b]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++b<c;)T=this._style._layers[i[b]];for(;b<c;++b){const R=this._style._layers[i[b]];R.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(R)?void 0===v&&(v=b):void 0!==v&&(m.push({start:v,end:b-1}),v=void 0))}void 0!==v&&m.push({start:v,end:b-1}),this._drapedRenderBatches=m}_setupRenderCache(i){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const T=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let R=0;R<T.length;++R){const z=Object.values(T[R]);c.renderCachePool.push(...z)}}return}this._clearRasterFadeFromRenderCache();const m=this.proxyCoords,v=this._tilesDirty;for(let T=m.length-1;T>=0;T--){const R=m[T];if(c.getTileByID(R.key),void 0!==c.proxyCachedFBO[R.key]){const z=i[R.key],j=this.proxyToSource[R.key];let q=0;for(const Q in j){const se=j[Q],he=z[Q];if(!he||he.length!==se.length||se.some((ue,fe)=>ue!==he[fe]||v[Q]&&v[Q].hasOwnProperty(ue.key))){q=-1;break}++q}for(const Q in c.proxyCachedFBO[R.key])c.renderCache[c.proxyCachedFBO[R.key][Q]].dirty=q<0||q!==Object.values(z).length}}const b=[...this._drapedRenderBatches];b.sort((T,R)=>R.end-R.start-(T.end-T.start));for(const T of b)for(const R of m){if(c.proxyCachedFBO[R.key])continue;let z=c.renderCachePool.pop();void 0===z&&c.renderCache.length<50&&(z=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==z&&(c.proxyCachedFBO[R.key]={},c.proxyCachedFBO[R.key][T.start]=z,c.renderCache[z].dirty=!0)}this._tilesDirty={}}_setupStencil(i,c,m,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,T=b.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let R;if(m.isTileClipped())R=c.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);R=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+R>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=R,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):h.StencilMode.disabled}_renderTileClippingMasks(i,c){const m=this.painter,v=this.painter.context,b=v.gl;m._tileClippingMaskIDs={},v.setColorMode(h.ColorMode.disabled),v.setDepthMode(h.DepthMode.disabled);const T=m.useProgram("clippingMask");for(const R of i){const z=m._tileClippingMaskIDs[R.key]=--c;T.draw(v,b.TRIANGLES,h.DepthMode.disabled,new h.StencilMode({func:b.ALWAYS,mask:0},z,255,b.KEEP,b.KEEP,b.REPLACE),h.ColorMode.disabled,h.CullFaceMode.disabled,Ti(R.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(i){const c=this.painter.transform;if(i.x<0||i.x>c.width||i.y<0||i.y>c.height)return null;const m=[i.x,i.y,1,1];h.transformMat4$1(m,m,c.pixelMatrixInverse),h.scale$1(m,m,1/m[3]),m[0]/=c.worldSize,m[1]/=c.worldSize;const v=c._camera.position,b=h.mercatorZfromAltitude(1,c.center.lat),T=[v[0],v[1],v[2]/b,0],R=h.subtract([],m.slice(0,3),T);h.normalize(R,R);const z=this.raycast(T,R,this._exaggeration);return null!==z&&z?(h.scaleAndAdd(T,T,R,z),T[3]=T[2],T[2]*=b,T):null}drawDepth(){const i=this.painter,c=i.context,m=this.proxySourceCache,v=Math.ceil(i.width),b=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===b||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const T=c.gl,R=c.createFramebuffer(v,b,!0);c.activeTexture.set(T.TEXTURE0);const z=new h.Texture(c,{width:v,height:b,data:null},T.RGBA);z.bind(T.NEAREST,T.CLAMP_TO_EDGE),R.colorAttachment.set(z.texture);const j=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,v,b);R.depthAttachment.set(j),this._depthFBO=R,this._depthTexture=z}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,v,b]),function(T,R,z,j){if("globe"===T.transform.projection.name)return;const q=T.context,Q=q.gl;q.clear({depth:1});const se=T.useProgram("terrainDepth"),he=new h.DepthMode(Q.LESS,h.DepthMode.ReadWrite,T.depthRangeFor3D);for(const ue of j){const fe=z.getTile(ue),Se=gi(ue.projMatrix,0);R.setupElevationDraw(fe,se),se.draw(q,Q.TRIANGLES,he,h.StencilMode.disabled,h.ColorMode.unblended,h.CullFaceMode.backCCW,Se,"terrain_depth",R.gridBuffer,R.gridIndexBuffer,R.gridNoSkirtSegments)}}(i,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,c,m){if(i.getSource()instanceof jo)return this._setupProxiedCoordsForImageSource(i,c,m);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const v=this.proxiedCoords[i.id]=[],b=this.proxyCoords;for(let R=0;R<b.length;R++){const z=b[R],j=this._findTileCoveringTileID(z,i);if(j){const q=this._createProxiedId(z,j,m[z.key]&&m[z.key][i.id]);v.push(q),this.proxyToSource[z.key][i.id]=[q]}}let T=!1;for(let R=0;R<c.length;R++){const z=i.getTile(c[R]);if(!z||!z.hasData())continue;const j=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(j&&j.tileID.canonical.z!==z.tileID.canonical.z){const q=this.proxyToSource[j.tileID.key][i.id],Q=this._createProxiedId(j.tileID,z,m[j.tileID.key]&&m[j.tileID.key][i.id]);q?q.splice(q.length-1,0,Q):this.proxyToSource[j.tileID.key][i.id]=[Q],v.push(Q),T=!0}}this._sourceTilesOverlap[i.id]=T}_setupProxiedCoordsForImageSource(i,c,m){if(!i.getSource().loaded())return;const v=this.proxiedCoords[i.id]=[],b=this.proxyCoords,T=i.getSource(),R=new h.pointGeometry(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),z=T.coordinates.map(h.MercatorCoordinate.fromLngLat).reduce((q,Q)=>(q.min.x=Math.min(q.min.x,Q.x-R.x),q.min.y=Math.min(q.min.y,Q.y-R.y),q.max.x=Math.max(q.max.x,Q.x-R.x),q.max.y=Math.max(q.max.y,Q.y-R.y),q),{min:new h.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new h.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),j=(q,Q)=>{const se=q.wrap+q.canonical.x/(1<<q.canonical.z),he=q.canonical.y/(1<<q.canonical.z),ue=h.EXTENT/(1<<q.canonical.z),fe=Q.wrap+Q.canonical.x/(1<<Q.canonical.z),Se=Q.canonical.y/(1<<Q.canonical.z);return se+ue<fe+z.min.x||se>fe+z.max.x||he+ue<Se+z.min.y||he>Se+z.max.y};for(let q=0;q<b.length;q++){const Q=b[q];for(let se=0;se<c.length;se++){const he=i.getTile(c[se]);if(!he||!he.hasData()||j(Q,he.tileID))continue;const ue=this._createProxiedId(Q,he,m[Q.key]&&m[Q.key][i.id]),fe=this.proxyToSource[Q.key][i.id];fe?fe.push(ue):this.proxyToSource[Q.key][i.id]=[ue],v.push(ue)}}}_createProxiedId(i,c,m){let v=this.orthoMatrix;if(m){const b=m.find(T=>T.key===c.tileID.key);if(b)return b}if(c.tileID.key!==i.key){const b=i.canonical.z-c.tileID.canonical.z;let T,R,z;v=h.create();const j=c.tileID.wrap-i.wrap<<i.overscaledZ;b>0?(T=h.EXTENT>>b,R=T*((c.tileID.canonical.x<<b)-i.canonical.x+j),z=T*((c.tileID.canonical.y<<b)-i.canonical.y)):(T=h.EXTENT<<-b,R=h.EXTENT*(c.tileID.canonical.x-(i.canonical.x+j<<-b)),z=h.EXTENT*(c.tileID.canonical.y-(i.canonical.y<<-b))),h.ortho(v,0,T,0,T,0,1),h.translate(v,v,[R,z,0])}return new S(c.tileID,i.key,v)}_findTileCoveringTileID(i,c){let m=c.getTile(i);if(m&&m.hasData())return m;const v=this._findCoveringTileCache[c.id],b=v[i.key];if(m=b?c.getTileByID(b):null,m&&m.hasData()||null===b)return m;let T=m?m.tileID:i,R=T.overscaledZ;const z=c.getSource().minzoom,j=[];if(!b){const Q=c.getSource().maxzoom;if(i.canonical.z>=Q){const se=i.canonical.z-Q;c.getSource().reparseOverscaled?(R=Math.max(i.canonical.z+2,c.transform.tileZoom),T=new h.OverscaledTileID(R,i.wrap,Q,i.canonical.x>>se,i.canonical.y>>se)):0!==se&&(R=Q,T=new h.OverscaledTileID(R,i.wrap,Q,i.canonical.x>>se,i.canonical.y>>se))}T.key!==i.key&&(j.push(T.key),m=c.getTile(T))}const q=Q=>{j.forEach(se=>{v[se]=Q}),j.length=0};for(R-=1;R>=z&&(!m||!m.hasData());R--){m&&q(m.tileID.key);const Q=T.calculateScaledKey(R);if(m=c.getTileByID(Q),m&&m.hasData())break;const se=v[Q];if(null===se)break;void 0===se?j.push(Q):m=c.getTileByID(se)}return q(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(i){this.renderedToTile=!0}_clearRenderCacheForTile(i,c){let m=this._tilesDirty[i];m||(m=this._tilesDirty[i]={}),m[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(c){let m,v,b;const T=new h.StructArrayLayout2ui4,R=131;for(v=1;v<129;v++){for(m=1;m<129;m++)b=v*R+m,T.emplaceBack(b,b+1),T.emplaceBack(b,b+R),T.emplaceBack(b+1,b+R),128===v&&T.emplaceBack(b+R,b+R+1);T.emplaceBack(b+1,b+1+R)}return T}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=h.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function I(f){const i=[];for(let c=0;c<f.length;c++){if(null===f[c])continue;const m=f[c].split(" ");i.push(m.pop())}return i}class K{static cacheKey(i,c,m){let v=`${i}${m?m.cacheKey:""}`;for(const b of c)v+=`/${b}`;return v}constructor(i,c,m,v,b,T){const R=i.gl;this.program=R.createProgram();const z=I(m.staticAttributes),j=v?v.getBinderAttributes():[],q=z.concat(j),Q=m.staticUniforms?I(m.staticUniforms):[],se=v?v.getBinderUniforms():[],he=Q.concat(se),ue=[];for(const Ce of he)ue.indexOf(Ce)<0&&ue.push(Ce);let fe=v?v.defines():[];fe=fe.concat(T.map(Ce=>`#define ${Ce}`));const Se=fe.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ao,Jn.fragmentSource,bs.fragmentSource,m.fragmentSource).join("\n"),de=fe.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ao,Jn.vertexSource,bs.vertexSource,Ho.vertexSource,m.vertexSource).join("\n"),Ee=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);R.shaderSource(Ee,Se),R.compileShader(Ee),R.attachShader(this.program,Ee);const Ae=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);R.shaderSource(Ae,de),R.compileShader(Ae),R.attachShader(this.program,Ae),this.attributes={};const be={};this.numAttributes=q.length;for(let Ce=0;Ce<this.numAttributes;Ce++)q[Ce]&&(R.bindAttribLocation(this.program,Ce,q[Ce]),this.attributes[q[Ce]]=Ce);R.linkProgram(this.program),R.deleteShader(Ae),R.deleteShader(Ee);for(let Ce=0;Ce<ue.length;Ce++){const Pe=ue[Ce];if(Pe&&!be[Pe]){const We=R.getUniformLocation(this.program,Pe);We&&(be[Pe]=We)}}var Ce,Pe;this.fixedUniforms=b(i,be),this.binderUniforms=v?v.getUniforms(i,be):[],-1!==T.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new h.Uniform1i(Ce=i,(Pe=be).u_dem),u_dem_prev:new h.Uniform1i(Ce,Pe.u_dem_prev),u_dem_unpack:new h.Uniform4f(Ce,Pe.u_dem_unpack),u_dem_tl:new h.Uniform2f(Ce,Pe.u_dem_tl),u_dem_scale:new h.Uniform1f(Ce,Pe.u_dem_scale),u_dem_tl_prev:new h.Uniform2f(Ce,Pe.u_dem_tl_prev),u_dem_scale_prev:new h.Uniform1f(Ce,Pe.u_dem_scale_prev),u_dem_size:new h.Uniform1f(Ce,Pe.u_dem_size),u_dem_lerp:new h.Uniform1f(Ce,Pe.u_dem_lerp),u_exaggeration:new h.Uniform1f(Ce,Pe.u_exaggeration),u_depth:new h.Uniform1i(Ce,Pe.u_depth),u_depth_size_inv:new h.Uniform2f(Ce,Pe.u_depth_size_inv),u_meter_to_dem:new h.Uniform1f(Ce,Pe.u_meter_to_dem),u_label_plane_matrix_inv:new h.UniformMatrix4f(Ce,Pe.u_label_plane_matrix_inv),u_tile_tl_up:new h.Uniform3f(Ce,Pe.u_tile_tl_up),u_tile_tr_up:new h.Uniform3f(Ce,Pe.u_tile_tr_up),u_tile_br_up:new h.Uniform3f(Ce,Pe.u_tile_br_up),u_tile_bl_up:new h.Uniform3f(Ce,Pe.u_tile_bl_up),u_tile_up_scale:new h.Uniform1f(Ce,Pe.u_tile_up_scale)}),-1!==T.indexOf("FOG")&&(this.fogUniforms=((Ce,Pe)=>({u_fog_matrix:new h.UniformMatrix4f(Ce,Pe.u_fog_matrix),u_fog_range:new h.Uniform2f(Ce,Pe.u_fog_range),u_fog_color:new h.Uniform4f(Ce,Pe.u_fog_color),u_fog_horizon_blend:new h.Uniform1f(Ce,Pe.u_fog_horizon_blend),u_fog_temporal_offset:new h.Uniform1f(Ce,Pe.u_fog_temporal_offset)}))(i,be))}setTerrainUniformValues(i,c){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const v in c)m[v].set(c[v])}}setFogUniformValues(i,c){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const v in c)m[v].location&&m[v].set(c[v])}}draw(i,c,m,v,b,T,R,z,j,q,Q,se,he,ue,fe,Se){const de=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(m),i.setStencilMode(v),i.setColorMode(b),i.setCullFace(T);for(const Ae of Object.keys(this.fixedUniforms))this.fixedUniforms[Ae].set(R[Ae]);ue&&ue.setUniforms(i,this.binderUniforms,se,{zoom:he});const Ee={[de.LINES]:2,[de.TRIANGLES]:3,[de.LINE_STRIP]:1}[c];for(const Ae of Q.get()){const be=Ae.vaos||(Ae.vaos={});(be[z]||(be[z]=new Pi)).bind(i,this,j,ue?ue.getPaintVertexBuffers():[],q,Ae.vertexOffset,fe,Se),de.drawElements(c,Ae.primitiveLength*Ee,de.UNSIGNED_SHORT,Ae.primitiveOffset*Ee*2)}}}function He(f,i,c){const m=1/dn(c,1,i.transform.tileZoom),v=Math.pow(2,c.tileID.overscaledZ),b=c.tileSize*Math.pow(2,i.transform.tileZoom)/v,T=b*(c.tileID.canonical.x+c.tileID.wrap*v),R=b*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[m,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[T>>16,R>>16],u_pixel_coord_lower:[65535&T,65535&R]}}const yt=(f,i,c,m)=>{const v=i.style.light,b=v.properties.get("position"),T=[b.x,b.y,b.z],R=h.create$1();"viewport"===v.properties.get("anchor")&&(h.fromRotation(R,-i.transform.angle),h.transformMat3(T,T,R));const z=v.properties.get("color");return{u_matrix:f,u_lightpos:T,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+c,u_opacity:m}},Pn=(f,i,c,m,v,b,T)=>h.extend(yt(f,i,c,m),He(b,i,T),{u_height_factor:-Math.pow(2,v.overscaledZ)/T.tileSize/8}),pr=f=>({u_matrix:f}),Hn=(f,i,c,m)=>h.extend(pr(f),He(c,i,m)),ar=(f,i)=>({u_matrix:f,u_world:i}),Vr=(f,i,c,m,v)=>h.extend(Hn(f,i,c,m),{u_world:v}),Ri=(f,i,c,m)=>{const v=f.transform;let b;return b="map"===m.paint.get("circle-pitch-alignment")?v.calculatePixelsToTileUnitsMatrix(c):new Float32Array([v.pixelsToGLUnits[0],0,0,v.pixelsToGLUnits[1]]),{u_camera_to_center_distance:v.cameraToCenterDistance,u_matrix:f.translatePosMatrix(i.projMatrix,c,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:h.exported.devicePixelRatio,u_extrude_scale:b}},So=f=>{const i=[];return"map"===f.paint.get("circle-pitch-alignment")&&i.push("PITCH_WITH_MAP"),"map"===f.paint.get("circle-pitch-scale")&&i.push("SCALE_WITH_MAP"),i},_i=(f,i,c)=>{const m=h.EXTENT/c.tileSize;return{u_matrix:f,u_camera_to_center_distance:i.cameraToCenterDistance,u_extrude_scale:[i.pixelsToGLUnits[0]/m,i.pixelsToGLUnits[1]/m]}},qs=(f,i,c=1)=>({u_matrix:f,u_color:i,u_overlay:0,u_overlay_scale:c}),ds=(f,i,c,m)=>({u_matrix:f,u_extrude_scale:dn(i,1,c),u_intensity:m}),ts=(f,i,c,m,v,b)=>{const T=f.transform,R=T.calculatePixelsToTileUnitsMatrix(i),z={u_matrix:Ws(f,i,c,v),u_pixels_to_tile_units:R,u_device_pixel_ratio:h.exported.devicePixelRatio,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Ys(c)){const j=ps(i,f.transform);z.u_texsize=i.lineAtlasTexture.size,z.u_scale=[j,m.fromScale,m.toScale],z.u_mix=m.t}return z},xr=(f,i,c,m,v)=>{const b=f.transform,T=ps(i,b);return{u_matrix:Ws(f,i,c,v),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:h.exported.devicePixelRatio,u_image:0,u_scale:[T,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ps(f,i){return 1/dn(f,1,i.tileZoom)}function Ws(f,i,c,m){return f.translatePosMatrix(m||i.tileID.projMatrix,i,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function Ys(f){const i=f.paint.get("line-dasharray").value;return i.value||"constant"!==i.kind}const No=(f,i,c,m,v,b)=>{return{u_matrix:f,u_tl_parent:i,u_scale_parent:c,u_fade_t:m.mix,u_opacity:m.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(R=v.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(T=v.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:Oa(v.paint.get("raster-hue-rotate")),u_perspective_transform:b};var T,R};function Oa(f){f*=Math.PI/180;const i=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*i-c+1)/3,(Math.sqrt(3)*i-c+1)/3]}const Ca=(f,i,c,m,v,b,T,R,z,j,q,Q,se,he)=>{const ue=v.transform;return{u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:ue.cameraToCenterDistance,u_pitch:ue.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:ue.width/ue.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:R,u_is_text:+z,u_pitch_with_map:+m,u_texsize:j,u_tile_id:q,u_zoom_transition:Q,u_inv_rot_matrix:se,u_merc_center:he,u_texture:0}},Sn=(f,i,c,m,v,b,T,R,z,j,q,Q,se,he,ue)=>{const{cameraToCenterDistance:fe,_pitch:Se}=v.transform;return h.extend(Ca(f,i,c,m,v,b,T,R,z,j,Q,se,he,ue),{u_gamma_scale:m?fe*Math.cos(v.terrain?0:Se):1,u_device_pixel_ratio:h.exported.devicePixelRatio,u_is_halo:+q})},Sl=(f,i,c,m,v,b,T,R,z,j,q,Q,se,he)=>h.extend(Sn(f,i,c,m,v,b,T,R,!0,z,!0,q,Q,se,he),{u_texsize_icon:j,u_texture_icon:1}),fr=(f,i,c)=>({u_matrix:f,u_opacity:i,u_color:c}),Fa=(f,i,c,m,v,b)=>h.extend(function(T,R,z,j){const q=z.imageManager.getPattern(T.from.toString()),Q=z.imageManager.getPattern(T.to.toString()),{width:se,height:he}=z.imageManager.getPixelSize(),ue=Math.pow(2,j.tileID.overscaledZ),fe=j.tileSize*Math.pow(2,z.transform.tileZoom)/ue,Se=fe*(j.tileID.canonical.x+j.tileID.wrap*ue),de=fe*j.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:q.tl,u_pattern_br_a:q.br,u_pattern_tl_b:Q.tl,u_pattern_br_b:Q.br,u_texsize:[se,he],u_mix:R.t,u_pattern_size_a:q.displaySize,u_pattern_size_b:Q.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/dn(j,1,z.transform.tileZoom),u_pixel_coord_upper:[Se>>16,de>>16],u_pixel_coord_lower:[65535&Se,65535&de]}}(m,b,c,v),{u_matrix:f,u_opacity:i}),Il={fillExtrusion:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_lightpos:new h.Uniform3f(f,i.u_lightpos),u_lightintensity:new h.Uniform1f(f,i.u_lightintensity),u_lightcolor:new h.Uniform3f(f,i.u_lightcolor),u_vertical_gradient:new h.Uniform1f(f,i.u_vertical_gradient),u_opacity:new h.Uniform1f(f,i.u_opacity)}),fillExtrusionPattern:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_lightpos:new h.Uniform3f(f,i.u_lightpos),u_lightintensity:new h.Uniform1f(f,i.u_lightintensity),u_lightcolor:new h.Uniform3f(f,i.u_lightcolor),u_vertical_gradient:new h.Uniform1f(f,i.u_vertical_gradient),u_height_factor:new h.Uniform1f(f,i.u_height_factor),u_image:new h.Uniform1i(f,i.u_image),u_texsize:new h.Uniform2f(f,i.u_texsize),u_pixel_coord_upper:new h.Uniform2f(f,i.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(f,i.u_pixel_coord_lower),u_scale:new h.Uniform3f(f,i.u_scale),u_fade:new h.Uniform1f(f,i.u_fade),u_opacity:new h.Uniform1f(f,i.u_opacity)}),fill:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix)}),fillPattern:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_image:new h.Uniform1i(f,i.u_image),u_texsize:new h.Uniform2f(f,i.u_texsize),u_pixel_coord_upper:new h.Uniform2f(f,i.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(f,i.u_pixel_coord_lower),u_scale:new h.Uniform3f(f,i.u_scale),u_fade:new h.Uniform1f(f,i.u_fade)}),fillOutline:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_world:new h.Uniform2f(f,i.u_world)}),fillOutlinePattern:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_world:new h.Uniform2f(f,i.u_world),u_image:new h.Uniform1i(f,i.u_image),u_texsize:new h.Uniform2f(f,i.u_texsize),u_pixel_coord_upper:new h.Uniform2f(f,i.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(f,i.u_pixel_coord_lower),u_scale:new h.Uniform3f(f,i.u_scale),u_fade:new h.Uniform1f(f,i.u_fade)}),circle:(f,i)=>({u_camera_to_center_distance:new h.Uniform1f(f,i.u_camera_to_center_distance),u_extrude_scale:new h.UniformMatrix2f(f,i.u_extrude_scale),u_device_pixel_ratio:new h.Uniform1f(f,i.u_device_pixel_ratio),u_matrix:new h.UniformMatrix4f(f,i.u_matrix)}),collisionBox:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_camera_to_center_distance:new h.Uniform1f(f,i.u_camera_to_center_distance),u_extrude_scale:new h.Uniform2f(f,i.u_extrude_scale)}),collisionCircle:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_inv_matrix:new h.UniformMatrix4f(f,i.u_inv_matrix),u_camera_to_center_distance:new h.Uniform1f(f,i.u_camera_to_center_distance),u_viewport_size:new h.Uniform2f(f,i.u_viewport_size)}),debug:(f,i)=>({u_color:new h.UniformColor(f,i.u_color),u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_overlay:new h.Uniform1i(f,i.u_overlay),u_overlay_scale:new h.Uniform1f(f,i.u_overlay_scale)}),clippingMask:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix)}),heatmap:(f,i)=>({u_extrude_scale:new h.Uniform1f(f,i.u_extrude_scale),u_intensity:new h.Uniform1f(f,i.u_intensity),u_matrix:new h.UniformMatrix4f(f,i.u_matrix)}),heatmapTexture:(f,i)=>({u_image:new h.Uniform1i(f,i.u_image),u_color_ramp:new h.Uniform1i(f,i.u_color_ramp),u_opacity:new h.Uniform1f(f,i.u_opacity)}),hillshade:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_image:new h.Uniform1i(f,i.u_image),u_latrange:new h.Uniform2f(f,i.u_latrange),u_light:new h.Uniform2f(f,i.u_light),u_shadow:new h.UniformColor(f,i.u_shadow),u_highlight:new h.UniformColor(f,i.u_highlight),u_accent:new h.UniformColor(f,i.u_accent)}),hillshadePrepare:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_image:new h.Uniform1i(f,i.u_image),u_dimension:new h.Uniform2f(f,i.u_dimension),u_zoom:new h.Uniform1f(f,i.u_zoom),u_unpack:new h.Uniform4f(f,i.u_unpack)}),line:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_pixels_to_tile_units:new h.UniformMatrix2f(f,i.u_pixels_to_tile_units),u_device_pixel_ratio:new h.Uniform1f(f,i.u_device_pixel_ratio),u_units_to_pixels:new h.Uniform2f(f,i.u_units_to_pixels),u_dash_image:new h.Uniform1i(f,i.u_dash_image),u_gradient_image:new h.Uniform1i(f,i.u_gradient_image),u_image_height:new h.Uniform1f(f,i.u_image_height),u_texsize:new h.Uniform2f(f,i.u_texsize),u_scale:new h.Uniform3f(f,i.u_scale),u_mix:new h.Uniform1f(f,i.u_mix),u_alpha_discard_threshold:new h.Uniform1f(f,i.u_alpha_discard_threshold)}),linePattern:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_texsize:new h.Uniform2f(f,i.u_texsize),u_pixels_to_tile_units:new h.UniformMatrix2f(f,i.u_pixels_to_tile_units),u_device_pixel_ratio:new h.Uniform1f(f,i.u_device_pixel_ratio),u_image:new h.Uniform1i(f,i.u_image),u_units_to_pixels:new h.Uniform2f(f,i.u_units_to_pixels),u_scale:new h.Uniform3f(f,i.u_scale),u_fade:new h.Uniform1f(f,i.u_fade),u_alpha_discard_threshold:new h.Uniform1f(f,i.u_alpha_discard_threshold)}),raster:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_tl_parent:new h.Uniform2f(f,i.u_tl_parent),u_scale_parent:new h.Uniform1f(f,i.u_scale_parent),u_fade_t:new h.Uniform1f(f,i.u_fade_t),u_opacity:new h.Uniform1f(f,i.u_opacity),u_image0:new h.Uniform1i(f,i.u_image0),u_image1:new h.Uniform1i(f,i.u_image1),u_brightness_low:new h.Uniform1f(f,i.u_brightness_low),u_brightness_high:new h.Uniform1f(f,i.u_brightness_high),u_saturation_factor:new h.Uniform1f(f,i.u_saturation_factor),u_contrast_factor:new h.Uniform1f(f,i.u_contrast_factor),u_spin_weights:new h.Uniform3f(f,i.u_spin_weights),u_perspective_transform:new h.Uniform2f(f,i.u_perspective_transform)}),symbolIcon:(f,i)=>({u_is_size_zoom_constant:new h.Uniform1i(f,i.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(f,i.u_is_size_feature_constant),u_size_t:new h.Uniform1f(f,i.u_size_t),u_size:new h.Uniform1f(f,i.u_size),u_camera_to_center_distance:new h.Uniform1f(f,i.u_camera_to_center_distance),u_pitch:new h.Uniform1f(f,i.u_pitch),u_rotate_symbol:new h.Uniform1i(f,i.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(f,i.u_aspect_ratio),u_fade_change:new h.Uniform1f(f,i.u_fade_change),u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(f,i.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(f,i.u_coord_matrix),u_is_text:new h.Uniform1i(f,i.u_is_text),u_pitch_with_map:new h.Uniform1i(f,i.u_pitch_with_map),u_texsize:new h.Uniform2f(f,i.u_texsize),u_tile_id:new h.Uniform3f(f,i.u_tile_id),u_zoom_transition:new h.Uniform1f(f,i.u_zoom_transition),u_inv_rot_matrix:new h.UniformMatrix4f(f,i.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(f,i.u_merc_center),u_texture:new h.Uniform1i(f,i.u_texture)}),symbolSDF:(f,i)=>({u_is_size_zoom_constant:new h.Uniform1i(f,i.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(f,i.u_is_size_feature_constant),u_size_t:new h.Uniform1f(f,i.u_size_t),u_size:new h.Uniform1f(f,i.u_size),u_camera_to_center_distance:new h.Uniform1f(f,i.u_camera_to_center_distance),u_pitch:new h.Uniform1f(f,i.u_pitch),u_rotate_symbol:new h.Uniform1i(f,i.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(f,i.u_aspect_ratio),u_fade_change:new h.Uniform1f(f,i.u_fade_change),u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(f,i.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(f,i.u_coord_matrix),u_is_text:new h.Uniform1i(f,i.u_is_text),u_pitch_with_map:new h.Uniform1i(f,i.u_pitch_with_map),u_texsize:new h.Uniform2f(f,i.u_texsize),u_texture:new h.Uniform1i(f,i.u_texture),u_gamma_scale:new h.Uniform1f(f,i.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f(f,i.u_device_pixel_ratio),u_tile_id:new h.Uniform3f(f,i.u_tile_id),u_zoom_transition:new h.Uniform1f(f,i.u_zoom_transition),u_inv_rot_matrix:new h.UniformMatrix4f(f,i.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(f,i.u_merc_center),u_is_halo:new h.Uniform1i(f,i.u_is_halo)}),symbolTextAndIcon:(f,i)=>({u_is_size_zoom_constant:new h.Uniform1i(f,i.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(f,i.u_is_size_feature_constant),u_size_t:new h.Uniform1f(f,i.u_size_t),u_size:new h.Uniform1f(f,i.u_size),u_camera_to_center_distance:new h.Uniform1f(f,i.u_camera_to_center_distance),u_pitch:new h.Uniform1f(f,i.u_pitch),u_rotate_symbol:new h.Uniform1i(f,i.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(f,i.u_aspect_ratio),u_fade_change:new h.Uniform1f(f,i.u_fade_change),u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(f,i.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(f,i.u_coord_matrix),u_is_text:new h.Uniform1i(f,i.u_is_text),u_pitch_with_map:new h.Uniform1i(f,i.u_pitch_with_map),u_texsize:new h.Uniform2f(f,i.u_texsize),u_texsize_icon:new h.Uniform2f(f,i.u_texsize_icon),u_texture:new h.Uniform1i(f,i.u_texture),u_texture_icon:new h.Uniform1i(f,i.u_texture_icon),u_gamma_scale:new h.Uniform1f(f,i.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f(f,i.u_device_pixel_ratio),u_is_halo:new h.Uniform1i(f,i.u_is_halo)}),background:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_opacity:new h.Uniform1f(f,i.u_opacity),u_color:new h.UniformColor(f,i.u_color)}),backgroundPattern:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_opacity:new h.Uniform1f(f,i.u_opacity),u_image:new h.Uniform1i(f,i.u_image),u_pattern_tl_a:new h.Uniform2f(f,i.u_pattern_tl_a),u_pattern_br_a:new h.Uniform2f(f,i.u_pattern_br_a),u_pattern_tl_b:new h.Uniform2f(f,i.u_pattern_tl_b),u_pattern_br_b:new h.Uniform2f(f,i.u_pattern_br_b),u_texsize:new h.Uniform2f(f,i.u_texsize),u_mix:new h.Uniform1f(f,i.u_mix),u_pattern_size_a:new h.Uniform2f(f,i.u_pattern_size_a),u_pattern_size_b:new h.Uniform2f(f,i.u_pattern_size_b),u_scale_a:new h.Uniform1f(f,i.u_scale_a),u_scale_b:new h.Uniform1f(f,i.u_scale_b),u_pixel_coord_upper:new h.Uniform2f(f,i.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(f,i.u_pixel_coord_lower),u_tile_units_to_pixels:new h.Uniform1f(f,i.u_tile_units_to_pixels)}),terrainRaster:qo,terrainDepth:qo,skybox:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_sun_direction:new h.Uniform3f(f,i.u_sun_direction),u_cubemap:new h.Uniform1i(f,i.u_cubemap),u_opacity:new h.Uniform1f(f,i.u_opacity),u_temporal_offset:new h.Uniform1f(f,i.u_temporal_offset)}),skyboxGradient:(f,i)=>({u_matrix:new h.UniformMatrix4f(f,i.u_matrix),u_color_ramp:new h.Uniform1i(f,i.u_color_ramp),u_center_direction:new h.Uniform3f(f,i.u_center_direction),u_radius:new h.Uniform1f(f,i.u_radius),u_opacity:new h.Uniform1f(f,i.u_opacity),u_temporal_offset:new h.Uniform1f(f,i.u_temporal_offset)}),skyboxCapture:(f,i)=>({u_matrix_3f:new h.UniformMatrix3f(f,i.u_matrix_3f),u_sun_direction:new h.Uniform3f(f,i.u_sun_direction),u_sun_intensity:new h.Uniform1f(f,i.u_sun_intensity),u_color_tint_r:new h.Uniform4f(f,i.u_color_tint_r),u_color_tint_m:new h.Uniform4f(f,i.u_color_tint_m),u_luminance:new h.Uniform1f(f,i.u_luminance)}),globeRaster:(f,i)=>({u_proj_matrix:new h.UniformMatrix4f(f,i.u_proj_matrix),u_globe_matrix:new h.UniformMatrix4f(f,i.u_globe_matrix),u_merc_matrix:new h.UniformMatrix4f(f,i.u_merc_matrix),u_zoom_transition:new h.Uniform1f(f,i.u_zoom_transition),u_merc_center:new h.Uniform2f(f,i.u_merc_center),u_image0:new h.Uniform1i(f,i.u_image0)}),globeAtmosphere:(f,i)=>({u_center:new h.Uniform2f(f,i.u_center),u_radius:new h.Uniform1f(f,i.u_radius),u_screen_size:new h.Uniform2f(f,i.u_screen_size),u_pixel_ratio:new h.Uniform1f(f,i.u_pixel_ratio),u_opacity:new h.Uniform1f(f,i.u_opacity),u_fadeout_range:new h.Uniform1f(f,i.u_fadeout_range),u_start_color:new h.Uniform3f(f,i.u_start_color),u_end_color:new h.Uniform3f(f,i.u_end_color)})};let fs;function Pl(f,i,c,m,v,b,T){const R=f.context,z=R.gl,j=f.useProgram("collisionBox"),q=[];let Q=0,se=0;for(let Ae=0;Ae<m.length;Ae++){const be=m[Ae],Ce=i.getTile(be),Pe=Ce.getBucket(c);if(!Pe)continue;let We=be.projMatrix;0===v[0]&&0===v[1]||(We=f.translatePosMatrix(be.projMatrix,Ce,v,b));const et=T?Pe.textCollisionBox:Pe.iconCollisionBox,Ft=Pe.collisionCircleArray;if(Ft.length>0){const bt=h.create(),Tt=We;h.mul(bt,Pe.placementInvProjMatrix,f.transform.glCoordMatrix),h.mul(bt,bt,Pe.placementViewportMatrix),q.push({circleArray:Ft,circleOffset:se,transform:Tt,invTransform:bt}),Q+=Ft.length/4,se=Q}et&&(f.terrain&&f.terrain.setupElevationDraw(Ce,j),j.draw(R,z.LINES,h.DepthMode.disabled,h.StencilMode.disabled,f.colorModeForRenderPass(),h.CullFaceMode.disabled,_i(We,f.transform,Ce),c.id,et.layoutVertexBuffer,et.indexBuffer,et.segments,null,f.transform.zoom,null,et.collisionVertexBuffer,et.collisionVertexBufferExt))}if(!T||!q.length)return;const he=f.useProgram("collisionCircle"),ue=new h.StructArrayLayout2f1f2i16;ue.resize(4*Q),ue._trim();let fe=0;for(const Ae of q)for(let be=0;be<Ae.circleArray.length/4;be++){const Ce=4*be,Pe=Ae.circleArray[Ce+0],We=Ae.circleArray[Ce+1],et=Ae.circleArray[Ce+2],Ft=Ae.circleArray[Ce+3];ue.emplace(fe++,Pe,We,et,Ft,0),ue.emplace(fe++,Pe,We,et,Ft,1),ue.emplace(fe++,Pe,We,et,Ft,2),ue.emplace(fe++,Pe,We,et,Ft,3)}(!fs||fs.length<2*Q)&&(fs=function(Ae){const be=2*Ae,Ce=new h.StructArrayLayout3ui6;Ce.resize(be),Ce._trim();for(let Pe=0;Pe<be;Pe++){const We=6*Pe;Ce.uint16[We+0]=4*Pe+0,Ce.uint16[We+1]=4*Pe+1,Ce.uint16[We+2]=4*Pe+2,Ce.uint16[We+3]=4*Pe+2,Ce.uint16[We+4]=4*Pe+3,Ce.uint16[We+5]=4*Pe+0}return Ce}(Q));const Se=R.createIndexBuffer(fs,!0),de=R.createVertexBuffer(ue,h.collisionCircleLayout.members,!0);for(const Ae of q){const be={u_matrix:Ae.transform,u_inv_matrix:Ae.invTransform,u_camera_to_center_distance:(Ee=f.transform).cameraToCenterDistance,u_viewport_size:[Ee.width,Ee.height]};he.draw(R,z.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,f.colorModeForRenderPass(),h.CullFaceMode.disabled,be,c.id,de,Se,h.SegmentVector.simpleSegment(0,2*Ae.circleOffset,Ae.circleArray.length,Ae.circleArray.length/2),null,f.transform.zoom,null,null,null)}var Ee;de.destroy(),Se.destroy()}const ca=h.identity(new Float32Array(16));function Mt(f,i,c,m,v,b){const{horizontalAlign:T,verticalAlign:R}=h.getAnchorAlignment(f),z=-(T-.5)*i,j=-(R-.5)*c,q=h.evaluateVariableOffset(f,m);return new h.pointGeometry((z/v+q[0])*b,(j/v+q[1])*b)}function br(f,i,c,m,v,b,T,R,z,j,q,Q){const se=f.text.placedSymbolArray,he=f.text.dynamicLayoutVertexArray,ue=f.icon.dynamicLayoutVertexArray,fe={},Se=R.projMatrix,de=b.elevation,Ee=de?de.getAtTileOffsetFunc(R,Q):Ae=>[0,0,0];he.clear();for(let Ae=0;Ae<se.length;Ae++){const be=se.get(Ae),Ce=f.allowVerticalPlacement&&!be.placedOrientation,Pe=be.hidden||!be.crossTileID||Ce?null:m[be.crossTileID];if(Pe){const We=new h.pointGeometry(be.tileAnchorX,be.tileAnchorY),et=Ee(We),Ft=Nt(We,c?Se:T,et[2]),bt=yn(b.cameraToCenterDistance,Ft.signedDistanceFromCamera);let Tt=v.evaluateSizeForFeature(f.textSizeData,j,be)*bt/h.ONE_EM;c&&(Tt*=f.tilePixelRatio/z);const{width:pt,height:tt,anchor:vt,textOffset:gt,textScale:on}=Pe,gn=Mt(vt,pt,tt,gt,on,Tt),Zn=c?Nt(We.add(gn),T,et[2]).point:Ft.point.add(i?gn.rotate(-b.angle):gn),Ot=f.allowVerticalPlacement&&be.placedOrientation===h.WritingMode.vertical?Math.PI/2:0;for(let ln=0;ln<be.numGlyphs;ln++)h.addDynamicAttributes(he,Zn,Ot);q&&be.associatedIconIndex>=0&&(fe[be.associatedIconIndex]={shiftedAnchor:Zn,angle:Ot})}else pi(be.numGlyphs,he)}if(q){ue.clear();const Ae=f.icon.placedSymbolArray;for(let be=0;be<Ae.length;be++){const Ce=Ae.get(be);if(Ce.hidden)pi(Ce.numGlyphs,ue);else{const Pe=fe[be];if(Pe)for(let We=0;We<Ce.numGlyphs;We++)h.addDynamicAttributes(ue,Pe.shiftedAnchor,Pe.angle);else pi(Ce.numGlyphs,ue)}}f.icon.dynamicLayoutVertexBuffer.updateData(ue)}f.text.dynamicLayoutVertexBuffer.updateData(he)}function Jl(f,i,c){return c.iconsInText&&i?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function yi(f,i,c,m,v,b,T,R,z,j,q,Q){const se=f.context,he=se.gl,ue=f.transform,fe=ue.projection.createTileTransform(ue,ue.worldSize),Se="map"===R,de="map"===z,Ee=Se&&"point"!==c.layout.get("symbol-placement"),Ae=Se&&!de&&!Ee,be=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let Ce=!1;const Pe=f.depthModeForSublayer(0,h.DepthMode.ReadOnly),We=[h.mercatorXfromLng(ue.center.lng),h.mercatorYfromLat(ue.center.lat)],et=c.layout.get("text-variable-anchor"),Ft="globe"===ue.projection.name,bt=Ft?h.globeToMercatorTransition(ue.zoom):0,Tt=[],pt=[];f.terrain&&de&&pt.push("PITCH_WITH_MAP_TERRAIN"),Ft&&pt.push("PROJECTION_GLOBE_VIEW"),Ee&&pt.push("PROJECTED_POS_ON_VIEWPORT");for(const tt of m){const vt=i.getTile(tt),gt=vt.getBucket(c);if(!gt||gt.projection!==ue.projection.name)continue;const on=v?gt.text:gt.icon;if(!on||gt.fullyClipped||!on.segments.get().length)continue;const gn=on.programConfigurations.get(c.id),Zn=v||gt.sdfIcons,Ot=v?gt.textSizeData:gt.iconSizeData,ln=de||0!==ue.pitch,Vn=f.useProgram(Jl(Zn,v,gt),gn,pt),Or=h.evaluateSizeForZoom(Ot,ue.zoom),Yr=[tt.canonical.x,tt.canonical.y,1<<tt.canonical.z];let vn,lr,vi,vo,rs=[0,0],ma=null;if(v){if(lr=vt.glyphAtlasTexture,vi=he.LINEAR,vn=vt.glyphAtlasTexture.size,gt.iconsInText){rs=vt.imageAtlasTexture.size,ma=vt.imageAtlasTexture;const Bi="composite"===Ot.kind||"camera"===Ot.kind;vo=ln||f.options.rotating||f.options.zooming||Bi?he.LINEAR:he.NEAREST}}else{const Bi=1!==c.layout.get("icon-size").constantOr(0)||gt.iconsNeedLinear;lr=vt.imageAtlasTexture,vi=Zn||f.options.rotating||f.options.zooming||Bi||ln?he.LINEAR:he.NEAREST,vn=vt.imageAtlasTexture.size}const Bs=f.transform.calculatePixelsToTileUnitsMatrix(vt),cr=eo(tt.projMatrix,vt.tileID.canonical,de,Se,f.transform,Bs),En=f.terrain&&de&&Ee?h.invert(new Float32Array(16),cr):ca,_r=ei(tt.projMatrix,vt.tileID.canonical,de,Se,f.transform,Bs),ir=et&&gt.hasTextData(),Ts="none"!==c.layout.get("icon-text-fit")&&ir&&gt.hasIconData();if(Ee){const Bi=ue.elevation,_s=Bi?Bi.getAtTileOffsetFunc(tt,fe):ga=>[0,0,0];un(gt,tt.projMatrix,f,v,cr,_r,de,j,_s,tt)}const xi=f.translatePosMatrix(tt.projMatrix,vt,b,T),Io=Ee||v&&et||Ts?ca:cr,Ha=f.translatePosMatrix(_r,vt,b,T,!0),Ds=Zn&&0!==c.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1);let fl;const tn=fe.createInversionMatrix(tt.toUnwrapped());fl=Zn?gt.iconsInText?Sl(Ot.kind,Or,Ae,de,f,xi,Io,Ha,vn,rs,Yr,bt,tn,We):Sn(Ot.kind,Or,Ae,de,f,xi,Io,Ha,v,vn,!0,Yr,bt,tn,We):Ca(Ot.kind,Or,Ae,de,f,xi,Io,Ha,v,vn,Yr,bt,tn,We);const fn={program:Vn,buffers:on,uniformValues:fl,atlasTexture:lr,atlasTextureIcon:ma,atlasInterpolation:vi,atlasInterpolationIcon:vo,isSDF:Zn,hasHalo:Ds,tile:vt,labelPlaneMatrixInv:En};if(be&&gt.canOverlap){Ce=!0;const Bi=on.segments.get();for(const _s of Bi)Tt.push({segments:new h.SegmentVector([_s]),sortKey:_s.sortKey,state:fn})}else Tt.push({segments:on.segments,sortKey:0,state:fn})}Ce&&Tt.sort((tt,vt)=>tt.sortKey-vt.sortKey);for(const tt of Tt){const vt=tt.state;if(f.terrain&&f.terrain.setupElevationDraw(vt.tile,vt.program,{useDepthForOcclusion:!Ft,labelPlaneMatrixInv:vt.labelPlaneMatrixInv}),se.activeTexture.set(he.TEXTURE0),vt.atlasTexture.bind(vt.atlasInterpolation,he.CLAMP_TO_EDGE),vt.atlasTextureIcon&&(se.activeTexture.set(he.TEXTURE1),vt.atlasTextureIcon&&vt.atlasTextureIcon.bind(vt.atlasInterpolationIcon,he.CLAMP_TO_EDGE)),vt.isSDF){const gt=vt.uniformValues;vt.hasHalo&&(gt.u_is_halo=1,La(vt.buffers,tt.segments,c,f,vt.program,Pe,q,Q,gt)),gt.u_is_halo=0}La(vt.buffers,tt.segments,c,f,vt.program,Pe,q,Q,vt.uniformValues)}}function La(f,i,c,m,v,b,T,R,z){const j=m.context;v.draw(j,j.gl.TRIANGLES,b,T,R,h.CullFaceMode.disabled,z,c.id,f.layoutVertexBuffer,f.indexBuffer,i,c.paint,m.transform.zoom,f.programConfigurations.get(c.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Xs(f,i,c,m,v,b,T){const R=f.context.gl,z=c.paint.get("fill-pattern"),j=z&&z.constantOr(1),q=c.getCrossfadeParameters();let Q,se,he,ue,fe;T?(se=j&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Q=R.LINES):(se=j?"fillPattern":"fill",Q=R.TRIANGLES);for(const Se of m){const de=i.getTile(Se);if(j&&!de.patternsLoaded())continue;const Ee=de.getBucket(c);if(!Ee)continue;f.prepareDrawTile(Se);const Ae=Ee.programConfigurations.get(c.id),be=f.useProgram(se,Ae);j&&(f.context.activeTexture.set(R.TEXTURE0),de.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Ae.updatePaintBuffers(q));const Ce=z.constantOr(null);if(Ce&&de.imageAtlas){const We=de.imageAtlas,et=We.patternPositions[Ce.to.toString()],Ft=We.patternPositions[Ce.from.toString()];et&&Ft&&Ae.setConstantPatternPositions(et,Ft)}const Pe=f.translatePosMatrix(Se.projMatrix,de,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(T){ue=Ee.indexBuffer2,fe=Ee.segments2;const We=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[R.drawingBufferWidth,R.drawingBufferHeight];he="fillOutlinePattern"===se&&j?Vr(Pe,f,q,de,We):ar(Pe,We)}else ue=Ee.indexBuffer,fe=Ee.segments,he=j?Hn(Pe,f,q,de):pr(Pe);f.prepareDrawProgram(f.context,be,Se.toUnwrapped()),be.draw(f.context,Q,v,f.stencilModeForClipping(Se),b,h.CullFaceMode.disabled,he,c.id,Ee.layoutVertexBuffer,ue,fe,c.paint,f.transform.zoom,Ae)}}function go(f,i,c,m,v,b,T){const R=f.context,z=R.gl,j=c.paint.get("fill-extrusion-pattern"),q=j.constantOr(1),Q=c.getCrossfadeParameters(),se=c.paint.get("fill-extrusion-opacity");for(const he of m){const ue=i.getTile(he),fe=ue.getBucket(c);if(!fe)continue;const Se=fe.programConfigurations.get(c.id),de=f.useProgram(q?"fillExtrusionPattern":"fillExtrusion",Se);if(f.terrain){const Pe=f.terrain;if(!fe.enableTerrain)continue;if(Pe.setupElevationDraw(ue,de,{useMeterToDem:!0}),nl(R,i,he,fe,c,Pe),!fe.centroidVertexBuffer){const We=de.attributes.a_centroid_pos;void 0!==We&&z.vertexAttrib2f(We,0,0)}}q&&(f.context.activeTexture.set(z.TEXTURE0),ue.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Se.updatePaintBuffers(Q));const Ee=j.constantOr(null);if(Ee&&ue.imageAtlas){const Pe=ue.imageAtlas,We=Pe.patternPositions[Ee.to.toString()],et=Pe.patternPositions[Ee.from.toString()];We&&et&&Se.setConstantPatternPositions(We,et)}const Ae=f.translatePosMatrix(he.projMatrix,ue,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),be=c.paint.get("fill-extrusion-vertical-gradient"),Ce=q?Pn(Ae,f,be,se,he,Q,ue):yt(Ae,f,be,se);f.prepareDrawProgram(R,de,he.toUnwrapped()),de.draw(R,R.gl.TRIANGLES,v,b,T,h.CullFaceMode.backCCW,Ce,c.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,c.paint,f.transform.zoom,Se,f.terrain?fe.centroidVertexBuffer:null)}}function nl(f,i,c,m,v,b){const T=[de=>{let Ee=de.canonical.x-1,Ae=de.wrap;return Ee<0&&(Ee=(1<<de.canonical.z)-1,Ae--),new h.OverscaledTileID(de.overscaledZ,Ae,de.canonical.z,Ee,de.canonical.y)},de=>{let Ee=de.canonical.x+1,Ae=de.wrap;return Ee===1<<de.canonical.z&&(Ee=0,Ae++),new h.OverscaledTileID(de.overscaledZ,Ae,de.canonical.z,Ee,de.canonical.y)},de=>new h.OverscaledTileID(de.overscaledZ,de.wrap,de.canonical.z,de.canonical.x,(0===de.canonical.y?1<<de.canonical.z:de.canonical.y)-1),de=>new h.OverscaledTileID(de.overscaledZ,de.wrap,de.canonical.z,de.canonical.x,de.canonical.y===(1<<de.canonical.z)-1?0:de.canonical.y+1)],R=de=>{const Ee=i.getSource().maxzoom,Ae=We=>{const et=i.getTileByID(We);if(et&&et.hasData())return et.getBucket(v)};let be,Ce,Pe;return(de.overscaledZ===de.canonical.z||de.overscaledZ>=Ee)&&(be=Ae(de.key)),de.overscaledZ>=Ee&&(Ce=Ae(de.calculateScaledKey(de.overscaledZ+1))),de.overscaledZ>Ee&&(Pe=Ae(de.calculateScaledKey(de.overscaledZ-1))),be||Ce||Pe},z=[0,0,0],j=(de,Ee)=>(z[0]=Math.min(de.min.y,Ee.min.y),z[1]=Math.max(de.max.y,Ee.max.y),z[2]=h.EXTENT-Ee.min.x>de.max.x?Ee.min.x-h.EXTENT:de.max.x,z),q=(de,Ee)=>(z[0]=Math.min(de.min.x,Ee.min.x),z[1]=Math.max(de.max.x,Ee.max.x),z[2]=h.EXTENT-Ee.min.y>de.max.y?Ee.min.y-h.EXTENT:de.max.y,z),Q=[(de,Ee)=>j(de,Ee),(de,Ee)=>j(Ee,de),(de,Ee)=>q(de,Ee),(de,Ee)=>q(Ee,de)],se=new h.pointGeometry(0,0);let he,ue,fe;const Se=(de,Ee,Ae,be,Ce)=>{const Pe=[[be?Ae:de,be?de:Ae,0],[be?Ae:Ee,be?Ee:Ae,0]],We=Ce<0?h.EXTENT+Ce:Ce,et=[be?We:(de+Ee)/2,be?(de+Ee)/2:We,0];return 0===Ae&&Ce<0||0!==Ae&&Ce>0?b.getForTilePoints(fe,[et],!0,ue):Pe.push(et),b.getForTilePoints(c,Pe,!0,he),Math.max(Pe[0][2],Pe[1][2],et[2])/b.exaggeration()};for(let de=0;de<4;de++){const Ee=m.borders[de];if(0===Ee.length&&(m.borderDone[de]=!0),m.borderDone[de])continue;const Ae=fe=T[de](c),be=R(Ae);if(!(be&&be.enableTerrain&&(ue=b.findDEMTileFor(Ae),ue&&ue.dem)))continue;if(!he){const et=b.findDEMTileFor(c);if(!et||!et.dem)return;he=et}const Ce=(de<2?1:5)-de,Pe=be.borders[Ce];let We=0;for(let et=0;et<Ee.length;et++){const Ft=m.featuresOnBorder[Ee[et]],bt=Ft.borders[de];let Tt;for(;We<Pe.length&&(Tt=be.featuresOnBorder[Pe[We]],!(Tt.borders[Ce][1]>bt[0]+3));)be.borderDone[Ce]||be.encodeCentroid(void 0,Tt,!1),We++;if(Tt&&We<Pe.length){const pt=We;let tt=0;for(;!(Tt.borders[Ce][0]>bt[1]-3)&&(tt++,++We!==Pe.length);)Tt=be.featuresOnBorder[Pe[We]];if(Tt=be.featuresOnBorder[Pe[pt]],Ft.intersectsCount()>1||Tt.intersectsCount()>1||1!==tt){1!==tt&&(We=pt),m.encodeCentroid(void 0,Ft,!1),be.borderDone[Ce]||be.encodeCentroid(void 0,Tt,!1);continue}const vt=Q[de](Ft,Tt),gt=de%2?h.EXTENT-1:0;se.x=Se(vt[0],Math.min(h.EXTENT-1,vt[1]),gt,de<2,vt[2]),se.y=0,m.encodeCentroid(se,Ft,!1),be.borderDone[Ce]||be.encodeCentroid(se,Tt,!1)}else m.encodeCentroid(void 0,Ft,!1)}m.borderDone[de]=m.needsCentroidUpdate=!0,be.borderDone[Ce]||(be.borderDone[Ce]=be.needsCentroidUpdate=!0)}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&0!==m.centroidVertexArray.length)&&m.uploadCentroid(f)}const Na=new h.Color(1,0,0,1),Rl=new h.Color(0,1,0,1),za=new h.Color(0,0,1,1),Ks=new h.Color(1,0,1,1),Js=new h.Color(0,1,1,1);function Y(f,i,c,m){F(f,0,i+c/2,f.transform.width,c,m)}function te(f,i,c,m){F(f,i-c/2,0,c,f.transform.height,m)}function F(f,i,c,m,v,b){const T=f.context,R=T.gl;R.enable(R.SCISSOR_TEST),R.scissor(i*h.exported.devicePixelRatio,c*h.exported.devicePixelRatio,m*h.exported.devicePixelRatio,v*h.exported.devicePixelRatio),T.clear({color:b}),R.disable(R.SCISSOR_TEST)}function ee(f,i,c){const m=f.context,v=m.gl,b=c.projMatrix,T=f.useProgram("debug"),R=i.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(R,T);const z=h.DepthMode.disabled,j=h.StencilMode.disabled,q=f.colorModeForRenderPass(),Q="$debug";m.activeTexture.set(v.TEXTURE0),f.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),R._makeDebugTileBoundsBuffers(f.context,f.transform.projection);const se=R._tileDebugBuffer||f.debugBuffer,he=R._tileDebugIndexBuffer||f.debugIndexBuffer,ue=R._tileDebugSegments||f.debugSegments;T.draw(m,v.LINE_STRIP,z,j,q,h.CullFaceMode.disabled,qs(b,h.Color.red),Q,se,he,ue);const fe=R.latestRawTileData,Se=Math.floor((fe&&fe.byteLength||0)/1024),de=i.getTile(c).tileSize,Ee=512/Math.min(de,512)*(c.overscaledZ/f.transform.zoom)*.5;let Ae=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ae+=` => ${c.overscaledZ}`),function(be,Ce){be.initDebugOverlayCanvas();const Pe=be.debugOverlayCanvas,We=be.context.gl,et=be.debugOverlayCanvas.getContext("2d");et.clearRect(0,0,Pe.width,Pe.height),et.shadowColor="white",et.shadowBlur=2,et.lineWidth=1.5,et.strokeStyle="white",et.textBaseline="top",et.font="bold 36px Open Sans, sans-serif",et.fillText(Ce,5,5),et.strokeText(Ce,5,5),be.debugOverlayTexture.update(Pe),be.debugOverlayTexture.bind(We.LINEAR,We.CLAMP_TO_EDGE)}(f,`${Ae} ${Se}kb`),T.draw(m,v.TRIANGLES,z,j,h.ColorMode.alphaBlended,h.CullFaceMode.disabled,qs(b,h.Color.transparent,Ee),Q,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}const Te=h.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:it}=Te;function Et(f,i,c,m){f.emplaceBack(i,c,m)}class jn{constructor(i){this.vertexArray=new h.StructArrayLayout3f12,this.indices=new h.StructArrayLayout3ui6,Et(this.vertexArray,-1,-1,1),Et(this.vertexArray,1,-1,1),Et(this.vertexArray,-1,1,1),Et(this.vertexArray,1,1,1),Et(this.vertexArray,-1,-1,-1),Et(this.vertexArray,1,-1,-1),Et(this.vertexArray,-1,1,-1),Et(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,it),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=h.SegmentVector.simpleSegment(0,0,36,12)}}function Pr(f,i,c,m,v,b){const T=f.gl,R=i.paint.get("sky-atmosphere-color"),z=i.paint.get("sky-atmosphere-halo-color"),j=i.paint.get("sky-atmosphere-sun-intensity"),q={u_matrix_3f:h.fromMat4([],m),u_sun_direction:v,u_sun_intensity:j,u_color_tint_r:[(ue=R).r,ue.g,ue.b,ue.a],u_color_tint_m:[(fe=z).r,fe.g,fe.b,fe.a],u_luminance:5e-5};var ue,fe;T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+b,i.skyboxTexture,0),c.draw(f,T.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,h.ColorMode.unblended,h.CullFaceMode.frontCW,q,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const qi={symbol:function(f,i,c,m,v){if("translucent"!==f.renderPass)return;const b=h.StencilMode.disabled,T=f.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(R,z,j,q,Q,se,he){const ue=z.transform,fe="map"===Q,Se="map"===se,de=ue.projection.createTileTransform(ue,ue.worldSize);for(const Ee of R){const Ae=q.getTile(Ee),be=Ae.getBucket(j);if(!be||be.projection!==ue.projection.name||!be.text||!be.text.segments.get().length)continue;const Ce=h.evaluateSizeForZoom(be.textSizeData,ue.zoom),Pe=z.transform.calculatePixelsToTileUnitsMatrix(Ae),We=eo(Ee.projMatrix,Ae.tileID.canonical,Se,fe,z.transform,Pe),et="none"!==j.layout.get("icon-text-fit")&&be.hasIconData();if(Ce){const Ft=Math.pow(2,ue.zoom-Ae.tileID.overscaledZ);br(be,fe,Se,he,h.symbolSize,ue,We,Ee,Ft,Ce,et,de)}}}(m,f,c,i,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),v),0!==c.paint.get("icon-opacity").constantOr(1)&&yi(f,i,c,m,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),b,T),0!==c.paint.get("text-opacity").constantOr(1)&&yi(f,i,c,m,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),b,T),i.map.showCollisionBoxes&&(Pl(f,i,c,m,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Pl(f,i,c,m,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,i,c,m){if("translucent"!==f.renderPass)return;const v=c.paint.get("circle-opacity"),b=c.paint.get("circle-stroke-width"),T=c.paint.get("circle-stroke-opacity"),R=void 0!==c.layout.get("circle-sort-key").constantOr(1);if(0===v.constantOr(1)&&(0===b.constantOr(1)||0===T.constantOr(1)))return;const z=f.context,j=z.gl,q=f.depthModeForSublayer(0,h.DepthMode.ReadOnly),Q=h.StencilMode.disabled,se=f.colorModeForRenderPass(),he=[];for(let fe=0;fe<m.length;fe++){const Se=m[fe],de=i.getTile(Se),Ee=de.getBucket(c);if(!Ee)continue;const Ae=Ee.programConfigurations.get(c.id),be=So(c),Ce={programConfiguration:Ae,program:f.useProgram("circle",Ae,be),layoutVertexBuffer:Ee.layoutVertexBuffer,indexBuffer:Ee.indexBuffer,uniformValues:Ri(f,Se,de,c),tile:de};if(R){const Pe=Ee.segments.get();for(const We of Pe)he.push({segments:new h.SegmentVector([We]),sortKey:We.sortKey,state:Ce})}else he.push({segments:Ee.segments,sortKey:0,state:Ce})}R&&he.sort((fe,Se)=>fe.sortKey-Se.sortKey);const ue={useDepthForOcclusion:"globe"!==f.transform.projection.name};for(const fe of he){const{programConfiguration:Se,program:de,layoutVertexBuffer:Ee,indexBuffer:Ae,uniformValues:be,tile:Ce}=fe.state,Pe=fe.segments;f.terrain&&f.terrain.setupElevationDraw(Ce,de,ue),f.prepareDrawProgram(z,de,Ce.tileID.toUnwrapped()),de.draw(z,j.TRIANGLES,q,Q,se,h.CullFaceMode.disabled,be,c.id,Ee,Ae,Pe,c.paint,f.transform.zoom,Se)}},heatmap:function(f,i,c,m){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const v=f.context,b=v.gl,T=h.StencilMode.disabled,R=new h.ColorMode([b.ONE,b.ONE],h.Color.transparent,[!0,!0,!0,!0]);(function(z,j,q){const Q=z.gl;z.activeTexture.set(Q.TEXTURE1),z.viewport.set([0,0,j.width/4,j.height/4]);let se=q.heatmapFbo;if(se)Q.bindTexture(Q.TEXTURE_2D,se.colorAttachment.get()),z.bindFramebuffer.set(se.framebuffer);else{const he=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,he),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),se=q.heatmapFbo=z.createFramebuffer(j.width/4,j.height/4,!1),function(ue,fe,Se,de){const Ee=ue.gl;Ee.texImage2D(Ee.TEXTURE_2D,0,Ee.RGBA,fe.width/4,fe.height/4,0,Ee.RGBA,ue.extRenderToTextureHalfFloat?ue.extTextureHalfFloat.HALF_FLOAT_OES:Ee.UNSIGNED_BYTE,null),de.colorAttachment.set(Se)}(z,j,he,se)}})(v,f,c),v.clear({color:h.Color.transparent});for(let z=0;z<m.length;z++){const j=m[z];if(i.hasRenderableParent(j))continue;const q=i.getTile(j),Q=q.getBucket(c);if(!Q)continue;const se=Q.programConfigurations.get(c.id),he=f.useProgram("heatmap",se),{zoom:ue}=f.transform;f.terrain&&f.terrain.setupElevationDraw(q,he),f.prepareDrawProgram(v,he,j.toUnwrapped()),he.draw(v,b.TRIANGLES,h.DepthMode.disabled,T,R,h.CullFaceMode.disabled,ds(j.projMatrix,q,ue,c.paint.get("heatmap-intensity")),c.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,c.paint,f.transform.zoom,se)}v.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(v,b){const T=v.context,R=T.gl,z=b.heatmapFbo;if(!z)return;T.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,z.colorAttachment.get()),T.activeTexture.set(R.TEXTURE1);let j=b.colorRampTexture;j||(j=b.colorRampTexture=new h.Texture(T,b.colorRamp,R.RGBA)),j.bind(R.LINEAR,R.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(T,R.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,v.colorModeForRenderPass(),h.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:b.paint.get("heatmap-opacity")},b.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,b.paint,v.transform.zoom)}(f,c))},line:function(f,i,c,m){if("translucent"!==f.renderPass)return;const v=c.paint.get("line-opacity"),b=c.paint.get("line-width");if(0===v.constantOr(1)||0===b.constantOr(1))return;const T=f.depthModeForSublayer(0,h.DepthMode.ReadOnly),R=f.colorModeForRenderPass(),z=c.paint.get("line-dasharray"),j=z.constantOr(1),q=c.layout.get("line-cap"),Q=c.paint.get("line-pattern"),se=Q.constantOr(1),he=c.paint.get("line-gradient"),ue=c.getCrossfadeParameters(),fe=se?"linePattern":"line",Se=f.context,de=Se.gl,Ee=(be=>{const Ce=[];Ys(be)&&Ce.push("RENDER_LINE_DASH"),be.paint.get("line-gradient")&&Ce.push("RENDER_LINE_GRADIENT");const Pe=be.paint.get("line-pattern").constantOr(1),We=1!==be.paint.get("line-opacity").constantOr(1);return!Pe&&We&&Ce.push("RENDER_LINE_ALPHA_DISCARD"),Ce})(c);let Ae=Ee.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(Ae=!1);for(const be of m){const Ce=i.getTile(be);if(se&&!Ce.patternsLoaded())continue;const Pe=Ce.getBucket(c);if(!Pe)continue;f.prepareDrawTile(be);const We=Pe.programConfigurations.get(c.id),et=f.useProgram(fe,We,Ee),Ft=Q.constantOr(null);if(Ft&&Ce.imageAtlas){const gt=Ce.imageAtlas,on=gt.patternPositions[Ft.to.toString()],gn=gt.patternPositions[Ft.from.toString()];on&&gn&&We.setConstantPatternPositions(on,gn)}const bt=z.constantOr(null),Tt=q.constantOr(null);if(!se&&bt&&Tt&&Ce.lineAtlas){const gt=Ce.lineAtlas,on=gt.getDash(bt.to,Tt),gn=gt.getDash(bt.from,Tt);on&&gn&&We.setConstantPatternPositions(on,gn)}const pt=f.terrain?be.projMatrix:null,tt=se?xr(f,Ce,c,ue,pt):ts(f,Ce,c,ue,pt,Pe.lineClipsArray.length);if(he){const gt=Pe.gradients[c.id];let on=gt.texture;if(c.gradientVersion!==gt.version){let gn=256;if(c.stepInterpolant){const Zn=i.getSource().maxzoom,Ot=be.canonical.z===Zn?Math.ceil(1<<f.transform.maxZoom-be.canonical.z):1;gn=h.clamp(h.nextPowerOfTwo(Pe.maxLineLength/h.EXTENT*1024*Ot),256,Se.maxTextureSize)}gt.gradient=h.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:gn,image:gt.gradient||void 0,clips:Pe.lineClipsArray}),gt.texture?gt.texture.update(gt.gradient):gt.texture=new h.Texture(Se,gt.gradient,de.RGBA),gt.version=c.gradientVersion,on=gt.texture}Se.activeTexture.set(de.TEXTURE1),on.bind(c.stepInterpolant?de.NEAREST:de.LINEAR,de.CLAMP_TO_EDGE)}j&&(Se.activeTexture.set(de.TEXTURE0),Ce.lineAtlasTexture.bind(de.LINEAR,de.REPEAT),We.updatePaintBuffers(ue)),se&&(Se.activeTexture.set(de.TEXTURE0),Ce.imageAtlasTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),We.updatePaintBuffers(ue)),f.prepareDrawProgram(Se,et,be.toUnwrapped());const vt=gt=>{et.draw(Se,de.TRIANGLES,T,gt,R,h.CullFaceMode.disabled,tt,c.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,c.paint,f.transform.zoom,We,Pe.layoutVertexBuffer2)};if(Ae){const gt=f.stencilModeForClipping(be).ref;0===gt&&f.terrain&&Se.clear({stencil:0});const on={func:de.EQUAL,mask:255};tt.u_alpha_discard_threshold=.8,vt(new h.StencilMode(on,gt,255,de.KEEP,de.KEEP,de.INVERT)),tt.u_alpha_discard_threshold=0,vt(new h.StencilMode(on,gt,255,de.KEEP,de.KEEP,de.KEEP))}else vt(f.stencilModeForClipping(be))}Ae&&(f.resetStencilClippingMasks(),f.terrain&&Se.clear({stencil:0}))},fill:function(f,i,c,m){const v=c.paint.get("fill-color"),b=c.paint.get("fill-opacity");if(0===b.constantOr(1))return;const T=f.colorModeForRenderPass(),R=c.paint.get("fill-pattern"),z=f.opaquePassEnabledForLayer()&&!R.constantOr(1)&&1===v.constantOr(h.Color.transparent).a&&1===b.constantOr(0)?"opaque":"translucent";if(f.renderPass===z){const j=f.depthModeForSublayer(1,"opaque"===f.renderPass?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly);Xs(f,i,c,m,j,T,!1)}if("translucent"===f.renderPass&&c.paint.get("fill-antialias")){const j=f.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,h.DepthMode.ReadOnly);Xs(f,i,c,m,j,T,!0)}},"fill-extrusion":function(f,i,c,m){const v=c.paint.get("fill-extrusion-opacity");if(0!==v&&"translucent"===f.renderPass){const b=new h.DepthMode(f.context.gl.LEQUAL,h.DepthMode.ReadWrite,f.depthRangeFor3D);if(1!==v||c.paint.get("fill-extrusion-pattern").constantOr(1))go(f,i,c,m,b,h.StencilMode.disabled,h.ColorMode.disabled),go(f,i,c,m,b,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const T=f.colorModeForRenderPass();go(f,i,c,m,b,h.StencilMode.disabled,T)}}},hillshade:function(f,i,c,m){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass)return;const v=f.context,b=f.depthModeForSublayer(0,h.DepthMode.ReadOnly),T=f.colorModeForRenderPass(),R=f.terrain&&f.terrain.renderingToTexture,[z,j]="translucent"!==f.renderPass||R?[{},m]:f.stencilConfigForOverlap(m);for(const q of j){const Q=i.getTile(q);if(Q.needsHillshadePrepare&&"offscreen"===f.renderPass)Wr(f,Q,c,b,h.StencilMode.disabled,T);else if("translucent"===f.renderPass){const se=R&&f.terrain?f.terrain.stencilModeForRTTOverlap(q):z[q.overscaledZ];fo(f,q,Q,c,b,se,T)}}v.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,i,c,m,v,b){if("translucent"!==f.renderPass||0===c.paint.get("raster-opacity")||!m.length)return;const T=f.context,R=T.gl,z=i.getSource(),j=f.useProgram("raster"),q=f.colorModeForRenderPass(),Q=f.terrain&&f.terrain.renderingToTexture,[se,he]=z instanceof jo||Q?[{},m]:f.stencilConfigForOverlap(m),ue=he[he.length-1].overscaledZ,fe=!f.options.moving;for(const Se of he){const de=Q?h.DepthMode.disabled:f.depthModeForSublayer(Se.overscaledZ-ue,1===c.paint.get("raster-opacity")?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly,R.LESS),Ee=Se.toUnwrapped(),Ae=i.getTile(Se);if(Q&&(!Ae||!Ae.hasData()))continue;const be=Q?Se.projMatrix:f.transform.calculateProjMatrix(Ee,fe),Ce=f.terrain&&Q?f.terrain.stencilModeForRTTOverlap(Se):se[Se.overscaledZ],Pe=b?0:c.paint.get("raster-fade-duration");Ae.registerFadeDuration(Pe);const We=i.findLoadedParent(Se,0),et=H(Ae,We,i,f.transform,Pe);let Ft,bt;f.terrain&&f.terrain.prepareDrawTile(Se);const Tt="nearest"===c.paint.get("raster-resampling")?R.NEAREST:R.LINEAR;T.activeTexture.set(R.TEXTURE0),Ae.texture.bind(Tt,R.CLAMP_TO_EDGE),T.activeTexture.set(R.TEXTURE1),We?(We.texture.bind(Tt,R.CLAMP_TO_EDGE),Ft=Math.pow(2,We.tileID.overscaledZ-Ae.tileID.overscaledZ),bt=[Ae.tileID.canonical.x*Ft%1,Ae.tileID.canonical.y*Ft%1]):Ae.texture.bind(Tt,R.CLAMP_TO_EDGE);const pt=No(be,bt||[0,0],Ft||1,et,c,z instanceof jo?z.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(T,j,Ee),z instanceof jo)j.draw(T,R.TRIANGLES,de,h.StencilMode.disabled,q,h.CullFaceMode.disabled,pt,c.id,z.boundsBuffer,f.quadTriangleIndexBuffer,z.boundsSegments);else{const{tileBoundsBuffer:tt,tileBoundsIndexBuffer:vt,tileBoundsSegments:gt}=f.getTileBoundsBuffers(Ae);j.draw(T,R.TRIANGLES,de,Ce,q,h.CullFaceMode.disabled,pt,c.id,tt,vt,gt)}}f.resetStencilClippingMasks()},background:function(f,i,c,m){const v=c.paint.get("background-color"),b=c.paint.get("background-opacity");if(0===b)return;const T=f.context,R=T.gl,z=f.transform,j=z.tileSize,q=c.paint.get("background-pattern");if(f.isPatternMissing(q))return;const Q=!q&&1===v.a&&1===b&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==Q)return;const se=h.StencilMode.disabled,he=f.depthModeForSublayer(0,"opaque"===Q?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly),ue=f.colorModeForRenderPass(),fe=f.useProgram(q?"backgroundPattern":"background");let Se,de=m;de||(Se=f.getBackgroundTiles(),de=Object.values(Se).map(Ae=>Ae.tileID)),q&&(T.activeTexture.set(R.TEXTURE0),f.imageManager.bind(f.context));const Ee=c.getCrossfadeParameters();for(const Ae of de){const be=Ae.toUnwrapped(),Ce=m?Ae.projMatrix:f.transform.calculateProjMatrix(be);f.prepareDrawTile(Ae);const Pe=i?i.getTile(Ae):Se?Se[Ae.key]:new h.Tile(Ae,j,z.zoom,f),We=q?Fa(Ce,b,f,q,{tileID:Ae,tileSize:j},Ee):fr(Ce,b,v);f.prepareDrawProgram(T,fe,be);const{tileBoundsBuffer:et,tileBoundsIndexBuffer:Ft,tileBoundsSegments:bt}=f.getTileBoundsBuffers(Pe);fe.draw(T,R.TRIANGLES,he,se,ue,h.CullFaceMode.disabled,We,c.id,et,Ft,bt)}},sky:function(f,i,c){const m=f.transform,v="mercator"===m.projection.name||"globe"===m.projection.name?1:h.smoothstep(7,8,m.zoom),b=c.paint.get("sky-opacity")*v;if(0===b)return;const T=f.context,R=c.paint.get("sky-type"),z=new h.DepthMode(T.gl.LEQUAL,h.DepthMode.ReadOnly,[0,1]),j=f.frameCounter/1e3%1;"atmosphere"===R?"offscreen"===f.renderPass?c.needsSkyboxCapture(f)&&(function(q,Q,se,he){const ue=q.context,fe=ue.gl;let Se=Q.skyboxFbo;if(!Se){Se=Q.skyboxFbo=ue.createFramebuffer(32,32,!1),Q.skyboxGeometry=new jn(ue),Q.skyboxTexture=ue.gl.createTexture(),fe.bindTexture(fe.TEXTURE_CUBE_MAP,Q.skyboxTexture),fe.texParameteri(fe.TEXTURE_CUBE_MAP,fe.TEXTURE_WRAP_S,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_CUBE_MAP,fe.TEXTURE_WRAP_T,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_CUBE_MAP,fe.TEXTURE_MIN_FILTER,fe.LINEAR),fe.texParameteri(fe.TEXTURE_CUBE_MAP,fe.TEXTURE_MAG_FILTER,fe.LINEAR);for(let be=0;be<6;++be)fe.texImage2D(fe.TEXTURE_CUBE_MAP_POSITIVE_X+be,0,fe.RGBA,32,32,0,fe.RGBA,fe.UNSIGNED_BYTE,null)}ue.bindFramebuffer.set(Se.framebuffer),ue.viewport.set([0,0,32,32]);const de=Q.getCenter(q,!0),Ee=q.useProgram("skyboxCapture"),Ae=new Float64Array(16);h.identity(Ae),h.rotateY(Ae,Ae,.5*-Math.PI),Pr(ue,Q,Ee,Ae,de,0),h.identity(Ae),h.rotateY(Ae,Ae,.5*Math.PI),Pr(ue,Q,Ee,Ae,de,1),h.identity(Ae),h.rotateX(Ae,Ae,.5*-Math.PI),Pr(ue,Q,Ee,Ae,de,2),h.identity(Ae),h.rotateX(Ae,Ae,.5*Math.PI),Pr(ue,Q,Ee,Ae,de,3),h.identity(Ae),Pr(ue,Q,Ee,Ae,de,4),h.identity(Ae),h.rotateY(Ae,Ae,Math.PI),Pr(ue,Q,Ee,Ae,de,5),ue.viewport.set([0,0,q.width,q.height])}(f,c),c.markSkyboxValid(f)):"sky"===f.renderPass&&function(q,Q,se,he,ue){const fe=q.context,Se=fe.gl,de=q.transform,Ee=q.useProgram("skybox");fe.activeTexture.set(Se.TEXTURE0),Se.bindTexture(Se.TEXTURE_CUBE_MAP,Q.skyboxTexture);const Ae={u_matrix:de.skyboxMatrix,u_sun_direction:Q.getCenter(q,!1),u_cubemap:0,u_opacity:he,u_temporal_offset:ue};q.prepareDrawProgram(fe,Ee),Ee.draw(fe,Se.TRIANGLES,se,h.StencilMode.disabled,q.colorModeForRenderPass(),h.CullFaceMode.backCW,Ae,"skybox",Q.skyboxGeometry.vertexBuffer,Q.skyboxGeometry.indexBuffer,Q.skyboxGeometry.segment)}(f,c,z,b,j):"gradient"===R&&"sky"===f.renderPass&&function(q,Q,se,he,ue){const fe=q.context,Se=fe.gl,de=q.transform,Ee=q.useProgram("skyboxGradient");Q.skyboxGeometry||(Q.skyboxGeometry=new jn(fe)),fe.activeTexture.set(Se.TEXTURE0);let Ae=Q.colorRampTexture;Ae||(Ae=Q.colorRampTexture=new h.Texture(fe,Q.colorRamp,Se.RGBA)),Ae.bind(Se.LINEAR,Se.CLAMP_TO_EDGE);const be=(Ce=de.skyboxMatrix,Pe=Q.getCenter(q,!1),We=Q.paint.get("sky-gradient-radius"),et=he,Ft=ue,{u_matrix:Ce,u_color_ramp:0,u_center_direction:Pe,u_radius:h.degToRad(We),u_opacity:et,u_temporal_offset:Ft});var Ce,Pe,We,et,Ft;q.prepareDrawProgram(fe,Ee),Ee.draw(fe,Se.TRIANGLES,se,h.StencilMode.disabled,q.colorModeForRenderPass(),h.CullFaceMode.backCW,be,"skyboxGradient",Q.skyboxGeometry.vertexBuffer,Q.skyboxGeometry.indexBuffer,Q.skyboxGeometry.segment)}(f,c,z,b,j)},debug:function(f,i,c){for(let m=0;m<c.length;m++)ee(f,i,c[m])},custom:function(f,i,c){const m=f.context,v=c.implementation;if(f.transform.projection.unsupportedLayers&&f.transform.projection.unsupportedLayers.includes("custom"))h.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===f.renderPass){const b=v.prerender;b&&(f.setCustomLayerDefaults(),m.setColorMode(f.colorModeForRenderPass()),b.call(v,m.gl,f.transform.customLayerMatrix()),m.setDirty(),f.setBaseState())}else if("translucent"===f.renderPass){f.setCustomLayerDefaults(),m.setColorMode(f.colorModeForRenderPass()),m.setStencilMode(h.StencilMode.disabled);const b="3d"===v.renderingMode?new h.DepthMode(f.context.gl.LEQUAL,h.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,h.DepthMode.ReadOnly);m.setDepthMode(b),v.render(m.gl,f.transform.customLayerMatrix()),m.setDirty(),f.setBaseState(),m.bindFramebuffer.set(null)}}};class ws{constructor(i,c){this.context=new On(i),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=h.SourceCache.maxUnderzooming+h.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Zo,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,c){const m=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new k(this,i));const v=this._terrain;this.transform.elevation=m?v:null,v.update(i,this.transform,c)}_updateFog(i){const c=i.fog;if(!c||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,v]=c.getFovAdjustedRange(this.transform._fov);if(m>v)return void(this.transform.fogCullDistSq=null);const b=m+.78*(v-m);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,c){if(this.width=i*h.exported.devicePixelRatio,this.height=c*h.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const i=this.context,c=new h.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(h.EXTENT,0),c.emplaceBack(0,h.EXTENT),c.emplaceBack(h.EXTENT,h.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(c,h.posAttributes.members),this.tileExtentSegments=h.SegmentVector.simpleSegment(0,0,4,2);const m=new h.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(h.EXTENT,0),m.emplaceBack(0,h.EXTENT),m.emplaceBack(h.EXTENT,h.EXTENT),this.debugBuffer=i.createVertexBuffer(m,h.posAttributes.members),this.debugSegments=h.SegmentVector.simpleSegment(0,0,4,5);const v=new h.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(v,h.posAttributes.members),this.viewportSegments=h.SegmentVector.simpleSegment(0,0,4,2);const b=new h.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(h.EXTENT,0,h.EXTENT,0),b.emplaceBack(0,h.EXTENT,0,h.EXTENT),b.emplaceBack(h.EXTENT,h.EXTENT,h.EXTENT,h.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(b,h.boundsAttributes.members),this.mercatorBoundsSegments=h.SegmentVector.simpleSegment(0,0,4,2);const T=new h.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(T);const R=new h.StructArrayLayout1ui2;for(const j of[0,1,3,2,0])R.emplaceBack(j);this.debugIndexBuffer=i.createIndexBuffer(R),this.emptyTexture=new h.Texture(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA),this.identityMat=h.create();const z=this.context.gl;this.stencilClearMode=new h.StencilMode({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.loadTimeStamps.push(h.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,c=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,c.TRIANGLES,h.DepthMode.disabled,this.stencilClearMode,h.ColorMode.disabled,h.CullFaceMode.disabled,Ti(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,c,m){if(!c||this.currentStencilSource===c.id||!i.isTileClipped()||!m||0===m.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let R=!1;for(const z of m)if(void 0===this._tileClippingMaskIDs[z.key]){R=!0;break}if(!R)return}this.currentStencilSource=c.id;const v=this.context,b=v.gl;this.nextStencilID+m.length>256&&this.clearStencil(),v.setColorMode(h.ColorMode.disabled),v.setDepthMode(h.DepthMode.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const R of m){const z=c.getTile(R),j=this._tileClippingMaskIDs[R.key]=this.nextStencilID++,{tileBoundsBuffer:q,tileBoundsIndexBuffer:Q,tileBoundsSegments:se}=this.getTileBoundsBuffers(z);T.draw(v,b.TRIANGLES,h.DepthMode.disabled,new h.StencilMode({func:b.ALWAYS,mask:0},j,255,b.KEEP,b.KEEP,b.REPLACE),h.ColorMode.disabled,h.CullFaceMode.disabled,Ti(R.projMatrix),"$clipping",q,Q,se)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,c=this.context.gl;return new h.StencilMode({func:c.NOTEQUAL,mask:255},i,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const c=this.context.gl;return new h.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(i){const c=this.context.gl,m=i.sort((T,R)=>R.overscaledZ-T.overscaledZ),v=m[m.length-1].overscaledZ,b=m[0].overscaledZ-v+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let R=0;R<b;R++)T[R+v]=new h.StencilMode({func:c.GEQUAL,mask:255},R+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=b,[T,m]}return[{[v]:h.StencilMode.disabled},m]}colorModeForRenderPass(){const i=this.context.gl;if(this._showOverdrawInspector){const c=1/8;return new h.ColorMode([i.CONSTANT_COLOR,i.ONE],new h.Color(c,c,c,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?h.ColorMode.unblended:h.ColorMode.alphaBlended}depthModeForSublayer(i,c,m){if(!this.opaquePassEnabledForLayer())return h.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new h.DepthMode(m||this.context.gl.LEQUAL,c,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,c){this.style=i,this.options=c,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(h.exported.now()),this.imageManager.beginFrame();const m=this.style.order,v=this.style._sourceCaches;for(const j in v){const q=v[j];q.used&&q.prepare(this.context)}const b={},T={},R={};for(const j in v){const q=v[j];b[j]=q.getVisibleCoordinates(),T[j]=b[j].slice().reverse(),R[j]=q.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let j=0;j<m.length;j++)if(this.style._layers[m[j]].is3D()){this.opaquePassCutoff=j;break}if(this.terrain&&(this.terrain.updateTileBinding(R),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new h.GlobeSharedBuffers(this.context)),!h.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const j of m){const q=this.style._layers[j],Q=i._getLayerSourceCache(q);if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;const se=Q?T[Q.id]:void 0;("custom"===q.type||q.isSky()||se&&se.length)&&this.renderLayer(this,Q,q,se)}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let z=h.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(z=this.style.fog.properties.get("color")),this.context.clear({color:c.showOverdrawInspector?h.Color.black:z,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const j=this.style._layers[m[this.currentLayer]],q=i._getLayerSourceCache(j);if(j.isSky())continue;const Q=q?T[q.id]:void 0;this._renderTileClippingMasks(j,q,Q),this.renderLayer(this,q,j,Q)}if(this.renderPass="sky",(h.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const j=this.style._layers[m[this.currentLayer]],q=i._getLayerSourceCache(j);j.isSky()&&this.renderLayer(this,q,j,q?T[q.id]:void 0)}for("globe"===this.transform.projection.name&&function(j){const q=j.context,Q=q.gl,se=j.transform,he=new h.DepthMode(Q.LEQUAL,h.DepthMode.ReadOnly,[0,1]),ue=j.useProgram("globeAtmosphere"),fe=se._camera.getWorldToCamera(se.worldSize,1),Se=se._camera.getCameraToClipPerspective(se._fov,se.width/se.height,se._nearZ,se._farZ),de=h.mul([],fe,h.calculateGlobeMatrix(se,se.worldSize)),Ee=h.mul([],se.labelPlaneMatrix,Se),Ae=h.transformMat4([],[0,0,0],de),be=h.add([],Ae,[se.worldSize/Math.PI/2,0,0]),Ce=h.transformMat4([],Ae,Ee),Pe=h.transformMat4([],be,Ee),We=h.length(h.sub([],Pe,Ce)),et=1-h.globeToMercatorTransition(se.zoom),Ft={u_center:Ce,u_radius:We,u_screen_size:[se.width,se.height],u_pixel_ratio:h.exported.devicePixelRatio,u_opacity:et,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};j.prepareDrawProgram(q,ue);const bt=j.globeSharedBuffers;bt&&ue.draw(q,Q.TRIANGLES,he,h.StencilMode.disabled,h.ColorMode.alphaBlended,h.CullFaceMode.backCW,Ft,"skybox",bt.atmosphereVertexBuffer,bt.atmosphereIndexBuffer,bt.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const j=this.style._layers[m[this.currentLayer]],q=i._getLayerSourceCache(j);if(j.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(j)){if(j.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const Q=q?("symbol"===j.type?R:T)[q.id]:void 0;this._renderTileClippingMasks(j,q,q?b[q.id]:void 0),this.renderLayer(this,q,j,Q),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let j=null;h.values(this.style._layers).forEach(q=>{const Q=i._getLayerSourceCache(q);Q&&!q.isHidden(this.transform.zoom)&&(!j||j.getSource().maxzoom<Q.getSource().maxzoom)&&(j=Q)}),j&&this.options.showTileBoundaries&&qi.debug(this,j,j.getVisibleCoordinates())}this.options.showPadding&&function(j){const q=j.transform.padding;Y(j,j.transform.height-(q.top||0),3,Na),Y(j,q.bottom||0,3,Rl),te(j,q.left||0,3,za),te(j,j.transform.width-(q.right||0),3,Ks);const Q=j.transform.centerPoint;var se,he,ue,fe;F(se=j,(he=Q.x)-1,(ue=j.transform.height-Q.y)-10,2,20,fe=Js),F(se,he-10,ue-1,20,2,fe)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(h.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,c,m,v){m.isHidden(this.transform.zoom)||("background"===m.type||"sky"===m.type||"custom"===m.type||v&&v.length)&&(this.id=m.id,this.gpuTimingStart(m),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(m.type)||qi[m.type](i,c,m,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let m=this.gpuTimers[i.id];m||(m=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),m.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,m.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}queryGpuTimers(i){const c={};for(const m in i){const v=i[m],b=this.context.extTimerQuery,T=b.getQueryObjectEXT(v.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(v.query),c[m]=T}return c}translatePosMatrix(i,c,m,v,b){if(!m[0]&&!m[1])return i;const T=b?"map"===v?this.transform.angle:0:"viewport"===v?-this.transform.angle:0;if(T){const j=Math.sin(T),q=Math.cos(T);m=[m[0]*q-m[1]*j,m[0]*j+m[1]*q]}const R=[b?m[0]:dn(c,m[0],this.transform.zoom),b?m[1]:dn(c,m[1],this.transform.zoom),0],z=new Float32Array(16);return h.translate(z,i,R),z}saveTileTexture(i){const c=this._tileTextures[i.size[0]];c?c.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const c=this._tileTextures[i];return c&&c.length>0?c.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const c=this.imageManager.getPattern(i.from.toString()),m=this.imageManager.getPattern(i.to.toString());return!c||!m}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,c=this.style&&this.style.fog,m=[];return this.terrain&&!this.terrain.renderingToTexture&&m.push("TERRAIN"),c&&!i&&0!==c.getOpacity(this.transform.pitch)&&m.push("FOG"),i&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}useProgram(i,c,m){this.cache=this.cache||{};const v=m||[],b=this.currentGlobalDefines().concat(v),T=K.cacheKey(i,b,c);return this.cache[T]||(this.cache[T]=new K(this.context,i,po[i],c,Il[i],b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=h.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(i){this.terrain&&this.terrain.prepareDrawTile(i)}prepareDrawProgram(i,c,m){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const b=v.getOpacity(this.transform.pitch);0!==b&&c.setFogUniformValues(i,((T,R,z,j)=>{const q=R.properties.get("color"),Q=T.frameCounter/1e3%1,se=[q.r/q.a,q.g/q.a,q.b/q.a,j];return{u_fog_matrix:z?T.transform.calculateFogTileMatrix(z):T.identityMat,u_fog_range:R.getFovAdjustedRange(T.transform._fov),u_fog_color:se,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_temporal_offset:Q}})(this,v,m,b))}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const i=this.context.gl,c=i.createTexture();return i.bindTexture(i.TEXTURE_2D,c),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&0!==i.getOpacity(this.transform.pitch)}getBackgroundTiles(){const i=this._backgroundTiles,c=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const v of m)c[v.key]=i[v.key]||new h.Tile(v,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class Cs{constructor(i=0,c=0,m=0,v=0){if(isNaN(i)||i<0||isNaN(c)||c<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=c,this.left=m,this.right=v}interpolate(i,c,m){return null!=c.top&&null!=i.top&&(this.top=h.number(i.top,c.top,m)),null!=c.bottom&&null!=i.bottom&&(this.bottom=h.number(i.bottom,c.bottom,m)),null!=c.left&&null!=i.left&&(this.left=h.number(i.left,c.left,m)),null!=c.right&&null!=i.right&&(this.right=h.number(i.right,c.right,m)),this}getCenter(i,c){const m=h.clamp((this.left+i-this.right)/2,0,i),v=h.clamp((this.top+c-this.bottom)/2,0,c);return new h.pointGeometry(m,v)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Cs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function zo(f,i){const c=h.getColumn(f,3);h.fromQuat(f,i),h.setColumn(f,3,c)}function hu(f,i){h.setColumn(f,3,[i[0],i[1],i[2],1])}function kl(f,i){const c=h.identity$1([]);return h.rotateZ$1(c,c,-i),h.rotateX$1(c,c,-f),c}function rl(f,i){const c=[f[0],f[1],0],m=[i[0],i[1],0];if(h.length(c)>=1e-15){const T=h.normalize([],c);h.scale$2(m,T,h.dot(m,T)),i[0]=m[0],i[1]=m[1]}const v=h.cross([],i,f);if(h.len(v)<1e-15)return null;const b=Math.atan2(-v[1],v[0]);return kl(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),b)}class Pc{constructor(i,c){this.position=i,this.orientation=c}get position(){return this._position}set position(i){this._position=this._renderWorldCopies?function(c){if(!c)return;const m=Array.isArray(c)?new h.MercatorCoordinate(c[0],c[1],c[2]):c;return m.x=h.wrap(m.x,0,1),m}(i):i}lookAtPoint(i,c){if(this.orientation=null,!this.position)return;const m=this._elevation?this._elevation.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(i)):0,v=this.position,b=h.MercatorCoordinate.fromLngLat(i,m),T=[b.x-v.x,b.y-v.y,b.z-v.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=rl(T,c)}setPitchBearing(i,c){this.orientation=kl(h.degToRad(i),h.degToRad(-c))}}class Ql{constructor(i,c){this._transform=h.identity([]),this._orientation=h.identity$1([]),c&&(this._orientation=c,zo(this._transform,this._orientation)),i&&hu(this._transform,i)}get mercatorPosition(){const i=this.position;return new h.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=h.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){hu(this._transform,i)}get orientation(){return this._orientation}set orientation(i){this._orientation=i,zo(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,c){this._orientation=kl(i,c),zo(this._transform,this._orientation)}forward(){const i=h.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=h.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=h.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,c){const m=new Float64Array(16);return h.invert(m,this.getWorldToCamera(i,c)),m}getWorldToCameraPosition(i,c,m){const v=this.position;h.scale$2(v,v,-i);const b=new Float64Array(16);return h.fromScaling(b,[m,m,m]),h.translate(b,b,v),b[10]*=c,b}getWorldToCamera(i,c){const m=new Float64Array(16),v=new Float64Array(4),b=this.position;return h.conjugate(v,this._orientation),h.scale$2(b,b,-i),h.fromQuat(m,v),h.translate(m,m,b),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=c,m[9]*=c,m[10]*=c,m[11]*=c,m}getCameraToClipPerspective(i,c,m,v){const b=new Float64Array(16);return h.perspective(b,i,c,m,v),b}getDistanceToElevation(i){const c=0===i?0:h.mercatorZfromAltitude(i,this.position[1]),m=this.forward();return(c-this.position[2])/m[2]}clone(){return new Ql([...this.position],[...this.orientation])}}function Rc(f,i){const c=Ea(f),m=function(b,T,R,z,j){const q=new h.LngLat(R.lng-180*Qs,R.lat),Q=new h.LngLat(R.lng+180*Qs,R.lat),se=b.project(q.lng,q.lat),he=b.project(Q.lng,Q.lat),ue=-Math.atan2(he.y-se.y,he.x-se.x),fe=h.MercatorCoordinate.fromLngLat(R);fe.y=h.clamp(fe.y,-.999975,.999975);const Se=fe.toLngLat(),de=b.project(Se.lng,Se.lat),Ee=h.MercatorCoordinate.fromLngLat(Se);Ee.x+=Qs;const Ae=Ee.toLngLat(),be=b.project(Ae.lng,Ae.lat),Ce=_o(be.x-de.x,be.y-de.y,ue),Pe=h.MercatorCoordinate.fromLngLat(Se);Pe.y+=Qs;const We=Pe.toLngLat(),et=b.project(We.lng,We.lat),Ft=_o(et.x-de.x,et.y-de.y,ue),bt=Math.abs(Ce.x)/Math.abs(Ft.y),Tt=h.identity([]);h.rotateZ(Tt,Tt,-ue*(1-(j?0:z)));const pt=h.identity([]);return h.scale(pt,pt,[1,1-(1-bt)*z,1]),pt[4]=-Ft.x/Ft.y*z,h.rotateZ(pt,pt,ue),h.multiply$1(pt,Tt,pt),pt}(f.projection,0,f.center,c,i),v=Ol(f);return h.scale(m,m,[v,v,1]),m}function Ol(f){const i=f.projection,c=Ea(f),m=ec(i,f.center),v=ec(i,h.LngLat.convert(i.center));return Math.pow(2,m*c+(1-c)*v)}function Ea(f){const i=f.projection.range;if(!i)return 0;const c=Math.max(f.width,f.height),m=Math.log(c/1024)/Math.LN2;return h.smoothstep(i[0]+m,i[1]+m,f.zoom)}const Qs=1/4e4;function ec(f,i){const c=h.clamp(i.lat,-h.MAX_MERCATOR_LATITUDE,h.MAX_MERCATOR_LATITUDE),m=new h.LngLat(i.lng-180*Qs,c),v=new h.LngLat(i.lng+180*Qs,c),b=f.project(m.lng,c),T=f.project(v.lng,c),R=h.MercatorCoordinate.fromLngLat(m),z=h.MercatorCoordinate.fromLngLat(v),j=T.x-b.x,q=T.y-b.y,Q=z.x-R.x,se=z.y-R.y,he=Math.sqrt((Q*Q+se*se)/(j*j+q*q));return Math.log(he)/Math.LN2}function _o(f,i,c){const m=Math.cos(c),v=Math.sin(c);return{x:f*m-i*v,y:f*v+i*m}}class ms{constructor(i,c,m,v,b){this.tileSize=512,this._renderWorldCopies=void 0===b||b,this._minZoom=i||0,this._maxZoom=c||22,this._minPitch=null==m?0:m,this._maxPitch=null==v?60:v,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new h.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Cs,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Ql,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const i=new ms(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.setProjection(this.getProjection()),i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i.tileSize=this.tileSize,i.setMaxBounds(this.getMaxBounds()),i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._cameraZoom=this._cameraZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,i?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(i){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),i&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return h.pick(this.projection,["name","center","parallels"])}setProjection(i){null==i&&(i={name:"mercator"}),this.projectionOptions=i;const c=this.projection?this.getProjection():void 0;return this.projection=h.getProjection(i),!qe(c,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(i){void 0===i?i=!0:null===i&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.pointGeometry(this.width,this.height)}get bearing(){return h.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const c=-i*Math.PI/180;var m,v,b,T,R,z,j,q,Q,se;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(m=new h.ARRAY_TYPE(4),h.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),v=this.rotationMatrix,T=this.angle,R=(b=this.rotationMatrix)[0],z=b[1],j=b[2],q=b[3],Q=Math.sin(T),se=Math.cos(T),v[0]=R*se+j*Q,v[1]=z*se+q*Q,v[2]=R*-Q+j*se,v[3]=z*-Q+q*se)}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const c=h.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(i){const c=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===i?(this._cameraZoom=null,!1):(this._centerAltitude=i,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let v=0,b=0;for(let T=0;T<c.length;T++){const R=new h.pointGeometry(c[T][0]*this.width,m+c[T][1]*(this.height-m)),z=i.pointCoordinate(R);if(!z)continue;const j=1/Math.hypot(z[0]-this._camera.position[0],z[1]-this._camera.position[1]);v+=z[3]*j,b+=j}return 0===b?NaN:v/b}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const i=this._cameraZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*c,v=this._mercatorZfromZoom(i),b=this._mercatorZfromZoom(this._maxZoom),T=Math.max(v-m,b);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let m;m=i.z<this._camera.position[2]?[c.x,c.y,c.z]:[i.x,i.y,i.z];const v=h.length(h.sub([],this._camera.position,m));return h.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let c=!1;if(i.orientation&&!h.exactEquals(i.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(i.orientation)),i.position){const m=[i.position.x,i.position.y,i.position.z];h.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,c=new Pc;return c.position=new h.MercatorCoordinate(i[0],i[1],i[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(i){if(!h.length$1(i))return!1;h.normalize$1(i,i);const c=h.transformQuat([],[0,0,-1],i),m=h.transformQuat([],[0,-1,0],i);if(m[2]<0)return!1;const v=rl(c,m);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(i){const c=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;i[2]=h.clamp(i[2],v/m,v/c),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,c,m){this._unmodified=!1,this._edgeInsets.interpolate(i,c,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const c=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(i){const c=[new h.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const m=this.pointCoordinate(new h.pointGeometry(0,0)),v=this.pointCoordinate(new h.pointGeometry(this.width,0)),b=this.pointCoordinate(new h.pointGeometry(this.width,this.height)),T=this.pointCoordinate(new h.pointGeometry(0,this.height)),R=Math.floor(Math.min(m.x,v.x,b.x,T.x)),z=Math.floor(Math.max(m.x,v.x,b.x,T.x)),j=1;for(let q=R-j;q<=z+j;q++)0!==q&&c.push(new h.UnwrappedTileID(q,i))}return c}coveringTiles(i){let c=this.coveringZoomLevel(i);const m=c,v=this.elevation&&!i.isTerrainDEM,b="mercator"===this.projection.name;if(void 0!==i.minzoom&&c<i.minzoom)return[];void 0!==i.maxzoom&&c>i.maxzoom&&(c=i.maxzoom);const T=this.locationCoordinate(this.center),R=1<<c,z=[R*T.x,R*T.y,0],j=h.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,"globe"!==this.projection.name),q=this.pointCoordinate(this.getCameraPoint()),Q=R*h.mercatorZfromAltitude(1,this.center.lat),se=this._camera.position[2]/h.mercatorZfromAltitude(1,this.center.lat),he=[R*q.x,R*q.y,se],ue=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),fe=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,Se=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,de=i.isTerrainDEM?-Se:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ee=this.projection.isReprojectedInTileSpace?Ol(this):1,Ae=tt=>{const vt=1/4e4,gt=new h.MercatorCoordinate(tt.x+vt,tt.y,tt.z),on=new h.MercatorCoordinate(tt.x,tt.y+vt,tt.z),gn=tt.toLngLat(),Zn=gt.toLngLat(),Ot=on.toLngLat(),ln=this.locationCoordinate(gn),Vn=this.locationCoordinate(Zn),Or=this.locationCoordinate(Ot),Yr=Math.hypot(Vn.x-ln.x,Vn.y-ln.y),vn=Math.hypot(Or.x-ln.x,Or.y-ln.y);return Math.sqrt(Yr*vn)*Ee/vt},be=tt=>{const vt=Se,gt=de;return{aabb:h.tileAABB(this,R,0,0,0,tt,gt,vt,this.projection),zoom:0,x:0,y:0,minZ:gt,maxZ:vt,wrap:tt,fullyVisible:!1}},Ce=[];let Pe=[];const We=c,et=i.reparseOverscaled?m:c,Ft=tt=>tt*tt,bt=Ft((se-this._centerAltitude)*Q),Tt=tt=>{if(!this._elevation||!tt.tileID||!b)return;const vt=this._elevation.getMinMaxForTile(tt.tileID),gt=tt.aabb;vt?(gt.min[2]=vt.min,gt.max[2]=vt.max,gt.center[2]=(gt.min[2]+gt.max[2])/2):(tt.shouldSplit=pt(tt),tt.shouldSplit||(gt.min[2]=gt.max[2]=gt.center[2]=this._centerAltitude))},pt=tt=>{if(tt.zoom<fe)return!0;if(tt.zoom===We)return!1;if(null!=tt.shouldSplit)return tt.shouldSplit;const vt=tt.aabb.distanceX(he),gt=tt.aabb.distanceY(he);let on=bt;v&&(on=Ft(tt.aabb.distanceZ(he)*Q));let gn=1;if(this.projection.isReprojectedInTileSpace&&m<=5){const Ot=Math.pow(2,tt.zoom),ln=Ae(new h.MercatorCoordinate((tt.x+.5)/Ot,(tt.y+.5)/Ot));gn=ln>.85?1:ln}const Zn=vt*vt+gt*gt+on;return Zn<Ft((1<<We-tt.zoom)*ue*gn*((Ot,ln)=>{if(ln*Ft(.707)<Ot)return 1;const Vn=Math.sqrt(ln/Ot);return Vn/(1.4144271570014144+(Math.pow(1.1,Vn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(on,bt),Zn))};if(this.renderWorldCopies)for(let tt=1;tt<=3;tt++)Ce.push(be(-tt)),Ce.push(be(tt));for(Ce.push(be(0));Ce.length>0;){const tt=Ce.pop(),vt=tt.x,gt=tt.y;let on=tt.fullyVisible;if(!on){const gn=tt.aabb.intersects(j);if(0===gn)continue;on=2===gn}if(tt.zoom!==We&&pt(tt))for(let gn=0;gn<4;gn++){const Zn=(vt<<1)+gn%2,Ot=(gt<<1)+(gn>>1),ln={aabb:b?tt.aabb.quadrant(gn):h.tileAABB(this,R,tt.zoom+1,Zn,Ot,tt.wrap,tt.minZ,tt.maxZ,this.projection),zoom:tt.zoom+1,x:Zn,y:Ot,wrap:tt.wrap,fullyVisible:on,tileID:void 0,shouldSplit:void 0,minZ:tt.minZ,maxZ:tt.maxZ};v&&(ln.tileID=new h.OverscaledTileID(tt.zoom+1===We?et:tt.zoom+1,tt.wrap,tt.zoom+1,Zn,Ot),Tt(ln)),Ce.push(ln)}else{const gn=tt.zoom===We?et:tt.zoom;if(i.minzoom&&i.minzoom>gn)continue;const Zn=z[0]-(.5+vt+(tt.wrap<<tt.zoom))*(1<<c-tt.zoom),Ot=z[1]-.5-gt,ln=tt.tileID?tt.tileID:new h.OverscaledTileID(gn,tt.wrap,tt.zoom,vt,gt);Pe.push({tileID:ln,distanceSq:Zn*Zn+Ot*Ot})}}if(this.fogCullDistSq){const tt=this.fogCullDistSq,vt=this.horizonLineFromTop();Pe=Pe.filter(gt=>{const on=[0,0,0,1],gn=[h.EXTENT,h.EXTENT,0,1],Zn=this.calculateFogTileMatrix(gt.tileID.toUnwrapped());h.transformMat4$1(on,on,Zn),h.transformMat4$1(gn,gn,Zn);const Ot=h.getAABBPointSquareDist(on,gn);if(0===Ot)return!0;let ln=!1;const Vn=this._elevation;if(Vn&&Ot>tt&&0!==vt){const Or=this.calculateProjMatrix(gt.tileID.toUnwrapped());let Yr;i.isTerrainDEM||(Yr=Vn.getMinMaxForTile(gt.tileID)),Yr||(Yr={min:de,max:Se});const vn=h.furthestTileCorner(this.rotation),lr=[vn[0]*h.EXTENT,vn[1]*h.EXTENT,Yr.max];h.transformMat4(lr,lr,Or),ln=(1-lr[1])*this.height*.5<vt}return Ot<tt||ln})}return Pe.sort((tt,vt)=>tt.distanceSq-vt.distanceSq).map(tt=>tt.tileID)}resize(i,c){this.width=i,this.height=c,this.pixelsToGLUnits=[2/i,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const c=h.clamp(i.lat,-h.MAX_MERCATOR_LATITUDE,h.MAX_MERCATOR_LATITUDE),m=this.projection.project(i.lng,c);return new h.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(i,c){const m=this.pointCoordinate(c),v=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(i);this.setLocation(new h.MercatorCoordinate(b.x-(m.x-v.x),b.y-(m.y-v.y)))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this._coordinatePoint(this.locationCoordinate(i),!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,c){const m=c?h.mercatorZfromAltitude(c,i.lat):void 0,v=this.projection.project(i.lng,i.lat);return new h.MercatorCoordinate(v.x,v.y,m)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,c){const m=null!=c?c:this._centerAltitude,v=[i.x,i.y,0,1],b=[i.x,i.y,1,1];h.transformMat4$1(v,v,this.pixelMatrixInverse),h.transformMat4$1(b,b,this.pixelMatrixInverse);const T=b[3];h.scale$1(v,v,1/v[3]),h.scale$1(b,b,1/T);const R=v[2],z=b[2];return{p0:v,p1:b,t:R===z?0:(m-R)/(z-R)}}screenPointToMercatorRay(i){const c=[i.x,i.y,0,1],m=[i.x,i.y,1,1];return h.transformMat4$1(c,c,this.pixelMatrixInverse),h.transformMat4$1(m,m,this.pixelMatrixInverse),h.scale$1(c,c,1/c[3]),h.scale$1(m,m,1/m[3]),c[2]=h.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,m[2]=h.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,h.scale$1(c,c,1/this.worldSize),h.scale$1(m,m,1/this.worldSize),new h.Ray([c[0],c[1],c[2]],h.normalize([],h.sub([],m,c)))}rayIntersectionCoordinate(i){const{p0:c,p1:m,t:v}=i,b=h.mercatorZfromAltitude(c[2],this._center.lat),T=h.mercatorZfromAltitude(m[2],this._center.lat);return new h.MercatorCoordinate(h.number(c[0],m[0],v)/this.worldSize,h.number(c[1],m[1],v)/this.worldSize,h.number(b,T,v))}pointCoordinate(i,c=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(i.x,i.y,c)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);const c=this.elevation;let m=this.elevation.pointCoordinate(i);if(m)return new h.MercatorCoordinate(m[0],m[1],m[2]);let v=0,b=this.horizonLineFromTop();if(i.y>b)return this.pointCoordinate(i);const T=.02*b,R=i.clone();for(let z=0;z<10&&b-v>T;z++){R.y=h.number(v,b,.66);const j=c.pointCoordinate(R);j?(b=R.y,m=j):v=R.y}return m?new h.MercatorCoordinate(m[0],m[1],m[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){if(this.elevation)return!this.elevation.pointCoordinate(i);{const c=this.horizonLineFromTop();return i.y<c}}_coordinatePoint(i,c){const m=c&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,v=[i.x*this.worldSize,i.y*this.worldSize,m+i.toAltitude(),1];return h.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new h.pointGeometry(v[0]/v[3],v[1]/v[3]):new h.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(i,c){const m=new h.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),v=new h.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new h.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),T=new h.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let R=this.pointCoordinate(m,i),z=this.pointCoordinate(v,i);const j=this.pointCoordinate(b,c),q=this.pointCoordinate(T,c),Q=(se,he)=>(he.y-se.y)/(he.x-se.x);return R.y>1&&z.y>=0?R=new h.MercatorCoordinate((1-q.y)/Q(q,R)+q.x,1):R.y<0&&z.y<=1&&(R=new h.MercatorCoordinate(-q.y/Q(q,R)+q.x,0)),z.y>1&&R.y>=0?z=new h.MercatorCoordinate((1-j.y)/Q(j,z)+j.x,1):z.y<0&&R.y<=1&&(z=new h.MercatorCoordinate(-j.y/Q(j,z)+j.x,0)),(new h.LngLatBounds).extend(this.coordinateLocation(R)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(j))}_getBounds3D(){const i=this.elevation;if(!i.visibleDemTiles.length)return this._getBounds(0,0);const c=i.visibleDemTiles.reduce((m,v)=>{if(v.dem){const b=v.dem.tree;m.min=Math.min(m.min,b.minimums[0]),m.max=Math.max(m.max,b.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(c.min*i.exaggeration(),c.max*i.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(i=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-c*(1-this._horizonShift);return i?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-h.MAX_MERCATOR_LATITUDE,this.maxLat=h.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=h.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=h.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=h.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=h.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,c){return this.projection.createTileTransform(this,c).createTileMatrix(i)}calculateDistanceTileData(i){const c=i.key,m=this._distanceTileDataCache;if(m[c])return m[c];const v=i.canonical,b=1/this.height,T=this.cameraWorldSize/this.zoomScale(v.z),R=(v.x+Math.pow(2,v.z)*i.wrap)*T,z=v.y*T,j=this.point,q=this.angle,Q=Math.sin(-q),se=-Math.cos(-q);return m[c]={bearing:[Q,se],center:[(j.x-R)*b,(j.y-z)*b],scale:T/h.EXTENT*b},m[c]}calculateFogTileMatrix(i){const c=i.key,m=this._fogTileMatrixCache;if(m[c])return m[c];const v=this.calculatePosMatrix(i,this.cameraWorldSize);return h.multiply$1(v,this.worldToFogMatrix,v),m[c]=new Float32Array(v),m[c]}calculateProjMatrix(i,c=!1){const m=i.key,v=c?this._alignedProjMatrixCache:this._projMatrixCache;if(v[m])return v[m];const b=this.calculatePosMatrix(i,this.worldSize);return h.multiply$1(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,b),v[m]=new Float32Array(b),v[m]}calculatePixelsToTileUnitsMatrix(i){const c=i.tileID.key,m=this._pixelsToTileUnitsCache;if(m[c])return m[c];const v=function(b,T){const{scale:R}=b.tileTransform,z=R*h.EXTENT/(b.tileSize*Math.pow(2,T.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return j=new Float32Array(4),se=(q=T.inverseAdjustmentMatrix)[1],he=q[2],ue=q[3],Se=(Q=[z,z])[1],j[0]=q[0]*(fe=Q[0]),j[1]=se*fe,j[2]=he*Se,j[3]=ue*Se,j;var j,q,Q,se,he,ue,fe,Se}(i,this);return m[c]=v,m[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const c=h.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),v=this._camera.forward(),b=h.mercatorZfromAltitude(1,this._center.lat);m[2]/=b,v[2]/=b,h.normalize(v,v);const T=i.raycast(m,v,i.exaggeration());if(T){const R=h.scaleAndAdd([],m,v,T),z=new h.MercatorCoordinate(R[0],R[1],h.mercatorZfromAltitude(R[2],h.latFromMercatorY(R[1]))),j=(z.z+h.length([z.x-m[0],z.y-m[1],z.z-m[2]*b]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(j),this._centerAltitude=z.toAltitude(),this._center=this.coordinateLocation(z),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const c=h.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),v=i.getAtPointOrZero(new h.MercatorCoordinate(...m)),b=this._minimumHeightOverTerrain()*Math.cos(h.degToRad(this._maxPitch)),T=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*v;if(T<b){const R=this.locationCoordinate(this._center,this._centerAltitude),z=[R.x-m[0],R.y-m[1],R.z-m[2]],j=h.length(z);z[2]-=(b-T)/this._projectionScaler;const q=h.length(z);if(0===q)return;h.scale$2(z,z,j/q*this._projectionScaler),this._camera.position=[R.x-z[0],R.y-z[1],R.z*this._projectionScaler-z[2]],this._camera.orientation=rl(z,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const Q=this.center;return Q.lat=h.clamp(Q.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(Q.lng=h.clamp(Q.lng,this.minLng,this.maxLng)),this.center=Q,void(this._constraining=!1)}const i=this._unmodified,{x:c,y:m}=this.point;let v=0,b=c,T=m;const R=this.width/2,z=this.height/2,j=this.worldMinY*this.scale,q=this.worldMaxY*this.scale;if(m-z<j&&(T=j+z),m+z>q&&(T=q-z),q-j<this.height&&(v=Math.max(v,this.height/(q-j)),T=(q+j)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Q=this.worldMinX*this.scale,se=this.worldMaxX*this.scale,he=this.worldSize/2-(Q+se)/2;b=(c+he+this.worldSize)%this.worldSize-he,b-R<Q&&(b=Q+R),b+R>se&&(b=se-R),se-Q<this.width&&(v=Math.max(v,this.width/(se-Q)),b=(se+Q)/2)}b===c&&T===m||(this.center=this.unproject(new h.pointGeometry(b,T))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCameraAltitude(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this._fov/2,c=this.centerOffset,m=this.pixelsPerMeter;this._projectionScaler=m/(h.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(i)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?m:1),b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);b[8]=2*-c.x/this.width,b[9]=2*c.y/this.height;let T=h.mul([],b,v);if(this.projection.isReprojectedInTileSpace){const be=this.locationCoordinate(this.center),Ce=h.identity([]);h.translate(Ce,Ce,[be.x*this.worldSize,be.y*this.worldSize,0]),h.multiply$1(Ce,Ce,Rc(this)),h.translate(Ce,Ce,[-be.x*this.worldSize,-be.y*this.worldSize,0]),h.multiply$1(T,T,Ce),this.inverseAdjustmentMatrix=function(Pe){const We=Rc(Pe,!0);return Me([],[We[0],We[1],We[4],We[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=h.scale([],T,[this.worldSize,this.worldSize,this.worldSize/m,1]),this.projMatrix=T,this.invProjMatrix=h.invert(new Float64Array(16),this.projMatrix);const R=new Float32Array(16);h.identity(R),h.scale(R,R,[1,-1,1]),h.rotateX(R,R,this._pitch),h.rotateZ(R,R,this.angle);const z=h.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),j=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-c.x/this.width,z[9]=2*(c.y+j)/this.height,this.skyboxMatrix=h.multiply$1(R,z,R);const q=this.point,Q=q.x,se=q.y,he=this.width%2/2,ue=this.height%2/2,fe=Math.cos(this.angle),Se=Math.sin(this.angle),de=Q-Math.round(Q)+fe*he+Se*ue,Ee=se-Math.round(se)+fe*ue+Se*he,Ae=new Float64Array(T);if(h.translate(Ae,Ae,[de>.5?de-1:de,Ee>.5?Ee-1:Ee,0]),this.alignedProjMatrix=Ae,T=h.create(),h.scale(T,T,[this.width/2,-this.height/2,1]),h.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=h.create(),h.scale(T,T,[1,-1,1]),h.translate(T,T,[-1,-1,0]),h.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.pixelMatrix=h.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},T=h.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");this.pixelMatrixInverse=T,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSize,c=this.cameraPixelsPerMeter,m=this._camera.position,v=1/this.height,b=[i,i,c];h.scale$2(b,b,v),h.scale$2(m,m,-1),h.multiply$2(m,m,b);const T=h.create();h.translate(T,T,m),h.scale(T,T,b),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,c,v)}_computeCameraPosition(i){const c=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),v=this.point,b=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*c-i/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-m[0]*b,v.y/this.worldSize-m[1]*b,i/this.worldSize*this._centerAltitude-m[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=i[2];let v=1;m>0&&(v=Math.min((c-this._camera.position[2])/m,1)),this._camera.position=h.scaleAndAdd([],this._camera.position,i,v),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,c=this._camera.forward(),{pitch:m,bearing:v}=this._camera.getPitchBearing(),b=h.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(h.degToRad(this._maxPitch)),R=Math.max((i[2]-b)/Math.cos(m),T),z=this._zoomFromMercatorZ(R);h.scaleAndAdd(i,i,c,R),this._pitch=h.clamp(m,h.degToRad(this.minPitch),h.degToRad(this.maxPitch)),this.angle=h.wrap(v,-Math.PI,Math.PI),this._setZoom(h.clamp(z,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new h.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(h.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(i,c){const m=Math.min(i.x,c.x),v=Math.max(i.x,c.x),b=Math.min(i.y,c.y),T=Math.max(i.y,c.y);if(b<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const R=[new h.pointGeometry(m,b),new h.pointGeometry(v,T),new h.pointGeometry(m,T),new h.pointGeometry(v,b)],z=this.renderWorldCopies?-3:0,j=this.renderWorldCopies?4:1;for(const q of R){const Q=this.pointRayIntersection(q);if(Q.t<0)return!0;const se=this.rayIntersectionCoordinate(Q);if(se.x<z||se.y<0||se.x>j||se.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+h.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new h.pointGeometry(0,0),new h.pointGeometry(this.width,this.height))}zoomDeltaToMovement(i,c){const m=h.length(h.sub([],this._camera.position,i)),v=this._zoomFromMercatorZ(m)+c;return m-this._mercatorZfromZoom(v)}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.pointGeometry(0,i))}}function Hr(f,i){let c=!1,m=null;const v=()=>{m=null,c&&(f(),m=setTimeout(v,i),c=!1)};return()=>(c=!0,m||v(),m)}class du{constructor(i){this._hashName=i&&encodeURIComponent(i),h.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Hr(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,h.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return h.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const c=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,v=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,v),T=Math.round(c.lng*b)/b,R=Math.round(c.lat*b)/b,z=this._map.getBearing(),j=this._map.getPitch();let q="";if(q+=i?`/${T}/${R}/${m}`:`${m}/${R}/${T}`,(z||j)&&(q+="/"+Math.round(10*z)/10),j&&(q+=`/${Math.round(j)}`),this._hashName){const Q=this._hashName;let se=!1;const he=h.window.location.hash.slice(1).split("&").map(ue=>{const fe=ue.split("=")[0];return fe===Q?(se=!0,`${fe}=${q}`):ue}).filter(ue=>ue);return se||he.push(`${Q}=${q}`),`#${he.join("&")}`}return`#${q}`}_getCurrentHash(){const i=h.window.location.hash.replace("#","");if(this._hashName){let c;return i.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(c=m)}),(c&&c[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._getCurrentHash();if(i.length>=3&&!i.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:c,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=h.window.location.href.replace(/(#.+)?$/,this.getHashString());h.window.history.replaceState(h.window.history.state,null,i)}}const ua={linearity:.3,easing:h.bezier(0,0,.3,1)},il=h.extend({deceleration:2500,maxSpeed:1400},ua),pu=h.extend({deceleration:20,maxSpeed:1400},ua),kc=h.extend({deceleration:1e3,maxSpeed:360},ua),wr=h.extend({deceleration:1e3,maxSpeed:90},ua);class Ba{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:h.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,c=h.exported.now();for(;i.length>0&&c-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new h.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)c.zoom+=b.zoomDelta||0,c.bearing+=b.bearingDelta||0,c.pitch+=b.pitchDelta||0,b.panDelta&&c.pan._add(b.panDelta),b.around&&(c.around=b.around),b.pinchAround&&(c.pinchAround=b.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(c.pan.mag()){const b=Ta(c.pan.mag(),m,h.extend({},il,i||{}));v.offset=c.pan.mult(b.amount/c.pan.mag()),v.center=this._map.transform.center,Va(v,b)}if(c.zoom){const b=Ta(c.zoom,m,pu);v.zoom=this._map.transform.zoom+b.amount,Va(v,b)}if(c.bearing){const b=Ta(c.bearing,m,kc);v.bearing=this._map.transform.bearing+h.clamp(b.amount,-179,179),Va(v,b)}if(c.pitch){const b=Ta(c.pitch,m,wr);v.pitch=this._map.transform.pitch+b.amount,Va(v,b)}if(v.zoom||v.bearing){const b=void 0===c.pinchAround?c.around:c.pinchAround;v.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),h.extend(v,{noMoveStart:!0})}}function Va(f,i){(!f.duration||f.duration<i.duration)&&(f.duration=i.duration,f.easing=i.easing)}function Ta(f,i,c){const{maxSpeed:m,linearity:v,deceleration:b}=c,T=h.clamp(f*v/(i/1e3),-m,m),R=Math.abs(T)/(b*v);return{easing:c.easing,duration:1e3*R,amount:T*(R/2)}}class zi extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,m,v={}){const b=ge.mousePos(c.getCanvasContainer(),m),T=c.unproject(b);super(i,h.extend({point:b,lngLat:T,originalEvent:m},v)),this._defaultPrevented=!1,this.target=c}}class ol extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,m){const v="touchend"===i?m.changedTouches:m.touches,b=ge.touchPos(c.getCanvasContainer(),v),T=b.map(z=>c.unproject(z)),R=b.reduce((z,j,q,Q)=>z.add(j.div(Q.length)),new h.pointGeometry(0,0));super(i,{points:b,point:R,lngLats:T,lngLat:c.unproject(R),originalEvent:m}),this._defaultPrevented=!1}}class zu extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,m){super(i,{originalEvent:m}),this._defaultPrevented=!1}}class ns{constructor(i,c){this._map=i,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new zu(i.type,this._map,i))}mousedown(i,c){return this._mousedownPos=c,this._firePreventable(new zi(i.type,this._map,i))}mouseup(i){this._map.fire(new zi(i.type,this._map,i))}preclick(i){const c=h.extend({},i);c.type="preclick",this._map.fire(new zi(c.type,this._map,c))}click(i,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(i),this._map.fire(new zi(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new zi(i.type,this._map,i))}mouseover(i){this._map.fire(new zi(i.type,this._map,i))}mouseout(i){this._map.fire(new zi(i.type,this._map,i))}touchstart(i){return this._firePreventable(new ol(i.type,this._map,i))}touchmove(i){this._map.fire(new ol(i.type,this._map,i))}touchend(i){this._map.fire(new ol(i.type,this._map,i))}touchcancel(i){this._map.fire(new ol(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fl{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(i){this._map.fire(new zi(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new zi(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Oc{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,c){this.isEnabled()&&i.shiftKey&&0===i.button&&(ge.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(i,c){if(!this._active)return;const m=c;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=m,this._box||(this._box=ge.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const b=Math.min(v.x,m.x),T=Math.max(v.x,m.x),R=Math.min(v.y,m.y),z=Math.max(v.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${R}px)`,this._box.style.width=T-b+"px",this._box.style.height=z-R+"px")})}mouseupWindow(i,c){if(!this._active||0!==i.button)return;const m=this._startPos,v=c;if(this.reset(),ge.suppressClick(),m.x!==v.x||m.y!==v.y)return this._map.fire(new h.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:b=>b.fitScreenCoordinates(m,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&27===i.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ge.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,c){return this._map.fire(new h.Event(i,{originalEvent:c}))}}function sl(f,i){const c={};for(let m=0;m<f.length;m++)c[f[m].identifier]=i[m];return c}class ha{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,c,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=i.timeStamp),m.length===this.numTouches&&(this.centroid=function(v){const b=new h.pointGeometry(0,0);for(const T of v)b._add(T);return b.div(v.length)}(c),this.touches=sl(m,c)))}touchmove(i,c,m){if(this.aborted||!this.centroid)return;const v=sl(m,c);for(const b in this.touches){const T=this.touches[b],R=v[b];(!R||R.dist(T)>30)&&(this.aborted=!0)}}touchend(i,c,m){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Da{constructor(i){this.singleTap=new ha(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,c,m){this.singleTap.touchstart(i,c,m)}touchmove(i,c,m){this.singleTap.touchmove(i,c,m)}touchend(i,c,m){const v=this.singleTap.touchend(i,c,m);if(v){const b=i.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(v)<30;if(b&&T||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Fc{constructor(){this._zoomIn=new Da({numTouches:1,numTaps:2}),this._zoomOut=new Da({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,c,m){this._zoomIn.touchstart(i,c,m),this._zoomOut.touchstart(i,c,m)}touchmove(i,c,m){this._zoomIn.touchmove(i,c,m),this._zoomOut.touchmove(i,c,m)}touchend(i,c,m){const v=this._zoomIn.touchend(i,c,m),b=this._zoomOut.touchend(i,c,m);return v?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(v)},{originalEvent:i})}):b?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const fu={0:1,2:2};class ro{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(i,c){return!1}_move(i,c){return{}}mousedown(i,c){if(this._lastPoint)return;const m=ge.mouseButton(i);this._correctButton(i,m)&&(this._lastPoint=c,this._eventButton=m)}mousemoveWindow(i,c){const m=this._lastPoint;if(m)if(i.preventDefault(),function(v,b){const T=fu[b];return void 0===v.buttons||(v.buttons&T)!==T}(i,this._eventButton))this.reset();else if(this._moved||!(c.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(m,c)}mouseupWindow(i){this._lastPoint&&ge.mouseButton(i)===this._eventButton&&(this._moved&&ge.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lc extends ro{mousedown(i,c){super.mousedown(i,c),this._lastPoint&&(this._active=!0)}_correctButton(i,c){return 0===c&&!i.ctrlKey}_move(i,c){return{around:c,panDelta:c.sub(i)}}}class yo extends ro{_correctButton(i,c){return 0===c&&i.ctrlKey||2===c}_move(i,c){const m=.8*(c.x-i.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(i){i.preventDefault()}}class Ua extends ro{_correctButton(i,c){return 0===c&&i.ctrlKey||2===c}_move(i,c){const m=-.5*(c.y-i.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(i){i.preventDefault()}}class ja{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),h.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new h.pointGeometry(0,0)}touchstart(i,c,m){return this._calculateTransform(i,c,m)}touchmove(i,c,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===m.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.preventDefault(),this._calculateTransform(i,c,m)}}touchend(i,c,m){this._calculateTransform(i,c,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,c,m){m.length>0&&(this._active=!0);const v=sl(m,c),b=new h.pointGeometry(0,0),T=new h.pointGeometry(0,0);let R=0;for(const j in v){const q=v[j],Q=this._touches[j];Q&&(b._add(q),T._add(q.sub(Q)),R++,v[j]=q)}if(this._touches=v,R<this._minTouches||!T.mag())return;const z=T.div(R);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(R),panDelta:z}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ge.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Es{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(i){}_move(i,c,m){return{}}touchstart(i,c,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([c[0],c[1]]))}touchmove(i,c,m){if(!this._firstTwoTouches)return;i.preventDefault();const[v,b]=this._firstTwoTouches,T=ea(m,c,v),R=ea(m,c,b);if(!T||!R)return;const z=this._aroundCenter?null:T.add(R).div(2);return this._move([T,R],z,i)}touchend(i,c,m){if(!this._firstTwoTouches)return;const[v,b]=this._firstTwoTouches,T=ea(m,c,v),R=ea(m,c,b);T&&R||(this._active&&ge.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ea(f,i,c){for(let m=0;m<f.length;m++)if(f[m].identifier===c)return i[m]}function tc(f,i){return Math.log(f/i)/Math.LN2}class Ls extends Es{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,c){const m=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(tc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:tc(this._distance,m),pinchAround:c}}}function nc(f,i){return 180*f.angleWith(i)/Math.PI}class ta extends Es{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,c){const m=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:nc(this._vector,m),pinchAround:c}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const c=25/(Math.PI*this._minDiameter)*360,m=nc(i,this._startVector);return Math.abs(m)<c}}function al(f){return Math.abs(f.y)>Math.abs(f.x)}class ll extends Es{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(i){this._lastPoints=i,al(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,c,m){const v=i[0].sub(this._lastPoints[0]),b=i[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&m.touches.length<3)&&(this._valid=this.gestureBeginsVertically(v,b,m.timeStamp),this._valid))return this._lastPoints=i,this._active=!0,{pitchDelta:(v.y+b.y)/2*-.5}}gestureBeginsVertically(i,c,m){if(void 0!==this._valid)return this._valid;const v=i.mag()>=2,b=c.mag()>=2;if(!v&&!b)return;if(!v||!b)return void 0===this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const T=i.y>0==c.y>0;return al(i)&&al(c)&&T}}const cl={panStep:100,bearingStep:15,pitchStep:10};class rc{constructor(){const i=cl;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let c=0,m=0,v=0,b=0,T=0;switch(i.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:i.shiftKey?m=-1:(i.preventDefault(),b=-1);break;case 39:i.shiftKey?m=1:(i.preventDefault(),b=1);break;case 38:i.shiftKey?v=1:(i.preventDefault(),T=-1);break;case 40:i.shiftKey?v=-1:(i.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:R=>{const z=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:Bu,zoom:c?Math.round(z)+c*(i.shiftKey?2:1):z,bearing:R.getBearing()+m*this._bearingStep,pitch:R.getPitch()+v*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:R.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Bu(f){return f*(2-f)}const da=4.000244140625;class Ll{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,h.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=i.deltaMode===h.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const m=h.exported.now(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==c&&c%da==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(v*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),i.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=i,this._delta-=c,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=ge.mousePos(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform,c=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(0!==this._delta){const z="wheel"===this._type&&Math.abs(this._delta)>da?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&0!==j&&(j=1/j);const q=c(),Q=Math.pow(2,q),se="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):Q;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(se*j))),"wheel"===this._type&&(this._startZoom=c(),this._easing=this._smoothOutEasing(200)),this._delta=0}const m="number"==typeof this._targetZoom?this._targetZoom:c(),v=this._startZoom,b=this._easing;let T,R=!1;if("wheel"===this._type&&v&&b){const z=Math.min((h.exported.now()-this._lastWheelEventTime)/200,1),j=b(z);T=h.number(v,m,j),z<1?this._frameId||(this._frameId=!0):R=!0}else T=m,R=!0;return this._active=!0,R&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!R,zoomDelta:T-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let c=h.ease;if(this._prevEase){const m=this._prevEase,v=(h.exported.now()-m.start)/m.duration,b=m.easing(v+.01)-m.easing(v),T=.27/Math.sqrt(b*b+1e-4)*.01,R=Math.sqrt(.0729-T*T);c=h.bezier(T,R,.25,1)}return this._prevEase={start:h.exported.now(),duration:i,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ge.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(h.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!h.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class $a{constructor(i,c){this._clickZoom=i,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ic{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,c){return i.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(i.shiftKey?-1:1),around:m.unproject(c)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oc{constructor(){this._tap=new Da({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(i,c,m){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=c[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(i,c,m))}touchmove(i,c,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const v=c[0],b=v.y-this._swipePoint.y;return this._swipePoint=v,i.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(i,c,m)}touchend(i,c,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(i,c,m)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Za{constructor(i,c,m){this._el=i,this._mousePan=c,this._touchPan=m}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ul{constructor(i,c,m){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=c,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class mu{constructor(i,c,m,v){this._el=i,this._touchZoom=c,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const hl=f=>f.zoom||f.drag||f.pitch||f.rotate;class sc extends h.Event{}class Nc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,c){const m=h.sub([],c,i);this.radius=h.length(m[2]<0?h.div([],m,this.constants):[m[0],m[1],0])}projectRay(i){h.div(i,i,this.constants),h.normalize(i,i),h.mul$1(i,i,this.constants);const c=h.scale$2([],i,this.radius);if(c[2]>0){const m=h.scale$2([],[0,0,1],h.dot(c,[0,0,1])),v=h.scale$2([],h.normalize([],[c[0],c[1],0]),this.radius),b=h.add([],c,h.scale$2([],h.sub([],h.add([],v,m),c),2));c[0]=b[0],c[1]=b[1]}return c}}function dl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class pl{constructor(i,c){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ba(i),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Nc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),h.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[h.window.document,"mousemove",{capture:!0}],[h.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[h.window,"blur",void 0]];for(const[v,b,T]of this._listeners)v.addEventListener(b,v===h.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[i,c,m]of this._listeners)i.removeEventListener(c,i===h.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(i){const c=this._map,m=c.getCanvasContainer();this._add("mapEvent",new ns(c,i));const v=c.boxZoom=new Oc(c,i);this._add("boxZoom",v);const b=new Fc,T=new ic;c.doubleClickZoom=new $a(T,b),this._add("tapZoom",b),this._add("clickZoom",T);const R=new oc;this._add("tapDragZoom",R);const z=c.touchPitch=new ll(c);this._add("touchPitch",z);const j=new yo(i),q=new Ua(i);c.dragRotate=new ul(i,j,q),this._add("mouseRotate",j,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]);const Q=new Lc(i),se=new ja(c,i);c.dragPan=new Za(m,Q,se),this._add("mousePan",Q),this._add("touchPan",se,["touchZoom","touchRotate"]);const he=new ta,ue=new Ls;c.touchZoomRotate=new mu(m,ue,he,R),this._add("touchRotate",he,["touchPan","touchZoom"]),this._add("touchZoom",ue,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Fl(c));const fe=c.scrollZoom=new Ll(c,this);this._add("scrollZoom",fe,["mousePan"]);const Se=c.keyboard=new rc;this._add("keyboard",Se);for(const de of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[de]&&c[de].enable(i[de])}_add(i,c,m){this._handlers.push({handlerName:i,handler:c,allowed:m}),this._handlersById[i]=c}stop(i){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(hl(this._eventsInProgress))||this.isZooming()}_blockedByActive(i,c,m){for(const v in i)if(v!==m&&(!c||c.indexOf(v)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const c=[];for(const m of i)this._el.contains(m.target)&&c.push(m);return c}handleEvent(i,c){this._updatingCamera=!0;const m="renderFrame"===i.type,v=m?void 0:i,b={needsRenderFrame:!1},T={},R={},z=i.touches?this._getMapTouches(i.touches):void 0,j=z?ge.touchPos(this._el,z):m?void 0:ge.mousePos(this._el,i);for(const{handlerName:se,handler:he,allowed:ue}of this._handlers){if(!he.isEnabled())continue;let fe;this._blockedByActive(R,ue,se)?he.reset():he[c||i.type]&&(fe=he[c||i.type](i,j,z),this.mergeHandlerResult(b,T,fe,se,v),fe&&fe.needsRenderFrame&&this._triggerRenderFrame()),(fe||he.isActive())&&(R[se]=he)}const q={};for(const se in this._previousActiveHandlers)R[se]||(q[se]=v);this._previousActiveHandlers=R,(Object.keys(q).length||dl(b))&&(this._changes.push([b,T,q]),this._triggerRenderFrame()),(Object.keys(R).length||dl(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Q}=b;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))}mergeHandlerResult(i,c,m,v,b){if(!m)return;h.extend(i,m);const T={handlerName:v,originalEvent:m.originalEvent||b};void 0!==m.zoomDelta&&(c.zoom=T),void 0!==m.panDelta&&(c.drag=T),void 0!==m.pitchDelta&&(c.pitch=T),void 0!==m.bearingDelta&&(c.rotate=T)}_applyChanges(){const i={},c={},m={};for(const[v,b,T]of this._changes)v.panDelta&&(i.panDelta=(i.panDelta||new h.pointGeometry(0,0))._add(v.panDelta)),v.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+v.pitchDelta),void 0!==v.around&&(i.around=v.around),void 0!==v.aroundCoord&&(i.aroundCoord=v.aroundCoord),void 0!==v.pinchAround&&(i.pinchAround=v.pinchAround),v.noInertia&&(i.noInertia=v.noInertia),h.extend(c,b),h.extend(m,T);this._updateMapTransform(i,c,m),this._changes=[]}_updateMapTransform(i,c,m){const v=this._map,b=v.transform,T=Ee=>[Ee.x,Ee.y,Ee.z];if((Ee=>{const Ae=this._eventsInProgress.drag;return Ae&&!this._handlersById[Ae.handlerName].isActive()})()&&!dl(i)){const Ee=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",Ee!==b.zoom&&this._map._update(!0)}if(!dl(i))return this._fireEvents(c,m,!0);let{panDelta:R,zoomDelta:z,bearingDelta:j,pitchDelta:q,around:Q,aroundCoord:se,pinchAround:he}=i;void 0!==he&&(Q=he),(Ee=>c.drag&&!this._eventsInProgress.drag)()&&Q&&(this._dragOrigin=T(b.pointCoordinate3D(Q)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",v._stop(!0),Q=Q||v.transform.centerPoint,j&&(b.bearing+=j),q&&(b.pitch+=q),b._updateCameraState();const ue=[0,0,0];if(R){const Ee=b.pointCoordinate(Q),Ae=b.pointCoordinate(Q.sub(R));Ee&&Ae&&(ue[0]=Ae.x-Ee.x,ue[1]=Ae.y-Ee.y)}const fe=b.zoom,Se=[0,0,0];if(z){const Ee=T(se||b.pointCoordinate3D(Q)),Ae={dir:h.normalize([],h.sub([],Ee,b._camera.position))};if(Ae.dir[2]<0){const be=b.zoomDeltaToMovement(Ee,z);h.scale$2(Se,Ae.dir,be)}}const de=h.add(ue,ue,Se);b._translateCameraConstrained(de),z&&Math.abs(b.zoom-fe)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(c,m,!0)}_fireEvents(i,c,m){const v=hl(this._eventsInProgress),b=hl(i),T={};for(const q in i){const{originalEvent:Q}=i[q];this._eventsInProgress[q]||(T[`${q}start`]=Q),this._eventsInProgress[q]=i[q]}!v&&b&&this._fireEvent("movestart",b.originalEvent);for(const q in T)this._fireEvent(q,T[q]);b&&this._fireEvent("move",b.originalEvent);for(const q in i){const{originalEvent:Q}=i[q];this._fireEvent(q,Q)}const R={};let z;for(const q in this._eventsInProgress){const{handlerName:Q,originalEvent:se}=this._eventsInProgress[q];this._handlersById[Q].isActive()||(delete this._eventsInProgress[q],z=c[Q]||se,R[`${q}end`]=z)}for(const q in R)this._fireEvent(q,R[q]);const j=hl(this._eventsInProgress);if(m&&(v||b)&&!j){this._updatingCamera=!0;const q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=se=>0!==se&&-this._bearingSnap<se&&se<this._bearingSnap;q?(Q(q.bearing||this._map.getBearing())&&(q.bearing=0),this._map.easeTo(q,{originalEvent:z})):(this._map.fire(new h.Event("moveend",{originalEvent:z})),Q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,c){this._map.fire(new h.Event(i,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new sc("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Nl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class zl extends h.Evented{constructor(i,c){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=c.bearingSnap,h.bindAll(["_renderFrameCallback"],this)}getCenter(){return new h.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,c){return this.jumpTo({center:i},c)}panBy(i,c,m){return i=h.pointGeometry.convert(i).mult(-1),this.panTo(this.transform.center,h.extend({offset:i},c),m)}panTo(i,c,m){return this.easeTo(h.extend({center:i},c),m)}getZoom(){return this.transform.zoom}setZoom(i,c){return this.jumpTo({zoom:i},c),this}zoomTo(i,c,m){return this.easeTo(h.extend({zoom:i},c),m)}zoomIn(i,c){return this.zoomTo(this.getZoom()+1,i,c),this}zoomOut(i,c){return this.zoomTo(this.getZoom()-1,i,c),this}getBearing(){return this.transform.bearing}setBearing(i,c){return this.jumpTo({bearing:i},c),this}getPadding(){return this.transform.padding}setPadding(i,c){return this.jumpTo({padding:i},c),this}rotateTo(i,c,m){return this.easeTo(h.extend({bearing:i},c),m)}resetNorth(i,c){return this.rotateTo(0,h.extend({duration:1e3},i),c),this}resetNorthPitch(i,c){return this.easeTo(h.extend({bearing:0,pitch:0,duration:1e3},i),c),this}snapToNorth(i,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,c):this}getPitch(){return this.transform.pitch}setPitch(i,c){return this.jumpTo({pitch:i},c),this}cameraForBounds(i,c){i=h.LngLatBounds.convert(i);const m=c&&c.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),m,c)}_extendCameraOptions(i){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=h.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){const m=i.padding;i.padding={top:m,bottom:m,right:m,left:m}}return i.padding=h.extend(c,i.padding),i}_cameraForBoxAndBearing(i,c,m,v){const b=this._extendCameraOptions(v),T=this.transform,R=T.padding,z=T.project(h.LngLat.convert(i)),j=T.project(h.LngLat.convert(c)),q=z.rotate(-h.degToRad(m)),Q=j.rotate(-h.degToRad(m)),se=new h.pointGeometry(Math.max(q.x,Q.x),Math.max(q.y,Q.y)),he=new h.pointGeometry(Math.min(q.x,Q.x),Math.min(q.y,Q.y)),ue=se.sub(he),fe=(T.width-(R.left+R.right+b.padding.left+b.padding.right))/ue.x,Se=(T.height-(R.top+R.bottom+b.padding.top+b.padding.bottom))/ue.y;if(Se<0||fe<0)return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const de=Math.min(T.scaleZoom(T.scale*Math.min(fe,Se)),b.maxZoom),Ee="number"==typeof b.offset.x?new h.pointGeometry(b.offset.x,b.offset.y):h.pointGeometry.convert(b.offset),Ae=new h.pointGeometry((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(m*Math.PI/180),be=Ee.add(Ae).mult(T.scale/T.zoomScale(de));return{center:T.unproject(z.add(j).div(2).sub(be)),zoom:de,bearing:m}}_cameraForBox(i,c,m,v,b){const T=this._extendCameraOptions(b);m=m||0,v=v||0,i=h.LngLat.convert(i),c=h.LngLat.convert(c);const R=this.transform.clone();R.padding=T.padding;const z=this.getFreeCameraOptions(),j=new h.LngLat(.5*(i.lng+c.lng),.5*(i.lat+c.lat)),q=.5*(m+v);if(R._camera.position[2]<h.mercatorZfromAltitude(q,j.lat))return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");z.lookAtPoint(j),R.setFreeCameraOptions(z);const Q=h.MercatorCoordinate.fromLngLat(i),se=h.MercatorCoordinate.fromLngLat(c),he=R.pointRayIntersection(R.centerPoint,q),ue=[(fe=R.rayIntersectionCoordinate(he)).x,fe.y,fe.z];var fe;const Se=R.screenPointToMercatorRay(R.centerPoint),de="globe"!==R.projection.name;let Ee,Ae=0;do{const be=Math.floor(R.zoom),Ce=1<<be,Pe=Math.min(Ce*Q.x,Ce*se.x),We=Math.min(Ce*Q.y,Ce*se.y),et=Math.max(Ce*Q.x,Ce*se.x),Ft=Math.max(Ce*Q.y,Ce*se.y),bt=new h.Aabb([Pe,We,m],[et,Ft,v]),Tt=h.Frustum.fromInvProjectionMatrix(R.invProjMatrix,R.worldSize,be,de);if(2!==bt.intersects(Tt)){Ee&&(R._camera.position=h.scaleAndAdd([],R._camera.position,Se.dir,-Ee),R._updateStateFromCamera());break}const pt=h.sub([],R._camera.position,ue);Ee=.5*h.length(pt),R._camera.position=h.scaleAndAdd([],R._camera.position,Se.dir,Ee);try{R._updateStateFromCamera()}catch(tt){return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++Ae<10);return{center:R.center,zoom:R.zoom,bearing:R.bearing,pitch:R.pitch}}fitBounds(i,c,m){return this._fitInternal(this.cameraForBounds(i,c),c,m)}_raycastElevationBox(i,c){const m=this.transform.elevation;if(!m)return;const v=new h.pointGeometry(i.x,c.y),b=new h.pointGeometry(c.x,i.y),T=m.pointCoordinate(i);if(!T)return;const R=m.pointCoordinate(c);if(!R)return;const z=m.pointCoordinate(v);if(!z)return;const j=m.pointCoordinate(b);if(!j)return;const q=new h.MercatorCoordinate(T[0],T[1]).toLngLat(),Q=new h.MercatorCoordinate(R[0],R[1]).toLngLat(),se=new h.MercatorCoordinate(z[0],z[1]).toLngLat(),he=new h.MercatorCoordinate(j[0],j[1]).toLngLat(),ue=Math.min(q.lng,Math.min(Q.lng,Math.min(se.lng,he.lng))),fe=Math.min(q.lat,Math.min(Q.lat,Math.min(se.lat,he.lat))),Se=Math.max(q.lng,Math.max(Q.lng,Math.max(se.lng,he.lng))),de=Math.max(q.lat,Math.max(Q.lat,Math.max(se.lat,he.lat))),Ee=Math.min(T[3],Math.min(R[3],Math.min(z[3],j[3]))),Ae=Math.max(T[3],Math.max(R[3],Math.max(z[3],j[3])));return{minLngLat:new h.LngLat(ue,fe),maxLngLat:new h.LngLat(Se,de),minAltitude:Ee,maxAltitude:Ae}}fitScreenCoordinates(i,c,m,v,b){let T,R,z,j;const q=h.pointGeometry.convert(i),Q=h.pointGeometry.convert(c),se=this._raycastElevationBox(q,Q);if(se)T=se.minLngLat,R=se.maxLngLat,z=se.minAltitude,j=se.maxAltitude;else{if(this.transform.anyCornerOffEdge(q,Q))return this;T=this.transform.pointLocation(q),R=this.transform.pointLocation(Q)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(h.pointGeometry.convert(i)),this.transform.pointLocation(h.pointGeometry.convert(c)),m,v):this._cameraForBox(T,R,z,j,v),v,b)}_fitInternal(i,c,m){return i?(delete(c=h.extend(i,c)).padding,c.linear?this.easeTo(c,m):this.flyTo(c,m)):this}jumpTo(i,c){this.stop();const m=i.preloadOnly?this.transform.clone():this.transform;let v=!1,b=!1,T=!1;return"zoom"in i&&m.zoom!==+i.zoom&&(v=!0,m.zoom=+i.zoom),void 0!==i.center&&(m.center=h.LngLat.convert(i.center)),"bearing"in i&&m.bearing!==+i.bearing&&(b=!0,m.bearing=+i.bearing),"pitch"in i&&m.pitch!==+i.pitch&&(T=!0,m.pitch=+i.pitch),null==i.padding||m.isPaddingEqual(i.padding)||(m.padding=i.padding),i.preloadOnly?(this._preloadTiles(m),this):(this.fire(new h.Event("movestart",c)).fire(new h.Event("move",c)),v&&this.fire(new h.Event("zoomstart",c)).fire(new h.Event("zoom",c)).fire(new h.Event("zoomend",c)),b&&this.fire(new h.Event("rotatestart",c)).fire(new h.Event("rotate",c)).fire(new h.Event("rotateend",c)),T&&this.fire(new h.Event("pitchstart",c)).fire(new h.Event("pitch",c)).fire(new h.Event("pitchend",c)),this.fire(new h.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||h.warnOnce(Nl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,c){const m=this.transform;if(!m.projection.supportsFreeCamera)return void h.warnOnce(Nl);this.stop();const v=m.zoom,b=m.pitch,T=m.bearing;m.setFreeCameraOptions(i);const R=v!==m.zoom,z=b!==m.pitch,j=T!==m.bearing;return this.fire(new h.Event("movestart",c)).fire(new h.Event("move",c)),R&&this.fire(new h.Event("zoomstart",c)).fire(new h.Event("zoom",c)).fire(new h.Event("zoomend",c)),j&&this.fire(new h.Event("rotatestart",c)).fire(new h.Event("rotate",c)).fire(new h.Event("rotateend",c)),z&&this.fire(new h.Event("pitchstart",c)).fire(new h.Event("pitch",c)).fire(new h.Event("pitchend",c)),this.fire(new h.Event("moveend",c)),this}easeTo(i,c){this._stop(!1,i.easeId),(!1===(i=h.extend({offset:[0,0],duration:500,easing:h.ease},i)).animate||!i.essential&&h.exported.prefersReducedMotion)&&(i.duration=0);const m=this.transform,v=this.getZoom(),b=this.getBearing(),T=this.getPitch(),R=this.getPadding(),z="zoom"in i?+i.zoom:v,j="bearing"in i?this._normalizeBearing(i.bearing,b):b,q="pitch"in i?+i.pitch:T,Q="padding"in i?i.padding:m.padding,se=h.pointGeometry.convert(i.offset);let he=m.centerPoint.add(se);const ue="globe"===m.projection.name?m.pointCoordinate(he).toLngLat():m.pointLocation(he),fe=h.LngLat.convert(i.center||ue);this._normalizeCenter(fe);const Se=m.project(ue),de=m.project(fe).sub(Se),Ee=m.zoomScale(z-v);let Ae,be;i.around&&(Ae=h.LngLat.convert(i.around),be=m.locationPoint(Ae));const Ce=this._zooming||z!==v,Pe=this._rotating||b!==j,We=this._pitching||q!==T,et=!m.isPaddingEqual(Q),Ft=Tt=>pt=>{if(Ce&&(Tt.zoom=h.number(v,z,pt)),Pe&&(Tt.bearing=h.number(b,j,pt)),We&&(Tt.pitch=h.number(T,q,pt)),et&&(Tt.interpolatePadding(R,Q,pt),he=Tt.centerPoint.add(se)),Ae)Tt.setLocationAtPoint(Ae,be);else{const tt=Tt.zoomScale(Tt.zoom-v),vt=z>v?Math.min(2,Ee):Math.max(.5,Ee),gt=Math.pow(vt,1-pt),on=Tt.unproject(Se.add(de.mult(pt*gt)).mult(tt));Tt.setLocationAtPoint(Tt.renderWorldCopies?on.wrap():on,he)}return i.preloadOnly||this._fireMoveEvents(c),Tt};if(i.preloadOnly){const Tt=this._emulate(Ft,i.duration,m);return this._preloadTiles(Tt),this}const bt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ce,this._rotating=Pe,this._pitching=We,this._padding=et,this._easeId=i.easeId,this._prepareEase(c,i.noMoveStart,bt),this._ease(Ft(m),Tt=>{m.recenterOnTerrain(),this._afterEase(c,Tt)},i),this}_prepareEase(i,c,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||m.moving||this.fire(new h.Event("movestart",i)),this._zooming&&!m.zooming&&this.fire(new h.Event("zoomstart",i)),this._rotating&&!m.rotating&&this.fire(new h.Event("rotatestart",i)),this._pitching&&!m.pitching&&this.fire(new h.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new h.Event("move",i)),this._zooming&&this.fire(new h.Event("zoom",i)),this._rotating&&this.fire(new h.Event("rotate",i)),this._pitching&&this.fire(new h.Event("pitch",i))}_afterEase(i,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId,this.transform.cameraElevationReference="ground";const m=this._zooming,v=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new h.Event("zoomend",i)),v&&this.fire(new h.Event("rotateend",i)),b&&this.fire(new h.Event("pitchend",i)),this.fire(new h.Event("moveend",i))}flyTo(i,c){if(!i.essential&&h.exported.prefersReducedMotion){const Ot=h.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ot,c)}this.stop(),i=h.extend({offset:[0,0],speed:1.2,curve:1.42,easing:h.ease},i);const m=this.transform,v=this.getZoom(),b=this.getBearing(),T=this.getPitch(),R=this.getPadding(),z="zoom"in i?h.clamp(+i.zoom,m.minZoom,m.maxZoom):v,j="bearing"in i?this._normalizeBearing(i.bearing,b):b,q="pitch"in i?+i.pitch:T,Q="padding"in i?i.padding:m.padding,se=m.zoomScale(z-v),he=h.pointGeometry.convert(i.offset);let ue=m.centerPoint.add(he);const fe=m.pointLocation(ue),Se=h.LngLat.convert(i.center||fe);this._normalizeCenter(Se);const de=m.project(fe),Ee=m.project(Se).sub(de);let Ae=i.curve;const be=Math.max(m.width,m.height),Ce=be/se,Pe=Ee.mag();if("minZoom"in i){const Ot=h.clamp(Math.min(i.minZoom,v,z),m.minZoom,m.maxZoom),ln=be/m.zoomScale(Ot-v);Ae=Math.sqrt(ln/Pe*2)}const We=Ae*Ae;function et(Ot){const ln=(Ce*Ce-be*be+(Ot?-1:1)*We*We*Pe*Pe)/(2*(Ot?Ce:be)*We*Pe);return Math.log(Math.sqrt(ln*ln+1)-ln)}function Ft(Ot){return(Math.exp(Ot)-Math.exp(-Ot))/2}function bt(Ot){return(Math.exp(Ot)+Math.exp(-Ot))/2}const Tt=et(0);let pt=function(Ot){return bt(Tt)/bt(Tt+Ae*Ot)},tt=function(Ot){return be*((bt(Tt)*(Ft(ln=Tt+Ae*Ot)/bt(ln))-Ft(Tt))/We)/Pe;var ln},vt=(et(1)-Tt)/Ae;if(Math.abs(Pe)<1e-6||!isFinite(vt)){if(Math.abs(be-Ce)<1e-6)return this.easeTo(i,c);const Ot=Ce<be?-1:1;vt=Math.abs(Math.log(Ce/be))/Ae,tt=function(){return 0},pt=function(ln){return Math.exp(Ot*Ae*ln)}}i.duration="duration"in i?+i.duration:1e3*vt/("screenSpeed"in i?+i.screenSpeed/Ae:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const gt=b!==j,on=q!==T,gn=!m.isPaddingEqual(Q),Zn=Ot=>ln=>{const Vn=ln*vt,Or=1/pt(Vn);Ot.zoom=1===ln?z:v+Ot.scaleZoom(Or),gt&&(Ot.bearing=h.number(b,j,ln)),on&&(Ot.pitch=h.number(T,q,ln)),gn&&(Ot.interpolatePadding(R,Q,ln),ue=Ot.centerPoint.add(he));const Yr=1===ln?Se:Ot.unproject(de.add(Ee.mult(tt(Vn))).mult(Or));return Ot.setLocationAtPoint(Ot.renderWorldCopies?Yr.wrap():Yr,ue),Ot._updateCenterElevation(),i.preloadOnly||this._fireMoveEvents(c),Ot};if(i.preloadOnly){const Ot=this._emulate(Zn,i.duration,m);return this._preloadTiles(Ot),this}return this._zooming=!0,this._rotating=gt,this._pitching=on,this._padding=gn,this._prepareEase(c,!1),this._ease(Zn(m),()=>this._afterEase(c),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,c)}if(!i){const m=this.handlers;m&&m.stop(!1)}return this}_ease(i,c,m){!1===m.animate||0===m.duration?(i(1),c()):(this._easeStart=h.exported.now(),this._easeOptions=m,this._onEaseFrame=i,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((h.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,c){i=h.wrap(i,-180,180);const m=Math.abs(i-c);return Math.abs(i-360-c)<m&&(i-=360),Math.abs(i+360-c)<m&&(i+=360),i}_normalizeCenter(i){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const m=i.lng-c.center.lng;i.lng+=m>180?-360:m<-180?360:0}_emulate(i,c,m){const v=Math.ceil(15*c/1e3),b=[],T=i(m.clone());for(let R=0;R<=v;R++){const z=T(R/v);b.push(z.clone())}return b}}class Ga{constructor(i={}){this.options=i,h.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const c=this.options&&this.options.compact;return this._map=i,this._container=ge.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ge.create("button","mapboxgl-ctrl-attrib-button",this._container),ge.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ge.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,c){const m=this._map._getUIString(`AttributionControl.${c}`);i.setAttribute("aria-label",m),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||h.config.ACCESS_TOKEN}];if(i){const m=c.reduce((v,b,T)=>(b.value&&(v+=`${b.key}=${b.value}${T<c.length-1?"&":""}`),v),"?");i.href=`${h.config.FEEDBACK_URL}/${m}${this._map._hash?this._map._hash.getHashString(!0):""}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||"metadata"!==i.sourceDataType&&"visibility"!==i.sourceDataType&&"style"!==i.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const c=this._map.style._sourceCaches;for(const v in c){const b=c[v];if(b.used){const T=b.getSource();T.attribution&&i.indexOf(T.attribution)<0&&i.push(T.attribution)}}i.sort((v,b)=>v.length-b.length),i=i.filter((v,b)=>{for(let T=b+1;T<i.length;T++)if(i[T].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const m=i.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,i.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ac{constructor(){h.bindAll(["_updateLogo"],this),h.bindAll(["_updateCompact"],this)}onAdd(i){this._map=i,this._container=ge.create("div","mapboxgl-ctrl");const c=ge.create("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&"metadata"!==i.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(0===Object.entries(i).length)return!0;for(const c in i){const m=i[c].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const c=i[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class lc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const c=++this._id;return this._queue.push({callback:i,id:c,cancelled:!1}),c}remove(i){const c=this._currentlyRunning,m=c?this._queue.concat(c):this._queue;for(const v of m)if(v.id===i)return void(v.cancelled=!0)}run(i=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const m of c)if(!m.cancelled&&(m.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function zc(f,i,c){if(f=new h.LngLat(f.lng,f.lat),i){const m=new h.LngLat(f.lng-360,f.lat),v=new h.LngLat(f.lng+360,f.lat),b=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),T=c.locationPoint(f).distSqr(i),R=i.x<0||i.y<0||i.x>c.width||i.y>c.height;c.locationPoint(m).distSqr(i)<T&&(R||Math.abs(m.lng-c.center.lng)<b)?f=m:c.locationPoint(v).distSqr(i)<T&&(R||Math.abs(v.lng-c.center.lng)<b)&&(f=v)}for(;Math.abs(f.lng-c.center.lng)>180;){const m=c.locationPoint(f);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const L={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class M extends h.Evented{constructor(i,c){if(super(),(i instanceof h.window.HTMLElement||c)&&(i=h.extend({element:i},c)),h.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&"auto"!==i.pitchAlignment?i.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),i&&i.element)this._element=i.element,this._offset=h.pointGeometry.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=ge.create("div");const v=41,b=27,T=ge.createSVG("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),R=ge.createSVG("radialGradient",{id:"shadowGradient"},ge.createSVG("defs",{},T));ge.createSVG("stop",{offset:"10%","stop-opacity":.4},R),ge.createSVG("stop",{offset:"100%","stop-opacity":.05},R),ge.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),ge.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),ge.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),ge.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=h.pointGeometry.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const m=this._element.classList;for(const v in L)m.remove(`mapboxgl-marker-anchor-${v}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=h.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const c=38.1,m=13.5,v=Math.sqrt(Math.pow(m,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-c],"bottom-left":[v,-1*(c-m+v)],"bottom-right":[-v,-1*(c-m+v)],left:[m,-1*(c-m)],right:[-m,-1*(c-m)]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const c=i.code,m=i.charCode||i.keyCode;"Space"!==c&&"Enter"!==c&&32!==m&&13!==m||this.togglePopup()}_onMapClick(i){const c=i.originalEvent.target,m=this._element;this._popup&&(c===m||m.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const i=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(i))return void this._clearFadeTimer();const c=this._map.unproject(i);let m=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const b=this._map.getFreeCameraOptions();if(b.position){const T=b.position.toLngLat();m=T.distanceTo(c)<.9*T.distanceTo(this._lngLat)}}const v=(1-this._map._queryFogOpacity(c))*(m?.2:1);this._element.style.opacity=`${v}`,this._popup&&this._popup._setOpacity(`${v}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(i){const c=this._map.transform;return!!i&&i.x>=0&&i.x<c.width&&i.y>=0&&i.y<c.height}_updateDOM(){const i=this._pos||new h.pointGeometry(0,0),c=this._calculatePitch(),m=this._calculateRotation();this._element.style.transform=`${L[this._anchor]} translate(${i.x}px, ${i.y}px) rotateX(${c}deg) rotateZ(${m}deg)`}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(i){h.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=zc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),!0===i?this._updateFrameId=h.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const i=this._map.transform,c=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&c._rotate(i.angle),"map"===this._pitchAlignment&&(c.y*=Math.cos(i._pitch)),c}getOffset(){return this._offset}setOffset(i){return this._offset=h.pointGeometry.convert(i),this._update(),this}_onMove(i){if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new h.Event("dragstart"))),this.fire(new h.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new h.Event("dragend")),this._state="inactive"}_addDragHandler(i){this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&"auto"!==i?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class A{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const c=h.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,c,m){this._start=this.getValue(c),this._end=i,this._startTime=c,this._endTime=c+m}}const V={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:W,HTMLElement:oe,ImageBitmap:we}=h.window,Le={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function ft(f){f.parentNode&&f.parentNode.removeChild(f)}const en={showCompass:!0,showZoom:!0,visualizePitch:!1};class Rr{constructor(i,c,m=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new yo({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,m&&(this.mousePitch=new Ua({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),h.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(i,c){this.mouseRotate.mousedown(i,c),this.mousePitch&&this.mousePitch.mousedown(i,c),ge.disableDrag()}move(i,c){const m=this.map,v=this.mouseRotate.mousemoveWindow(i,c);if(v&&v.bearingDelta&&m.setBearing(m.getBearing()+v.bearingDelta),this.mousePitch){const b=this.mousePitch.mousemoveWindow(i,c);b&&b.pitchDelta&&m.setPitch(m.getPitch()+b.pitchDelta)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ge.enableDrag(),h.window.removeEventListener("mousemove",this.mousemove),h.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(h.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),ge.mousePos(this.element,i)),h.window.addEventListener("mousemove",this.mousemove),h.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,ge.mousePos(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){1!==i.targetTouches.length?this.reset():(this._startPos=this._lastPos=ge.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){1!==i.targetTouches.length?this.reset():(this._lastPos=ge.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){0===i.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const wn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let rr,gr=0,gs=!1;const kr={maxWidth:100,unit:"metric"};function Ht(f,i,c){const m=c&&c.maxWidth||100,v=f._containerHeight/2,b=f.unproject([0,v]),T=f.unproject([m,v]),R=b.distanceTo(T);if(c&&"imperial"===c.unit){const z=3.2808*R;z>5280?Ns(i,m,z/5280,f._getUIString("ScaleControl.Miles"),f):Ns(i,m,z,f._getUIString("ScaleControl.Feet"),f)}else c&&"nautical"===c.unit?Ns(i,m,R/1852,f._getUIString("ScaleControl.NauticalMiles"),f):R>=1e3?Ns(i,m,R/1e3,f._getUIString("ScaleControl.Kilometers"),f):Ns(i,m,R,f._getUIString("ScaleControl.Meters"),f)}function Ns(f,i,c,m,v){const b=function(R){const z=Math.pow(10,`${Math.floor(R)}`.length-1);let j=R/z;return j=j>=10?10:j>=5?5:j>=3?3:j>=2?2:j>=1?1:function(q){const Q=Math.pow(10,Math.ceil(-Math.log(q)/Math.LN10));return Math.round(q*Q)/Q}(j),z*j}(c),T=b/c;v._requestDomTask(()=>{f.style.width=i*T+"px",f.innerHTML=`${b}&nbsp;${m}`})}const pa={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},zs=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),fa={version:h.version,supported:Qe,setRTLTextPlugin:h.setRTLTextPlugin,getRTLTextPluginStatus:h.getRTLTextPluginStatus,Map:class extends zl{constructor(f){if(null!=(f=h.extend({},Le,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ms(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._renderTaskQueue=new lc,this._domRenderTaskQueue=new lc,this._controls=[],this._markers=[],this._mapId=h.uniqueId(),this._locale=h.extend({},V,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new A(0),this._requestManager=new h.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,"string"==typeof f.container){if(this._container=h.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof oe))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&h.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),h.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==h.window&&(h.window.addEventListener("online",this._onWindowOnline,!1),h.window.addEventListener("resize",this._onWindowResize,!1),h.window.addEventListener("orientationchange",this._onWindowResize,!1),h.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new pl(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new du("string"==typeof f.hash&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,h.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new Ga({customAttribution:f.customAttribution})),this._logoControl=new ac,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update("style"===i.dataType),this.fire(new h.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new h.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(f,i){if(void 0===i&&(i=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const m=this._controlPositions[i];return-1!==i.indexOf("bottom")?m.insertBefore(c,m.firstChild):m.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(f);return i>-1&&this._controls.splice(i,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new h.Event("movestart",f)).fire(new h.Event("move",f)),this.fire(new h.Event("resize",f)),i&&this.fire(new h.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(h.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=null==f?-2:f)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new h.Event("zoomstart")).fire(new h.Event("zoom")).fire(new h.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=null==f?22:f)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new h.Event("zoomstart")).fire(new h.Event("zoom")).fire(new h.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=null==f?0:f)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new h.Event("pitchstart")).fire(new h.Event("pitch")).fire(new h.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=null==f?85:f)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new h.Event("pitchstart")).fire(new h.Event("pitch")).fire(new h.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getProjection(){return this.transform.getProjection()}setProjection(f){return this._lazyInitEmptyStyle(),"string"==typeof f&&(f={name:f}),this._runtimeProjection=f,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(f){return this.transform.locationPoint3D(h.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(h.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(f,i,c){if("mouseenter"===f||"mouseover"===f){let m=!1;const v=T=>{const R=i.filter(j=>this.getLayer(j)),z=R.length?this.queryRenderedFeatures(T.point,{layers:R}):[];z.length?m||(m=!0,c.call(this,new zi(f,this,T.originalEvent,{features:z}))):m=!1},b=()=>{m=!1};return{layers:new Set(i),listener:c,delegates:{mousemove:v,mouseout:b}}}if("mouseleave"===f||"mouseout"===f){let m=!1;const v=T=>{const R=i.filter(z=>this.getLayer(z));(R.length?this.queryRenderedFeatures(T.point,{layers:R}):[]).length?m=!0:m&&(m=!1,c.call(this,new zi(f,this,T.originalEvent)))},b=T=>{m&&(m=!1,c.call(this,new zi(f,this,T.originalEvent)))};return{layers:new Set(i),listener:c,delegates:{mousemove:v,mouseout:b}}}{const m=v=>{const b=i.filter(R=>this.getLayer(R)),T=b.length?this.queryRenderedFeatures(v.point,{layers:b}):[];T.length&&(v.features=T,c.call(this,v),delete v.features)};return{layers:new Set(i),listener:c,delegates:{[f]:m}}}}on(f,i,c){if(void 0===c)return super.on(f,i);Array.isArray(i)||(i=[i]);const m=this._createDelegatedListener(f,i,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(m);for(const v in m.delegates)this.on(v,m.delegates[v]);return this}once(f,i,c){if(void 0===c)return super.once(f,i);Array.isArray(i)||(i=[i]);const m=this._createDelegatedListener(f,i,c);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(f,i,c){if(void 0===c)return super.off(f,i);i=new Set(Array.isArray(i)?i:[i]);const m=(b,T)=>{if(b.size!==T.size)return!1;for(const R of b)if(!T.has(R))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[f]:void 0;return v&&(b=>{for(let T=0;T<b.length;T++){const R=b[T];if(R.listener===c&&m(R.layers,i)){for(const z in R.delegates)this.off(z,R.delegates[z]);return b.splice(T,1),this}}})(v),this}queryRenderedFeatures(f,i){return this.style?(void 0!==i||void 0===f||f instanceof h.pointGeometry||Array.isArray(f)||(i=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(f,i){return this.style.querySourceFeatures(f,i)}queryTerrainElevation(f,i){const c=this.transform.elevation;return c?(i=h.extend({},{exaggerated:!0},i),c.getAtPoint(h.MercatorCoordinate.fromLngLat(f),null,i.exaggerated)):null}setStyle(f,i){return!1!==(i=h.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(f,i))}_getUIString(f){const i=this._locale[f];if(null==i)throw new Error(`Missing UI string '${f}'`);return i}_updateStyle(f,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),f&&(this.style=new Ii(this,i||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof f?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ii(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,i){if("string"==typeof f){const c=this._requestManager.normalizeStyleURL(f),m=this._requestManager.transformRequest(c,h.ResourceType.Style);h.getJSON(m,(v,b)=>{v?this.fire(new h.ErrorEvent(v)):b&&this._updateDiff(b,i)})}else"object"==typeof f&&this._updateDiff(f,i)}_updateDiff(f,i){try{this.style.setState(f)&&this._update(!0)}catch(c){h.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(f,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.warnOnce("There is no style added to the map.")}addSource(f,i){return this._lazyInitEmptyStyle(),this.style.addSource(f,i),this._update(!0)}isSourceLoaded(f){const i=this.style&&this.style._getSourceCaches(f);if(0!==i.length)return i.every(c=>c.loaded());this.fire(new h.ErrorEvent(new Error(`There is no source with ID '${f}'`)))}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const i in f){const c=f[i]._tiles;for(const m in c){const v=c[m];if("loaded"!==v.state&&"errored"!==v.state)return!1}}return!0}addSourceType(f,i,c){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,i,c)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,i,{pixelRatio:c=1,sdf:m=!1,stretchX:v,stretchY:b,content:T}={}){if(this._lazyInitEmptyStyle(),i instanceof W||we&&i instanceof we){const{width:R,height:z,data:j}=h.exported.getImageData(i);this.style.addImage(f,{data:new h.RGBAImage({width:R,height:z},j),pixelRatio:c,stretchX:v,stretchY:b,content:T,sdf:m,version:0})}else{if(void 0===i.width||void 0===i.height)return this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:R,height:z,data:j}=i,q=i;this.style.addImage(f,{data:new h.RGBAImage({width:R,height:z},new Uint8Array(j)),pixelRatio:c,stretchX:v,stretchY:b,content:T,sdf:m,version:0,userImage:q}),q.onAdd&&q.onAdd(this,f)}}}updateImage(f,i){const c=this.style.getImage(f);if(!c)return this.fire(new h.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=i instanceof W||we&&i instanceof we?h.exported.getImageData(i):i,{width:v,height:b,data:T}=m;return void 0===v||void 0===b?this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):v!==c.data.width||b!==c.data.height?this.fire(new h.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(c.data.replace(T,!(i instanceof W||we&&i instanceof we)),void this.style.updateImage(f,c))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new h.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,i){h.getImage(this._requestManager.transformRequest(f,h.ResourceType.Image),(c,m)=>{i(c,m instanceof W?h.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(f,i){return this._lazyInitEmptyStyle(),this.style.addLayer(f,i),this._update(!0)}moveLayer(f,i){return this.style.moveLayer(f,i),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,i,c){return this.style.setLayerZoomRange(f,i,c),this._update(!0)}setFilter(f,i,c={}){return this.style.setFilter(f,i,c),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,i,c,m={}){return this.style.setPaintProperty(f,i,c,m),this._update(!0)}getPaintProperty(f,i){return this.style.getPaintProperty(f,i)}setLayoutProperty(f,i,c,m={}){return this.style.setLayoutProperty(f,i,c,m),this._update(!0)}getLayoutProperty(f,i){return this.style.getLayoutProperty(f,i)}setLight(f,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){"globe"===this.transform.projection.name&&this.transform.zoom>=h.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(h.LngLat.convert(f),this.transform):0}setFeatureState(f,i){return this.style.setFeatureState(f,i),this._update()}removeFeatureState(f,i){return this.style.removeFeatureState(f,i),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let c,m=this._container;for(;m&&!c;){const v=h.window.getComputedStyle(m).transform;v&&"none"!==v&&(c=v.match(/matrix.*\((.+)\)/)[1].split(", ")),m=m.parentElement}c?(this._containerWidth=c[0]&&"0"!==c[0]?Math.abs(f/c[0]):f,this._containerHeight=c[3]&&"0"!==c[3]?Math.abs(i/c[3]):i):(this._containerWidth=f,this._containerHeight=i)}_detectMissingCSS(){"rgb(250, 128, 114)"!==h.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&h.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=ge.create("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=ge.create("div","mapboxgl-canvas-container",f);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=ge.create("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=ge.create("div","mapboxgl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{m[v]=ge.create("div",`mapboxgl-ctrl-${v}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,i){const c=h.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(i),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${i}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const i=this._markers.indexOf(f);-1!==i&&this._markers.splice(i,1)}_setupPainter(){const f=h.extend({},Qe.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);i?(h.storeAuthState(i,!0),this.painter=new ws(i,this.transform),this.on("data",c=>{"source"===c.dataType&&this.painter.setTileLoadedFlag(!0)}),h.exported$1.testSupport(i)):this.fire(new h.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new h.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new h.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let i;const c=this.painter.context.extTimerQuery,m=h.exported.now();this.listens("gpu-timing-frame")&&(i=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,i));let v=this._updateAverageElevation(m);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjection();let b=!1;const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,j=this.transform.pitch,q=h.exported.now();this.style.zoomHistory.update(z,q);const Q=new h.EvaluationParameters(z,{now:q,fadeDuration:T,pitch:j,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),se=Q.crossFadingFactor();1===se&&se===this._crossFadingFactor||(b=!0,this._crossFadingFactor=se),this.style.update(Q)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new h.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new h.Event("load"))),this.style&&(this.style.hasTransitions()||b)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const z=h.exported.now()-m;c.endQueryEXT(c.TIME_ELAPSED_EXT,i),setTimeout(()=>{const j=c.getQueryObjectEXT(i,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(i),this.fire(new h.Event("gpu-timing-frame",{cpuTime:z,gpuTime:j}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const j=this.painter.queryGpuTimers(z);this.fire(new h.Event("gpu-timing-layer",{layerTimes:j}))},50)}const R=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(R||this._repaint)this.triggerRepaint();else{const z=!this.isMoving()&&this.loaded();if(z&&(v=this._updateAverageElevation(m,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new h.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const j=this._calculateSpeedIndex();this.fire(new h.Event("speedindexcompleted",{speedIndex:j})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const f of this._markers)f._update()}_updateAverageElevation(f,i=!1){const c=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);if((i||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const m=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();isNaN(v)?v=0:this._averageElevationLastSampledAt=f;const b=Math.abs(m-v);if(b>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(v),c(v);this._averageElevation.easeTo(v,f,300)}else if(b>1e-4)return this._averageElevation.jumpTo(v),c(v)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){h.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===h.AUTH_ERR_MSG||401===f.status)){const i=this.painter.context.gl;h.storeAuthState(i,!1),this._logoControl instanceof ac&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new h.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),h.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const c=this.painter.context.gl,m=c.createFramebuffer();function v(b){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,b,0);const T=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,T),T}return c.bindFramebuffer(c.FRAMEBUFFER,m),this._canvasPixelComparison(v(f),i.canvasCopies.map(v),i.timeStamps)}_canvasPixelComparison(f,i,c){let m=c[1]-c[0];const v=f.length/4;for(let b=0;b<i.length;b++){const T=i[b];let R=0;for(let z=0;z<T.length;z+=4)T[z]===f[z]&&T[z+1]===f[z+1]&&T[z+2]===f[z+2]&&T[z+3]===f[z+3]&&(R+=1);m+=(c[b+2]-c[b+1])*(1-R/v)}return m}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==h.window&&(h.window.removeEventListener("resize",this._onWindowResize,!1),h.window.removeEventListener("orientationchange",this._onWindowResize,!1),h.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),h.window.removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),ft(this._canvasContainer),ft(this._controlContainer),ft(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),h.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new h.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=h.exported.frame(i=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(i)}))}_preloadTiles(f){const i=this.style&&Object.values(this.style._sourceCaches)||[];return h.asyncAll(i,(c,m)=>c._preloadTiles(f,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,i){h.setCacheLimits(f,i)}get version(){return h.version}},NavigationControl:class{constructor(f){this.options=h.extend({},en,f),this._container=ge.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(h.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),ge.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),ge.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(h.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=ge.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const f=this._map.getZoom(),i=f===this._map.getMaxZoom(),c=f===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const f=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=f)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Rr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,i){const c=ge.create("button",f,this._container);return c.type="button",c.addEventListener("click",i),c}_setButtonTitle(f,i){const c=this._map._getUIString(`NavigationControl.${i}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends h.Evented{constructor(f){super(),this.options=h.extend({},wn,f),h.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Hr(this._updateMarkerRotation,20)}onAdd(f){var i;return this._map=f,this._container=ge.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,void 0!==rr?i(rr):void 0!==h.window.navigator.permissions?h.window.navigator.permissions.query({name:"geolocation"}).then(c=>{rr="denied"!==c.state,i(rr)}):(rr=!!h.window.navigator.geolocation,i(rr)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(h.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,gr=0,gs=!1}_isOutOfMapMaxBounds(f){const i=this._map.getMaxBounds(),c=f.coords;return i&&(c.longitude<i.getWest()||c.longitude>i.getEast()||c.latitude<i.getSouth()||c.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new h.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new h.Event("geolocate",f)),this._finish()}}_updateCamera(f){const i=new h.LngLat(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,m=this._map.getBearing(),v=h.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(c),v,{geolocateSource:!0})}_updateMarker(f){if(f){const i=new h.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map._containerHeight/2,i=this._map.unproject([0,f]),c=this._map.unproject([100,f]),m=i.distanceTo(c)/100,v=Math.ceil(2*this._accuracy/m);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&gs)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new h.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=ge.create("button","mapboxgl-ctrl-geolocate",this._container),ge.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===f){h.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ge.create("div","mapboxgl-user-location"),this._dotElement.appendChild(ge.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ge.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new M({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ge.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new M({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||"ACTIVE_LOCK"!==this._watchState||i.originalEvent&&"resize"===i.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new h.Event("trackuserlocationend")))})}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:!0===f.absolute&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return h.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":gr--,gs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new h.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),gr++,gr>1?(f={maximumAge:6e5,timeout:0},gs=!0):(f=this.options.positionOptions,gs=!1),this._geolocationWatchID=h.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else h.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{h.window.addEventListener("ondeviceorientationabsolute"in h.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==h.window.DeviceMotionEvent&&"function"==typeof h.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(i=>{"granted"===i&&f()}).catch(console.error):f()}_clearWatch(){h.window.navigator.geolocation.clearWatch(this._geolocationWatchID),h.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),h.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ga,ScaleControl:class{constructor(f){this.options=h.extend({},kr,f),h.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Ht(this._map,this._container,this.options)}onAdd(f){return this._map=f,this._container=ge.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(f){this.options.unit=f,Ht(this._map,this._container,this.options)}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof h.window.HTMLElement?this._container=f.container:h.warnOnce("Full screen control 'container' must be a DOM element.")),h.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in h.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in h.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=ge.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",h.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,h.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!h.window.document.fullscreenEnabled&&!h.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=ge.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ge.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),h.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(h.window.document.fullscreenElement||h.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?h.window.document.exitFullscreen?h.window.document.exitFullscreen():h.window.document.webkitCancelFullScreen&&h.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends h.Evented{constructor(f){super(),this.options=h.extend(Object.create(pa),f),h.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new h.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new h.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=h.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(h.window.document.createTextNode(f))}setHTML(f){const i=h.window.document.createDocumentFragment(),c=h.window.document.createElement("body");let m;for(c.innerHTML=f;m=c.firstChild,m;)i.appendChild(m);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ge.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._container&&this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._container&&this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let i;return this._classList.delete(f)?i=!1:(this._classList.add(f),i=!0),this._container&&this._updateClassList(),i}_createCloseButton(){this.options.closeButton&&(this._closeButton=ge.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(f){this._update(f.point)}_onMouseMove(f){this._update(f.point)}_onDrag(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const i=this._pos,c=this._container.offsetWidth,m=this._container.offsetHeight;let v;return v=i.y+f.bottom.y<m?["top"]:i.y>this._map.transform.height-m?["bottom"]:[],i.x<c/2?v.push("left"):i.x>this._map.transform.width-c/2&&v.push("right"),0===v.length?"bottom":v.join("-")}_updateClassList(){const f=[...this._classList];f.push("mapboxgl-popup"),this._anchor&&f.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&f.push("mapboxgl-popup-track-pointer"),this._container.className=f.join(" ")}_update(f){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=ge.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=ge.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=zc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f){const i=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),c=function(b){if(b||(b=new h.pointGeometry(0,0)),"number"==typeof b){const T=Math.round(Math.sqrt(.5*Math.pow(b,2)));return{center:new h.pointGeometry(0,0),top:new h.pointGeometry(0,b),"top-left":new h.pointGeometry(T,T),"top-right":new h.pointGeometry(-T,T),bottom:new h.pointGeometry(0,-b),"bottom-left":new h.pointGeometry(T,-T),"bottom-right":new h.pointGeometry(-T,-T),left:new h.pointGeometry(b,0),right:new h.pointGeometry(-b,0)}}if(b instanceof h.pointGeometry||Array.isArray(b)){const T=h.pointGeometry.convert(b);return{center:T,top:T,"top-left":T,"top-right":T,bottom:T,"bottom-left":T,"bottom-right":T,left:T,right:T}}return{center:h.pointGeometry.convert(b.center||[0,0]),top:h.pointGeometry.convert(b.top||[0,0]),"top-left":h.pointGeometry.convert(b["top-left"]||[0,0]),"top-right":h.pointGeometry.convert(b["top-right"]||[0,0]),bottom:h.pointGeometry.convert(b.bottom||[0,0]),"bottom-left":h.pointGeometry.convert(b["bottom-left"]||[0,0]),"bottom-right":h.pointGeometry.convert(b["bottom-right"]||[0,0]),left:h.pointGeometry.convert(b.left||[0,0]),right:h.pointGeometry.convert(b.right||[0,0])}}(this.options.offset),m=this._anchor=this._getAnchor(c),v=i.add(c[m]).round();this._map._requestDomTask(()=>{this._container&&m&&(this._container.style.transform=`${L[m]} translate(${v.x}px,${v.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(zs);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._content&&(this._content.style.opacity=f),this._tip&&(this._tip.style.opacity=f)}},Marker:M,Style:Ii,LngLat:h.LngLat,LngLatBounds:h.LngLatBounds,Point:h.pointGeometry,MercatorCoordinate:h.MercatorCoordinate,FreeCameraOptions:Pc,Evented:h.Evented,config:h.config,prewarm:function(){Oe().acquire(Ie)},clearPrewarmedResources:function(){const f=je;f&&(f.isPreloaded()&&1===f.numActive()?(f.release(Ie),je=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return h.config.ACCESS_TOKEN},set accessToken(f){h.config.ACCESS_TOKEN=f},get baseApiUrl(){return h.config.API_URL},set baseApiUrl(f){h.config.API_URL=f},get workerCount(){return Be.workerCount},set workerCount(f){Be.workerCount=f},get maxParallelImageRequests(){return h.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){h.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){h.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:h.exported.setNow,restoreNow:h.exported.restoreNow};return fa}),$}()},7574:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{y:()=>Ye});var $=xe(7393),Rt=xe(9181),h=xe(6490),nt=xe(6554),ze=xe(4487);var ge=xe(2494);let Ye=(()=>{class Ct{constructor(Vt){this._isScalar=!1,Vt&&(this._subscribe=Vt)}lift(Vt){const ut=new Ct;return ut.source=this,ut.operator=Vt,ut}subscribe(Vt,ut,qt){const{operator:Dn}=this,cn=function(Ct,_t,Vt){if(Ct){if(Ct instanceof $.L)return Ct;if(Ct[Rt.b])return Ct[Rt.b]()}return Ct||_t||Vt?new $.L(Ct,_t,Vt):new $.L(h.c)}(Vt,ut,qt);if(cn.add(Dn?Dn.call(cn,this.source):this.source||ge.v.useDeprecatedSynchronousErrorHandling&&!cn.syncErrorThrowable?this._subscribe(cn):this._trySubscribe(cn)),ge.v.useDeprecatedSynchronousErrorHandling&&cn.syncErrorThrowable&&(cn.syncErrorThrowable=!1,cn.syncErrorThrown))throw cn.syncErrorValue;return cn}_trySubscribe(Vt){try{return this._subscribe(Vt)}catch(ut){ge.v.useDeprecatedSynchronousErrorHandling&&(Vt.syncErrorThrown=!0,Vt.syncErrorValue=ut),function(Ct){for(;Ct;){const{closed:_t,destination:Vt,isStopped:ut}=Ct;if(_t||ut)return!1;Ct=Vt&&Vt instanceof $.L?Vt:null}return!0}(Vt)?Vt.error(ut):console.warn(ut)}}forEach(Vt,ut){return new(ut=Xe(ut))((qt,Dn)=>{let cn;cn=this.subscribe(jt=>{try{Vt(jt)}catch(vr){Dn(vr),cn&&cn.unsubscribe()}},Dn,qt)})}_subscribe(Vt){const{source:ut}=this;return ut&&ut.subscribe(Vt)}[nt.L](){return this}pipe(...Vt){return 0===Vt.length?this:function(Ct){return 0===Ct.length?ze.y:1===Ct.length?Ct[0]:function(Vt){return Ct.reduce((ut,qt)=>qt(ut),Vt)}}(Vt)(this)}toPromise(Vt){return new(Vt=Xe(Vt))((ut,qt)=>{let Dn;this.subscribe(cn=>Dn=cn,cn=>qt(cn),()=>ut(Dn))})}}return Ct.create=_t=>new Ct(_t),Ct})();function Xe(Ct){if(Ct||(Ct=ge.v.Promise||Promise),!Ct)throw new Error("no Promise impl found");return Ct}},6490:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{c:()=>Rt});var $=xe(2494),y=xe(4449);const Rt={closed:!0,next(h){},error(h){if($.v.useDeprecatedSynchronousErrorHandling)throw h;(0,y.z)(h)},complete(){}}},9765:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{Yc:()=>ze,xQ:()=>Me});var $=xe(7574),y=xe(7393),Rt=xe(5319),h=xe(7971),Qe=xe(8858),nt=xe(9181);class ze extends y.L{constructor(Ye){super(Ye),this.destination=Ye}}let Me=(()=>{class ge extends $.y{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[nt.b](){return new ze(this)}lift(Xe){const Ct=new qe(this,this);return Ct.operator=Xe,Ct}next(Xe){if(this.closed)throw new h.N;if(!this.isStopped){const{observers:Ct}=this,_t=Ct.length,Vt=Ct.slice();for(let ut=0;ut<_t;ut++)Vt[ut].next(Xe)}}error(Xe){if(this.closed)throw new h.N;this.hasError=!0,this.thrownError=Xe,this.isStopped=!0;const{observers:Ct}=this,_t=Ct.length,Vt=Ct.slice();for(let ut=0;ut<_t;ut++)Vt[ut].error(Xe);this.observers.length=0}complete(){if(this.closed)throw new h.N;this.isStopped=!0;const{observers:Xe}=this,Ct=Xe.length,_t=Xe.slice();for(let Vt=0;Vt<Ct;Vt++)_t[Vt].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(Xe){if(this.closed)throw new h.N;return super._trySubscribe(Xe)}_subscribe(Xe){if(this.closed)throw new h.N;return this.hasError?(Xe.error(this.thrownError),Rt.w.EMPTY):this.isStopped?(Xe.complete(),Rt.w.EMPTY):(this.observers.push(Xe),new Qe.W(this,Xe))}asObservable(){const Xe=new $.y;return Xe.source=this,Xe}}return ge.create=(Ye,Xe)=>new qe(Ye,Xe),ge})();class qe extends Me{constructor(Ye,Xe){super(),this.destination=Ye,this.source=Xe}next(Ye){const{destination:Xe}=this;Xe&&Xe.next&&Xe.next(Ye)}error(Ye){const{destination:Xe}=this;Xe&&Xe.error&&this.destination.error(Ye)}complete(){const{destination:Ye}=this;Ye&&Ye.complete&&this.destination.complete()}_subscribe(Ye){const{source:Xe}=this;return Xe?this.source.subscribe(Ye):Rt.w.EMPTY}}},8858:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{W:()=>y});var $=xe(5319);class y extends $.w{constructor(h,Qe){super(),this.subject=h,this.subscriber=Qe,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const h=this.subject,Qe=h.observers;if(this.subject=null,!Qe||0===Qe.length||h.isStopped||h.closed)return;const nt=Qe.indexOf(this.subscriber);-1!==nt&&Qe.splice(nt,1)}}},7393:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{L:()=>ze});var $=xe(9105),y=xe(6490),Rt=xe(5319),h=xe(9181),Qe=xe(2494),nt=xe(4449);class ze extends Rt.w{constructor(ge,Ye,Xe){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=y.c;break;case 1:if(!ge){this.destination=y.c;break}if("object"==typeof ge){ge instanceof ze?(this.syncErrorThrowable=ge.syncErrorThrowable,this.destination=ge,ge.add(this)):(this.syncErrorThrowable=!0,this.destination=new Me(this,ge));break}default:this.syncErrorThrowable=!0,this.destination=new Me(this,ge,Ye,Xe)}}[h.b](){return this}static create(ge,Ye,Xe){const Ct=new ze(ge,Ye,Xe);return Ct.syncErrorThrowable=!1,Ct}next(ge){this.isStopped||this._next(ge)}error(ge){this.isStopped||(this.isStopped=!0,this._error(ge))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(ge){this.destination.next(ge)}_error(ge){this.destination.error(ge),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:ge}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=ge,this}}class Me extends ze{constructor(ge,Ye,Xe,Ct){super(),this._parentSubscriber=ge;let _t,Vt=this;(0,$.m)(Ye)?_t=Ye:Ye&&(_t=Ye.next,Xe=Ye.error,Ct=Ye.complete,Ye!==y.c&&(Vt=Object.create(Ye),(0,$.m)(Vt.unsubscribe)&&this.add(Vt.unsubscribe.bind(Vt)),Vt.unsubscribe=this.unsubscribe.bind(this))),this._context=Vt,this._next=_t,this._error=Xe,this._complete=Ct}next(ge){if(!this.isStopped&&this._next){const{_parentSubscriber:Ye}=this;Qe.v.useDeprecatedSynchronousErrorHandling&&Ye.syncErrorThrowable?this.__tryOrSetError(Ye,this._next,ge)&&this.unsubscribe():this.__tryOrUnsub(this._next,ge)}}error(ge){if(!this.isStopped){const{_parentSubscriber:Ye}=this,{useDeprecatedSynchronousErrorHandling:Xe}=Qe.v;if(this._error)Xe&&Ye.syncErrorThrowable?(this.__tryOrSetError(Ye,this._error,ge),this.unsubscribe()):(this.__tryOrUnsub(this._error,ge),this.unsubscribe());else if(Ye.syncErrorThrowable)Xe?(Ye.syncErrorValue=ge,Ye.syncErrorThrown=!0):(0,nt.z)(ge),this.unsubscribe();else{if(this.unsubscribe(),Xe)throw ge;(0,nt.z)(ge)}}}complete(){if(!this.isStopped){const{_parentSubscriber:ge}=this;if(this._complete){const Ye=()=>this._complete.call(this._context);Qe.v.useDeprecatedSynchronousErrorHandling&&ge.syncErrorThrowable?(this.__tryOrSetError(ge,Ye),this.unsubscribe()):(this.__tryOrUnsub(Ye),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(ge,Ye){try{ge.call(this._context,Ye)}catch(Xe){if(this.unsubscribe(),Qe.v.useDeprecatedSynchronousErrorHandling)throw Xe;(0,nt.z)(Xe)}}__tryOrSetError(ge,Ye,Xe){if(!Qe.v.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{Ye.call(this._context,Xe)}catch(Ct){return Qe.v.useDeprecatedSynchronousErrorHandling?(ge.syncErrorValue=Ct,ge.syncErrorThrown=!0,!0):((0,nt.z)(Ct),!0)}return!1}_unsubscribe(){const{_parentSubscriber:ge}=this;this._context=null,this._parentSubscriber=null,ge.unsubscribe()}}},5319:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{w:()=>nt});var $=xe(9796),y=xe(1555),Rt=xe(9105);const Qe=(()=>{function Me(qe){return Error.call(this),this.message=qe?`${qe.length} errors occurred during unsubscription:\n${qe.map((ge,Ye)=>`${Ye+1}) ${ge.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=qe,this}return Me.prototype=Object.create(Error.prototype),Me})();class nt{constructor(qe){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,qe&&(this._ctorUnsubscribe=!0,this._unsubscribe=qe)}unsubscribe(){let qe;if(this.closed)return;let{_parentOrParents:ge,_ctorUnsubscribe:Ye,_unsubscribe:Xe,_subscriptions:Ct}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,ge instanceof nt)ge.remove(this);else if(null!==ge)for(let _t=0;_t<ge.length;++_t)ge[_t].remove(this);if((0,Rt.m)(Xe)){Ye&&(this._unsubscribe=void 0);try{Xe.call(this)}catch(_t){qe=_t instanceof Qe?ze(_t.errors):[_t]}}if((0,$.k)(Ct)){let _t=-1,Vt=Ct.length;for(;++_t<Vt;){const ut=Ct[_t];if((0,y.K)(ut))try{ut.unsubscribe()}catch(qt){qe=qe||[],qt instanceof Qe?qe=qe.concat(ze(qt.errors)):qe.push(qt)}}}if(qe)throw new Qe(qe)}add(qe){let ge=qe;if(!qe)return nt.EMPTY;switch(typeof qe){case"function":ge=new nt(qe);case"object":if(ge===this||ge.closed||"function"!=typeof ge.unsubscribe)return ge;if(this.closed)return ge.unsubscribe(),ge;if(!(ge instanceof nt)){const Ct=ge;ge=new nt,ge._subscriptions=[Ct]}break;default:throw new Error("unrecognized teardown "+qe+" added to Subscription.")}let{_parentOrParents:Ye}=ge;if(null===Ye)ge._parentOrParents=this;else if(Ye instanceof nt){if(Ye===this)return ge;ge._parentOrParents=[Ye,this]}else{if(-1!==Ye.indexOf(this))return ge;Ye.push(this)}const Xe=this._subscriptions;return null===Xe?this._subscriptions=[ge]:Xe.push(ge),ge}remove(qe){const ge=this._subscriptions;if(ge){const Ye=ge.indexOf(qe);-1!==Ye&&ge.splice(Ye,1)}}}var Me;function ze(Me){return Me.reduce((qe,ge)=>qe.concat(ge instanceof Qe?ge.errors:ge),[])}nt.EMPTY=((Me=new nt).closed=!0,Me)},2494:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{v:()=>y});let $=!1;const y={Promise:void 0,set useDeprecatedSynchronousErrorHandling(Rt){if(Rt){const h=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+h.stack)}else $&&console.log("RxJS: Back to a better error behavior. Thank you. <3");$=Rt},get useDeprecatedSynchronousErrorHandling(){return $}}},5345:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{IY:()=>h,Ds:()=>nt,ft:()=>Me});var $=xe(7393),y=xe(7574),Rt=xe(7444);class h extends $.L{constructor(ge){super(),this.parent=ge}_next(ge){this.parent.notifyNext(ge)}_error(ge){this.parent.notifyError(ge),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class nt extends $.L{notifyNext(ge){this.destination.next(ge)}notifyError(ge){this.destination.error(ge)}notifyComplete(){this.destination.complete()}}function Me(qe,ge){if(ge.closed)return;if(qe instanceof y.y)return qe.subscribe(ge);let Ye;try{Ye=(0,Rt.s)(qe)(ge)}catch(Xe){ge.error(Xe)}return Ye}},2441:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{c:()=>Qe,N:()=>nt});var $=xe(9765),y=xe(7574),Rt=xe(5319),h=xe(1307);class Qe extends y.y{constructor(Ye,Xe){super(),this.source=Ye,this.subjectFactory=Xe,this._refCount=0,this._isComplete=!1}_subscribe(Ye){return this.getSubject().subscribe(Ye)}getSubject(){const Ye=this._subject;return(!Ye||Ye.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let Ye=this._connection;return Ye||(this._isComplete=!1,Ye=this._connection=new Rt.w,Ye.add(this.source.subscribe(new ze(this.getSubject(),this))),Ye.closed&&(this._connection=null,Ye=Rt.w.EMPTY)),Ye}refCount(){return(0,h.x)()(this)}}const nt=(()=>{const ge=Qe.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:ge._subscribe},_isComplete:{value:ge._isComplete,writable:!0},getSubject:{value:ge.getSubject},connect:{value:ge.connect},refCount:{value:ge.refCount}}})();class ze extends $.Yc{constructor(Ye,Xe){super(Ye),this.connectable=Xe}_error(Ye){this._unsubscribe(),super._error(Ye)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const Ye=this.connectable;if(Ye){this.connectable=null;const Xe=Ye._connection;Ye._refCount=0,Ye._subject=null,Ye._connection=null,Xe&&Xe.unsubscribe()}}}},8071:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{z:()=>h});var $=xe(5917),y=xe(3282);function h(...Qe){return(0,y.J)(1)((0,$.of)(...Qe))}},1439:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{P:()=>h});var $=xe(7574),y=xe(4402),Rt=xe(9193);function h(Qe){return new $.y(nt=>{let ze;try{ze=Qe()}catch(qe){return void nt.error(qe)}return(ze?(0,y.D)(ze):(0,Rt.c)()).subscribe(nt)})}},9193:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{E:()=>y,c:()=>Rt});var $=xe(7574);const y=new $.y(Qe=>Qe.complete());function Rt(Qe){return Qe?function(Qe){return new $.y(nt=>Qe.schedule(()=>nt.complete()))}(Qe):y}},5758:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{D:()=>nt});var $=xe(7574),y=xe(9796),Rt=xe(8002),h=xe(1555),Qe=xe(4402);function nt(...Me){if(1===Me.length){const qe=Me[0];if((0,y.k)(qe))return ze(qe,null);if((0,h.K)(qe)&&Object.getPrototypeOf(qe)===Object.prototype){const ge=Object.keys(qe);return ze(ge.map(Ye=>qe[Ye]),ge)}}if("function"==typeof Me[Me.length-1]){const qe=Me.pop();return ze(Me=1===Me.length&&(0,y.k)(Me[0])?Me[0]:Me,null).pipe((0,Rt.U)(ge=>qe(...ge)))}return ze(Me,null)}function ze(Me,qe){return new $.y(ge=>{const Ye=Me.length;if(0===Ye)return void ge.complete();const Xe=new Array(Ye);let Ct=0,_t=0;for(let Vt=0;Vt<Ye;Vt++){const ut=(0,Qe.D)(Me[Vt]);let qt=!1;ge.add(ut.subscribe({next:Dn=>{qt||(qt=!0,_t++),Xe[Vt]=Dn},error:Dn=>ge.error(Dn),complete:()=>{Ct++,(Ct===Ye||!qt)&&(_t===Ye&&ge.next(qe?qe.reduce((Dn,cn,jt)=>(Dn[cn]=Xe[jt],Dn),{}):Xe),ge.complete())}}))}})}},4402:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{D:()=>Vt});var $=xe(7574),y=xe(7444),Rt=xe(5319),h=xe(6554),ze=xe(4087),Me=xe(377),Ye=xe(4072),Xe=xe(9489);function Vt(ut,qt){return qt?function(ut,qt){if(null!=ut){if(function(ut){return ut&&"function"==typeof ut[h.L]}(ut))return function(ut,qt){return new $.y(Dn=>{const cn=new Rt.w;return cn.add(qt.schedule(()=>{const jt=ut[h.L]();cn.add(jt.subscribe({next(vr){cn.add(qt.schedule(()=>Dn.next(vr)))},error(vr){cn.add(qt.schedule(()=>Dn.error(vr)))},complete(){cn.add(qt.schedule(()=>Dn.complete()))}}))})),cn})}(ut,qt);if((0,Ye.t)(ut))return function(ut,qt){return new $.y(Dn=>{const cn=new Rt.w;return cn.add(qt.schedule(()=>ut.then(jt=>{cn.add(qt.schedule(()=>{Dn.next(jt),cn.add(qt.schedule(()=>Dn.complete()))}))},jt=>{cn.add(qt.schedule(()=>Dn.error(jt)))}))),cn})}(ut,qt);if((0,Xe.z)(ut))return(0,ze.r)(ut,qt);if(function(ut){return ut&&"function"==typeof ut[Me.hZ]}(ut)||"string"==typeof ut)return function(ut,qt){if(!ut)throw new Error("Iterable cannot be null");return new $.y(Dn=>{const cn=new Rt.w;let jt;return cn.add(()=>{jt&&"function"==typeof jt.return&&jt.return()}),cn.add(qt.schedule(()=>{jt=ut[Me.hZ](),cn.add(qt.schedule(function(){if(Dn.closed)return;let vr,hn;try{const Kr=jt.next();vr=Kr.value,hn=Kr.done}catch(Kr){return void Dn.error(Kr)}hn?Dn.complete():(Dn.next(vr),this.schedule())}))})),cn})}(ut,qt)}throw new TypeError((null!==ut&&typeof ut||ut)+" is not observable")}(ut,qt):ut instanceof $.y?ut:new $.y((0,y.s)(ut))}},6693:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{n:()=>h});var $=xe(7574),y=xe(5015),Rt=xe(4087);function h(Qe,nt){return nt?(0,Rt.r)(Qe,nt):new $.y((0,y.V)(Qe))}},5917:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{of:()=>h});var $=xe(4869),y=xe(6693),Rt=xe(4087);function h(...Qe){let nt=Qe[Qe.length-1];return(0,$.K)(nt)?(Qe.pop(),(0,Rt.r)(Qe,nt)):(0,y.n)(Qe)}},1460:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{H:()=>qe});var $=xe(7574),y=xe(6465);const Qe=new(xe(6102).v)(y.o);var nt=xe(9796);function ze(Ye){return!(0,nt.k)(Ye)&&Ye-parseFloat(Ye)+1>=0}var Me=xe(4869);function qe(Ye=0,Xe,Ct){let _t=-1;return ze(Xe)?_t=Number(Xe)<1?1:Number(Xe):(0,Me.K)(Xe)&&(Ct=Xe),(0,Me.K)(Ct)||(Ct=Qe),new $.y(Vt=>{const ut=ze(Ye)?Ye:+Ye-Ct.now();return Ct.schedule(ge,ut,{index:0,period:_t,subscriber:Vt})})}function ge(Ye){const{index:Xe,period:Ct,subscriber:_t}=Ye;if(_t.next(Xe),!_t.closed){if(-1===Ct)return _t.complete();Ye.index=Xe+1,this.schedule(Ye,Ct)}}},4612:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{b:()=>y});var $=xe(9773);function y(Rt,h){return(0,$.zg)(Rt,h,1)}},5435:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{h:()=>y});var $=xe(7393);function y(Qe,nt){return function(Me){return Me.lift(new Rt(Qe,nt))}}class Rt{constructor(nt,ze){this.predicate=nt,this.thisArg=ze}call(nt,ze){return ze.subscribe(new h(nt,this.predicate,this.thisArg))}}class h extends $.L{constructor(nt,ze,Me){super(nt),this.predicate=ze,this.thisArg=Me,this.count=0}_next(nt){let ze;try{ze=this.predicate.call(this.thisArg,nt,this.count++)}catch(Me){return void this.destination.error(Me)}ze&&this.destination.next(nt)}}},8002:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{U:()=>y});var $=xe(7393);function y(Qe,nt){return function(Me){if("function"!=typeof Qe)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return Me.lift(new Rt(Qe,nt))}}class Rt{constructor(nt,ze){this.project=nt,this.thisArg=ze}call(nt,ze){return ze.subscribe(new h(nt,this.project,this.thisArg))}}class h extends $.L{constructor(nt,ze,Me){super(nt),this.project=ze,this.count=0,this.thisArg=Me||this}_next(nt){let ze;try{ze=this.project.call(this.thisArg,nt,this.count++)}catch(Me){return void this.destination.error(Me)}this.destination.next(ze)}}},3282:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{J:()=>Rt});var $=xe(9773),y=xe(4487);function Rt(h=Number.POSITIVE_INFINITY){return(0,$.zg)(y.y,h)}},9773:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{zg:()=>h});var $=xe(8002),y=xe(4402),Rt=xe(5345);function h(Me,qe,ge=Number.POSITIVE_INFINITY){return"function"==typeof qe?Ye=>Ye.pipe(h((Xe,Ct)=>(0,y.D)(Me(Xe,Ct)).pipe((0,$.U)((_t,Vt)=>qe(Xe,_t,Ct,Vt))),ge)):("number"==typeof qe&&(ge=qe),Ye=>Ye.lift(new Qe(Me,ge)))}class Qe{constructor(qe,ge=Number.POSITIVE_INFINITY){this.project=qe,this.concurrent=ge}call(qe,ge){return ge.subscribe(new nt(qe,this.project,this.concurrent))}}class nt extends Rt.Ds{constructor(qe,ge,Ye=Number.POSITIVE_INFINITY){super(qe),this.project=ge,this.concurrent=Ye,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(qe){this.active<this.concurrent?this._tryNext(qe):this.buffer.push(qe)}_tryNext(qe){let ge;const Ye=this.index++;try{ge=this.project(qe,Ye)}catch(Xe){return void this.destination.error(Xe)}this.active++,this._innerSub(ge)}_innerSub(qe){const ge=new Rt.IY(this),Ye=this.destination;Ye.add(ge);const Xe=(0,Rt.ft)(qe,ge);Xe!==ge&&Ye.add(Xe)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(qe){this.destination.next(qe)}notifyComplete(){const qe=this.buffer;this.active--,qe.length>0?this._next(qe.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}},1307:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{x:()=>y});var $=xe(7393);function y(){return function(nt){return nt.lift(new Rt(nt))}}class Rt{constructor(nt){this.connectable=nt}call(nt,ze){const{connectable:Me}=this;Me._refCount++;const qe=new h(nt,Me),ge=ze.subscribe(qe);return qe.closed||(qe.connection=Me.connect()),ge}}class h extends $.L{constructor(nt,ze){super(nt),this.connectable=ze}_unsubscribe(){const{connectable:nt}=this;if(!nt)return void(this.connection=null);this.connectable=null;const ze=nt._refCount;if(ze<=0)return void(this.connection=null);if(nt._refCount=ze-1,ze>1)return void(this.connection=null);const{connection:Me}=this,qe=nt._connection;this.connection=null,qe&&(!Me||qe===Me)&&qe.unsubscribe()}}},3190:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{w:()=>h});var $=xe(8002),y=xe(4402),Rt=xe(5345);function h(ze,Me){return"function"==typeof Me?qe=>qe.pipe(h((ge,Ye)=>(0,y.D)(ze(ge,Ye)).pipe((0,$.U)((Xe,Ct)=>Me(ge,Xe,Ye,Ct))))):qe=>qe.lift(new Qe(ze))}class Qe{constructor(Me){this.project=Me}call(Me,qe){return qe.subscribe(new nt(Me,this.project))}}class nt extends Rt.Ds{constructor(Me,qe){super(Me),this.project=qe,this.index=0}_next(Me){let qe;const ge=this.index++;try{qe=this.project(Me,ge)}catch(Ye){return void this.destination.error(Ye)}this._innerSub(qe)}_innerSub(Me){const qe=this.innerSubscription;qe&&qe.unsubscribe();const ge=new Rt.IY(this),Ye=this.destination;Ye.add(ge),this.innerSubscription=(0,Rt.ft)(Me,ge),this.innerSubscription!==ge&&Ye.add(this.innerSubscription)}_complete(){const{innerSubscription:Me}=this;(!Me||Me.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(Me){this.destination.next(Me)}}},5257:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{q:()=>h});var $=xe(7393),y=xe(7108),Rt=xe(9193);function h(ze){return Me=>0===ze?(0,Rt.c)():Me.lift(new Qe(ze))}class Qe{constructor(Me){if(this.total=Me,this.total<0)throw new y.W}call(Me,qe){return qe.subscribe(new nt(Me,this.total))}}class nt extends $.L{constructor(Me,qe){super(Me),this.total=qe,this.count=0}_next(Me){const qe=this.total,ge=++this.count;ge<=qe&&(this.destination.next(Me),ge===qe&&(this.destination.complete(),this.unsubscribe()))}}},4087:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{r:()=>Rt});var $=xe(7574),y=xe(5319);function Rt(h,Qe){return new $.y(nt=>{const ze=new y.w;let Me=0;return ze.add(Qe.schedule(function(){Me!==h.length?(nt.next(h[Me++]),nt.closed||ze.add(this.schedule())):nt.complete()})),ze})}},6465:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{o:()=>Rt});var $=xe(5319);class y extends $.w{constructor(Qe,nt){super()}schedule(Qe,nt=0){return this}}class Rt extends y{constructor(Qe,nt){super(Qe,nt),this.scheduler=Qe,this.work=nt,this.pending=!1}schedule(Qe,nt=0){if(this.closed)return this;this.state=Qe;const ze=this.id,Me=this.scheduler;return null!=ze&&(this.id=this.recycleAsyncId(Me,ze,nt)),this.pending=!0,this.delay=nt,this.id=this.id||this.requestAsyncId(Me,this.id,nt),this}requestAsyncId(Qe,nt,ze=0){return setInterval(Qe.flush.bind(Qe,this),ze)}recycleAsyncId(Qe,nt,ze=0){if(null!==ze&&this.delay===ze&&!1===this.pending)return nt;clearInterval(nt)}execute(Qe,nt){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const ze=this._execute(Qe,nt);if(ze)return ze;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(Qe,nt){let Me,ze=!1;try{this.work(Qe)}catch(qe){ze=!0,Me=!!qe&&qe||new Error(qe)}if(ze)return this.unsubscribe(),Me}_unsubscribe(){const Qe=this.id,nt=this.scheduler,ze=nt.actions,Me=ze.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==Me&&ze.splice(Me,1),null!=Qe&&(this.id=this.recycleAsyncId(nt,Qe,null)),this.delay=null}}},6102:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{v:()=>y});let $=(()=>{class Rt{constructor(Qe,nt=Rt.now){this.SchedulerAction=Qe,this.now=nt}schedule(Qe,nt=0,ze){return new this.SchedulerAction(this,Qe).schedule(ze,nt)}}return Rt.now=()=>Date.now(),Rt})();class y extends ${constructor(h,Qe=$.now){super(h,()=>y.delegate&&y.delegate!==this?y.delegate.now():Qe()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(h,Qe=0,nt){return y.delegate&&y.delegate!==this?y.delegate.schedule(h,Qe,nt):super.schedule(h,Qe,nt)}flush(h){const{actions:Qe}=this;if(this.active)return void Qe.push(h);let nt;this.active=!0;do{if(nt=h.execute(h.state,h.delay))break}while(h=Qe.shift());if(this.active=!1,nt){for(;h=Qe.shift();)h.unsubscribe();throw nt}}}},377:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{hZ:()=>y});const y="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"},6554:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{L:()=>$});const $="function"==typeof Symbol&&Symbol.observable||"@@observable"},9181:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{b:()=>$});const $="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()},7108:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{W:()=>y});const y=(()=>{function Rt(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return Rt.prototype=Object.create(Error.prototype),Rt})()},7971:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{N:()=>y});const y=(()=>{function Rt(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return Rt.prototype=Object.create(Error.prototype),Rt})()},4449:(Cn,Dt,xe)=>{"use strict";function $(y){setTimeout(()=>{throw y},0)}xe.d(Dt,{z:()=>$})},4487:(Cn,Dt,xe)=>{"use strict";function $(y){return y}xe.d(Dt,{y:()=>$})},9796:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{k:()=>$});const $=Array.isArray||(y=>y&&"number"==typeof y.length)},9489:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{z:()=>$});const $=y=>y&&"number"==typeof y.length&&"function"!=typeof y},9105:(Cn,Dt,xe)=>{"use strict";function $(y){return"function"==typeof y}xe.d(Dt,{m:()=>$})},1555:(Cn,Dt,xe)=>{"use strict";function $(y){return null!==y&&"object"==typeof y}xe.d(Dt,{K:()=>$})},4072:(Cn,Dt,xe)=>{"use strict";function $(y){return!!y&&"function"!=typeof y.subscribe&&"function"==typeof y.then}xe.d(Dt,{t:()=>$})},4869:(Cn,Dt,xe)=>{"use strict";function $(y){return y&&"function"==typeof y.schedule}xe.d(Dt,{K:()=>$})},7444:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{s:()=>Ye});var $=xe(5015),y=xe(4449),h=xe(377),nt=xe(6554),Me=xe(9489),qe=xe(4072),ge=xe(1555);const Ye=Xe=>{if(Xe&&"function"==typeof Xe[nt.L])return(Xe=>Ct=>{const _t=Xe[nt.L]();if("function"!=typeof _t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return _t.subscribe(Ct)})(Xe);if((0,Me.z)(Xe))return(0,$.V)(Xe);if((0,qe.t)(Xe))return(Xe=>Ct=>(Xe.then(_t=>{Ct.closed||(Ct.next(_t),Ct.complete())},_t=>Ct.error(_t)).then(null,y.z),Ct))(Xe);if(Xe&&"function"==typeof Xe[h.hZ])return(Xe=>Ct=>{const _t=Xe[h.hZ]();for(;;){let Vt;try{Vt=_t.next()}catch(ut){return Ct.error(ut),Ct}if(Vt.done){Ct.complete();break}if(Ct.next(Vt.value),Ct.closed)break}return"function"==typeof _t.return&&Ct.add(()=>{_t.return&&_t.return()}),Ct})(Xe);{const _t=`You provided ${(0,ge.K)(Xe)?"an invalid object":`'${Xe}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(_t)}}},5015:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{V:()=>$});const $=y=>Rt=>{for(let h=0,Qe=y.length;h<Qe&&!Rt.closed;h++)Rt.next(y[h]);Rt.complete()}},501:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{G:()=>h});var $=xe(2340),y=xe(639),Rt=xe(1841);let h=(()=>{class Qe{constructor(ze){this.http=ze,this.apiURLCategories=$.N.apiURL+"categories",this.apiURLMogatas=$.N.apiURL+"mogatas"}getCategories(){return this.http.get(this.apiURLCategories)}getSingleCategory(ze){return this.http.get(`${this.apiURLCategories}/${ze}`)}createCategory(ze){return this.http.post(this.apiURLCategories,ze)}updateCategory(ze,Me){return this.http.put(`${this.apiURLCategories}/${Me}`,ze)}deleteCategory(ze){return this.http.delete(`${this.apiURLCategories}/${ze}`)}getMogatas(){return this.http.get(this.apiURLMogatas)}getSingleMogata(ze){return this.http.get(`${this.apiURLMogatas}/${ze}`)}createMogata(ze){return this.http.post(this.apiURLMogatas,ze)}updateMogata(ze,Me){return this.http.put(`${this.apiURLMogatas}/${Me}`,ze)}deleteMogata(ze){return this.http.delete(`${this.apiURLMogatas}/${ze}`)}}return Qe.\u0275fac=function(ze){return new(ze||Qe)(y.LFG(Rt.eN))},Qe.\u0275prov=y.Yz7({token:Qe,factory:Qe.\u0275fac,providedIn:"root"}),Qe})()},9467:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{_:()=>h});var $=xe(2340),y=xe(639),Rt=xe(1841);let h=(()=>{class Qe{constructor(ze){this.http=ze,this.apiURLWilayas=$.N.apiURL+"wilayas"}updateWilays(ze,Me){return this.http.put(`${this.apiURLWilayas}/${Me}`,ze)}getSingleWilaya(ze){return this.http.get(`${this.apiURLWilayas}/${ze}`)}getWilayas(){return this.http.get(this.apiURLWilayas)}createWilaya(ze){return this.http.post(this.apiURLWilayas,ze)}deleteWilaya(ze){return this.http.delete(`${this.apiURLWilayas}/${ze}`)}}return Qe.\u0275fac=function(ze){return new(ze||Qe)(y.LFG(Rt.eN))},Qe.\u0275prov=y.Yz7({token:Qe,factory:Qe.\u0275fac,providedIn:"root"}),Qe})()},1647:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{C:()=>h});var $=xe(1841),y=xe(2340),Rt=xe(639);let h=(()=>{class Qe{constructor(ze){this.http=ze,this.apiURLProperties=y.N.apiURL+"properties"}getProperties(ze,Me,qe,ge,Ye=!1){let Xe=new $.LE;return ze&&ze!==[]&&(Xe=Xe.append("categories",ze.join(","))),Me&&Me!==[]&&(Xe=Xe.append("mogatas",Me.join(","))),qe&&""!==qe[0]&&(Xe=Xe.append("price",qe.join(","))),this.http.get(Ye?`${this.apiURLProperties}/rent`:this.apiURLProperties,{params:Xe})}getByMogata(ze){let Me=new $.LE;return Me=Me.append("mogatas",ze.join(",")),this.http.get(this.apiURLProperties,{params:Me})}getByPrice(ze){let Me=new $.LE;return Me=Me.append("price",ze),this.http.get(this.apiURLProperties,{params:Me})}getByWilaya(ze){let Me=new $.LE;return ze?(Me=Me.append("wilaya",ze.join(",")),this.http.get(this.apiURLProperties,{params:Me})):this.http.get(this.apiURLProperties)}getSingleProperty(ze){return this.http.get(`${this.apiURLProperties}/${ze}`)}getUserProperty(ze){return this.http.get(`${this.apiURLProperties}/users/${ze}`)}getPropertyByName(ze){return this.http.get(`${this.apiURLProperties}/name/${ze}`)}createProperty(ze){return this.http.post(this.apiURLProperties,ze)}createUserProperty(ze){return this.http.post(`${this.apiURLProperties}/users`,ze)}getFeaturedProperties(ze){return this.http.get(`${this.apiURLProperties}/get/featured/${ze}`)}updateProperty(ze,Me){return this.http.put(`${this.apiURLProperties}/${Me}`,ze)}deleteProperty(ze){return this.http.delete(`${this.apiURLProperties}/${ze}`)}deleteUserProperty(ze){return this.http.delete(`${this.apiURLProperties}/users/${ze}`)}uploadPropertyImages(ze,Me){return this.http.put(`${this.apiURLProperties}/gallery-image/${Me}`,ze)}getUserProperties(){return this.http.get(`${this.apiURLProperties}/users`)}validate(ze){return this.http.post(`${this.apiURLProperties}/validate/${ze}`,{})}}return Qe.\u0275fac=function(ze){return new(ze||Qe)(Rt.LFG($.eN))},Qe.\u0275prov=Rt.Yz7({token:Qe,factory:Qe.\u0275fac,providedIn:"root"}),Qe})()},2340:(Cn,Dt,xe)=>{"use strict";xe.d(Dt,{N:()=>$});const $={production:!0,mapbox:{accessToken:"pk.eyJ1IjoibXZoYWRlbiIsImEiOiJja3poZDB0enQxOXR0MnVueWhyZ3JwcTBtIn0.REqPaUAimBK3TB2P9dSqNw"},googleMap:{apiKey:"AIzaSyAp-au0nM_esKXU4E89iY1JmaeX43tCpS0"},apiURL:"https://rimcode-samsar.herokuapp.com/api/v1/"}},5383:(Cn,Dt,xe)=>{"use strict";var $=xe(8583),y=xe(639);class Rt extends $.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class h extends Rt{static makeCurrent(){(0,$.HT)(new h)}onAndCancel(te,F,ee){return te.addEventListener(F,ee,!1),()=>{te.removeEventListener(F,ee,!1)}}dispatchEvent(te,F){te.dispatchEvent(F)}remove(te){te.parentNode&&te.parentNode.removeChild(te)}createElement(te,F){return(F=F||this.getDefaultDocument()).createElement(te)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(te){return te.nodeType===Node.ELEMENT_NODE}isShadowRoot(te){return te instanceof DocumentFragment}getGlobalEventTarget(te,F){return"window"===F?window:"document"===F?te:"body"===F?te.body:null}getBaseHref(te){const F=(Qe=Qe||document.querySelector("base"),Qe?Qe.getAttribute("href"):null);return null==F?null:function(Y){ze=ze||document.createElement("a"),ze.setAttribute("href",Y);const te=ze.pathname;return"/"===te.charAt(0)?te:`/${te}`}(F)}resetBaseElement(){Qe=null}getUserAgent(){return window.navigator.userAgent}getCookie(te){return(0,$.Mx)(document.cookie,te)}}let ze,Qe=null;const qe=new y.OlP("TRANSITION_ID"),Ye=[{provide:y.ip1,useFactory:function(Y,te,F){return()=>{F.get(y.CZH).donePromise.then(()=>{const ee=(0,$.q)(),Te=te.querySelectorAll(`style[ng-transition="${Y}"]`);for(let it=0;it<Te.length;it++)ee.remove(Te[it])})}},deps:[qe,$.K0,y.zs3],multi:!0}];class Xe{static init(){(0,y.VLi)(new Xe)}addToWindow(te){y.dqk.getAngularTestability=(ee,Te=!0)=>{const it=te.findTestabilityInTree(ee,Te);if(null==it)throw new Error("Could not find testability for element.");return it},y.dqk.getAllAngularTestabilities=()=>te.getAllTestabilities(),y.dqk.getAllAngularRootElements=()=>te.getAllRootElements(),y.dqk.frameworkStabilizers||(y.dqk.frameworkStabilizers=[]),y.dqk.frameworkStabilizers.push(ee=>{const Te=y.dqk.getAllAngularTestabilities();let it=Te.length,Et=!1;const jn=function(Pr){Et=Et||Pr,it--,0==it&&ee(Et)};Te.forEach(function(Pr){Pr.whenStable(jn)})})}findTestabilityInTree(te,F,ee){if(null==F)return null;const Te=te.getTestability(F);return null!=Te?Te:ee?(0,$.q)().isShadowRoot(F)?this.findTestabilityInTree(te,F.host,!0):this.findTestabilityInTree(te,F.parentElement,!0):null}}let Ct=(()=>{class Y{build(){return new XMLHttpRequest}}return Y.\u0275fac=function(F){return new(F||Y)},Y.\u0275prov=y.Yz7({token:Y,factory:Y.\u0275fac}),Y})();const In=new y.OlP("EventManagerPlugins");let dn=(()=>{class Y{constructor(F,ee){this._zone=ee,this._eventNameToPlugin=new Map,F.forEach(Te=>Te.manager=this),this._plugins=F.slice().reverse()}addEventListener(F,ee,Te){return this._findPluginFor(ee).addEventListener(F,ee,Te)}addGlobalEventListener(F,ee,Te){return this._findPluginFor(ee).addGlobalEventListener(F,ee,Te)}getZone(){return this._zone}_findPluginFor(F){const ee=this._eventNameToPlugin.get(F);if(ee)return ee;const Te=this._plugins;for(let it=0;it<Te.length;it++){const Et=Te[it];if(Et.supports(F))return this._eventNameToPlugin.set(F,Et),Et}throw new Error(`No event manager plugin found for event ${F}`)}}return Y.\u0275fac=function(F){return new(F||Y)(y.LFG(In),y.LFG(y.R0b))},Y.\u0275prov=y.Yz7({token:Y,factory:Y.\u0275fac}),Y})();class Un{constructor(te){this._doc=te}addGlobalEventListener(te,F,ee){const Te=(0,$.q)().getGlobalEventTarget(this._doc,te);if(!Te)throw new Error(`Unsupported event target ${Te} for event ${F}`);return this.addEventListener(Te,F,ee)}}let $t=(()=>{class Y{constructor(){this._stylesSet=new Set}addStyles(F){const ee=new Set;F.forEach(Te=>{this._stylesSet.has(Te)||(this._stylesSet.add(Te),ee.add(Te))}),this.onStylesAdded(ee)}onStylesAdded(F){}getAllStyles(){return Array.from(this._stylesSet)}}return Y.\u0275fac=function(F){return new(F||Y)},Y.\u0275prov=y.Yz7({token:Y,factory:Y.\u0275fac}),Y})(),lo=(()=>{class Y extends $t{constructor(F){super(),this._doc=F,this._hostNodes=new Map,this._hostNodes.set(F.head,[])}_addStylesToHost(F,ee,Te){F.forEach(it=>{const Et=this._doc.createElement("style");Et.textContent=it,Te.push(ee.appendChild(Et))})}addHost(F){const ee=[];this._addStylesToHost(this._stylesSet,F,ee),this._hostNodes.set(F,ee)}removeHost(F){const ee=this._hostNodes.get(F);ee&&ee.forEach(Ln),this._hostNodes.delete(F)}onStylesAdded(F){this._hostNodes.forEach((ee,Te)=>{this._addStylesToHost(F,Te,ee)})}ngOnDestroy(){this._hostNodes.forEach(F=>F.forEach(Ln))}}return Y.\u0275fac=function(F){return new(F||Y)(y.LFG($.K0))},Y.\u0275prov=y.Yz7({token:Y,factory:Y.\u0275fac}),Y})();function Ln(Y){(0,$.q)().remove(Y)}const Ki={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},hi=/%COMP%/g;function ji(Y,te,F){for(let ee=0;ee<te.length;ee++){let Te=te[ee];Array.isArray(Te)?ji(Y,Te,F):(Te=Te.replace(hi,Y),F.push(Te))}return F}function Jr(Y){return te=>{if("__ngUnwrap__"===te)return Y;!1===Y(te)&&(te.preventDefault(),te.returnValue=!1)}}let Xn=(()=>{class Y{constructor(F,ee,Te){this.eventManager=F,this.sharedStylesHost=ee,this.appId=Te,this.rendererByCompId=new Map,this.defaultRenderer=new An(F)}createRenderer(F,ee){if(!F||!ee)return this.defaultRenderer;switch(ee.encapsulation){case y.ifc.Emulated:{let Te=this.rendererByCompId.get(ee.id);return Te||(Te=new Ji(this.eventManager,this.sharedStylesHost,ee,this.appId),this.rendererByCompId.set(ee.id,Te)),Te.applyToHost(F),Te}case 1:case y.ifc.ShadowDom:return new Uo(this.eventManager,this.sharedStylesHost,F,ee);default:if(!this.rendererByCompId.has(ee.id)){const Te=ji(ee.id,ee.styles,[]);this.sharedStylesHost.addStyles(Te),this.rendererByCompId.set(ee.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return Y.\u0275fac=function(F){return new(F||Y)(y.LFG(dn),y.LFG(lo),y.LFG(y.AFp))},Y.\u0275prov=y.Yz7({token:Y,factory:Y.\u0275fac}),Y})();class An{constructor(te){this.eventManager=te,this.data=Object.create(null)}destroy(){}createElement(te,F){return F?document.createElementNS(Ki[F]||F,te):document.createElement(te)}createComment(te){return document.createComment(te)}createText(te){return document.createTextNode(te)}appendChild(te,F){te.appendChild(F)}insertBefore(te,F,ee){te&&te.insertBefore(F,ee)}removeChild(te,F){te&&te.removeChild(F)}selectRootElement(te,F){let ee="string"==typeof te?document.querySelector(te):te;if(!ee)throw new Error(`The selector "${te}" did not match any elements`);return F||(ee.textContent=""),ee}parentNode(te){return te.parentNode}nextSibling(te){return te.nextSibling}setAttribute(te,F,ee,Te){if(Te){F=Te+":"+F;const it=Ki[Te];it?te.setAttributeNS(it,F,ee):te.setAttribute(F,ee)}else te.setAttribute(F,ee)}removeAttribute(te,F,ee){if(ee){const Te=Ki[ee];Te?te.removeAttributeNS(Te,F):te.removeAttribute(`${ee}:${F}`)}else te.removeAttribute(F)}addClass(te,F){te.classList.add(F)}removeClass(te,F){te.classList.remove(F)}setStyle(te,F,ee,Te){Te&(y.JOm.DashCase|y.JOm.Important)?te.style.setProperty(F,ee,Te&y.JOm.Important?"important":""):te.style[F]=ee}removeStyle(te,F,ee){ee&y.JOm.DashCase?te.style.removeProperty(F):te.style[F]=""}setProperty(te,F,ee){te[F]=ee}setValue(te,F){te.nodeValue=F}listen(te,F,ee){return"string"==typeof te?this.eventManager.addGlobalEventListener(te,F,Jr(ee)):this.eventManager.addEventListener(te,F,Jr(ee))}}class Ji extends An{constructor(te,F,ee,Te){super(te),this.component=ee;const it=ji(Te+"-"+ee.id,ee.styles,[]);F.addStyles(it),this.contentAttr="_ngcontent-%COMP%".replace(hi,Te+"-"+ee.id),this.hostAttr="_nghost-%COMP%".replace(hi,Te+"-"+ee.id)}applyToHost(te){super.setAttribute(te,this.hostAttr,"")}createElement(te,F){const ee=super.createElement(te,F);return super.setAttribute(ee,this.contentAttr,""),ee}}class Uo extends An{constructor(te,F,ee,Te){super(te),this.sharedStylesHost=F,this.hostEl=ee,this.shadowRoot=ee.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const it=ji(Te.id,Te.styles,[]);for(let Et=0;Et<it.length;Et++){const jn=document.createElement("style");jn.textContent=it[Et],this.shadowRoot.appendChild(jn)}}nodeOrShadowRoot(te){return te===this.hostEl?this.shadowRoot:te}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(te,F){return super.appendChild(this.nodeOrShadowRoot(te),F)}insertBefore(te,F,ee){return super.insertBefore(this.nodeOrShadowRoot(te),F,ee)}removeChild(te,F){return super.removeChild(this.nodeOrShadowRoot(te),F)}parentNode(te){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(te)))}}let pn=(()=>{class Y extends Un{constructor(F){super(F)}supports(F){return!0}addEventListener(F,ee,Te){return F.addEventListener(ee,Te,!1),()=>this.removeEventListener(F,ee,Te)}removeEventListener(F,ee,Te){return F.removeEventListener(ee,Te)}}return Y.\u0275fac=function(F){return new(F||Y)(y.LFG($.K0))},Y.\u0275prov=y.Yz7({token:Y,factory:Y.\u0275fac}),Y})();const Zt=["alt","control","meta","shift"],Xt={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},_n={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},On={alt:Y=>Y.altKey,control:Y=>Y.ctrlKey,meta:Y=>Y.metaKey,shift:Y=>Y.shiftKey};let rn=(()=>{class Y extends Un{constructor(F){super(F)}supports(F){return null!=Y.parseEventName(F)}addEventListener(F,ee,Te){const it=Y.parseEventName(ee),Et=Y.eventCallback(it.fullKey,Te,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,$.q)().onAndCancel(F,it.domEventName,Et))}static parseEventName(F){const ee=F.toLowerCase().split("."),Te=ee.shift();if(0===ee.length||"keydown"!==Te&&"keyup"!==Te)return null;const it=Y._normalizeKey(ee.pop());let Et="";if(Zt.forEach(Pr=>{const qi=ee.indexOf(Pr);qi>-1&&(ee.splice(qi,1),Et+=Pr+".")}),Et+=it,0!=ee.length||0===it.length)return null;const jn={};return jn.domEventName=Te,jn.fullKey=Et,jn}static getEventFullKey(F){let ee="",Te=function(Y){let te=Y.key;if(null==te){if(te=Y.keyIdentifier,null==te)return"Unidentified";te.startsWith("U+")&&(te=String.fromCharCode(parseInt(te.substring(2),16)),3===Y.location&&_n.hasOwnProperty(te)&&(te=_n[te]))}return Xt[te]||te}(F);return Te=Te.toLowerCase()," "===Te?Te="space":"."===Te&&(Te="dot"),Zt.forEach(it=>{it!=Te&&On[it](F)&&(ee+=it+".")}),ee+=Te,ee}static eventCallback(F,ee,Te){return it=>{Y.getEventFullKey(it)===F&&Te.runGuarded(()=>ee(it))}}static _normalizeKey(F){switch(F){case"esc":return"escape";default:return F}}}return Y.\u0275fac=function(F){return new(F||Y)(y.LFG($.K0))},Y.\u0275prov=y.Yz7({token:Y,factory:Y.\u0275fac}),Y})();const pe=(0,y.eFA)(y._c5,"browser",[{provide:y.Lbi,useValue:$.bD},{provide:y.g9A,useValue:function(){h.makeCurrent(),Xe.init()},multi:!0},{provide:$.K0,useFactory:function(){return(0,y.RDi)(document),document},deps:[]}]),ve=[[],{provide:y.zSh,useValue:"root"},{provide:y.qLn,useFactory:function(){return new y.qLn},deps:[]},{provide:In,useClass:pn,multi:!0,deps:[$.K0,y.R0b,y.Lbi]},{provide:In,useClass:rn,multi:!0,deps:[$.K0]},[],{provide:Xn,useClass:Xn,deps:[dn,lo,y.AFp]},{provide:y.FYo,useExisting:Xn},{provide:$t,useExisting:lo},{provide:lo,useClass:lo,deps:[$.K0]},{provide:y.dDg,useClass:y.dDg,deps:[y.R0b]},{provide:dn,useClass:dn,deps:[In,y.R0b]},{provide:$.JF,useClass:Ct,deps:[]},[]];let Ie=(()=>{class Y{constructor(F){if(F)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(F){return{ngModule:Y,providers:[{provide:y.AFp,useValue:F.appId},{provide:qe,useExisting:y.AFp},Ye]}}}return Y.\u0275fac=function(F){return new(F||Y)(y.LFG(Y,12))},Y.\u0275mod=y.oAB({type:Y}),Y.\u0275inj=y.cJS({providers:ve,imports:[$.ez,y.hGG]}),Y})();"undefined"!=typeof window&&window;var un=xe(1460),oi=xe(5917),Zr=xe(7574);function si(Y){return!!Y&&(Y instanceof Zr.y||"function"==typeof Y.lift&&"function"==typeof Y.subscribe)}var Gr=xe(5758),Eo=xe(8071),to=xe(1439),bn=xe(5257),pi=xe(9765),Li=xe(6465),Lo=xe(6102);const Mi=new class extends Lo.v{}(class extends Li.o{constructor(te,F){super(te,F),this.scheduler=te,this.work=F}schedule(te,F=0){return F>0?super.schedule(te,F):(this.delay=F,this.state=te,this.scheduler.flush(this),this)}execute(te,F){return F>0||this.closed?super.execute(te,F):this._execute(te,F)}requestAsyncId(te,F,ee=0){return null!==ee&&ee>0||null===ee&&this.delay>0?super.requestAsyncId(te,F,ee):te.flush(this)}});var fi=xe(5319),Ir=xe(7393),la=xe(9193);class qr{constructor(te,F,ee){this.kind=te,this.value=F,this.error=ee,this.hasValue="N"===te}observe(te){switch(this.kind){case"N":return te.next&&te.next(this.value);case"E":return te.error&&te.error(this.error);case"C":return te.complete&&te.complete()}}do(te,F,ee){switch(this.kind){case"N":return te&&te(this.value);case"E":return F&&F(this.error);case"C":return ee&&ee()}}accept(te,F,ee){return te&&"function"==typeof te.next?this.observe(te):this.do(te,F,ee)}toObservable(){switch(this.kind){case"N":return(0,oi.of)(this.value);case"E":return Y=this.error,new Zr.y(F=>F.error(Y));case"C":return(0,la.c)()}var Y;throw new Error("unexpected notification kind value")}static createNext(te){return void 0!==te?new qr("N",te):qr.undefinedValueNotification}static createError(te){return new qr("E",void 0,te)}static createComplete(){return qr.completeNotification}}qr.completeNotification=new qr("C"),qr.undefinedValueNotification=new qr("N",void 0);class dr extends Ir.L{constructor(te,F,ee=0){super(te),this.scheduler=F,this.delay=ee}static dispatch(te){const{notification:F,destination:ee}=te;F.observe(ee),this.unsubscribe()}scheduleMessage(te){this.destination.add(this.scheduler.schedule(dr.dispatch,this.delay,new Qo(te,this.destination)))}_next(te){this.scheduleMessage(qr.createNext(te))}_error(te){this.scheduleMessage(qr.createError(te)),this.unsubscribe()}_complete(){this.scheduleMessage(qr.createComplete()),this.unsubscribe()}}class Qo{constructor(te,F){this.notification=te,this.destination=F}}var nr=xe(7971),ti=xe(8858);class Gi extends pi.xQ{constructor(te=Number.POSITIVE_INFINITY,F=Number.POSITIVE_INFINITY,ee){super(),this.scheduler=ee,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=te<1?1:te,this._windowTime=F<1?1:F,F===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(te){if(!this.isStopped){const F=this._events;F.push(te),F.length>this._bufferSize&&F.shift()}super.next(te)}nextTimeWindow(te){this.isStopped||(this._events.push(new Ei(this._getNow(),te)),this._trimBufferThenGetEvents()),super.next(te)}_subscribe(te){const F=this._infiniteTimeWindow,ee=F?this._events:this._trimBufferThenGetEvents(),Te=this.scheduler,it=ee.length;let Et;if(this.closed)throw new nr.N;if(this.isStopped||this.hasError?Et=fi.w.EMPTY:(this.observers.push(te),Et=new ti.W(this,te)),Te&&te.add(te=new dr(te,Te)),F)for(let jn=0;jn<it&&!te.closed;jn++)te.next(ee[jn]);else for(let jn=0;jn<it&&!te.closed;jn++)te.next(ee[jn].value);return this.hasError?te.error(this.thrownError):this.isStopped&&te.complete(),Et}_getNow(){return(this.scheduler||Mi).now()}_trimBufferThenGetEvents(){const te=this._getNow(),F=this._bufferSize,ee=this._windowTime,Te=this._events,it=Te.length;let Et=0;for(;Et<it&&!(te-Te[Et].time<ee);)Et++;return it>F&&(Et=Math.max(Et,it-F)),Et>0&&Te.splice(0,Et),Te}}class Ei{constructor(te,F){this.time=te,this.value=F}}function Si(Y,te,F){let ee;return ee=Y&&"object"==typeof Y?Y:{bufferSize:Y,windowTime:te,refCount:!1,scheduler:F},Te=>Te.lift(function({bufferSize:Y=Number.POSITIVE_INFINITY,windowTime:te=Number.POSITIVE_INFINITY,refCount:F,scheduler:ee}){let Te,Et,it=0,jn=!1,Pr=!1;return function(ws){let Cs;it++,!Te||jn?(jn=!1,Te=new Gi(Y,te,ee),Cs=Te.subscribe(this),Et=ws.subscribe({next(zo){Te.next(zo)},error(zo){jn=!0,Te.error(zo)},complete(){Pr=!0,Et=void 0,Te.complete()}}),Pr&&(Et=void 0)):Cs=Te.subscribe(this),this.add(()=>{it--,Cs.unsubscribe(),Cs=void 0,Et&&!Pr&&F&&0===it&&(Et.unsubscribe(),Et=void 0,Te=void 0)})}}(ee))}var Bn=xe(8002),Rn=xe(4612),mi=xe(3190);class ho{}let Fn=(()=>{class Y extends ho{getTranslation(F){return(0,oi.of)({})}}return Y.\u0275fac=function(){let te;return function(ee){return(te||(te=y.n5z(Y)))(ee||Y)}}(),Y.\u0275prov=y.Yz7({token:Y,factory:Y.\u0275fac}),Y})();class Zo{}let es=(()=>{class Y{handle(F){return F.key}}return Y.\u0275fac=function(F){return new(F||Y)},Y.\u0275prov=y.Yz7({token:Y,factory:Y.\u0275fac}),Y})();function To(Y,te){if(Y===te)return!0;if(null===Y||null===te)return!1;if(Y!=Y&&te!=te)return!0;let Te,it,Et,F=typeof Y;if(F==typeof te&&"object"==F){if(!Array.isArray(Y)){if(Array.isArray(te))return!1;for(it in Et=Object.create(null),Y){if(!To(Y[it],te[it]))return!1;Et[it]=!0}for(it in te)if(!(it in Et)&&void 0!==te[it])return!1;return!0}if(!Array.isArray(te))return!1;if((Te=Y.length)==te.length){for(it=0;it<Te;it++)if(!To(Y[it],te[it]))return!1;return!0}}return!1}function ui(Y){return null!=Y}function Dr(Y){return Y&&"object"==typeof Y&&!Array.isArray(Y)}function Gs(Y,te){let F=Object.assign({},Y);return Dr(Y)&&Dr(te)&&Object.keys(te).forEach(ee=>{Dr(te[ee])?ee in Y?F[ee]=Gs(Y[ee],te[ee]):Object.assign(F,{[ee]:te[ee]}):Object.assign(F,{[ee]:te[ee]})}),F}class Ii{}let Go=(()=>{class Y extends Ii{constructor(){super(...arguments),this.templateMatcher=/{{\s?([^{}\s]*)\s?}}/g}interpolate(F,ee){let Te;return Te="string"==typeof F?this.interpolateString(F,ee):"function"==typeof F?this.interpolateFunction(F,ee):F,Te}getValue(F,ee){let Te="string"==typeof ee?ee.split("."):[ee];ee="";do{ee+=Te.shift(),!ui(F)||!ui(F[ee])||"object"!=typeof F[ee]&&Te.length?Te.length?ee+=".":F=void 0:(F=F[ee],ee="")}while(Te.length);return F}interpolateFunction(F,ee){return F(ee)}interpolateString(F,ee){return ee?F.replace(this.templateMatcher,(Te,it)=>{let Et=this.getValue(ee,it);return ui(Et)?Et:Te}):F}}return Y.\u0275fac=function(){let te;return function(ee){return(te||(te=y.n5z(Y)))(ee||Y)}}(),Y.\u0275prov=y.Yz7({token:Y,factory:Y.\u0275fac}),Y})();class Do{}let Ho=(()=>{class Y extends Do{compile(F,ee){return F}compileTranslations(F,ee){return F}}return Y.\u0275fac=function(){let te;return function(ee){return(te||(te=y.n5z(Y)))(ee||Y)}}(),Y.\u0275prov=y.Yz7({token:Y,factory:Y.\u0275fac}),Y})();class bs{constructor(){this.currentLang=this.defaultLang,this.translations={},this.langs=[],this.onTranslationChange=new y.vpe,this.onLangChange=new y.vpe,this.onDefaultLangChange=new y.vpe}}const Jn=new y.OlP("USE_STORE"),Ao=new y.OlP("USE_DEFAULT_LANG"),po=new y.OlP("DEFAULT_LANGUAGE"),mn=new y.OlP("USE_EXTEND");let Pi=(()=>{class Y{constructor(F,ee,Te,it,Et,jn=!0,Pr=!1,qi=!1,ws){this.store=F,this.currentLoader=ee,this.compiler=Te,this.parser=it,this.missingTranslationHandler=Et,this.useDefaultLang=jn,this.isolate=Pr,this.extend=qi,this.pending=!1,this._onTranslationChange=new y.vpe,this._onLangChange=new y.vpe,this._onDefaultLangChange=new y.vpe,this._langs=[],this._translations={},this._translationRequests={},ws&&this.setDefaultLang(ws)}get onTranslationChange(){return this.isolate?this._onTranslationChange:this.store.onTranslationChange}get onLangChange(){return this.isolate?this._onLangChange:this.store.onLangChange}get onDefaultLangChange(){return this.isolate?this._onDefaultLangChange:this.store.onDefaultLangChange}get defaultLang(){return this.isolate?this._defaultLang:this.store.defaultLang}set defaultLang(F){this.isolate?this._defaultLang=F:this.store.defaultLang=F}get currentLang(){return this.isolate?this._currentLang:this.store.currentLang}set currentLang(F){this.isolate?this._currentLang=F:this.store.currentLang=F}get langs(){return this.isolate?this._langs:this.store.langs}set langs(F){this.isolate?this._langs=F:this.store.langs=F}get translations(){return this.isolate?this._translations:this.store.translations}set translations(F){this.isolate?this._translations=F:this.store.translations=F}setDefaultLang(F){if(F===this.defaultLang)return;let ee=this.retrieveTranslations(F);void 0!==ee?(null==this.defaultLang&&(this.defaultLang=F),ee.pipe((0,bn.q)(1)).subscribe(Te=>{this.changeDefaultLang(F)})):this.changeDefaultLang(F)}getDefaultLang(){return this.defaultLang}use(F){if(F===this.currentLang)return(0,oi.of)(this.translations[F]);let ee=this.retrieveTranslations(F);return void 0!==ee?(this.currentLang||(this.currentLang=F),ee.pipe((0,bn.q)(1)).subscribe(Te=>{this.changeLang(F)}),ee):(this.changeLang(F),(0,oi.of)(this.translations[F]))}retrieveTranslations(F){let ee;return(void 0===this.translations[F]||this.extend)&&(this._translationRequests[F]=this._translationRequests[F]||this.getTranslation(F),ee=this._translationRequests[F]),ee}getTranslation(F){this.pending=!0;const ee=this.currentLoader.getTranslation(F).pipe(Si(1),(0,bn.q)(1));return this.loadingTranslations=ee.pipe((0,Bn.U)(Te=>this.compiler.compileTranslations(Te,F)),Si(1),(0,bn.q)(1)),this.loadingTranslations.subscribe({next:Te=>{this.translations[F]=this.extend&&this.translations[F]?Object.assign(Object.assign({},Te),this.translations[F]):Te,this.updateLangs(),this.pending=!1},error:Te=>{this.pending=!1}}),ee}setTranslation(F,ee,Te=!1){ee=this.compiler.compileTranslations(ee,F),this.translations[F]=(Te||this.extend)&&this.translations[F]?Gs(this.translations[F],ee):ee,this.updateLangs(),this.onTranslationChange.emit({lang:F,translations:this.translations[F]})}getLangs(){return this.langs}addLangs(F){F.forEach(ee=>{-1===this.langs.indexOf(ee)&&this.langs.push(ee)})}updateLangs(){this.addLangs(Object.keys(this.translations))}getParsedResult(F,ee,Te){let it;if(ee instanceof Array){let Et={},jn=!1;for(let Pr of ee)Et[Pr]=this.getParsedResult(F,Pr,Te),si(Et[Pr])&&(jn=!0);if(jn){const Pr=ee.map(qi=>si(Et[qi])?Et[qi]:(0,oi.of)(Et[qi]));return(0,Gr.D)(Pr).pipe((0,Bn.U)(qi=>{let ws={};return qi.forEach((Cs,zo)=>{ws[ee[zo]]=Cs}),ws}))}return Et}if(F&&(it=this.parser.interpolate(this.parser.getValue(F,ee),Te)),void 0===it&&null!=this.defaultLang&&this.defaultLang!==this.currentLang&&this.useDefaultLang&&(it=this.parser.interpolate(this.parser.getValue(this.translations[this.defaultLang],ee),Te)),void 0===it){let Et={key:ee,translateService:this};void 0!==Te&&(Et.interpolateParams=Te),it=this.missingTranslationHandler.handle(Et)}return void 0!==it?it:ee}get(F,ee){if(!ui(F)||!F.length)throw new Error('Parameter "key" required');if(this.pending)return this.loadingTranslations.pipe((0,Rn.b)(Te=>si(Te=this.getParsedResult(Te,F,ee))?Te:(0,oi.of)(Te)));{let Te=this.getParsedResult(this.translations[this.currentLang],F,ee);return si(Te)?Te:(0,oi.of)(Te)}}getStreamOnTranslationChange(F,ee){if(!ui(F)||!F.length)throw new Error('Parameter "key" required');return(0,Eo.z)((0,to.P)(()=>this.get(F,ee)),this.onTranslationChange.pipe((0,mi.w)(Te=>{const it=this.getParsedResult(Te.translations,F,ee);return"function"==typeof it.subscribe?it:(0,oi.of)(it)})))}stream(F,ee){if(!ui(F)||!F.length)throw new Error('Parameter "key" required');return(0,Eo.z)((0,to.P)(()=>this.get(F,ee)),this.onLangChange.pipe((0,mi.w)(Te=>{const it=this.getParsedResult(Te.translations,F,ee);return si(it)?it:(0,oi.of)(it)})))}instant(F,ee){if(!ui(F)||!F.length)throw new Error('Parameter "key" required');let Te=this.getParsedResult(this.translations[this.currentLang],F,ee);if(si(Te)){if(F instanceof Array){let it={};return F.forEach((Et,jn)=>{it[F[jn]]=F[jn]}),it}return F}return Te}set(F,ee,Te=this.currentLang){this.translations[Te][F]=this.compiler.compile(ee,Te),this.updateLangs(),this.onTranslationChange.emit({lang:Te,translations:this.translations[Te]})}changeLang(F){this.currentLang=F,this.onLangChange.emit({lang:F,translations:this.translations[F]}),null==this.defaultLang&&this.changeDefaultLang(F)}changeDefaultLang(F){this.defaultLang=F,this.onDefaultLangChange.emit({lang:F,translations:this.translations[F]})}reloadLang(F){return this.resetLang(F),this.getTranslation(F)}resetLang(F){this._translationRequests[F]=void 0,this.translations[F]=void 0}getBrowserLang(){if("undefined"==typeof window||void 0===window.navigator)return;let F=window.navigator.languages?window.navigator.languages[0]:null;return F=F||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,void 0!==F?(-1!==F.indexOf("-")&&(F=F.split("-")[0]),-1!==F.indexOf("_")&&(F=F.split("_")[0]),F):void 0}getBrowserCultureLang(){if("undefined"==typeof window||void 0===window.navigator)return;let F=window.navigator.languages?window.navigator.languages[0]:null;return F=F||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,F}}return Y.\u0275fac=function(F){return new(F||Y)(y.LFG(bs),y.LFG(ho),y.LFG(Do),y.LFG(Ii),y.LFG(Zo),y.LFG(Ao),y.LFG(Jn),y.LFG(mn),y.LFG(po))},Y.\u0275prov=y.Yz7({token:Y,factory:Y.\u0275fac}),Y})(),fo=(()=>{class Y{constructor(F,ee){this.translate=F,this._ref=ee,this.value="",this.lastKey=null,this.lastParams=[]}updateValue(F,ee,Te){let it=Et=>{this.value=void 0!==Et?Et:F,this.lastKey=F,this._ref.markForCheck()};if(Te){let Et=this.translate.getParsedResult(Te,F,ee);si(Et.subscribe)?Et.subscribe(it):it(Et)}this.translate.get(F,ee).subscribe(it)}transform(F,...ee){if(!F||!F.length)return F;if(To(F,this.lastKey)&&To(ee,this.lastParams))return this.value;let Te;if(ui(ee[0])&&ee.length)if("string"==typeof ee[0]&&ee[0].length){let it=ee[0].replace(/(\')?([a-zA-Z0-9_]+)(\')?(\s)?:/g,'"$2":').replace(/:(\s)?(\')(.*?)(\')/g,':"$3"');try{Te=JSON.parse(it)}catch(Et){throw new SyntaxError(`Wrong parameter in TranslatePipe. Expected a valid Object, received: ${ee[0]}`)}}else"object"==typeof ee[0]&&!Array.isArray(ee[0])&&(Te=ee[0]);return this.lastKey=F,this.lastParams=ee,this.updateValue(F,Te),this._dispose(),this.onTranslationChange||(this.onTranslationChange=this.translate.onTranslationChange.subscribe(it=>{this.lastKey&&it.lang===this.translate.currentLang&&(this.lastKey=null,this.updateValue(F,Te,it.translations))})),this.onLangChange||(this.onLangChange=this.translate.onLangChange.subscribe(it=>{this.lastKey&&(this.lastKey=null,this.updateValue(F,Te,it.translations))})),this.onDefaultLangChange||(this.onDefaultLangChange=this.translate.onDefaultLangChange.subscribe(()=>{this.lastKey&&(this.lastKey=null,this.updateValue(F,Te))})),this.value}_dispose(){void 0!==this.onTranslationChange&&(this.onTranslationChange.unsubscribe(),this.onTranslationChange=void 0),void 0!==this.onLangChange&&(this.onLangChange.unsubscribe(),this.onLangChange=void 0),void 0!==this.onDefaultLangChange&&(this.onDefaultLangChange.unsubscribe(),this.onDefaultLangChange=void 0)}ngOnDestroy(){this._dispose()}}return Y.\u0275fac=function(F){return new(F||Y)(y.Y36(Pi,16),y.Y36(y.sBO,16))},Y.\u0275pipe=y.Yjl({name:"translate",type:Y,pure:!1}),Y.\u0275prov=y.Yz7({token:Y,factory:Y.\u0275fac}),Y})(),Ar=(()=>{class Y{static forRoot(F={}){return{ngModule:Y,providers:[F.loader||{provide:ho,useClass:Fn},F.compiler||{provide:Do,useClass:Ho},F.parser||{provide:Ii,useClass:Go},F.missingTranslationHandler||{provide:Zo,useClass:es},bs,{provide:Jn,useValue:F.isolate},{provide:Ao,useValue:F.useDefaultLang},{provide:mn,useValue:F.extend},{provide:po,useValue:F.defaultLanguage},Pi]}}static forChild(F={}){return{ngModule:Y,providers:[F.loader||{provide:ho,useClass:Fn},F.compiler||{provide:Do,useClass:Ho},F.parser||{provide:Ii,useClass:Go},F.missingTranslationHandler||{provide:Zo,useClass:es},{provide:Jn,useValue:F.isolate},{provide:Ao,useValue:F.useDefaultLang},{provide:mn,useValue:F.extend},{provide:po,useValue:F.defaultLanguage},Pi]}}}return Y.\u0275fac=function(F){return new(F||Y)},Y.\u0275mod=y.oAB({type:Y}),Y.\u0275inj=y.cJS({}),Y})();var Wr=xe(8217);let qo=(()=>{class Y{constructor(){}ngOnInit(){}}return Y.\u0275fac=function(F){return new(F||Y)},Y.\u0275cmp=y.Xpm({type:Y,selectors:[["app-nav"]],decls:29,vars:15,consts:[[1,"navbar","navbar-expand-lg","navbar-light","shadow-sm","fixed-top","bg-light"],[1,"container-fluid","mx-lg-5"],["routerLink","/",1,"navbar-brand","d-flex","align-items-center"],["src","assets/img/logo.png","alt","logo","width","36"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarHeader","aria-controls","navbarHeader","aria-expanded","false","aria-label","\u062a\u0628\u062f\u064a\u0644 \u0627\u0644\u062a\u0646\u0642\u0644",1,"navbar-toggler"],[1,"navbar-toggler-icon"],[1,"container","transition-custom"],["id","navbarHeader",1,"collapse","navbar-collapse","bg-light","light","mt-sm-2"],[1,"navbar-nav","me-auto","mb-2","mb-lg-0","d-flex","align-items-center","bg-light"],[1,"nav-item"],["routerLink","/home",1,"nav-link","home","text-dark"],["routerLink","/properties/sell",1,"nav-link","home","text-dark"],["routerLink","/properties/rent",1,"nav-link","home","text-dark"],["routerLink","/add",1,"nav-link","home","text-dark"],["routerLink","/contact",1,"nav-link","home","text-dark"]],template:function(F,ee){1&F&&(y.TgZ(0,"div",0),y.TgZ(1,"div",1),y.TgZ(2,"a",2),y._UZ(3,"img",3),y.qZA(),y.TgZ(4,"button",4),y._UZ(5,"span",5),y.qZA(),y.qZA(),y.TgZ(6,"div",6),y.TgZ(7,"div",7),y.TgZ(8,"ul",8),y.TgZ(9,"li",9),y.TgZ(10,"a",10),y._uU(11),y.ALo(12,"translate"),y.qZA(),y.qZA(),y.TgZ(13,"li",9),y.TgZ(14,"a",11),y._uU(15),y.ALo(16,"translate"),y.qZA(),y.qZA(),y.TgZ(17,"li",9),y.TgZ(18,"a",12),y._uU(19),y.ALo(20,"translate"),y.qZA(),y.qZA(),y.TgZ(21,"li",9),y.TgZ(22,"a",13),y._uU(23),y.ALo(24,"translate"),y.qZA(),y.qZA(),y.TgZ(25,"li",9),y.TgZ(26,"a",14),y._uU(27),y.ALo(28,"translate"),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.qZA()),2&F&&(y.xp6(11),y.hij(" ",y.lcZ(12,5,"NAV.HOME")," "),y.xp6(4),y.hij(" ",y.lcZ(16,7,"NAV.SELL")," "),y.xp6(4),y.hij(" ",y.lcZ(20,9,"NAV.RENT")," "),y.xp6(4),y.hij(" ",y.lcZ(24,11,"NAV.ADD")," "),y.xp6(4),y.hij(" ",y.lcZ(28,13,"NAV.CONTACT")," "))},directives:[Wr.yS],pipes:[fo],styles:[""]}),Y})(),gi=(()=>{class Y{constructor(){}ngOnInit(){}}return Y.\u0275fac=function(F){return new(F||Y)},Y.\u0275cmp=y.Xpm({type:Y,selectors:[["app-footer"]],decls:63,vars:30,consts:[[1,"container"],[1,"row"],[1,"col-lg-6","h-100","text-center","text-lg-start","my-auto","bg-white"],[1,"list-inline","mb-2"],[1,"list-inline-item"],["routerLink","/",1,"text-dark"],["routerLink","/properties/sell",1,"text-dark"],["routerLink","/properties/rent",1,"text-dark"],["routerLink","contact",1,"text-dark"],[1,"col-lg-6","h-100","text-center","text-lg-end","my-auto"],[1,"list-inline","mb-0"],[1,"list-inline-item","mx-2"],["href","https://www/facebook/com"],[1,"bi-facebook","fs-3","custom-icon"],["href","https://www.facebook.com"],[1,"bi-instagram","fs-3","custom-icon"],[1,"row","text-dark"],[1,"col-lg-4","h-100","text-center","my-auto"],["src","assets/img/logo.png","alt","samsar logo"],[1,"col-lg-4","h-100","text-center","text-lg-start","my-auto","text-dark"],[1,"col-lg-4","h-100","text-center","text-lg-start","my-auto"],[1,"list-inline-item","me-4"],[1,"bi-geo-alt","fs-3","custom-icon"],[1,"list-item","me-4"],[1,"bi-telephone","fs-3","custom-icon"],[1,"list-item"],[1,"bi","bi-envelope-plus","fs-3","custom-icon"]],template:function(F,ee){1&F&&(y.TgZ(0,"div",0),y.TgZ(1,"div",1),y.TgZ(2,"div",2),y.TgZ(3,"ul",3),y.TgZ(4,"li",4),y.TgZ(5,"a",5),y._uU(6),y.ALo(7,"translate"),y.qZA(),y.qZA(),y.TgZ(8,"li",4),y._uU(9,"\u22c5"),y.qZA(),y.TgZ(10,"li",4),y.TgZ(11,"a",6),y._uU(12),y.ALo(13,"translate"),y.qZA(),y.qZA(),y.TgZ(14,"li",4),y._uU(15,"\u22c5"),y.qZA(),y.TgZ(16,"li",4),y.TgZ(17,"a",7),y._uU(18),y.ALo(19,"translate"),y.qZA(),y.qZA(),y.TgZ(20,"li",4),y._uU(21,"\u22c5"),y.qZA(),y.TgZ(22,"li",4),y.TgZ(23,"a",8),y._uU(24),y.ALo(25,"translate"),y.qZA(),y.qZA(),y.TgZ(26,"li",4),y._uU(27,"\u22c5"),y.qZA(),y.qZA(),y.qZA(),y.TgZ(28,"div",9),y.TgZ(29,"ul",10),y.TgZ(30,"li",11),y.TgZ(31,"a",12),y._UZ(32,"i",13),y.qZA(),y.qZA(),y.TgZ(33,"li",11),y.TgZ(34,"a",14),y._UZ(35,"i",15),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.TgZ(36,"div",16),y.TgZ(37,"div",17),y._UZ(38,"img",18),y.qZA(),y.TgZ(39,"div",19),y.TgZ(40,"h3"),y._uU(41),y.ALo(42,"translate"),y.qZA(),y.TgZ(43,"p"),y._uU(44),y.ALo(45,"translate"),y.qZA(),y.qZA(),y.TgZ(46,"div",20),y.TgZ(47,"h3"),y._uU(48),y.ALo(49,"translate"),y.qZA(),y.TgZ(50,"ul",10),y.TgZ(51,"li",21),y._UZ(52,"i",22),y._uU(53),y.ALo(54,"translate"),y.qZA(),y.TgZ(55,"li",23),y._UZ(56,"i",24),y._uU(57),y.ALo(58,"translate"),y.qZA(),y.TgZ(59,"li",25),y._UZ(60,"i",26),y._uU(61),y.ALo(62,"translate"),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.qZA()),2&F&&(y.xp6(6),y.hij(" ",y.lcZ(7,10,"NAV.HOME")," "),y.xp6(6),y.hij(" ",y.lcZ(13,12,"NAV.SELL")," "),y.xp6(6),y.Oqu(y.lcZ(19,14,"NAV.RENT")),y.xp6(6),y.hij(" ",y.lcZ(25,16,"NAV.CONTACT")," "),y.xp6(17),y.Oqu(y.lcZ(42,18,"FOOTER.US")),y.xp6(3),y.hij(" ",y.lcZ(45,20,"FOOTER.US_TEXT")," "),y.xp6(4),y.Oqu(y.lcZ(49,22,"FOOTER.CONTACT.TITLE")),y.xp6(5),y.hij(" ",y.lcZ(54,24,"FOOTER.CONTACT.MAP")," "),y.xp6(4),y.hij(" ",y.lcZ(58,26,"FOOTER.CONTACT.PHONE")," 31292940 "),y.xp6(4),y.hij(" ",y.lcZ(62,28,"FOOTER.CONTACT.MAIL")," contact@samsar.com "))},directives:[Wr.yS],pipes:[fo],styles:[".custom-icon[_ngcontent-%COMP%]{color:#000!important}.custom-icon[_ngcontent-%COMP%]:hover{color:#ff1616!important}"]}),Y})();var an=xe(3679);function Hi(Y,te){if(1&Y&&(y.TgZ(0,"option",9),y._uU(1),y.qZA()),2&Y){const F=te.$implicit;y.Q6J("value",F),y.xp6(1),y.hij("",F," ")}}let Mo=(()=>{class Y{constructor(F,ee){this.renderer=F,this.translate=ee,this.title="Esemsar",ee.addLangs(["ar","fr"]),ee.setDefaultLang("ar"),document.dir="rtl"}ngAfterViewInit(){let F=this.renderer.selectRootElement("#preloader");(0,un.H)(2e3).toPromise().then(()=>{this.renderer.setStyle(F,"display","none")})}translateLanguageTo(F){this.translate.use(F),"fr"===F&&(document.dir="ltr"),"ar"===F&&(document.dir="rtl")}}return Y.\u0275fac=function(F){return new(F||Y)(y.Y36(y.Qsj),y.Y36(Pi))},Y.\u0275cmp=y.Xpm({type:Y,selectors:[["app-root"]],decls:17,vars:7,consts:[[1,"translate-btn"],["id","lang",1,"form-select",3,"change"],["selLang",""],[3,"value",4,"ngFor","ngForOf"],[1,"outlet"],[1,"text-muted","py-5"],[1,"container-fuild","py-5","bg-dark"],[1,"m-2","text-center","text-white","py-2"],["href","https://elhachimie-technology.site/"],[3,"value"]],template:function(F,ee){if(1&F){const Te=y.EpF();y.TgZ(0,"div",0),y.TgZ(1,"select",1,2),y.NdJ("change",function(){y.CHM(Te);const Et=y.MAs(2);return ee.translateLanguageTo(Et.value)}),y.YNc(3,Hi,2,2,"option",3),y.qZA(),y.qZA(),y.TgZ(4,"header"),y._UZ(5,"app-nav"),y.qZA(),y.TgZ(6,"main",4),y._UZ(7,"router-outlet"),y.qZA(),y.TgZ(8,"footer",5),y._UZ(9,"app-footer"),y.qZA(),y.TgZ(10,"div",6),y.TgZ(11,"p",7),y._uU(12),y.ALo(13,"translate"),y.TgZ(14,"a",8),y._uU(15),y.ALo(16,"translate"),y.qZA(),y.qZA(),y.qZA()}2&F&&(y.xp6(3),y.Q6J("ngForOf",ee.translate.getLangs()),y.xp6(9),y.hij(" 2022 \xa9 ",y.lcZ(13,3,"FOOTER.COPY")," "),y.xp6(3),y.hij(" ",y.lcZ(16,5,"FOOTER.LINK")," "))},directives:[$.sg,qo,Wr.lC,gi,an.YN,an.Kr],pipes:[fo],styles:[".translate-btn[_ngcontent-%COMP%]{display:inline-block;position:fixed;z-index:999999;top:0;left:10%}"]}),Y})();class mo{constructor(te,F="/assets/i18n/",ee=".json"){this.http=te,this.prefix=F,this.suffix=ee}getTranslation(te){return this.http.get(`${this.prefix}${te}${this.suffix}`)}}var Hs=xe(1841),Ti=xe(2958),H=xe(2340),ie=xe(1647);function G(Y,te){if(1&Y&&(y.TgZ(0,"div",1),y._UZ(1,"img",2),y.TgZ(2,"div",3),y.TgZ(3,"h4",4),y._uU(4),y.qZA(),y.TgZ(5,"p",5),y._uU(6),y.ALo(7,"currency"),y.qZA(),y.TgZ(8,"div",6),y.TgZ(9,"div",7),y.TgZ(10,"a",8),y._uU(11),y.ALo(12,"translate"),y.qZA(),y.TgZ(13,"a",9),y._uU(14),y.ALo(15,"translate"),y.qZA(),y.qZA(),y.TgZ(16,"small",10),y._uU(17),y.qZA(),y.qZA(),y.qZA(),y.qZA()),2&Y){const F=y.oxw();y.xp6(1),y.Q6J("src",F.property.image,y.LSH),y.xp6(3),y.hij(" ",F.property.name," "),y.xp6(2),y.hij(" ",y.xi3(7,9,F.property.price,"MRU")," "),y.xp6(4),y.Q6J("routerLink","/properties/properties/slug/"+F.property.name),y.xp6(1),y.hij(" ",y.lcZ(12,12,"PRODUCT.SHOW"),""),y.xp6(2),y.Q6J("routerLink","/onmap/"+F.property.name),y.xp6(1),y.hij(" ",y.lcZ(15,14,"PRODUCT.MAP")," "),y.xp6(3),y.AsE("",F.property.mogata.name,", ",F.property.category.name,"")}}let S=(()=>{class Y{constructor(){}ngOnInit(){}}return Y.\u0275fac=function(F){return new(F||Y)},Y.\u0275cmp=y.Xpm({type:Y,selectors:[["app-property"]],inputs:{property:"property"},decls:1,vars:1,consts:[["class","card shadow-sm",4,"ngIf"],[1,"card","shadow-sm"],["alt","samsar home","width","100%",3,"src"],[1,"card-body"],[1,"card-heading"],[1,"card-text"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn-group"],[1,"btn","btn-sm","custom-btn","border",3,"routerLink"],["disabled","",1,"btn","btn-sm","custom-btn","border",3,"routerLink"],[1,"text-muted"]],template:function(F,ee){1&F&&y.YNc(0,G,18,16,"div",0),2&F&&y.Q6J("ngIf",void 0!==ee.property)},directives:[$.O5,Wr.yS],pipes:[$.H9,fo],styles:[""]}),Y})();function k(Y,te){if(1&Y&&(y.ynx(0),y.TgZ(1,"div",4),y._UZ(2,"app-property",5),y.qZA(),y.BQk()),2&Y){const F=te.$implicit;y.xp6(2),y.Q6J("property",F)}}let I=(()=>{class Y{constructor(F,ee){this.propertyService=F,this.route=ee,this.properties=[],this.ft=!1,this.numberOfProps=24,this.rent=!1}ngOnInit(){this.rent=this.route.snapshot.data.rent,this.ft?this._getFeaturedProperties(this.numberOfProps):this._getProperties()}_getFeaturedProperties(F){this.propertyService.getFeaturedProperties(F).subscribe(ee=>{this.properties=ee})}_getProperties(F=[],ee=[],Te=[]){this.propertyService.getProperties(F,ee,Te,[],this.rent).subscribe(it=>{this.properties=it})}}return Y.\u0275fac=function(F){return new(F||Y)(y.Y36(ie.C),y.Y36(Wr.gz))},Y.\u0275cmp=y.Xpm({type:Y,selectors:[["app-properties"]],inputs:{ft:"ft",numberOfProps:"numberOfProps"},decls:4,vars:1,consts:[[1,"album","py-5","bg-light"],[1,"container-fluid","px-3"],[1,"row","row-cols-1","row-cols-sm-2","row-cols-md-3","g-3"],[4,"ngFor","ngForOf"],[1,"col"],[3,"property"]],template:function(F,ee){1&F&&(y.TgZ(0,"div",0),y.TgZ(1,"div",1),y.TgZ(2,"div",2),y.YNc(3,k,3,1,"ng-container",3),y.qZA(),y.qZA(),y.qZA()),2&F&&(y.xp6(3),y.Q6J("ngForOf",ee.properties))},directives:[$.sg,S],styles:[""]}),Y})();function K(Y,te){if(1&Y&&(y.TgZ(0,"div",5),y._UZ(1,"app-property",6),y.qZA()),2&Y){const F=y.oxw();y.xp6(1),y.Q6J("property",F.property)}}function He(Y,te){if(1&Y&&(y.ynx(0),y.TgZ(1,"div",9),y._UZ(2,"img",10),y.qZA(),y.BQk()),2&Y){const F=te.$implicit,ee=y.oxw(3);y.xp6(2),y.Q6J("src",F,y.LSH)("alt",ee.property.name)}}function yt(Y,te){if(1&Y&&(y.ynx(0),y.YNc(1,He,3,2,"ng-container",8),y.BQk()),2&Y){const F=y.oxw(2);y.xp6(1),y.Q6J("ngForOf",F.property.images)}}const Pn=function(){return[]};function pr(Y,te){if(1&Y&&(y.ynx(0),y.TgZ(1,"div",5),y.TgZ(2,"h3"),y._uU(3),y.qZA(),y.TgZ(4,"p"),y._uU(5),y.qZA(),y.TgZ(6,"p"),y._uU(7),y.ALo(8,"currency"),y.qZA(),y.TgZ(9,"small"),y._uU(10),y.qZA(),y._uU(11," , "),y.TgZ(12,"small"),y._uU(13),y.qZA(),y.qZA(),y.TgZ(14,"div",7),y.TgZ(15,"h5"),y._uU(16),y.ALo(17,"translate"),y.qZA(),y.YNc(18,yt,2,1,"ng-container",2),y.qZA(),y.BQk()),2&Y){const F=y.oxw();let ee;y.xp6(3),y.Oqu(F.property.name),y.xp6(2),y.hij(" ",null!==(ee=F.property.description)&&void 0!==ee?ee:""," "),y.xp6(2),y.hij(" ",y.xi3(8,7,F.property.price,"MRU")," "),y.xp6(3),y.Oqu(F.property.mogata.name),y.xp6(3),y.Oqu(F.property.category.name),y.xp6(3),y.hij(" ",y.lcZ(17,10,"PRODUCT.PHOTO")," "),y.xp6(2),y.Q6J("ngIf",F.property.images!=y.DdM(12,Pn))}}let Hn=(()=>{class Y{constructor(F,ee){this.propertiesService=F,this.route=ee,this.mapProperty=this.property,this.canShow=!1}ngOnInit(){this.route.params.subscribe(F=>{F.name&&this._getPropertyByName(F.name)})}_getPropertyByName(F){this.propertiesService.getPropertyByName(F).subscribe(ee=>{this.property=ee[0],this.canShow=!0})}}return Y.\u0275fac=function(F){return new(F||Y)(y.Y36(ie.C),y.Y36(Wr.gz))},Y.\u0275cmp=y.Xpm({type:Y,selectors:[["app-property-detail"]],inputs:{mapProperty:"mapProperty"},decls:5,vars:4,consts:[[1,"container-fluid","row","g-3"],["class","col-md-6",4,"ngIf"],[4,"ngIf"],[1,"col-md-12"],[3,"ft","numberOfProps"],[1,"col-md-6"],[3,"property"],[1,"col-12","row"],[4,"ngFor","ngForOf"],[1,"col-12","col-md-4","col-lg-3"],[1,"figure-img","img-fluid","rounded",2,"width","100%",3,"src","alt"]],template:function(F,ee){1&F&&(y.TgZ(0,"div",0),y.YNc(1,K,2,1,"div",1),y.YNc(2,pr,19,13,"ng-container",2),y.TgZ(3,"div",3),y._UZ(4,"app-properties",4),y.qZA(),y.qZA()),2&F&&(y.xp6(1),y.Q6J("ngIf",void 0!==ee.property),y.xp6(1),y.Q6J("ngIf",void 0!==ee.property),y.xp6(2),y.Q6J("ft",!0)("numberOfProps",2))},directives:[$.O5,I,S,$.sg],pipes:[$.H9,fo],styles:[""]}),Y})(),ar=(()=>{class Y{constructor(F,ee){this.propertiesService=F,this.route=ee,this.canShow=!1,this.detailProperty=this.property,this.style="mapbox://styles/mapbox/streets-v11",this.lat=18.050508691302554,this.lng=-15.963319982003418}ngOnInit(){Ti.accessToken=H.N.mapbox.accessToken,this.map=new Ti.Map({container:"map",style:this.style,zoom:10,center:[this.lng,this.lat]}),this.map.addControl(new Ti.NavigationControl),this.route.params.subscribe(F=>{F.name&&this._getProperty(F.name)})}_getProperty(F){this.propertiesService.getPropertyByName(F).subscribe(ee=>{var Te;let it=(null===(Te=ee[0].location)||void 0===Te?void 0:Te.split(","))||[18,-15],Et=document.createElement("div");Et.style.width="30px",Et.style.height="30px",Et.style.background="url(assets/icons/mapbox-marker-icon-gray.svg)",Et.style.backgroundRepeat="no-repeat",Et.className="marker",Et.addEventListener("click",()=>{window.alert(ee[0].name)}),new Ti.Marker(Et).setLngLat([+it[1],+it[0]]).addTo(this.map),this.property=ee[0]})}}return Y.\u0275fac=function(F){return new(F||Y)(y.Y36(ie.C),y.Y36(Wr.gz))},Y.\u0275cmp=y.Xpm({type:Y,selectors:[["app-maps"]],inputs:{detailProperty:"detailProperty"},decls:3,vars:1,consts:[[2,"width","100%","height","600px"],["id","map",1,"match-parent"],[3,"mapProperty"]],template:function(F,ee){1&F&&(y.TgZ(0,"section",0),y._UZ(1,"div",1),y.qZA(),y._UZ(2,"app-property-detail",2)),2&F&&(y.xp6(2),y.Q6J("mapProperty",ee.property))},directives:[Hn],styles:[".match-parent[_ngcontent-%COMP%]{width:100%;height:100%}.marker[_ngcontent-%COMP%]{position:relative;display:block;border:none;border-radius:50%;cursor:pointer;padding:0}"]}),Y})(),Vr=(()=>{class Y{constructor(F){this.http=F,this.apiURLComments=H.N.apiURL+"comment"}getComments(){return this.http.get(this.apiURLComments)}getSingleComment(F){return this.http.get(`${this.apiURLComments}/${F}`)}createComment(F){return this.http.post(this.apiURLComments,F)}updateComment(F,ee){return this.http.put(`${this.apiURLComments}/${ee}`,F)}deleteComment(F){return this.http.delete(`${this.apiURLComments}/${F}`)}}return Y.\u0275fac=function(F){return new(F||Y)(y.LFG(Hs.eN))},Y.\u0275prov=y.Yz7({token:Y,factory:Y.\u0275fac,providedIn:"root"}),Y})(),Ri=(()=>{class Y{constructor(F,ee,Te){this.formBuilder=F,this.location=ee,this.commentsService=Te,this.isSubmitted=!1,this.editMode=!1,this.commentId=""}ngOnInit(){this.form=this.formBuilder.group({username:["",an.kI.required],email:["",an.kI.required],comment:[""]})}onSubmit(){this.isSubmitted=!0,this.form.invalid||this._createComment({id:this.commentId,username:this.commentForm.username.value,email:this.commentForm.email.value,comment:this.commentForm.comment.value})}_createComment(F){this.commentsService.createComment(F).subscribe(ee=>{this.returnBack()},()=>{})}get commentForm(){return this.form.controls}returnBack(){(0,un.H)(2e3).toPromise().then(()=>{this.location.back()})}}return Y.\u0275fac=function(F){return new(F||Y)(y.Y36(an.qu),y.Y36($.Ye),y.Y36(Vr))},Y.\u0275cmp=y.Xpm({type:Y,selectors:[["app-contact"]],decls:38,vars:16,consts:[[1,"container","py-5","px-3","w-md-50"],[1,"row","px-md-auto","px-1",3,"formGroup"],[1,"col-12","col-md-4"],["for","username",1,"form-label"],[1,"input-group","has-validation"],[1,"input-group-text"],["formControlName","username","type","text","id","username","placeholder","\u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645","required","",1,"form-control"],[1,"invalid-feedback"],["for","email",1,"form-label"],[1,"text-muted"],["formControlName","email","type","email","id","email","placeholder","you@example.com",1,"form-control"],["for","number",1,"form-label"],["formControlName","email","type","number","id","number",1,"form-control"],[1,"col-8"],[1,"input-text"],["formControlName","comment",1,"form-control"],[1,"col-12","py-5","text-center"],["type","submit",1,"btn","btn-dark","px-5",3,"click"]],template:function(F,ee){1&F&&(y.TgZ(0,"div",0),y.TgZ(1,"form",1),y.TgZ(2,"div",2),y.TgZ(3,"label",3),y._uU(4),y.ALo(5,"translate"),y.qZA(),y.TgZ(6,"div",4),y.TgZ(7,"span",5),y._uU(8,"@"),y.qZA(),y._UZ(9,"input",6),y.TgZ(10,"div",7),y._uU(11," \u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645 \u0627\u0644\u062e\u0627\u0635 \u0628\u0643 \u0645\u0637\u0644\u0648\u0628. "),y.qZA(),y.qZA(),y.qZA(),y.TgZ(12,"div",2),y.TgZ(13,"label",8),y._uU(14),y.ALo(15,"translate"),y.TgZ(16,"span",9),y._uU(17,"(\u0627\u062e\u062a\u064a\u0627\u0631\u064a)"),y.qZA(),y.qZA(),y._UZ(18,"input",10),y.TgZ(19,"div",7),y._uU(20," \u064a\u0631\u062c\u0649 \u0625\u062f\u062e\u0627\u0644 \u0639\u0646\u0648\u0627\u0646 \u0628\u0631\u064a\u062f \u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a \u0635\u062d\u064a\u062d \u0644\u062a\u0635\u0644\u0643\u0645 \u062a\u062d\u062f\u064a\u062b\u0627\u062a. "),y.qZA(),y.qZA(),y.TgZ(21,"div",2),y.TgZ(22,"label",11),y._uU(23),y.ALo(24,"translate"),y.qZA(),y._UZ(25,"input",12),y.TgZ(26,"div",7),y._uU(27," \u064a\u0631\u062c\u0649 \u0625\u062f\u062e\u0627\u0644 \u0639\u0646\u0648\u0627\u0646 \u0628\u0631\u064a\u062f \u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a \u0635\u062d\u064a\u062d \u0644\u062a\u0635\u0644\u0643\u0645 \u062a\u062d\u062f\u064a\u062b\u0627\u062a. "),y.qZA(),y.qZA(),y.TgZ(28,"div",13),y.TgZ(29,"p"),y._uU(30),y.ALo(31,"translate"),y.qZA(),y._UZ(32,"span",14),y._UZ(33,"textarea",15),y.qZA(),y.TgZ(34,"div",16),y.TgZ(35,"button",17),y.NdJ("click",function(){return ee.onSubmit()}),y._uU(36),y.ALo(37,"translate"),y.qZA(),y.qZA(),y.qZA(),y.qZA()),2&F&&(y.xp6(1),y.Q6J("formGroup",ee.form),y.xp6(3),y.Oqu(y.lcZ(5,6,"CONTACT_PAGE.USER_NAME")),y.xp6(10),y.hij(" ",y.lcZ(15,8,"CONTACT_PAGE.MAIL")," "),y.xp6(9),y.hij(" ",y.lcZ(24,10,"CONTACT_PAGE.NUMBER"),""),y.xp6(7),y.Oqu(y.lcZ(31,12,"CONTACT_PAGE.COMMENT")),y.xp6(6),y.hij(" ",y.lcZ(37,14,"CONTACT_PAGE.BTN")," "))},directives:[an._Y,an.JL,an.sg,an.Fj,an.JJ,an.u,an.Q7,an.wV],pipes:[fo],styles:[""]}),Y})(),So=(()=>{class Y{constructor(F,ee,Te){this.router=F,this.formBuilder=ee,this.propertiesService=Te,this.properties=[],this.numProperties=6,this.propsParams=""}ngOnInit(){this.form=this.formBuilder.group({username:["",an.kI.required],phone:["",an.kI.required],type:[""],area:[""],details:[""]}),this._getProperties()}_getProperties(){this.propertiesService.getFeaturedProperties(this.numProperties).subscribe(F=>{this.properties=F})}onSubmit(){(0,un.H)(2e3).toPromise().then(()=>{this.router.navigateByUrl(`\n            https://api.whatsapp.com/send?phone=22222312929\n            text=\u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645:${this.requestFrom.username}\n\n            \u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062a\u0641: ${this.requestFrom.phone}\n\n            \u0627\u0644\u0646\u0648\u0639\u064a\u0629: ${this.requestFrom.type}\n\n            \u0627\u0644\u0645\u0633\u0627\u062d\u0627\u062a: ${this.requestFrom.area}\n\n            \u0627\u0644\u062a\u0641\u0627\u0635\u064a\u0644: ${this.requestFrom.detail}\n\n          `)})}get requestFrom(){return this.form.controls}}return Y.\u0275fac=function(F){return new(F||Y)(y.Y36(Wr.F0),y.Y36(an.qu),y.Y36(ie.C))},Y.\u0275cmp=y.Xpm({type:Y,selectors:[["app-home"]],decls:58,vars:28,consts:[[1,"py-2","container"],[1,"row","py-lg-5"],[1,"col-12","col-md-12","mx-2"],[1,"fw-light","w-75","mx-auto","py-2","my-3"],[1,"row","px-1",3,"formGroup","ngSubmit"],[1,"col-12","col-md-4"],["for","username",1,"form-label"],[1,"input-group","has-validation"],[1,"input-group-text"],["formControlName","username","type","text","id","username","placeholder","\u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645","required","",1,"form-control"],[1,"invalid-feedback"],["for","phone",1,"form-label"],["formControlNmae","phone","type","number","id","phonel",1,"form-control"],["for","type",1,"form-label"],["type","text","formControlNmae","type","id","type",1,"form-control"],["for","area",1,"form-label"],["type","number","formControlNmae","area","id","area",1,"form-control"],[1,"col-12"],[1,"input-text"],["formControlNmae","detail",1,"form-control"],[1,"col-12","mx-auto","text-center","my-3"],["type","submit",1,"btn","btn-dark","px-3"],[1,"py-2","text-center","container"],[1,"col-lg-6","col-md-8","mx-auto"],[1,"fw-light"],["routerLink","properties/sell",1,"btn","btn-dark","my-2"],[1,""]],template:function(F,ee){1&F&&(y.TgZ(0,"section"),y._UZ(1,"hero"),y.qZA(),y.TgZ(2,"section",0),y.TgZ(3,"div",1),y.TgZ(4,"div",2),y.TgZ(5,"h3",3),y._uU(6),y.ALo(7,"translate"),y.qZA(),y.TgZ(8,"form",4),y.NdJ("ngSubmit",function(){return ee.onSubmit()}),y.TgZ(9,"div",5),y.TgZ(10,"label",6),y._uU(11),y.ALo(12,"translate"),y.qZA(),y.TgZ(13,"div",7),y.TgZ(14,"span",8),y._uU(15,"@"),y.qZA(),y._UZ(16,"input",9),y.TgZ(17,"div",10),y._uU(18," \u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645 \u0627\u0644\u062e\u0627\u0635 \u0628\u0643 \u0645\u0637\u0644\u0648\u0628. "),y.qZA(),y.qZA(),y.qZA(),y.TgZ(19,"div",5),y.TgZ(20,"label",11),y._uU(21),y.ALo(22,"translate"),y.qZA(),y._UZ(23,"input",12),y.qZA(),y.TgZ(24,"div",5),y.TgZ(25,"label",13),y._uU(26),y.ALo(27,"translate"),y.qZA(),y._UZ(28,"input",14),y.qZA(),y.TgZ(29,"div",5),y.TgZ(30,"label",15),y._uU(31),y.ALo(32,"translate"),y.qZA(),y._UZ(33,"input",16),y.qZA(),y.TgZ(34,"div",17),y.TgZ(35,"span",18),y._uU(36),y.ALo(37,"translate"),y.qZA(),y._UZ(38,"textarea",19),y.qZA(),y.TgZ(39,"div",20),y.TgZ(40,"button",21),y._uU(41),y.ALo(42,"translate"),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.TgZ(43,"section",22),y.TgZ(44,"div",1),y.TgZ(45,"div",23),y.TgZ(46,"h1",24),y._uU(47),y.ALo(48,"translate"),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y._UZ(49,"app-properties"),y.TgZ(50,"section",22),y.TgZ(51,"div",1),y.TgZ(52,"div",23),y.TgZ(53,"p"),y.TgZ(54,"a",25),y._uU(55),y.ALo(56,"translate"),y._UZ(57,"i",26),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.qZA()),2&F&&(y.xp6(6),y.Oqu(y.lcZ(7,10,"HERO.REQ")),y.xp6(2),y.Q6J("formGroup",ee.form),y.xp6(3),y.Oqu(y.lcZ(12,12,"CONTACT_PAGE.USER_NAME")),y.xp6(10),y.hij(" ",y.lcZ(22,14,"HERO.PHONE")," "),y.xp6(5),y.Oqu(y.lcZ(27,16,"HERO.TYPE")),y.xp6(5),y.Oqu(y.lcZ(32,18,"HERO.AREA")),y.xp6(5),y.Oqu(y.lcZ(37,20,"HERO.FEATS")),y.xp6(5),y.hij(" ",y.lcZ(42,22,"CONTACT_PAGE.BTN")," "),y.xp6(6),y.Oqu(y.lcZ(48,24,"HERO.SUB")),y.xp6(8),y.hij(" ",y.lcZ(56,26,"PRODUCT.MORE")," "))},styles:[""]}),Y})();var _i=xe(501);function qs(Y,te){1&Y&&(y.TgZ(0,"div",44),y._uU(1," \u064a\u0631\u062c\u0649 \u0627\u062e\u0627\u0644 \u0627\u0644\u0627\u0633\u0645 "),y.qZA())}function ds(Y,te){1&Y&&(y.TgZ(0,"div",44),y._uU(1," \u064a\u0631\u062c\u0649 \u0627\u062f\u062e\u0627\u0644 \u0627\u0644\u0627\u062d\u062f\u0627\u062b\u064a\u0627\u062a "),y.qZA())}function ts(Y,te){1&Y&&(y.TgZ(0,"div",44),y._uU(1," \u064a\u0631\u062c\u0649 \u0627\u062f\u062e\u0627\u0644 \u0639\u0646\u0648\u0627\u0646 "),y.qZA())}function xr(Y,te){1&Y&&(y.TgZ(0,"div",44),y._uU(1," \u064a\u0631\u062c\u0649 \u0627\u062f\u062e\u0627\u0644 \u0627\u0644\u0633\u0639\u0631 "),y.qZA())}function ps(Y,te){1&Y&&(y.TgZ(0,"div",44),y._uU(1," \u064a\u0631\u062c\u0649 \u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062a\u0641 "),y.qZA())}function Ws(Y,te){if(1&Y&&(y.TgZ(0,"option",45),y._uU(1),y.qZA()),2&Y){const F=te.$implicit;y.Q6J("ngValue",F.id),y.xp6(1),y.hij(" ",F.name," ")}}function Ys(Y,te){1&Y&&(y.TgZ(0,"div",44),y._uU(1," \u064a\u0631\u062c\u0649 \u0627\u062f\u062e\u0627\u0644 \u0646\u0648\u0639\u064a\u0629 \u0627\u0644\u0639\u0642\u0627\u0631 "),y.qZA())}function No(Y,te){if(1&Y&&(y.TgZ(0,"option",45),y._uU(1),y.qZA()),2&Y){const F=te.$implicit;y.Q6J("ngValue",F.id),y.xp6(1),y.hij(" ",F.name," ")}}function Oa(Y,te){1&Y&&(y.TgZ(0,"div",44),y._uU(1," \u064a\u0631\u062c\u0649 \u0627\u062f\u062e\u0627\u0644 \u0627\u0644\u0645\u0642\u0627\u0637\u0639\u0629 "),y.qZA())}function Ca(Y,te){1&Y&&(y.TgZ(0,"div",44),y._uU(1," \u064a\u0631\u062c\u0649 \u0627\u0636\u0627\u0641\u0629 \u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u0645\u0646\u062a\u062c "),y.qZA())}function Sn(Y,te){if(1&Y){const F=y.EpF();y.TgZ(0,"div",21),y.TgZ(1,"label",30),y._uU(2,"\u0623\u0636\u0641 \u0635\u0648\u0631\u0627 \u0627\u062e\u0631\u0649 "),y.qZA(),y.TgZ(3,"input",31),y.NdJ("change",function(Te){return y.CHM(F),y.oxw().imagesUpload(Te)}),y.qZA(),y.qZA()}}const fr=[{path:"",component:So},{path:"home",component:So},{path:"contact",component:Ri},{path:"add",component:(()=>{class Y{constructor(F,ee,Te,it,Et){this.propertiesService=F,this.categoriesService=ee,this.formBuilder=Te,this.location$=it,this.route=Et,this.isSubmitted=!1,this.editMode=!1,this.propertyPramId="",this.message="\u0627\u0644\u0633\u0644\u0627\u0645 \u0639\u0644\u064a\u0643\u0645, \u0627\u0646\u0627 \u0645\u0647\u062a\u0645 \u0628\u0627\u0636\u0627\u0641\u0629 \u0639\u0642\u0627\u0631\u0627\u062a \u0627\u0644\u0649 \u0645\u0648\u0642\u0639\u0643\u0645"}ngOnInit(){this._initForm(),this._getCategoriesAndMogatas()}_initForm(){this.form=this.formBuilder.group({name:["",an.kI.required],price:["",an.kI.required],phone:["",an.kI.required],room:[""],category:["",an.kI.required],mogata:["",an.kI.required],description:[""],location:[""],address:[""],image:["",an.kI.required],isFeatured:[!1],sell:[!0]})}_getCategoriesAndMogatas(){this.categoriesService.getCategories().subscribe(F=>{this.categories=F}),this.categoriesService.getMogatas().subscribe(F=>{this.mogatas=F})}onSubmit(){if(this.isSubmitted=!0,this.form.invalid)return void console.log("invalid forms");const F=new FormData;Object.keys(this.propertyForm).map(ee=>{F.append(ee,this.propertyForm[ee].value)}),this._createUserProperty(F)}onImageUpload(F){var ee;const Te=F.target.files[0];if(Te){this.form.patchValue({image:Te}),null===(ee=this.form.get("image"))||void 0===ee||ee.updateValueAndValidity();const it=new FileReader;it.onload=()=>{this.imageDisplay=it.result},it.readAsDataURL(Te)}}imagesUpload(F){const ee=F.target.files,Te=new FormData;for(let it=0;it<ee.length;it++){const Et=ee[it];console.log(Et),Te.append("images",Et)}this.propertiesService.uploadPropertyImages(Te,this.propertyPramId).subscribe(it=>{})}_createUserProperty(F){this.propertiesService.createUserProperty(F).subscribe(ee=>{this.returnBack()})}returnBack(){(0,un.H)(2e3).toPromise().then(()=>{this.location$.back()})}get propertyForm(){return this.form.controls}}return Y.\u0275fac=function(F){return new(F||Y)(y.Y36(ie.C),y.Y36(_i.G),y.Y36(an.qu),y.Y36($.Ye),y.Y36(Wr.gz))},Y.\u0275cmp=y.Xpm({type:Y,selectors:[["app-services"]],decls:87,vars:27,consts:[[1,"container","m-1","p-md-5"],[1,"row","g-3",3,"formGroup"],[1,"col-md-4"],["for","propertyName",1,"form-label"],["type","text","formControlName","name","id","propertyName",1,"form-control"],["class","alert alert-danger",4,"ngIf"],["for","location",1,"form-label"],["type","text","formControlName","location","id","location",1,"form-control"],["for","address",1,"form-label"],["type","text","formControlName","address","id","address",1,"form-control"],["for","price",1,"form-label"],["type","number","formControlName","price","id","price",1,"form-control"],["for","phone",1,"form-label"],["type","number","formControlName","phone","id","phone",1,"form-control"],["for","room",1,"form-label"],["type","room","formControlName","room","id","room",1,"form-control"],["for","category",1,"form-label"],["id","category","formControlName","category",1,"form-select"],[3,"ngValue",4,"ngFor","ngForOf"],["for","mogata",1,"form-label"],["formControlName","mogata","id","mogata",1,"form-select"],[1,"col-md-12"],[1,"input-group-text"],["formControlName","description",1,"form-control"],[1,"col-8"],["for","image",1,"form-label"],["type","file","name","image","accept","image/*","id","image",1,"form-control",3,"change"],[1,"container"],["width","200","height","200","alt","the main image for the product",1,"img-thumbnail",3,"src"],["class","col-md-12",4,"ngIf"],["for","images",1,"form-label"],["type","file","name","images","accept","image/*","id","images","multiple","",1,"form-control",3,"change"],[1,"col-8","col-md-4"],["type","button",1,"btn","btn-dark",3,"click"],[1,"container","position-relative","my-5","pb-5"],[1,"row","justify-content-center","m-2","m-md-5"],[1,"col-xl-6"],[1,"text-center","text-black","py-5","px-1","px-md-5"],["for","message",1,"btn","btn-dark","text-white","my-3"],["id","message",1,"form-control","outline-success","border-success",3,"ngModel","ngModelChange"],["target","_blank",1,"whatsapp-button",2,"position","absolute","right","15px","bottom","15px",3,"href"],[1,"bi","bi-whatsapp","whatsapp-btn"],["href","tel:22312929","target","_blank",1,"whatsapp-button",2,"position","absolute","left","15px","bottom","15px"],[1,"bi","bi-telephone","whatsapp-btn"],[1,"alert","alert-danger"],[3,"ngValue"]],template:function(F,ee){1&F&&(y.TgZ(0,"div",0),y.TgZ(1,"form",1),y.TgZ(2,"div",2),y.TgZ(3,"label",3),y._uU(4,"\u0627\u0633\u0645 \u0627\u0644\u0639\u0642\u0627\u0631"),y.qZA(),y._UZ(5,"input",4),y.YNc(6,qs,2,0,"div",5),y.qZA(),y.TgZ(7,"div",2),y.TgZ(8,"label",6),y._uU(9,"\u0627\u0644\u0627\u062d\u062f\u0627\u062b\u064a\u0627\u062a"),y.qZA(),y._UZ(10,"input",7),y.YNc(11,ds,2,0,"div",5),y.qZA(),y.TgZ(12,"div",2),y.TgZ(13,"label",8),y._uU(14,"\u0639\u0646\u0648\u0646 \u0627\u0644\u0639\u0642\u0627\u0631 "),y.qZA(),y._UZ(15,"input",9),y.YNc(16,ts,2,0,"div",5),y.qZA(),y.TgZ(17,"div",2),y.TgZ(18,"label",10),y._uU(19,"\u0627\u0644\u0633\u0639\u0631 "),y.qZA(),y._UZ(20,"input",11),y.YNc(21,xr,2,0,"div",5),y.qZA(),y.TgZ(22,"div",2),y.TgZ(23,"label",12),y._uU(24,"\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062a\u0641 "),y.qZA(),y._UZ(25,"input",13),y.YNc(26,ps,2,0,"div",5),y.qZA(),y.TgZ(27,"div",2),y.TgZ(28,"label",14),y._uU(29,"\u0639\u062f\u062f \u0627\u0644\u063a\u0631\u0641"),y.qZA(),y._UZ(30,"input",15),y.qZA(),y.TgZ(31,"div",2),y.TgZ(32,"label",16),y._uU(33,"\u0646\u0648\u0639\u064a\u0629 \u0627\u0644\u0639\u0642\u0627\u0631"),y.qZA(),y.TgZ(34,"select",17),y.YNc(35,Ws,2,2,"option",18),y.qZA(),y.YNc(36,Ys,2,0,"div",5),y.qZA(),y.TgZ(37,"div",2),y.TgZ(38,"label",19),y._uU(39,"\u0627\u0644\u0645\u0642\u0627\u0637\u0639\u0629 "),y.qZA(),y.TgZ(40,"select",20),y.YNc(41,No,2,2,"option",18),y.qZA(),y.YNc(42,Oa,2,0,"div",5),y.qZA(),y.TgZ(43,"div",21),y.TgZ(44,"h5"),y._uU(45,"\u0627\u0636\u0641 \u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u0639\u0642\u0627\u0631 \u0647\u0646\u0627"),y.qZA(),y._UZ(46,"span",22),y._UZ(47,"textarea",23),y.qZA(),y.TgZ(48,"div",24),y.TgZ(49,"label",25),y._uU(50," \u0627\u0644\u0635\u0648\u0631\u0629 \u0627\u0644\u0631\u0626\u064a\u0633\u064a\u0629"),y.qZA(),y.TgZ(51,"input",26),y.NdJ("change",function(it){return ee.onImageUpload(it)}),y.qZA(),y.YNc(52,Ca,2,0,"div",5),y.TgZ(53,"div",27),y._UZ(54,"img",28),y.qZA(),y.qZA(),y.YNc(55,Sn,4,0,"div",29),y.TgZ(56,"div",21),y.TgZ(57,"label",30),y._uU(58,"\u0623\u0636\u0641 \u0635\u0648\u0631\u0627 \u0627\u062e\u0631\u0649 "),y.qZA(),y.TgZ(59,"input",31),y.NdJ("change",function(it){return ee.imagesUpload(it)}),y.qZA(),y.qZA(),y.TgZ(60,"div",32),y.TgZ(61,"button",33),y.NdJ("click",function(){return ee.onSubmit()}),y._uU(62," \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0639\u0642\u0627\u0631 "),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.TgZ(63,"div",34),y.TgZ(64,"div",35),y.TgZ(65,"div",36),y.TgZ(66,"div",37),y.TgZ(67,"h2"),y._uU(68),y.ALo(69,"translate"),y.qZA(),y.TgZ(70,"h3"),y._uU(71),y.ALo(72,"translate"),y.qZA(),y._UZ(73,"br"),y.TgZ(74,"h5"),y._uU(75),y.ALo(76,"translate"),y.qZA(),y._UZ(77,"br"),y._UZ(78,"br"),y.TgZ(79,"label",38),y._uU(80),y.ALo(81,"translate"),y.qZA(),y.TgZ(82,"textarea",39),y.NdJ("ngModelChange",function(it){return ee.message=it}),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.TgZ(83,"a",40),y._UZ(84,"i",41),y.qZA(),y.TgZ(85,"a",42),y._UZ(86,"i",43),y.qZA(),y.qZA()),2&F&&(y.xp6(1),y.Q6J("formGroup",ee.form),y.xp6(5),y.Q6J("ngIf",ee.propertyForm.name.invalid&&ee.isSubmitted),y.xp6(5),y.Q6J("ngIf",ee.propertyForm.location.invalid&&ee.isSubmitted),y.xp6(5),y.Q6J("ngIf",ee.propertyForm.address.invalid&&ee.isSubmitted),y.xp6(5),y.Q6J("ngIf",ee.propertyForm.price.invalid&&ee.isSubmitted),y.xp6(5),y.Q6J("ngIf",ee.propertyForm.phone.invalid&&ee.isSubmitted),y.xp6(9),y.Q6J("ngForOf",ee.categories),y.xp6(1),y.Q6J("ngIf",ee.propertyForm.category.invalid&&ee.isSubmitted),y.xp6(5),y.Q6J("ngForOf",ee.mogatas),y.xp6(1),y.Q6J("ngIf",ee.propertyForm.mogata.invalid&&ee.isSubmitted),y.xp6(10),y.Q6J("ngIf",ee.propertyForm.image.invalid&&ee.isSubmitted),y.xp6(2),y.Q6J("src",ee.imageDisplay,y.LSH),y.xp6(1),y.Q6J("ngIf",ee.editMode),y.xp6(13),y.hij(" ",y.lcZ(69,19,"ADD.HEAD")," "),y.xp6(3),y.hij(" ",y.lcZ(72,21,"ADD.SUB")," "),y.xp6(4),y.hij(" ",y.lcZ(76,23,"ADD.TEXT")," "),y.xp6(5),y.hij(" ",y.lcZ(81,25,"ADD.BUTTON")," "),y.xp6(2),y.Q6J("ngModel",ee.message),y.xp6(1),y.Q6J("href","https://api.whatsapp.com/send?phone=22222312929text="+ee.message,y.LSH))},directives:[an._Y,an.JL,an.sg,an.Fj,an.JJ,an.u,$.O5,an.wV,an.EJ,$.sg,an.On,an.YN,an.Kr],pipes:[fo],styles:[".whatsapp-btn[_ngcontent-%COMP%]{font-size:2.25rem;color:green}"]}),Y})()},{path:"onmap/:name",component:ar},{path:"admin",loadChildren:()=>xe.e(630).then(xe.bind(xe,6630)).then(Y=>Y.AdminModule)}];let Fa=(()=>{class Y{}return Y.\u0275fac=function(F){return new(F||Y)},Y.\u0275mod=y.oAB({type:Y}),Y.\u0275inj=y.cJS({imports:[[Wr.Bz.forRoot(fr)],Wr.Bz]}),Y})();function Il(Y,te){if(1&Y&&(y.ynx(0),y.TgZ(1,"div",4),y._UZ(2,"app-property",5),y.qZA(),y.BQk()),2&Y){const F=te.$implicit;y.xp6(2),y.Q6J("property",F)}}let fs=(()=>{class Y{constructor(F,ee){this.propertyService=F,this.route=ee,this.properties=[],this.mogataPage=!1,this.wilayaPage=!1,this.rent=!1,this.mogatas=[],this.cats=[],this.price=[]}ngOnInit(){""!==this.route.snapshot.queryParamMap.get("mogata")&&(this.mogatas=this.route.snapshot.queryParamMap.get("mogata").split(",")),""!==this.route.snapshot.queryParamMap.get("category")&&(this.cats=this.route.snapshot.queryParamMap.get("category").split(",")),this.route.snapshot.queryParamMap.has("price")&&(this.price=this.route.snapshot.queryParamMap.get("price").split(",")),this._getSearchResult(this.cats,this.mogatas,this.price)}_getSearchResult(F,ee,Te){this.propertyService.getProperties(F,ee,Te).subscribe(it=>{this.properties=it})}}return Y.\u0275fac=function(F){return new(F||Y)(y.Y36(ie.C),y.Y36(Wr.gz))},Y.\u0275cmp=y.Xpm({type:Y,selectors:[["app-search-result"]],decls:6,vars:1,consts:[[1,"album","py-5","bg-light"],[1,"container"],[1,"row","row-cols-1","row-cols-sm-2","row-cols-md-3","g-3"],[4,"ngFor","ngForOf"],[1,"col"],[3,"property"]],template:function(F,ee){1&F&&(y.TgZ(0,"div",0),y.TgZ(1,"div",1),y.TgZ(2,"h3"),y._uU(3,"\u0646\u062a\u0627\u0626\u062c \u0627\u0644\u0628\u062d\u062b "),y.qZA(),y.TgZ(4,"div",2),y.YNc(5,Il,3,1,"ng-container",3),y.qZA(),y.qZA(),y.qZA()),2&F&&(y.xp6(5),y.Q6J("ngForOf",ee.properties))},directives:[$.sg,S],styles:[""]}),Y})();const ca=[{path:"properties",component:(()=>{class Y{constructor(F){this.propertiesService=F}ngOnInit(){this.getProperties()}getProperties(){this.propertiesService.getProperties().subscribe(F=>{this.properties=F})}}return Y.\u0275fac=function(F){return new(F||Y)(y.Y36(ie.C))},Y.\u0275cmp=y.Xpm({type:Y,selectors:[["app-properties-page"]],decls:7,vars:2,consts:[[1,"container"],[1,"container-fluid","text-center","bg-light"],[3,"ft","numberOfProps"]],template:function(F,ee){1&F&&(y.TgZ(0,"section",0),y._UZ(1,"router-outlet"),y.qZA(),y._UZ(2,"br"),y.TgZ(3,"div",1),y.TgZ(4,"h3"),y._uU(5,"\u0627\u0644\u0639\u0642\u0627\u0631\u0627\u062a \u0627\u0644\u0645\u0645\u064a\u0632\u0629 "),y.qZA(),y._UZ(6,"app-properties",2),y.qZA()),2&F&&(y.xp6(6),y.Q6J("ft",!0)("numberOfProps",6))},directives:[Wr.lC,I],styles:[""]}),Y})(),children:[{path:"sell",component:I},{path:"rent",component:I,data:{rent:!0}},{path:"properties/:id",component:Hn},{path:"properties/slug/:name",component:Hn},{path:"mogata/sell/:mogata",component:I},{path:"mogata/rent/:mogata",component:I,data:{rent:!0}},{path:"wilaya/sell/:wilaya",component:I},{path:"wilaya/rent/:wilaya",component:I,data:{rent:!0}},{path:"category/sell/:category",component:I},{path:"category/rent/:category",component:I,data:{rent:!0}},{path:"search",component:fs},{path:"search/rent",component:fs,data:{rent:!0}}]}];let Mt=(()=>{class Y{}return Y.\u0275fac=function(F){return new(F||Y)},Y.\u0275mod=y.oAB({type:Y}),Y.\u0275inj=y.cJS({imports:[[Wr.Bz.forChild(ca),$.ez],Wr.Bz]}),Y})();function br(Y){return new mo(Y)}let Jl=(()=>{class Y{}return Y.\u0275fac=function(F){return new(F||Y)},Y.\u0275mod=y.oAB({type:Y}),Y.\u0275inj=y.cJS({providers:[ie.C],imports:[[$.ez,Mt,Hs.JF,an.u5,an.UX,Ar.forRoot({loader:{provide:ho,useFactory:br,deps:[Hs.eN]}})]]}),Y})();var yi=xe(9467);function La(Y,te){if(1&Y&&(y.ynx(0),y.TgZ(1,"p"),y.TgZ(2,"a",22),y._uU(3),y.qZA(),y.qZA(),y.BQk()),2&Y){const F=te.$implicit;y.xp6(2),y.s9C("routerLink","/properties/"+F.type+"/rent/"+F.id),y.xp6(1),y.Oqu(F.name)}}function Xs(Y,te){if(1&Y&&(y.ynx(0),y.TgZ(1,"div",20),y.YNc(2,La,4,2,"ng-container",21),y.qZA(),y.BQk()),2&Y){const F=y.oxw();y.xp6(2),y.Q6J("ngForOf",F.resultList)}}function go(Y,te){if(1&Y&&(y.ynx(0),y.TgZ(1,"p"),y.TgZ(2,"a",22),y._uU(3),y.qZA(),y.qZA(),y.BQk()),2&Y){const F=te.$implicit;y.xp6(2),y.s9C("routerLink","/properties/"+F.type+"/sell/"+F.id),y.xp6(1),y.Oqu(F.name)}}function nl(Y,te){if(1&Y&&(y.ynx(0),y.TgZ(1,"div",20),y.YNc(2,go,4,2,"ng-container",21),y.qZA(),y.BQk()),2&Y){const F=y.oxw();y.xp6(2),y.Q6J("ngForOf",F.resultList)}}function Na(Y,te){if(1&Y&&(y.TgZ(0,"option",23),y._uU(1),y.qZA()),2&Y){const F=te.$implicit;y.Q6J("value",F.id),y.xp6(1),y.Oqu(F.name)}}let Rl=(()=>{class Y{constructor(F,ee,Te,it){this.formBuilder=F,this.router=ee,this.categoriesService=Te,this.locationsService=it,this.mekaneList=[],this.rent=!1,this.categories=[],this.searchResult=!1,this.resultList=[],this.searchType=""}ngOnInit(){this.form=this.formBuilder.group({location:[""],category:[""],maxprice:[""],minprice:[""],numberrooms:[""]}),this._getLocations(),this.getCategories()}search(F){this.resultList=[],this.searchResult=!0,this.mekaneList.forEach(ee=>{ee.name.includes(F)&&this.resultList.push(ee)}),(""===F||this.resultList===[])&&(this.resultList=[],this.searchResult=!1)}hideList(){(0,un.H)(500).toPromise().then(()=>{this.searchResult=!1})}_getLocations(){this.categoriesService.getMogatas().subscribe(F=>{F.forEach(ee=>{this.mekaneList.push({name:ee.name,id:ee.id,type:"mogata"})})}),this.locationsService.getWilayas().subscribe(F=>{F.forEach(ee=>{this.mekaneList.push({name:ee.name,id:ee.id,type:"wilaya"})})})}getCategories(){this.categoriesService.getCategories().subscribe(F=>{this.categories=F})}onSubmit(){let F="";this.searchType=this.rent?"rent":"",this.resultList.forEach(ee=>{this.resultList.length<2?F+=ee.id:F=F+ee.id+","}),this.router.navigate([`properties/search/${this.searchType}`],{queryParams:{mogata:F,category:this.searchForm.category.value,price:this.searchForm.minprice.value+","+this.searchForm.maxprice.value,numberOfRooms:this.searchForm.numberrooms.value}}),console.log({mogata:F,category:this.searchForm.category.value,price:this.searchForm.minprice.value+","+this.searchForm.maxprice.value,numberOfRooms:this.searchForm.numberrooms.value})}get searchForm(){return this.form.controls}}return Y.\u0275fac=function(F){return new(F||Y)(y.Y36(an.qu),y.Y36(Wr.F0),y.Y36(_i.G),y.Y36(yi._))},Y.\u0275cmp=y.Xpm({type:Y,selectors:[["home-search"]],inputs:{rent:"rent"},decls:34,vars:22,consts:[[1,"accordion-item","py-3","px-2","realative"],[3,"formGroup"],[1,"d-flex","px-2","py-2"],["formControlName","location","type","text","autocomplete","off",1,"form-control","me-2",3,"placeholder","input","focus","blur"],["type","button",1,"btn","btn-dark","text-white","px-4",3,"click"],[4,"ngIf"],[1,"accordion-collapse","show","transition-custom"],[1,"container-fluid"],[1,"mb-3"],[1,"row"],[1,"col-12","col-md-4"],["for","category",1,"form-label"],["formControlName","category","id","category",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],["for","numberOfRooms",1,"form-label"],["formControlName","numberrooms","id","numberOfRooms","type","number",1,"form-control"],["for","price",1,"form-label"],["formControlName","minprice","id","minPrice","type","number",1,"form-control"],["for","maxPrice",1,"form-label"],["formControlName","maxprice","id","maxPrice","type","number",1,"form-control"],[1,"search-list","bg-light","bg-gradient"],[4,"ngFor","ngForOf"],[3,"routerLink"],[3,"value"]],template:function(F,ee){1&F&&(y.TgZ(0,"div",0),y.TgZ(1,"form",1),y.TgZ(2,"div",2),y.TgZ(3,"input",3),y.NdJ("input",function(){return ee.search(ee.searchForm.location.value)})("focus",function(){return ee.search(ee.searchForm.location.value)})("blur",function(){return ee.hideList()}),y.ALo(4,"translate"),y.qZA(),y.TgZ(5,"button",4),y.NdJ("click",function(){return ee.onSubmit()}),y._uU(6),y.ALo(7,"translate"),y.qZA(),y.qZA(),y.YNc(8,Xs,3,1,"ng-container",5),y.YNc(9,nl,3,1,"ng-container",5),y.TgZ(10,"div",6),y.TgZ(11,"div",7),y.TgZ(12,"div",8),y.TgZ(13,"div",9),y.TgZ(14,"div",10),y.TgZ(15,"label",11),y._uU(16),y.ALo(17,"translate"),y.qZA(),y.TgZ(18,"select",12),y.YNc(19,Na,2,2,"option",13),y.qZA(),y.qZA(),y.TgZ(20,"div",10),y.TgZ(21,"label",14),y._uU(22),y.ALo(23,"translate"),y.qZA(),y._UZ(24,"input",15),y.qZA(),y.TgZ(25,"div",10),y.TgZ(26,"label",16),y._uU(27),y.ALo(28,"translate"),y.qZA(),y._UZ(29,"input",17),y.TgZ(30,"label",18),y._uU(31),y.ALo(32,"translate"),y.qZA(),y._UZ(33,"input",19),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.qZA()),2&F&&(y.xp6(1),y.Q6J("formGroup",ee.form),y.xp6(2),y.Q6J("placeholder",y.lcZ(4,10,"SEARCH.PLACEHOLDER")),y.xp6(3),y.hij(" ",y.lcZ(7,12,"SEARCH.BUTTON")," "),y.xp6(2),y.Q6J("ngIf",ee.searchResult&&ee.rent),y.xp6(1),y.Q6J("ngIf",ee.searchResult&&!ee.rent),y.xp6(7),y.hij(" ",y.lcZ(17,14,"SEARCH.CAT")," "),y.xp6(3),y.Q6J("ngForOf",ee.categories),y.xp6(3),y.hij(" ",y.lcZ(23,16,"SEARCH.ROOM")," "),y.xp6(5),y.hij(" ",y.lcZ(28,18,"SEARCH.MIN")," "),y.xp6(4),y.hij(" ",y.lcZ(32,20,"SEARCH.MAX")," "))},directives:[an._Y,an.JL,an.sg,an.Fj,an.JJ,an.u,$.O5,an.EJ,$.sg,an.wV,Wr.yS,an.YN,an.Kr],pipes:[fo],styles:['.search-list[_ngcontent-%COMP%]{position:absolute;margin-right:8px;top:60px;width:66%;z-index:55;padding:8px}.custom-opacity[_ngcontent-%COMP%]{background-color:#fcfbfbe6}#form-wrapper[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center}.form-div[_ngcontent-%COMP%]{width:90%;max-width:500px}.form-div[_ngcontent-%COMP%]   #form-title[_ngcontent-%COMP%]{margin-top:0;font-weight:400;text-align:center}.form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-content:stretch;position:relative;width:100%;height:50px;-webkit-user-select:none;user-select:none}.form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]:before{content:" ";position:absolute;height:2px;width:100%;width:calc(100% * (4 / 5));top:50%;left:50%;transform:translate(-50%,-50%);background:#000}.form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{box-sizing:border-box;flex:1;-webkit-user-select:none;user-select:none;cursor:pointer}.form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:inline-block;position:relative;width:20%;height:100%;-webkit-user-select:none;user-select:none}.form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{content:attr(for);position:absolute;left:50%;padding-top:10px;transform:translate(-50%,45px);font-size:14px;letter-spacing:.4px;font-weight:400;white-space:nowrap;opacity:.85;transition:all .15s ease-in-out}.form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{content:" ";position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:30px;height:30px;border:2px solid #000;background:#fff;border-radius:50%;pointer-events:none;-webkit-user-select:none;user-select:none;z-index:1;cursor:pointer;transition:all .15s ease-in-out}.form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:hover:after{transform:translate(-50%,-50%) scale(1.25)}.form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:before{font-weight:800;opacity:1}.form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{border-width:4px;transform:translate(-50%,-50%) scale(.75)}.form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ #debt-amount-pos[_ngcontent-%COMP%]{opacity:1}.form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked:nth-child(1) ~ #debt-amount-pos[_ngcontent-%COMP%]{left:10%}.form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked:nth-child(3) ~ #debt-amount-pos[_ngcontent-%COMP%]{left:30%}.form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked:nth-child(5) ~ #debt-amount-pos[_ngcontent-%COMP%]{left:50%}.form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked:nth-child(7) ~ #debt-amount-pos[_ngcontent-%COMP%]{left:70%}.form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked:nth-child(9) ~ #debt-amount-pos[_ngcontent-%COMP%]{left:90%}.form-div[_ngcontent-%COMP%]   #debt-amount-slider[_ngcontent-%COMP%]   #debt-amount-pos[_ngcontent-%COMP%]{display:block;position:absolute;top:50%;width:12px;height:12px;background:#000;border-radius:50%;transition:all .15s ease-in-out;transform:translate(-50%,-50%);border:2px solid #fff;opacity:0;z-index:2}.form-div[_ngcontent-%COMP%]:valid   #debt-amount-slider[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] + label[_ngcontent-%COMP%]:before{transform:translate(-50%,45px) scale(.9);transition:all .15s linear}.form-div[_ngcontent-%COMP%]:valid   #debt-amount-slider[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:before{transform:translate(-50%,45px) scale(1.1);transition:all .15s linear}.form-div[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{display:block;position:relative;margin:56px auto 0;padding:10px 20px;-webkit-appearance:none;-moz-appearance:none;appearance:none;transition:all .15s ease-in-out;font-family:inherit;font-size:24px;font-weight:600;background:#fff;border:2px solid #000;border-radius:8px;outline:0;-webkit-user-select:none;user-select:none;cursor:pointer}.form-div[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]:hover{background:#000;color:#fff}.form-div[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]:hover:active{transform:scale(.9)}.form-div[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]:focus{background:#4caf50;border-color:#4caf50;color:#fff;pointer-events:none}.form-div[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]:focus:before{animation:spin 1s linear infinite}.form-div[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]:before{display:inline-block;width:0;opacity:0;content:"\\f3f4";font-family:"Font Awesome 5 Pro";font-weight:900;margin-right:0;transform:rotate(0)}.form-div[_ngcontent-%COMP%]:invalid + button[_ngcontent-%COMP%]{pointer-events:none;opacity:.25}@keyframes spin{0%{transform:rotate(0);width:24px;opacity:1;margin-right:12px}to{transform:rotate(360deg);width:24px;opacity:1;margin-right:12px}}']}),Y})(),za=(()=>{class Y{constructor(){this.mekaneList=[{name:"\u0627\u0644\u0631\u064a\u0627\u0636",id:"",type:"mogata"},{name:"\u0639\u0631\u0641\u0627\u062a",id:"",type:"mogata"},{name:"\u062a\u0648\u062c\u0646\u064a\u0646",id:"",type:"mogata"},{name:"\u062a\u0641\u0631\u063a \u0632\u064a\u0646\u0647",id:"",type:"mogata"},{name:"\u062a\u064a\u0627\u0631\u062a",id:"",type:"mogata"},{name:"\u062f\u0627\u0631 \u0627\u0644\u0646\u0639\u064a\u0645",id:"",type:"mogata"},{name:"\u0645\u0644\u062d",id:"",type:"mogata"},{name:"\u0628\u064a\u0643\u0647",id:"",type:"mogata"},{name:"\u0627\u0644\u0645\u064a\u0646\u0627\u0621",id:"",type:"mogata"},{name:"\u0627\u0644\u0633\u0628\u062e\u0629",id:"",type:"mogata"},{name:"\u0627\u0646\u0648\u0627\u0630\u064a\u0628\u0648",id:"",type:"mogata"},{name:"\u0646\u0648\u0627\u0643\u0634\u0648\u0637",id:"",type:"mogata"}],this.categories=[],this.rent=!1}ngOnInit(){}selectTypeSearch(){this.rent=!this.rent}}return Y.\u0275fac=function(F){return new(F||Y)},Y.\u0275cmp=y.Xpm({type:Y,selectors:[["hero"]],decls:17,vars:12,consts:[[1,"container-fluid","picture"],[1,"container-fluid","hero-search"],[1,"hero-heading"],[1,"container","px-2","bg-clear","p-1","m-2"],[1,"d-flex","justify-content-around","px-3","py-2"],[1,"d-flex","custom-opacity-hero","rounded"],["type","button",1,"btn","mx-3","my-2","px-3","px-md-4","transition-custom",3,"ngClass","click"],["type","button",1,"btn","px-3","px-md-4","mx-3","my-2","transition-custom",3,"ngClass","click"],[1,"hero","rounded"],[1,"realative",3,"rent"],["src","assets/samsar/hero3.jpg","alt","\u0635\u0648\u0631\u0629 \u0645\u0646 \u0645\u062f\u064a\u0646\u0629 \u0646\u0648\u0627\u0643\u0634\u0648\u0637"]],template:function(F,ee){1&F&&(y.TgZ(0,"div",0),y.TgZ(1,"div",1),y.TgZ(2,"h1",2),y._uU(3),y.ALo(4,"translate"),y.qZA(),y.TgZ(5,"div",3),y.TgZ(6,"div",4),y.TgZ(7,"div",5),y.TgZ(8,"button",6),y.NdJ("click",function(){return ee.selectTypeSearch()}),y._uU(9),y.ALo(10,"translate"),y.qZA(),y.TgZ(11,"button",7),y.NdJ("click",function(){return ee.selectTypeSearch()}),y._uU(12),y.ALo(13,"translate"),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.TgZ(14,"div",8),y._UZ(15,"home-search",9),y.qZA(),y.qZA(),y._UZ(16,"img",10),y.qZA()),2&F&&(y.xp6(3),y.hij(" ",y.lcZ(4,6,"HERO.HEADING")," "),y.xp6(5),y.Q6J("ngClass",ee.rent?"btn-clear text-black ":"btn-dark text-white"),y.xp6(1),y.hij(" ",y.lcZ(10,8,"HERO.BTN_LOUER")," "),y.xp6(2),y.Q6J("ngClass",ee.rent?"btn-dark text-white":"btn-clear text-black "),y.xp6(1),y.hij(" ",y.lcZ(13,10,"HERO.BTN_VENT")," "),y.xp6(3),y.Q6J("rent",ee.rent))},directives:[$.mk,Rl],pipes:[fo],styles:[".picture[_ngcontent-%COMP%]{height:auto;width:calc(100% - 3.2rem);margin:0 1.6rem;position:relative}.picture[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;max-height:59.9rem;border-radius:1rem;object-fit:cover}.hero-search[_ngcontent-%COMP%]{position:absolute;top:20%;right:15%;width:70%}.custom-opacity-hero[_ngcontent-%COMP%]{background-color:#fcfbfbe6}.hero-heading[_ngcontent-%COMP%]{color:#fff;margin:0;padding:0 1rem 8px;text-shadow:-.2rem .2rem 0 rgb(0 0 0 / 25%);font-size:3.01rem;text-align:center;font-weight:600;letter-spacing:normal;line-height:2.5rem;font-family:DroidArabicKufi,Helvetica,sans-serif}@media only screen and (max-width: 600px){.picture[_ngcontent-%COMP%]{height:700px;width:calc(100% - 16px);margin:10px 8px}.hero-heading[_ngcontent-%COMP%]{font-size:2.5rem}.hero-search[_ngcontent-%COMP%]{top:10%;right:8px;width:calc(100% - 16px)}}"]}),Y})();function Ks(Y){return new mo(Y)}let Js=(()=>{class Y{}return Y.\u0275fac=function(F){return new(F||Y)},Y.\u0275mod=y.oAB({type:Y,bootstrap:[Mo]}),Y.\u0275inj=y.cJS({providers:[],imports:[[Ie,Fa,an.u5,an.UX,Jl,Hs.JF,Ar.forRoot({loader:{provide:ho,useFactory:Ks,deps:[Hs.eN]}})]]}),Y})();y.B6R(So,[za,an._Y,an.JL,an.sg,an.Fj,an.JJ,an.u,an.Q7,I,Wr.yS],[fo]),H.N.production&&(0,y.G48)(),pe().bootstrapModule(Js).catch(Y=>console.error(Y))}},Cn=>{Cn(Cn.s=5383)}]);